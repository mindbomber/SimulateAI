<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RadarChart Enterprise Constants Fix Test</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .test-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
        border-left: 4px solid #007bff;
      }
      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 4px;
        font-weight: 500;
        font-size: 12px;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
      }
      .status.warning {
        background: #fff3cd;
        color: #856404;
      }
      .chart-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      #hero-ethics-chart {
        width: 100%;
        height: 400px;
        position: relative;
      }
      .controls {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        flex-wrap: wrap;
      }
      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-primary:hover {
        background: #0056b3;
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
      .btn-secondary:hover {
        background: #545b62;
      }
      .btn-success {
        background: #28a745;
        color: white;
      }
      .btn-success:hover {
        background: #1e7e34;
      }
      .btn-danger {
        background: #dc3545;
        color: white;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .console-monitor {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 15px;
        border-radius: 6px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        margin: 20px 0;
        border: 1px solid #444;
      }
      .error-log {
        color: #f85149;
      }
      .warn-log {
        color: #d29922;
      }
      .info-log {
        color: #79c0ff;
      }
      .success-log {
        color: #56d364;
      }
      .log-entry {
        margin: 2px 0;
        padding: 2px 0;
        border-bottom: 1px solid #333;
      }
      .log-entry:last-child {
        border-bottom: none;
      }
      .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .metric-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
        border: 1px solid #dee2e6;
      }
      .metric-value {
        font-size: 2em;
        font-weight: bold;
        color: #007bff;
        margin-bottom: 5px;
      }
      .metric-label {
        color: #6c757d;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîß RadarChart Enterprise Constants Fix Test</h1>
        <p>
          Testing defensive programming fixes for ENTERPRISE_CONSTANTS undefined
          errors
        </p>
      </div>

      <div class="test-section">
        <h3>üß™ Test Status</h3>
        <div id="testStatus">
          <span class="status warning">TESTING...</span>
          <span id="statusText"
            >Initializing RadarChart with various error conditions...</span
          >
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-primary" onclick="testNormalInitialization()">
          ‚úÖ Test Normal Init
        </button>
        <button class="btn btn-warning" onclick="testMissingConstants()">
          ‚ö†Ô∏è Test Missing Constants
        </button>
        <button class="btn btn-danger" onclick="testCorruptedConstants()">
          üí• Test Corrupted Constants
        </button>
        <button class="btn btn-secondary" onclick="testErrorHandling()">
          üîç Test Error Handling
        </button>
        <button class="btn btn-success" onclick="clearConsoleMonitor()">
          üßπ Clear Console
        </button>
      </div>

      <div class="metrics">
        <div class="metric-card">
          <div class="metric-value" id="errorCount">0</div>
          <div class="metric-label">Console Errors</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="warningCount">0</div>
          <div class="metric-label">Warnings</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="successCount">0</div>
          <div class="metric-label">Successful Operations</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="radarInstances">0</div>
          <div class="metric-label">RadarChart Instances</div>
        </div>
      </div>

      <div class="chart-container">
        <h3>üìä RadarChart Test Instance</h3>
        <div id="hero-ethics-chart"></div>
      </div>

      <div class="console-monitor" id="consoleMonitor">
        <div class="log-entry success-log">
          üü¢ Console Monitor Active - Real-time error tracking
        </div>
        <div class="log-entry info-log">
          ‚ÑπÔ∏è Watching for RadarChart ENTERPRISE_CONSTANTS errors...
        </div>
      </div>
    </div>

    <!-- Load dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="src/js/utils/logger.js"></script>
    <script src="src/js/config/app-config.js"></script>
    <script src="src/js/components/radar-chart.js"></script>

    <script>
      // Test tracking variables
      let errorCount = 0;
      let warningCount = 0;
      let successCount = 0;
      let radarInstances = 0;

      // Console monitoring setup
      const originalConsoleError = console.error;
      const originalConsoleWarn = console.warn;
      const originalConsoleLog = console.log;

      function updateMetrics() {
        document.getElementById("errorCount").textContent = errorCount;
        document.getElementById("warningCount").textContent = warningCount;
        document.getElementById("successCount").textContent = successCount;
        document.getElementById("radarInstances").textContent = radarInstances;
      }

      function addLogEntry(type, message) {
        const monitor = document.getElementById("consoleMonitor");
        const entry = document.createElement("div");
        entry.className = `log-entry ${type}-log`;
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        monitor.appendChild(entry);
        monitor.scrollTop = monitor.scrollHeight;
      }

      // Override console methods to track errors
      console.error = function (...args) {
        originalConsoleError.apply(console, args);
        errorCount++;
        updateMetrics();
        addLogEntry("error", `ERROR: ${args.join(" ")}`);
      };

      console.warn = function (...args) {
        originalConsoleWarn.apply(console, args);
        warningCount++;
        updateMetrics();
        addLogEntry("warn", `WARN: ${args.join(" ")}`);
      };

      console.log = function (...args) {
        originalConsoleLog.apply(console, args);
        if (
          args[0] &&
          args[0].includes &&
          (args[0].includes("SUCCESS") || args[0].includes("‚úÖ"))
        ) {
          successCount++;
          updateMetrics();
          addLogEntry("success", `SUCCESS: ${args.join(" ")}`);
        } else {
          addLogEntry("info", `INFO: ${args.join(" ")}`);
        }
      };

      function clearConsoleMonitor() {
        document.getElementById("consoleMonitor").innerHTML = `
                <div class="log-entry success-log">üü¢ Console Monitor Cleared</div>
                <div class="log-entry info-log">‚ÑπÔ∏è Ready for new tests...</div>
            `;
        errorCount = 0;
        warningCount = 0;
        successCount = 0;
        updateMetrics();
      }

      function updateTestStatus(status, message) {
        const statusEl = document.getElementById("testStatus");
        const statusText = document.getElementById("statusText");
        statusEl.querySelector(".status").className = `status ${status}`;
        statusEl.querySelector(".status").textContent = status.toUpperCase();
        statusText.textContent = message;
      }

      // Test functions
      async function testNormalInitialization() {
        try {
          updateTestStatus(
            "warning",
            "Testing normal RadarChart initialization...",
          );
          addLogEntry("info", "üß™ Starting normal initialization test...");

          // Clear container
          document.getElementById("hero-ethics-chart").innerHTML = "";

          // Create RadarChart with normal configuration
          const radarChart = new RadarChart("hero-ethics-chart", {
            title: "Test Ethics Radar",
            subtitle: "Normal initialization test",
          });

          radarInstances++;
          updateMetrics();
          updateTestStatus(
            "success",
            "Normal initialization completed successfully!",
          );
          addLogEntry(
            "success",
            "‚úÖ RadarChart initialized successfully with defensive programming",
          );
        } catch (error) {
          updateTestStatus(
            "error",
            `Normal initialization failed: ${error.message}`,
          );
          addLogEntry("error", `‚ùå Normal init failed: ${error.message}`);
        }
      }

      async function testMissingConstants() {
        try {
          updateTestStatus(
            "warning",
            "Testing with missing enterprise constants...",
          );
          addLogEntry(
            "info",
            "üß™ Testing missing ENTERPRISE_CONSTANTS scenario...",
          );

          // Temporarily break getEnterpriseConstants
          const originalGetEnterpriseConstants = window.getEnterpriseConstants;
          window.getEnterpriseConstants = () => null;

          // Clear container
          document.getElementById("hero-ethics-chart").innerHTML = "";

          // Try to create RadarChart
          const radarChart = new RadarChart("hero-ethics-chart", {
            title: "Missing Constants Test",
            subtitle: "Should use fallback constants",
          });

          // Restore original function
          window.getEnterpriseConstants = originalGetEnterpriseConstants;

          radarInstances++;
          updateMetrics();
          updateTestStatus(
            "success",
            "Missing constants test passed - using fallbacks!",
          );
          addLogEntry(
            "success",
            "‚úÖ RadarChart gracefully handled missing constants",
          );
        } catch (error) {
          updateTestStatus(
            "error",
            `Missing constants test failed: ${error.message}`,
          );
          addLogEntry(
            "error",
            `‚ùå Missing constants test failed: ${error.message}`,
          );
        }
      }

      async function testCorruptedConstants() {
        try {
          updateTestStatus(
            "warning",
            "Testing with corrupted enterprise constants...",
          );
          addLogEntry(
            "info",
            "üß™ Testing corrupted ENTERPRISE_CONSTANTS scenario...",
          );

          // Temporarily corrupt getEnterpriseConstants
          const originalGetEnterpriseConstants = window.getEnterpriseConstants;
          window.getEnterpriseConstants = () => ({ incomplete: true }); // Invalid structure

          // Clear container
          document.getElementById("hero-ethics-chart").innerHTML = "";

          // Try to create RadarChart
          const radarChart = new RadarChart("hero-ethics-chart", {
            title: "Corrupted Constants Test",
            subtitle: "Should detect and fix invalid structure",
          });

          // Restore original function
          window.getEnterpriseConstants = originalGetEnterpriseConstants;

          radarInstances++;
          updateMetrics();
          updateTestStatus(
            "success",
            "Corrupted constants test passed - validation working!",
          );
          addLogEntry(
            "success",
            "‚úÖ RadarChart detected and fixed corrupted constants",
          );
        } catch (error) {
          updateTestStatus(
            "error",
            `Corrupted constants test failed: ${error.message}`,
          );
          addLogEntry(
            "error",
            `‚ùå Corrupted constants test failed: ${error.message}`,
          );
        }
      }

      async function testErrorHandling() {
        try {
          updateTestStatus(
            "warning",
            "Testing error handling with undefined constants...",
          );
          addLogEntry("info", "üß™ Testing error handling scenarios...");

          // Clear container
          document.getElementById("hero-ethics-chart").innerHTML = "";

          // Create RadarChart and force an error
          const radarChart = new RadarChart("hero-ethics-chart", {
            title: "Error Handling Test",
            subtitle: "Testing _handleError method safety",
          });

          // Simulate an error that would trigger _handleError
          if (radarChart._handleError) {
            radarChart._handleError(
              new Error("Test error for defensive programming"),
              "test_context",
            );
          }

          radarInstances++;
          updateMetrics();
          updateTestStatus(
            "success",
            "Error handling test completed - no crashes!",
          );
          addLogEntry(
            "success",
            "‚úÖ Error handling working safely with defensive programming",
          );
        } catch (error) {
          updateTestStatus(
            "error",
            `Error handling test failed: ${error.message}`,
          );
          addLogEntry(
            "error",
            `‚ùå Error handling test failed: ${error.message}`,
          );
        }
      }

      // Auto-start normal test
      window.addEventListener("load", async () => {
        addLogEntry(
          "info",
          "üöÄ Starting RadarChart Enterprise Constants Fix Tests...",
        );
        await new Promise((resolve) => setTimeout(resolve, 1000)); // Wait for dependencies
        await testNormalInitialization();
      });
    </script>
  </body>
</html>
