{"version":3,"file":"ui-D3JF1NtD.js","sources":["../../src/js/core/ui.js","../../src/js/core/accessibility.js"],"sourcesContent":["/**\n * Copyright 2025 Armando Sori\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Enhanced UI Components System - Modern UI component framework for SimulateAI\n * Provides WCAG 2.1 AA compliant, responsive, and theme-aware UI components\n *\n * Features:\n * - Full accessibility compliance (WCAG 2.1 AA)\n * - Dark mode and theme integration\n * - Performance optimization and monitoring\n * - Advanced animation support\n * - Touch and mobile optimization\n * - Error handling and recovery\n * - RTL language support\n * - Screen reader compatibility\n *\n * @version 2.0.0\n * @author SimulateAI Team\n * @license Apache-2.0\n */\n\nimport logger from '../utils/logger.js';\nimport { COMMON, TIMING } from '../utils/constants.js';\n\n// Enhanced constants and configuration\nconst UI_CONSTANTS = {\n  ANIMATION_DURATION: 300,\n  DEBOUNCE_DELAY: 150,\n  FOCUS_DELAY: 16,\n  FOCUS_TRANSITION_DELAY: 100, // Delay for focus transitions in modals\n  TOUCH_TARGET_SIZE: 44,\n  FOCUS_RING_WIDTH: 2,\n  RIPPLE_DURATION: 600,\n  BREAKPOINTS: {\n    mobile: 768,\n    tablet: 1024,\n    desktop: 1200,\n  },\n\n  // Performance monitoring\n  FRAME_TIME_LIMIT: 16, // 1 frame at 60fps\n\n  // ID generation\n  RANDOM_BASE: 36,\n  RANDOM_ID_LENGTH: 9,\n\n  // Panel constraints\n  MIN_PANEL_WIDTH: 200,\n  MIN_PANEL_HEIGHT: 150,\n\n  // Feedback system\n  DEFAULT_HIDE_DELAY: 5000,\n  MAX_FEEDBACK_ITEMS: 5,\n\n  // Ethics grading thresholds\n  ETHICS_GRADES: {\n    EXCELLENT: 90,\n    GOOD: 80,\n    FAIR: 70,\n    NEEDS_IMPROVEMENT: 60,\n  },\n\n  // Animation delays\n  CLEANUP_DELAY: 300,\n};\n\nconst THEME_COLORS = {\n  light: {\n    primary: '#1a73e8',\n    secondary: '#34a853',\n    surface: '#ffffff',\n    background: '#f8f9fa',\n    text: '#202124',\n    border: '#dadce0',\n  },\n  dark: {\n    primary: '#4285f4',\n    secondary: '#34a853',\n    surface: '#2d2d30',\n    background: '#1e1e1e',\n    text: '#e8eaed',\n    border: '#5f6368',\n  },\n  highContrast: {\n    primary: '#000000',\n    secondary: '#000000',\n    surface: '#ffffff',\n    background: '#ffffff',\n    text: '#000000',\n    border: '#000000',\n  },\n};\n\n/**\n * Enhanced theme detection and management for UI components\n */\nclass UIThemeManager {\n  static getCurrentTheme() {\n    const prefersHighContrast = window.matchMedia?.(\n      '(prefers-contrast: high)'\n    ).matches;\n    const prefersReducedMotion = window.matchMedia?.(\n      '(prefers-reduced-motion: reduce)'\n    ).matches;\n\n    return {\n      name: prefersHighContrast ? 'highContrast' : 'light',\n      highContrast: prefersHighContrast,\n      reducedMotion: prefersReducedMotion,\n      colors: THEME_COLORS[prefersHighContrast ? 'highContrast' : 'light'],\n    };\n  }\n\n  static applyThemeToElement(element, theme = this.getCurrentTheme()) {\n    element.style.setProperty('--theme-primary', theme.colors.primary);\n    element.style.setProperty('--theme-secondary', theme.colors.secondary);\n    element.style.setProperty('--theme-surface', theme.colors.surface);\n    element.style.setProperty('--theme-background', theme.colors.background);\n    element.style.setProperty('--theme-text', theme.colors.text);\n    element.style.setProperty('--theme-border', theme.colors.border);\n  }\n}\n\n/**\n * Performance monitoring utility for UI components\n */\nclass UIPerformanceMonitor {\n  static measurements = new Map();\n\n  static startMeasurement(id) {\n    this.measurements.set(id, performance.now());\n  }\n\n  static endMeasurement(id) {\n    const start = this.measurements.get(id);\n    if (start) {\n      const duration = performance.now() - start;\n      this.measurements.delete(id);\n      if (duration > UI_CONSTANTS.FRAME_TIME_LIMIT) {\n        // Flag slow operations (> 1 frame)\n        logger.warn(`UI operation '${id}' took ${duration.toFixed(2)}ms`);\n      }\n      return duration;\n    }\n    return 0;\n  }\n}\n\n/**\n * Enhanced UIComponent - Base class for all UI components\n * Provides modern accessibility, theming, and performance features\n */\nclass UIComponent {\n  constructor(config = {}) {\n    // Performance monitoring\n    UIPerformanceMonitor.startMeasurement(\n      `ui-component-init-${this.constructor.name}`\n    );\n\n    // Core properties\n    this.id =\n      config.id ||\n      `ui-${Date.now()}-${Math.random().toString(UI_CONSTANTS.RANDOM_BASE).substr(2, UI_CONSTANTS.RANDOM_ID_LENGTH)}`;\n    this.position = config.position || { x: 0, y: 0 };\n    this.size = config.size || { width: 100, height: 100 };\n    this.visible = config.visible !== false;\n    this.active = config.active !== false;\n    this.zIndex = config.zIndex || 0;\n\n    // Enhanced properties\n    this.engine = null;\n    this.element = null;\n    this.styles = config.styles || {};\n    this.theme = UIThemeManager.getCurrentTheme();\n    this.accessible = config.accessible !== false;\n    this.responsive = config.responsive !== false;\n    this.animated = config.animated !== false && !this.theme.reducedMotion;\n\n    // Event system\n    this.events = new Map();\n    this.listeners = new Map();\n\n    // Accessibility properties\n    this.ariaLabel = config.ariaLabel || '';\n    this.ariaRole = config.ariaRole || 'button';\n    this.focusable = config.focusable !== false;\n    this.tabIndex = config.tabIndex || (this.focusable ? 0 : -1);\n\n    // Performance properties\n    this.performanceOptions = {\n      useGPU: config.useGPU !== false,\n      enableVirtualization: config.enableVirtualization === true,\n      debounceEvents: config.debounceEvents !== false,\n    };\n\n    // Error handling\n    this.errorHandler =\n      config.errorHandler || this.defaultErrorHandler.bind(this);\n\n    // Initialize component\n    this.createElement();\n    this.applyStyles();\n    this.setupAccessibility();\n    this.setupEventListeners();\n    this.setupThemeMonitoring();\n\n    UIPerformanceMonitor.endMeasurement(\n      `ui-component-init-${this.constructor.name}`\n    );\n  }\n\n  /**\n   * Create DOM element with modern features\n   */\n  createElement() {\n    try {\n      this.element = document.createElement(this.getElementTag());\n      this.element.className = this.getElementClasses();\n      this.element.id = this.id;\n\n      // Apply theme CSS variables\n      UIThemeManager.applyThemeToElement(this.element, this.theme);\n\n      this.updateElementPosition();\n    } catch (error) {\n      this.errorHandler(error, 'createElement');\n    }\n  }\n\n  /**\n   * Get element tag (override in subclasses)\n   */\n  getElementTag() {\n    return 'div';\n  }\n\n  /**\n   * Get element CSS classes\n   */\n  getElementClasses() {\n    const baseClasses = [\n      'ui-component',\n      `ui-${this.constructor.name.toLowerCase()}`,\n      'theme-aware',\n    ];\n\n    if (this.responsive) baseClasses.push('responsive');\n    if (this.animated) baseClasses.push('animated');\n    if (this.theme.highContrast) baseClasses.push('high-contrast');\n\n    return baseClasses.join(' ');\n  }\n\n  /**\n   * Apply modern styles with CSS custom properties\n   */\n  applyStyles() {\n    try {\n      const baseStyles = {\n        position: 'absolute',\n        boxSizing: 'border-box',\n        userSelect: 'none',\n        outline: 'none',\n        transition: this.animated ? 'all 0.3s ease' : 'none',\n\n        // Custom properties for theming\n        backgroundColor: 'var(--theme-surface)',\n        color: 'var(--theme-text)',\n        borderColor: 'var(--theme-border)',\n\n        // Accessibility enhancements\n        minWidth: this.focusable\n          ? `${UI_CONSTANTS.TOUCH_TARGET_SIZE}px`\n          : 'auto',\n        minHeight: this.focusable\n          ? `${UI_CONSTANTS.TOUCH_TARGET_SIZE}px`\n          : 'auto',\n\n        // Performance optimizations\n        willChange: this.animated ? 'transform, opacity' : 'auto',\n        backfaceVisibility: 'hidden',\n        transform: 'translateZ(0)', // Force GPU layer\n\n        ...this.styles,\n      };\n\n      Object.assign(this.element.style, baseStyles);\n\n      // Add focus styles\n      this.addFocusStyles();\n    } catch (error) {\n      this.errorHandler(error, 'applyStyles');\n    }\n  }\n\n  /**\n   * Add modern focus styles\n   */\n  addFocusStyles() {\n    if (!this.focusable) return;\n\n    const style = document.createElement('style');\n    style.textContent = `\n            #${this.id}:focus {\n                outline: ${UI_CONSTANTS.FOCUS_RING_WIDTH}px solid var(--theme-primary);\n                outline-offset: 2px;\n                box-shadow: 0 0 0 4px var(--theme-primary)20;\n            }\n            \n            #${this.id}:focus:not(:focus-visible) {\n                outline: none;\n                box-shadow: none;\n            }\n        `;\n\n    document.head.appendChild(style);\n  }\n\n  /**\n   * Setup comprehensive accessibility features\n   */\n  setupAccessibility() {\n    if (!this.accessible || !this.element) return;\n\n    try {\n      // ARIA attributes\n      if (this.ariaLabel) {\n        this.element.setAttribute('aria-label', this.ariaLabel);\n      }\n\n      if (this.ariaRole) {\n        this.element.setAttribute('role', this.ariaRole);\n      }\n\n      // Focus management\n      this.element.setAttribute('tabindex', this.tabIndex);\n\n      // Screen reader support\n      this.element.setAttribute('aria-hidden', this.visible ? 'false' : 'true');\n\n      // Touch accessibility\n      if ('ontouchstart' in window) {\n        this.element.style.touchAction = 'manipulation';\n      }\n    } catch (error) {\n      this.errorHandler(error, 'setupAccessibility');\n    }\n  }\n\n  /**\n   * Setup modern event listeners with performance optimization\n   */\n  setupEventListeners() {\n    if (!this.element) return;\n\n    try {\n      // Keyboard navigation\n      if (this.focusable) {\n        this.addEventListener('keydown', this.handleKeyDown.bind(this));\n        this.addEventListener('keyup', this.handleKeyUp.bind(this));\n      }\n\n      // Mouse events\n      this.addEventListener('mouseenter', this.handleMouseEnter.bind(this));\n      this.addEventListener('mouseleave', this.handleMouseLeave.bind(this));\n\n      // Touch events (with passive listeners for performance)\n      if ('ontouchstart' in window) {\n        this.addEventListener('touchstart', this.handleTouchStart.bind(this), {\n          passive: true,\n        });\n        this.addEventListener('touchend', this.handleTouchEnd.bind(this), {\n          passive: true,\n        });\n      }\n\n      // Focus events\n      this.addEventListener('focus', this.handleFocus.bind(this));\n      this.addEventListener('blur', this.handleBlur.bind(this));\n    } catch (error) {\n      this.errorHandler(error, 'setupEventListeners');\n    }\n  }\n\n  /**\n   * Setup theme change monitoring\n   */\n  setupThemeMonitoring() {\n    // Monitor system theme changes\n    const contrastQuery = window.matchMedia?.('(prefers-contrast: high)');\n    const motionQuery = window.matchMedia?.('(prefers-reduced-motion: reduce)');\n\n    const handleThemeChange = () => {\n      this.theme = UIThemeManager.getCurrentTheme();\n      this.updateTheme();\n    };\n\n    contrastQuery?.addEventListener?.('change', handleThemeChange);\n    motionQuery?.addEventListener?.('change', handleThemeChange);\n\n    // Store references for cleanup\n    this.themeQueries = { contrastQuery, motionQuery };\n    this.themeChangeHandler = handleThemeChange;\n  }\n\n  /**\n   * Update component when theme changes\n   */\n  updateTheme() {\n    try {\n      this.animated = !this.theme.reducedMotion;\n      this.element.className = this.getElementClasses();\n      UIThemeManager.applyThemeToElement(this.element, this.theme);\n      this.applyStyles();\n\n      this.emit('themeChanged', this.theme);\n    } catch (error) {\n      this.errorHandler(error, 'updateTheme');\n    }\n  }\n\n  /**\n   * Enhanced event handling methods\n   */\n  handleKeyDown(event) {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      this.emit('activate', { event, source: 'keyboard' });\n    }\n\n    this.emit('keyDown', { event, key: event.key });\n  }\n\n  handleKeyUp(event) {\n    this.emit('keyUp', { event, key: event.key });\n  }\n\n  handleMouseEnter(event) {\n    this.element.classList.add('hover');\n    this.emit('mouseEnter', { event });\n  }\n\n  handleMouseLeave(event) {\n    this.element.classList.remove('hover');\n    this.emit('mouseLeave', { event });\n  }\n\n  handleTouchStart(event) {\n    this.element.classList.add('active');\n    this.emit('touchStart', { event });\n  }\n\n  handleTouchEnd(event) {\n    this.element.classList.remove('active');\n    this.emit('touchEnd', { event });\n  }\n\n  handleFocus(event) {\n    this.element.classList.add('focused');\n    this.emit('focus', { event });\n  }\n\n  handleBlur(event) {\n    this.element.classList.remove('focused');\n    this.emit('blur', { event });\n  }\n\n  /**\n   * Enhanced utility methods\n   */\n  updateElementPosition() {\n    if (this.element) {\n      this.element.style.left = `${this.position.x}px`;\n      this.element.style.top = `${this.position.y}px`;\n      this.element.style.width = `${this.size.width}px`;\n      this.element.style.height = `${this.size.height}px`;\n      this.element.style.zIndex = this.zIndex;\n\n      // Update responsive behavior\n      if (this.responsive) {\n        this.updateResponsiveStyles();\n      }\n    }\n  }\n\n  /**\n   * Update responsive styles based on screen size\n   */\n  updateResponsiveStyles() {\n    const width = window.innerWidth;\n    const isMobile = width < UI_CONSTANTS.BREAKPOINTS.mobile;\n    const isTablet = width < UI_CONSTANTS.BREAKPOINTS.tablet;\n\n    this.element.classList.toggle('mobile', isMobile);\n    this.element.classList.toggle('tablet', isTablet && !isMobile);\n    this.element.classList.toggle('desktop', !isTablet);\n\n    // Adjust touch targets on mobile\n    if (isMobile && this.focusable) {\n      this.element.style.minWidth = `${UI_CONSTANTS.TOUCH_TARGET_SIZE}px`;\n      this.element.style.minHeight = `${UI_CONSTANTS.TOUCH_TARGET_SIZE}px`;\n    }\n  }\n\n  setEngine(engine) {\n    this.engine = engine;\n    if (engine && engine.container) {\n      engine.container.appendChild(this.element);\n    }\n  }\n\n  setPosition(x, y) {\n    this.position.x = x;\n    this.position.y = y;\n    this.updateElementPosition();\n  }\n\n  setSize(width, height) {\n    this.size.width = width;\n    this.size.height = height;\n    this.updateElementPosition();\n  }\n\n  show() {\n    this.visible = true;\n    if (this.element) {\n      this.element.style.display = 'block';\n      this.element.setAttribute('aria-hidden', 'false');\n\n      if (this.animated) {\n        this.element.style.opacity = '0';\n        this.element.style.transform = 'scale(0.95)';\n\n        requestAnimationFrame(() => {\n          this.element.style.transition =\n            'opacity 0.3s ease, transform 0.3s ease';\n          this.element.style.opacity = '1';\n          this.element.style.transform = 'scale(1)';\n        });\n      }\n    }\n\n    this.emit('show');\n  }\n\n  hide() {\n    this.visible = false;\n    if (this.element) {\n      if (this.animated) {\n        this.element.style.transition =\n          'opacity 0.3s ease, transform 0.3s ease';\n        this.element.style.opacity = '0';\n        this.element.style.transform = 'scale(0.95)';\n\n        setTimeout(() => {\n          this.element.style.display = 'none';\n          this.element.setAttribute('aria-hidden', 'true');\n        }, TIMING.FAST);\n      } else {\n        this.element.style.display = 'none';\n        this.element.setAttribute('aria-hidden', 'true');\n      }\n    }\n\n    this.emit('hide');\n  }\n\n  /**\n   * Enhanced event system with debouncing\n   */\n  addEventListener(event, callback, options = {}) {\n    if (\n      this.performanceOptions.debounceEvents &&\n      ['resize', 'scroll', 'mousemove'].includes(event)\n    ) {\n      callback = this.debounce(callback, UI_CONSTANTS.DEBOUNCE_DELAY);\n    }\n\n    this.element?.addEventListener(event, callback, options);\n\n    // Store for cleanup\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push({ callback, options });\n  }\n\n  removeEventListener(event, callback) {\n    this.element?.removeEventListener(event, callback);\n\n    // Clean up stored listeners\n    const listeners = this.listeners.get(event);\n    if (listeners) {\n      const index = listeners.findIndex(l => l.callback === callback);\n      if (index > -1) {\n        listeners.splice(index, 1);\n      }\n    }\n  }\n\n  /**\n   * Debounce utility for performance\n   */\n  debounce(func, delay) {\n    let timeoutId;\n    return (...args) => {\n      clearTimeout(timeoutId);\n      timeoutId = setTimeout(() => func.apply(this, args), delay);\n    };\n  }\n\n  on(event, callback) {\n    if (!this.events.has(event)) {\n      this.events.set(event, []);\n    }\n    this.events.get(event).push(callback);\n  }\n\n  emit(event, data = {}) {\n    if (this.events.has(event)) {\n      this.events.get(event).forEach(callback => {\n        try {\n          callback(data);\n        } catch (error) {\n          this.errorHandler(error, `emit-${event}`);\n        }\n      });\n    }\n  }\n\n  /**\n   * Default error handler\n   */\n  defaultErrorHandler(error, context) {\n    logger.error(`UI Component Error (${context}):`, error);\n\n    // Emit error event for external handling\n    this.emit('error', { error, context });\n  }\n\n  /**\n   * Announce text for screen readers\n   */\n  announce(text, priority = 'polite') {\n    const announcement = document.createElement('div');\n    announcement.setAttribute('aria-live', priority);\n    announcement.setAttribute('aria-atomic', 'true');\n    announcement.style.position = 'absolute';\n    announcement.style.left = '-10000px';\n    announcement.style.width = '1px';\n    announcement.style.height = '1px';\n    announcement.style.overflow = 'hidden';\n\n    document.body.appendChild(announcement);\n\n    setTimeout(() => {\n      announcement.textContent = text;\n      setTimeout(() => {\n        document.body.removeChild(announcement);\n      }, 1000);\n    }, 100);\n  }\n\n  update(deltaTime) {\n    // Override in subclasses for custom update logic\n    this.emit('update', { deltaTime });\n  }\n\n  render(_renderer) {\n    // UI components render to DOM, not canvas/svg\n    // Override in subclasses if needed\n  }\n\n  /**\n   * Enhanced cleanup with memory leak prevention\n   */\n  destroy() {\n    try {\n      // Remove all event listeners\n      this.listeners.forEach((listeners, event) => {\n        listeners.forEach(({ callback }) => {\n          this.element?.removeEventListener(event, callback);\n        });\n      });\n      this.listeners.clear();\n\n      // Clean up theme monitoring\n      if (this.themeQueries) {\n        const { contrastQuery, motionQuery } = this.themeQueries;\n        contrastQuery?.removeEventListener?.('change', this.themeChangeHandler);\n        motionQuery?.removeEventListener?.('change', this.themeChangeHandler);\n      }\n\n      // Remove DOM element\n      if (this.element && this.element.parentNode) {\n        this.element.parentNode.removeChild(this.element);\n      }\n\n      // Clear references\n      this.element = null;\n      this.engine = null;\n      this.events.clear();\n\n      this.emit('destroyed');\n    } catch (error) {\n      this.errorHandler(error, 'destroy');\n    }\n  }\n}\n\n/**\n * Enhanced UIPanel - Modern panel component with accessibility and theming\n */\nclass UIPanel extends UIComponent {\n  constructor(config = {}) {\n    super({\n      ...config,\n      ariaRole: 'dialog',\n      ariaLabel: config.title || 'Panel',\n      styles: {\n        backgroundColor: 'var(--theme-surface)',\n        border: '1px solid var(--theme-border)',\n        borderRadius: '12px',\n        padding: '20px',\n        boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\n        fontSize: '14px',\n        fontFamily: 'system-ui, -apple-system, sans-serif',\n        backdropFilter: 'blur(10px)',\n        ...config.styles,\n      },\n    });\n\n    this.title = config.title || '';\n    this.content = config.content || '';\n    this.components = [];\n    this.resizable = config.resizable === true;\n    this.closable = config.closable !== false;\n    this.modal = config.modal === true;\n\n    this.createContent();\n    this.setupPanelBehavior();\n  }\n\n  /**\n   * Get appropriate element tag for panels\n   */\n  getElementTag() {\n    return 'section';\n  }\n\n  /**\n   * Get enhanced CSS classes for panels\n   */\n  getElementClasses() {\n    const classes = super.getElementClasses();\n    const panelClasses = ['ui-panel'];\n\n    if (this.modal) panelClasses.push('modal-dialog');\n    if (this.resizable) panelClasses.push('resizable');\n    if (this.closable) panelClasses.push('closable');\n\n    return `${classes} ${panelClasses.join(' ')}`;\n  }\n\n  createContent() {\n    try {\n      this.element.innerHTML = `\n                ${\n                  this.closable\n                    ? `\n                    <button class=\"panel-close\" aria-label=\"Close panel\" tabindex=\"0\">\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                `\n                    : ''\n                }\n                ${\n                  this.title\n                    ? `\n                    <header class=\"panel-header\">\n                        <h2 class=\"panel-title\">${this.title}</h2>\n                    </header>\n                `\n                    : ''\n                }\n                <main class=\"panel-content\" role=\"main\">${this.content}</main>\n                <footer class=\"panel-controls\" role=\"toolbar\"></footer>\n            `;\n\n      this.styleContent();\n    } catch (error) {\n      this.errorHandler(error, 'createContent');\n    }\n  }\n\n  /**\n   * Apply modern styling to panel content\n   */\n  styleContent() {\n    // Style the close button\n    const closeBtn = this.element.querySelector('.panel-close');\n    if (closeBtn) {\n      Object.assign(closeBtn.style, {\n        position: 'absolute',\n        top: '10px',\n        right: '10px',\n        background: 'none',\n        border: 'none',\n        fontSize: '24px',\n        color: 'var(--theme-text)',\n        cursor: 'pointer',\n        width: '32px',\n        height: '32px',\n        borderRadius: '50%',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        transition: 'background-color 0.2s ease',\n      });\n\n      closeBtn.addEventListener('click', () => this.close());\n      closeBtn.addEventListener('mouseenter', () => {\n        closeBtn.style.backgroundColor = 'var(--theme-border)';\n      });\n      closeBtn.addEventListener('mouseleave', () => {\n        closeBtn.style.backgroundColor = 'transparent';\n      });\n    }\n\n    // Style the header\n    const header = this.element.querySelector('.panel-header');\n    if (header) {\n      Object.assign(header.style, {\n        fontWeight: '600',\n        marginBottom: '16px',\n        paddingBottom: '12px',\n        borderBottom: '1px solid var(--theme-border)',\n        color: 'var(--theme-text)',\n      });\n    }\n\n    // Style the title\n    const title = this.element.querySelector('.panel-title');\n    if (title) {\n      Object.assign(title.style, {\n        margin: '0',\n        fontSize: '18px',\n        fontWeight: '600',\n        color: 'var(--theme-text)',\n      });\n    }\n\n    // Style the content\n    const content = this.element.querySelector('.panel-content');\n    if (content) {\n      Object.assign(content.style, {\n        marginBottom: '16px',\n        lineHeight: '1.5',\n        color: 'var(--theme-text)',\n        maxHeight: this.modal ? '60vh' : 'none',\n        overflowY: this.modal ? 'auto' : 'visible',\n      });\n    }\n\n    // Style the controls\n    const controls = this.element.querySelector('.panel-controls');\n    if (controls) {\n      Object.assign(controls.style, {\n        display: 'flex',\n        gap: '8px',\n        flexWrap: 'wrap',\n        justifyContent: 'flex-end',\n        paddingTop: '12px',\n        borderTop: '1px solid var(--theme-border)',\n      });\n    }\n  }\n\n  /**\n   * Setup panel-specific behavior\n   */\n  setupPanelBehavior() {\n    // Modal behavior\n    if (this.modal) {\n      this.setupModalBehavior();\n    }\n\n    // Resizable behavior\n    if (this.resizable) {\n      this.setupResizableBehavior();\n    }\n\n    // Escape key handling\n    this.addEventListener('keydown', event => {\n      if (event.key === 'Escape' && this.closable) {\n        this.close();\n      }\n    });\n  }\n\n  /**\n   * Setup modal dialog behavior\n   */\n  setupModalBehavior() {\n    // Create backdrop\n    this.backdrop = document.createElement('div');\n    this.backdrop.className = 'modal-backdrop';\n    Object.assign(this.backdrop.style, {\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      width: '100%',\n      height: '100%',\n      backgroundColor: 'rgba(0, 0, 0, 0.5)',\n      backdropFilter: 'blur(4px)',\n      zIndex: this.zIndex - 1,\n      display: 'none',\n    });\n\n    // Close on backdrop click\n    this.backdrop.addEventListener('click', event => {\n      if (event.target === this.backdrop) {\n        this.close();\n      }\n    });\n\n    document.body.appendChild(this.backdrop);\n  }\n\n  /**\n   * Setup resizable behavior\n   */\n  setupResizableBehavior() {\n    // Add resize handles\n    const handles = ['n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'];\n    handles.forEach(direction => {\n      const handle = document.createElement('div');\n      handle.className = `resize-handle resize-${direction}`;\n      handle.style.cssText = `\n                position: absolute;\n                background: transparent;\n                cursor: ${direction}-resize;\n            `;\n\n      switch (direction) {\n        case 'n':\n        case 's':\n          handle.style.cssText += 'left: 0; right: 0; height: 4px;';\n          handle.style[direction === 'n' ? 'top' : 'bottom'] = '-2px';\n          break;\n        case 'e':\n        case 'w':\n          handle.style.cssText += 'top: 0; bottom: 0; width: 4px;';\n          handle.style[direction === 'e' ? 'right' : 'left'] = '-2px';\n          break;\n        default: // corners\n          handle.style.cssText += 'width: 8px; height: 8px;';\n          if (direction.includes('n')) handle.style.top = '-4px';\n          if (direction.includes('s')) handle.style.bottom = '-4px';\n          if (direction.includes('e')) handle.style.right = '-4px';\n          if (direction.includes('w')) handle.style.left = '-4px';\n      }\n\n      this.setupResizeHandle(handle, direction);\n      this.element.appendChild(handle);\n    });\n  }\n\n  /**\n   * Setup individual resize handle\n   */\n  setupResizeHandle(handle, direction) {\n    let isResizing = false;\n    let startX, startY, startWidth, startHeight, startLeft, startTop;\n\n    handle.addEventListener('mousedown', event => {\n      isResizing = true;\n      startX = event.clientX;\n      startY = event.clientY;\n\n      const rect = this.element.getBoundingClientRect();\n      startWidth = rect.width;\n      startHeight = rect.height;\n      startLeft = rect.left;\n      startTop = rect.top;\n\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n\n      event.preventDefault();\n    });\n\n    const handleMouseMove = event => {\n      if (!isResizing) return;\n\n      const deltaX = event.clientX - startX;\n      const deltaY = event.clientY - startY;\n\n      let newWidth = startWidth;\n      let newHeight = startHeight;\n      let newLeft = startLeft;\n      let newTop = startTop;\n\n      if (direction.includes('e')) newWidth += deltaX;\n      if (direction.includes('w')) {\n        newWidth -= deltaX;\n        newLeft += deltaX;\n      }\n      if (direction.includes('s')) newHeight += deltaY;\n      if (direction.includes('n')) {\n        newHeight -= deltaY;\n        newTop += deltaY;\n      }\n\n      // Apply constraints\n      newWidth = Math.max(UI_CONSTANTS.MIN_PANEL_WIDTH, newWidth);\n      newHeight = Math.max(UI_CONSTANTS.MIN_PANEL_HEIGHT, newHeight);\n\n      this.setSize(newWidth, newHeight);\n      this.setPosition(newLeft, newTop);\n    };\n\n    const handleMouseUp = () => {\n      isResizing = false;\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }\n\n  setContent(html) {\n    const contentEl = this.element.querySelector('.panel-content');\n    if (contentEl) {\n      contentEl.innerHTML = html;\n    }\n  }\n\n  /**\n   * Close panel with animation\n   */\n  close() {\n    this.emit('beforeClose');\n\n    if (this.animated) {\n      this.element.style.transition = 'opacity 0.3s ease, transform 0.3s ease';\n      this.element.style.opacity = '0';\n      this.element.style.transform = 'scale(0.95)';\n\n      if (this.backdrop) {\n        this.backdrop.style.transition = 'opacity 0.3s ease';\n        this.backdrop.style.opacity = '0';\n      }\n\n      setTimeout(() => {\n        this.hide();\n        this.emit('closed');\n      }, TIMING.FAST);\n    } else {\n      this.hide();\n      this.emit('closed');\n    }\n  }\n\n  /**\n   * Show panel with modal behavior\n   */\n  show() {\n    if (this.modal && this.backdrop) {\n      this.backdrop.style.display = 'block';\n      if (this.animated) {\n        this.backdrop.style.opacity = '0';\n        requestAnimationFrame(() => {\n          this.backdrop.style.transition = 'opacity 0.3s ease';\n          this.backdrop.style.opacity = '1';\n        });\n      }\n    }\n\n    super.show();\n\n    // Focus management for accessibility\n    const firstFocusable = this.element.querySelector(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    if (firstFocusable) {\n      setTimeout(\n        () => firstFocusable.focus(),\n        UI_CONSTANTS.FOCUS_TRANSITION_DELAY\n      );\n    }\n  }\n\n  /**\n   * Hide panel and backdrop\n   */\n  hide() {\n    if (this.backdrop) {\n      this.backdrop.style.display = 'none';\n    }\n\n    super.hide();\n  }\n\n  /**\n   * Add modern button with accessibility and theming\n   */\n  addButton(text, onClick, options = {}) {\n    const button = document.createElement('button');\n    button.textContent = text;\n    button.className = 'panel-button ui-button';\n    button.type = 'button';\n\n    // Accessibility attributes\n    if (options.ariaLabel) {\n      button.setAttribute('aria-label', options.ariaLabel);\n    }\n\n    if (options.disabled) {\n      button.disabled = true;\n      button.setAttribute('aria-disabled', 'true');\n    }\n\n    // Apply modern styling\n    Object.assign(button.style, {\n      padding: '8px 16px',\n      margin: '4px',\n      border: 'none',\n      backgroundColor: 'var(--theme-primary)',\n      color: 'white',\n      borderRadius: '6px',\n      cursor: options.disabled ? 'not-allowed' : 'pointer',\n      fontSize: '14px',\n      fontWeight: '500',\n      fontFamily: 'inherit',\n      minHeight: `${UI_CONSTANTS.TOUCH_TARGET_SIZE}px`,\n      transition: 'all 0.2s ease',\n      outline: 'none',\n      opacity: options.disabled ? '0.6' : '1',\n      ...options.styles,\n    });\n\n    // Enhanced event handling\n    if (!options.disabled) {\n      button.addEventListener('click', event => {\n        try {\n          onClick(event);\n        } catch (error) {\n          this.errorHandler(error, 'button-click');\n        }\n      });\n\n      // Hover effects\n      button.addEventListener('mouseenter', () => {\n        if (!button.disabled) {\n          button.style.transform = 'translateY(-1px)';\n          button.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';\n        }\n      });\n\n      button.addEventListener('mouseleave', () => {\n        button.style.transform = 'translateY(0)';\n        button.style.boxShadow = 'none';\n      });\n\n      // Active state\n      button.addEventListener('mousedown', () => {\n        button.style.transform = 'translateY(0) scale(0.98)';\n      });\n\n      button.addEventListener('mouseup', () => {\n        button.style.transform = 'translateY(-1px) scale(1)';\n      });\n\n      // Keyboard handling\n      button.addEventListener('keydown', event => {\n        if (event.key === 'Enter' || event.key === ' ') {\n          event.preventDefault();\n          button.click();\n        }\n      });\n    }\n\n    // Add focus styles\n    button.addEventListener('focus', () => {\n      button.style.outline = `2px solid var(--theme-primary)`;\n      button.style.outlineOffset = '2px';\n    });\n\n    button.addEventListener('blur', () => {\n      button.style.outline = 'none';\n    });\n\n    const controls = this.element.querySelector('.panel-controls');\n    if (controls) {\n      controls.appendChild(button);\n    }\n\n    return button;\n  }\n\n  /**\n   * Add modern slider with accessibility and theming\n   */\n  addSlider(label, min, max, value, onChange, options = {}) {\n    const container = document.createElement('div');\n    container.className = 'slider-container';\n    container.style.marginBottom = '16px';\n\n    // Create label\n    const labelEl = document.createElement('label');\n    labelEl.textContent = label;\n    labelEl.style.cssText = `\n            display: block;\n            margin-bottom: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            color: var(--theme-text);\n        `;\n\n    // Create slider input\n    const slider = document.createElement('input');\n    slider.type = 'range';\n    slider.min = min;\n    slider.max = max;\n    slider.value = value;\n    slider.step = options.step || 1;\n    slider.className = 'panel-slider';\n\n    // Generate unique ID for accessibility\n    const sliderId = `slider-${this.id}-${Date.now()}`;\n    slider.id = sliderId;\n    labelEl.setAttribute('for', sliderId);\n\n    // Accessibility attributes\n    slider.setAttribute('role', 'slider');\n    slider.setAttribute('aria-valuemin', min);\n    slider.setAttribute('aria-valuemax', max);\n    slider.setAttribute('aria-valuenow', value);\n    slider.setAttribute('aria-label', label);\n\n    // Apply modern styling\n    Object.assign(slider.style, {\n      width: '100%',\n      height: '6px',\n      borderRadius: '3px',\n      background: 'var(--theme-border)',\n      outline: 'none',\n      appearance: 'none',\n      marginBottom: '8px',\n      cursor: 'pointer',\n      ...options.styles,\n    });\n\n    // Style the thumb (webkit browsers)\n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = `\n            #${sliderId}::-webkit-slider-thumb {\n                appearance: none;\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--theme-primary);\n                cursor: pointer;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n                transition: transform 0.2s ease;\n            }\n            \n            #${sliderId}::-webkit-slider-thumb:hover {\n                transform: scale(1.1);\n            }\n            \n            #${sliderId}::-moz-range-thumb {\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--theme-primary);\n                cursor: pointer;\n                border: none;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n            }\n            \n            #${sliderId}:focus::-webkit-slider-thumb {\n                outline: 2px solid var(--theme-primary);\n                outline-offset: 2px;\n            }\n        `;\n    document.head.appendChild(styleSheet);\n\n    // Create value display\n    const valueDisplay = document.createElement('div');\n    valueDisplay.className = 'slider-value-display';\n    valueDisplay.style.cssText = `\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            font-size: 12px;\n            color: var(--theme-text);\n            opacity: 0.8;\n        `;\n\n    const currentValue = document.createElement('span');\n    currentValue.textContent = value;\n    currentValue.style.fontWeight = '600';\n\n    const minMaxDisplay = document.createElement('span');\n    minMaxDisplay.textContent = `${min} - ${max}`;\n\n    valueDisplay.appendChild(currentValue);\n    valueDisplay.appendChild(minMaxDisplay);\n\n    // Enhanced event handling\n    const handleInput = e => {\n      const newValue = parseFloat(e.target.value);\n      currentValue.textContent = newValue;\n      slider.setAttribute('aria-valuenow', newValue);\n\n      try {\n        onChange(newValue, e);\n      } catch (error) {\n        this.errorHandler(error, 'slider-change');\n      }\n    };\n\n    // Debounce for performance\n    const debouncedHandler = this.debounce(\n      handleInput,\n      UI_CONSTANTS.FOCUS_DELAY\n    ); // ~60fps\n    slider.addEventListener('input', debouncedHandler);\n\n    // Immediate feedback for accessibility\n    slider.addEventListener('input', e => {\n      const newValue = parseFloat(e.target.value);\n      currentValue.textContent = newValue;\n      slider.setAttribute('aria-valuenow', newValue);\n    });\n\n    // Keyboard enhancements\n    slider.addEventListener('keydown', event => {\n      const step = parseFloat(slider.step);\n      let currentVal = parseFloat(slider.value);\n\n      switch (event.key) {\n        case 'ArrowUp':\n        case 'ArrowRight':\n          event.preventDefault();\n          currentVal = Math.min(max, currentVal + step);\n          break;\n        case 'ArrowDown':\n        case 'ArrowLeft':\n          event.preventDefault();\n          currentVal = Math.max(min, currentVal - step);\n          break;\n        case 'Home':\n          event.preventDefault();\n          currentVal = min;\n          break;\n        case 'End':\n          event.preventDefault();\n          currentVal = max;\n          break;\n        case 'PageUp':\n          event.preventDefault();\n          currentVal = Math.min(max, currentVal + step * 10);\n          break;\n        case 'PageDown':\n          event.preventDefault();\n          currentVal = Math.max(min, currentVal - step * 10);\n          break;\n        default:\n          return;\n      }\n\n      slider.value = currentVal;\n      handleInput({ target: slider });\n    });\n\n    // Assemble the slider component\n    container.appendChild(labelEl);\n    container.appendChild(slider);\n    container.appendChild(valueDisplay);\n\n    const controls = this.element.querySelector('.panel-controls');\n    if (controls) {\n      controls.appendChild(container);\n    }\n\n    return {\n      container,\n      slider,\n      valueDisplay,\n      setValue: newValue => {\n        slider.value = newValue;\n        currentValue.textContent = newValue;\n        slider.setAttribute('aria-valuenow', newValue);\n      },\n    };\n  }\n\n  /**\n   * Enhanced destroy method for panels\n   */\n  destroy() {\n    // Clean up backdrop\n    if (this.backdrop && this.backdrop.parentNode) {\n      this.backdrop.parentNode.removeChild(this.backdrop);\n    }\n\n    super.destroy();\n  }\n\n  // ...existing panel methods...\n}\n\n/**\n * Enhanced EthicsDisplay - Modern ethics metrics visualization with accessibility\n */\nclass EthicsDisplay extends UIComponent {\n  constructor(config = {}) {\n    super({\n      ...config,\n      ariaRole: 'status',\n      ariaLabel: 'Ethics metrics display',\n      accessible: true,\n      animated: config.animated !== false,\n      styles: {\n        backgroundColor: 'var(--theme-surface)',\n        color: 'var(--theme-text)',\n        border: '1px solid var(--theme-border)',\n        borderRadius: '12px',\n        padding: '20px',\n        fontSize: '14px',\n        fontFamily: 'system-ui, -apple-system, sans-serif',\n        backdropFilter: 'blur(10px)',\n        boxShadow: '0 4px 12px rgba(0,0,0,0.1)',\n        ...config.styles,\n      },\n    });\n\n    this.metrics = config.metrics || new Map();\n    this.showLabels = config.showLabels !== false;\n    this.showValues = config.showValues !== false;\n    this.format = config.format || 'percentage'; // 'percentage' | 'decimal' | 'score'\n    this.colorMode = config.colorMode || 'gradient'; // 'gradient' | 'threshold' | 'single'\n    this.animated = config.animated !== false && !this.theme.reducedMotion;\n\n    // Color schemes for different themes\n    this.colorSchemes = {\n      gradient: {\n        low: '#ef4444', // Red\n        medium: '#f59e0b', // Amber\n        high: '#22c55e', // Green\n      },\n      threshold: {\n        poor: '#ef4444',\n        fair: '#f59e0b',\n        good: '#22c55e',\n        excellent: '#06b6d4',\n      },\n    };\n\n    this.createMetersDisplay();\n    this.setupLiveRegion();\n  }\n\n  /**\n   * Get appropriate element tag\n   */\n  getElementTag() {\n    return 'section';\n  }\n\n  /**\n   * Get enhanced CSS classes\n   */\n  getElementClasses() {\n    const classes = super.getElementClasses();\n    const displayClasses = ['ethics-display'];\n\n    if (this.animated) displayClasses.push('animated');\n    if (this.colorMode) displayClasses.push(`color-${this.colorMode}`);\n\n    return `${classes} ${displayClasses.join(' ')}`;\n  }\n\n  createMetersDisplay() {\n    try {\n      this.element.innerHTML = `\n                <header class=\"ethics-header\">\n                    <h3 class=\"ethics-title\">Ethics Metrics</h3>\n                    <div class=\"ethics-summary\" aria-live=\"polite\"></div>\n                </header>\n                <main class=\"ethics-meters\" role=\"main\"></main>\n            `;\n\n      this.styleHeader();\n      this.renderMeters();\n    } catch (error) {\n      this.errorHandler(error, 'createMetersDisplay');\n    }\n  }\n\n  /**\n   * Style the header elements\n   */\n  styleHeader() {\n    const header = this.element.querySelector('.ethics-header');\n    if (header) {\n      Object.assign(header.style, {\n        marginBottom: '16px',\n        borderBottom: '1px solid var(--theme-border)',\n        paddingBottom: '12px',\n      });\n    }\n\n    const title = this.element.querySelector('.ethics-title');\n    if (title) {\n      Object.assign(title.style, {\n        margin: '0 0 8px 0',\n        fontSize: '18px',\n        fontWeight: '600',\n        color: 'var(--theme-text)',\n      });\n    }\n\n    const summary = this.element.querySelector('.ethics-summary');\n    if (summary) {\n      Object.assign(summary.style, {\n        fontSize: '12px',\n        color: 'var(--theme-text)',\n        opacity: '0.8',\n      });\n    }\n  }\n\n  /**\n   * Setup live region for screen readers\n   */\n  setupLiveRegion() {\n    this.liveRegion = document.createElement('div');\n    this.liveRegion.setAttribute('aria-live', 'polite');\n    this.liveRegion.setAttribute('aria-atomic', 'false');\n    this.liveRegion.style.cssText = `\n            position: absolute;\n            left: -10000px;\n            width: 1px;\n            height: 1px;\n            overflow: hidden;\n        `;\n\n    this.element.appendChild(this.liveRegion);\n  }\n\n  /**\n   * Render all ethics meters\n   */\n  renderMeters() {\n    const container = this.element.querySelector('.ethics-meters');\n    if (!container) return;\n\n    container.innerHTML = '';\n\n    this.metrics.forEach((metric, name) => {\n      const meterElement = this.createMeter(metric, name);\n      container.appendChild(meterElement);\n    });\n\n    this.updateSummary();\n  }\n\n  /**\n   * Create individual ethics meter\n   */\n  createMeter(metric, name) {\n    const meterContainer = document.createElement('div');\n    meterContainer.className = 'ethics-meter';\n    meterContainer.setAttribute('data-metric', name);\n\n    // Generate unique IDs for accessibility\n    const labelId = `label-${this.id}-${name}`;\n    const valueId = `value-${this.id}-${name}`;\n\n    const value = Math.round(metric.value || 0);\n    const formattedValue = this.formatValue(metric.value || 0);\n    const color = this.getColorForValue(metric.value || 0);\n    const description = metric.description || `${metric.label} level`;\n\n    meterContainer.innerHTML = `\n            ${\n              this.showLabels\n                ? `\n                <div class=\"meter-label\" id=\"${labelId}\">\n                    ${metric.label}\n                    ${metric.description ? `<span class=\"meter-description\">${metric.description}</span>` : ''}\n                </div>\n            `\n                : ''\n            }\n            \n            <div class=\"meter-container\" role=\"progressbar\" \n                 aria-labelledby=\"${labelId}\" \n                 aria-describedby=\"${valueId}\"\n                 aria-valuemin=\"0\" \n                 aria-valuemax=\"100\" \n                 aria-valuenow=\"${value}\"\n                 aria-valuetext=\"${formattedValue} ${description}\">\n                 \n                <div class=\"meter-track\"></div>\n                <div class=\"meter-fill\" style=\"width: 0%; background-color: ${color};\"></div>\n                \n                ${\n                  this.showValues\n                    ? `\n                    <div class=\"meter-value\" id=\"${valueId}\" aria-hidden=\"true\">\n                        ${formattedValue}\n                    </div>\n                `\n                    : ''\n                }\n            </div>\n        `;\n\n    this.styleMeter(meterContainer, metric);\n\n    return meterContainer;\n  }\n\n  /**\n   * Style individual meter\n   */\n  styleMeter(container, _metric) {\n    Object.assign(container.style, {\n      marginBottom: '16px',\n      position: 'relative',\n    });\n\n    const label = container.querySelector('.meter-label');\n    if (label) {\n      Object.assign(label.style, {\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        marginBottom: '8px',\n        fontSize: '14px',\n        fontWeight: '500',\n        color: 'var(--theme-text)',\n      });\n    }\n\n    const description = container.querySelector('.meter-description');\n    if (description) {\n      Object.assign(description.style, {\n        fontSize: '12px',\n        fontWeight: '400',\n        opacity: '0.7',\n        fontStyle: 'italic',\n      });\n    }\n\n    const meterContainer = container.querySelector('.meter-container');\n    if (meterContainer) {\n      Object.assign(meterContainer.style, {\n        position: 'relative',\n        height: '12px',\n        borderRadius: '6px',\n        overflow: 'hidden',\n        backgroundColor: 'var(--theme-border)',\n        border: '1px solid var(--theme-border)',\n      });\n    }\n\n    const track = container.querySelector('.meter-track');\n    if (track) {\n      Object.assign(track.style, {\n        position: 'absolute',\n        top: '0',\n        left: '0',\n        width: '100%',\n        height: '100%',\n        backgroundColor: 'rgba(0,0,0,0.1)',\n        borderRadius: '6px',\n      });\n    }\n\n    const fill = container.querySelector('.meter-fill');\n    if (fill) {\n      Object.assign(fill.style, {\n        position: 'absolute',\n        top: '0',\n        left: '0',\n        height: '100%',\n        borderRadius: '6px',\n        transition: this.animated\n          ? 'width 0.8s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s ease'\n          : 'none',\n        backgroundImage:\n          this.colorMode === 'gradient'\n            ? 'linear-gradient(90deg, var(--meter-color) 0%, var(--meter-color) 100%)'\n            : 'none',\n      });\n    }\n\n    const valueDisplay = container.querySelector('.meter-value');\n    if (valueDisplay) {\n      Object.assign(valueDisplay.style, {\n        position: 'absolute',\n        right: '8px',\n        top: '50%',\n        transform: 'translateY(-50%)',\n        fontSize: '11px',\n        fontWeight: '600',\n        color: 'var(--theme-text)',\n        textShadow: '0 1px 2px rgba(0,0,0,0.3)',\n        pointerEvents: 'none',\n      });\n    }\n  }\n\n  /**\n   * Get color for metric value\n   */\n  getColorForValue(value) {\n    if (this.colorMode === 'single') {\n      return this.colorSchemes.gradient.high;\n    }\n\n    const normalized = Math.max(0, Math.min(100, value)) / 100;\n\n    if (this.colorMode === 'threshold') {\n      if (normalized < COMMON.OPACITY_30)\n        return this.colorSchemes.threshold.poor;\n      if (normalized < COMMON.HALF) return this.colorSchemes.threshold.fair;\n      if (normalized < COMMON.OPACITY_80)\n        return this.colorSchemes.threshold.good;\n      return this.colorSchemes.threshold.excellent;\n    }\n\n    // Gradient mode\n    if (normalized < COMMON.HALF) {\n      return this.interpolateColor(\n        this.colorSchemes.gradient.low,\n        this.colorSchemes.gradient.medium,\n        normalized * 2\n      );\n    } else {\n      return this.interpolateColor(\n        this.colorSchemes.gradient.medium,\n        this.colorSchemes.gradient.high,\n        (normalized - COMMON.HALF) * COMMON.TWO\n      );\n    }\n  }\n\n  /**\n   * Interpolate between two hex colors\n   */\n  interpolateColor(color1, color2, factor) {\n    const c1 = this.hexToRgb(color1);\n    const c2 = this.hexToRgb(color2);\n\n    const r = Math.round(c1.r + (c2.r - c1.r) * factor);\n    const g = Math.round(c1.g + (c2.g - c1.g) * factor);\n    const b = Math.round(c1.b + (c2.b - c1.b) * factor);\n\n    return `rgb(${r}, ${g}, ${b})`;\n  }\n\n  /**\n   * Convert hex color to RGB\n   */\n  hexToRgb(hex) {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result\n      ? {\n          r: parseInt(result[1], 16),\n          g: parseInt(result[2], 16),\n          b: parseInt(result[3], 16),\n        }\n      : { r: 0, g: 0, b: 0 };\n  }\n\n  /**\n   * Format value based on format setting\n   */\n  formatValue(value) {\n    switch (this.format) {\n      case 'decimal':\n        return (value / 100).toFixed(2);\n      case 'score':\n        return `${Math.round(value)}/100`;\n      case 'percentage':\n      default:\n        return `${Math.round(value)}%`;\n    }\n  }\n\n  /**\n   * Update ethics summary\n   */\n  updateSummary() {\n    const summary = this.element.querySelector('.ethics-summary');\n    if (!summary || this.metrics.size === 0) return;\n\n    const values = Array.from(this.metrics.values()).map(m => m.value || 0);\n    const average = values.reduce((sum, val) => sum + val, 0) / values.length;\n    const totalMetrics = this.metrics.size;\n\n    const gradeText = this.getEthicsGrade(average);\n    summary.textContent = `Overall: ${this.formatValue(average)} (${gradeText})  ${totalMetrics} metrics`;\n  }\n\n  /**\n   * Get ethics grade based on average score\n   */\n  getEthicsGrade(score) {\n    if (score >= UI_CONSTANTS.ETHICS_GRADES.EXCELLENT) return 'Excellent';\n    if (score >= UI_CONSTANTS.ETHICS_GRADES.GOOD) return 'Good';\n    if (score >= UI_CONSTANTS.ETHICS_GRADES.FAIR) return 'Fair';\n    if (score >= UI_CONSTANTS.ETHICS_GRADES.NEEDS_IMPROVEMENT)\n      return 'Needs Improvement';\n    return 'Critical Issues';\n  }\n\n  /**\n   * Update specific metric with animation\n   */\n  updateMetric(metricName, newValue, _options = {}) {\n    const metric = this.metrics.get(metricName);\n    if (!metric) return;\n\n    const oldValue = metric.value || 0;\n    metric.value = Math.max(0, Math.min(100, newValue));\n\n    const meterElement = this.element.querySelector(\n      `[data-metric=\"${metricName}\"]`\n    );\n    if (!meterElement) return;\n\n    const fill = meterElement.querySelector('.meter-fill');\n    const valueDisplay = meterElement.querySelector('.meter-value');\n    const progressBar = meterElement.querySelector('.meter-container');\n\n    if (fill) {\n      const newColor = this.getColorForValue(metric.value);\n      fill.style.backgroundColor = newColor;\n\n      if (this.animated && !this.theme.reducedMotion) {\n        // Animate the width change\n        fill.style.width = `${metric.value}%`;\n      } else {\n        fill.style.width = `${metric.value}%`;\n      }\n    }\n\n    if (valueDisplay) {\n      valueDisplay.textContent = this.formatValue(metric.value);\n    }\n\n    if (progressBar) {\n      progressBar.setAttribute('aria-valuenow', Math.round(metric.value));\n      progressBar.setAttribute(\n        'aria-valuetext',\n        `${this.formatValue(metric.value)} ${metric.description || metric.label}`\n      );\n    }\n\n    // Announce significant changes for accessibility\n    if (Math.abs(newValue - oldValue) >= 10) {\n      const changeText = `${metric.label} changed to ${this.formatValue(metric.value)}`;\n      this.announce(changeText);\n    }\n\n    this.updateSummary();\n    this.emit('metricUpdated', {\n      metricName,\n      oldValue,\n      newValue: metric.value,\n    });\n  }\n\n  /**\n   * Add new metric\n   */\n  addMetric(name, config) {\n    this.metrics.set(name, {\n      label: config.label || name,\n      value: config.value || 0,\n      description: config.description || '',\n      color: config.color || null,\n    });\n\n    this.renderMeters();\n    this.emit('metricAdded', { name, config });\n  }\n\n  /**\n   * Remove metric\n   */\n  removeMetric(name) {\n    if (this.metrics.delete(name)) {\n      this.renderMeters();\n      this.emit('metricRemoved', { name });\n    }\n  }\n\n  /**\n   * Get all metric values\n   */\n  getMetrics() {\n    const result = {};\n    this.metrics.forEach((metric, name) => {\n      result[name] = metric.value;\n    });\n    return result;\n  }\n\n  /**\n   * Set multiple metrics at once\n   */\n  setMetrics(values) {\n    Object.entries(values).forEach(([name, value]) => {\n      if (this.metrics.has(name)) {\n        this.updateMetric(name, value);\n      }\n    });\n  }\n\n  /**\n   * Reset all metrics to zero\n   */\n  resetMetrics() {\n    this.metrics.forEach((metric, name) => {\n      this.updateMetric(name, 0);\n    });\n\n    this.emit('metricsReset');\n  }\n}\n\n/**\n * Enhanced FeedbackSystem - Modern feedback component with accessibility and theming\n */\nclass FeedbackSystem extends UIComponent {\n  constructor(config = {}) {\n    super({\n      ...config,\n      ariaRole: 'alert',\n      ariaLabel: 'Feedback system',\n      accessible: true,\n      animated: config.animated !== false,\n      styles: {\n        backgroundColor: 'var(--theme-surface)',\n        color: 'var(--theme-text)',\n        border: '1px solid var(--theme-border)',\n        borderRadius: '12px',\n        padding: '16px',\n        fontSize: '14px',\n        fontFamily: 'system-ui, -apple-system, sans-serif',\n        maxWidth: '400px',\n        boxShadow: '0 4px 12px rgba(0,0,0,0.1)',\n        ...config.styles,\n      },\n    });\n\n    this.feedbackQueue = [];\n    this.currentFeedback = null;\n    this.autoHide = config.autoHide !== false;\n    this.hideDelay = config.hideDelay || UI_CONSTANTS.DEFAULT_HIDE_DELAY;\n    this.maxItems = config.maxItems || UI_CONSTANTS.MAX_FEEDBACK_ITEMS;\n    this.position = config.position || 'top-right'; // top-right, top-left, bottom-right, bottom-left\n\n    this.createFeedbackContainer();\n    this.setupPositioning();\n  }\n\n  /**\n   * Get appropriate element tag\n   */\n  getElementTag() {\n    return 'aside';\n  }\n\n  /**\n   * Get enhanced CSS classes\n   */\n  getElementClasses() {\n    const classes = super.getElementClasses();\n    const feedbackClasses = ['feedback-system', `position-${this.position}`];\n\n    if (this.animated) feedbackClasses.push('animated');\n\n    return `${classes} ${feedbackClasses.join(' ')}`;\n  }\n\n  createFeedbackContainer() {\n    try {\n      this.element.innerHTML = `\n                <div class=\"feedback-header\" style=\"display: none;\">\n                    <h3 class=\"feedback-title\">Notifications</h3>\n                    <button class=\"feedback-clear\" aria-label=\"Clear all notifications\">Clear All</button>\n                </div>\n                <div class=\"feedback-list\" role=\"log\" aria-live=\"polite\" aria-atomic=\"false\"></div>\n            `;\n\n      this.setupFeedbackBehavior();\n    } catch (error) {\n      this.errorHandler(error, 'createFeedbackContainer');\n    }\n  }\n\n  /**\n   * Setup feedback system positioning\n   */\n  setupPositioning() {\n    const positions = {\n      'top-right': { top: '20px', right: '20px' },\n      'top-left': { top: '20px', left: '20px' },\n      'bottom-right': { bottom: '20px', right: '20px' },\n      'bottom-left': { bottom: '20px', left: '20px' },\n    };\n\n    const pos = positions[this.position] || positions['top-right'];\n\n    Object.assign(this.element.style, {\n      position: 'fixed',\n      ...pos,\n      zIndex: '9999',\n      pointerEvents: 'auto',\n    });\n  }\n\n  /**\n   * Setup feedback behavior\n   */\n  setupFeedbackBehavior() {\n    const clearButton = this.element.querySelector('.feedback-clear');\n    if (clearButton) {\n      clearButton.addEventListener('click', () => this.clearAll());\n\n      Object.assign(clearButton.style, {\n        background: 'none',\n        border: 'none',\n        color: 'var(--theme-primary)',\n        cursor: 'pointer',\n        fontSize: '12px',\n        textDecoration: 'underline',\n      });\n    }\n  }\n\n  /**\n   * Show feedback message with enhanced styling and accessibility\n   */\n  showFeedback(message, type = 'info', options = {}) {\n    try {\n      const feedback = {\n        id: `feedback-${Date.now()}-${Math.random().toString(UI_CONSTANTS.RANDOM_BASE).substr(2, UI_CONSTANTS.RANDOM_ID_LENGTH)}`,\n        message,\n        type,\n        timestamp: new Date(),\n        duration: options.duration || this.hideDelay,\n        persistent: options.persistent === true,\n        actions: options.actions || [],\n      };\n\n      // Add to queue and process\n      this.feedbackQueue.push(feedback);\n      if (this.feedbackQueue.length > this.maxItems) {\n        this.feedbackQueue.shift();\n      }\n\n      this.renderFeedback(feedback);\n\n      // Auto-hide if not persistent\n      if (this.autoHide && !feedback.persistent) {\n        setTimeout(() => {\n          this.hideFeedback(feedback.id);\n        }, feedback.duration);\n      }\n\n      this.emit('feedbackShown', feedback);\n      return feedback.id;\n    } catch (error) {\n      this.errorHandler(error, 'showFeedback');\n      return null;\n    }\n  }\n\n  /**\n   * Render individual feedback item\n   */\n  renderFeedback(feedback) {\n    const container = this.element.querySelector('.feedback-list');\n    if (!container) return;\n\n    const feedbackElement = document.createElement('div');\n    feedbackElement.className = `feedback-item feedback-${feedback.type}`;\n    feedbackElement.setAttribute('data-feedback-id', feedback.id);\n    feedbackElement.setAttribute('role', 'alert');\n    feedbackElement.setAttribute('aria-live', 'assertive');\n\n    const typeIcons = {\n      success: '',\n      error: '',\n      warning: '',\n      info: '',\n    };\n\n    const typeColors = {\n      success: '#22c55e',\n      error: '#ef4444',\n      warning: '#f59e0b',\n      info: '#3b82f6',\n    };\n\n    feedbackElement.innerHTML = `\n            <div class=\"feedback-icon\" aria-hidden=\"true\">${typeIcons[feedback.type] || typeIcons.info}</div>\n            <div class=\"feedback-content\">\n                <div class=\"feedback-message\">${feedback.message}</div>\n                ${\n                  feedback.actions.length > 0\n                    ? `\n                    <div class=\"feedback-actions\">\n                        ${feedback.actions\n                          .map(\n                            action => `\n                            <button class=\"feedback-action\" data-action=\"${action.id}\">\n                                ${action.label}\n                            </button>\n                        `\n                          )\n                          .join('')}\n                    </div>\n                `\n                    : ''\n                }\n            </div>\n            ${\n              !feedback.persistent\n                ? `\n                <button class=\"feedback-close\" aria-label=\"Close notification\" data-close=\"${feedback.id}\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            `\n                : ''\n            }\n        `;\n\n    // Style the feedback item\n    Object.assign(feedbackElement.style, {\n      display: 'flex',\n      alignItems: 'flex-start',\n      gap: '12px',\n      padding: '16px',\n      marginBottom: '12px',\n      backgroundColor: 'var(--theme-surface)',\n      border: `1px solid ${typeColors[feedback.type]}`,\n      borderLeft: `4px solid ${typeColors[feedback.type]}`,\n      borderRadius: '8px',\n      boxShadow: '0 2px 8px rgba(0,0,0,0.1)',\n      position: 'relative',\n      opacity: '0',\n      transform: this.position.includes('top')\n        ? 'translateY(-20px)'\n        : 'translateY(20px)',\n      transition: this.animated\n        ? 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)'\n        : 'none',\n    });\n\n    // Style components\n    this.styleFeedbackComponents(\n      feedbackElement,\n      feedback,\n      typeColors[feedback.type]\n    );\n\n    // Setup event handlers\n    this.setupFeedbackEventHandlers(feedbackElement, feedback);\n\n    container.appendChild(feedbackElement);\n\n    // Animate in\n    if (this.animated) {\n      requestAnimationFrame(() => {\n        feedbackElement.style.opacity = '1';\n        feedbackElement.style.transform = 'translateY(0)';\n      });\n    } else {\n      feedbackElement.style.opacity = '1';\n      feedbackElement.style.transform = 'translateY(0)';\n    }\n\n    // Show header if we have multiple items\n    this.updateHeader();\n  }\n\n  /**\n   * Style feedback components\n   */\n  styleFeedbackComponents(element, feedback, accentColor) {\n    const icon = element.querySelector('.feedback-icon');\n    if (icon) {\n      Object.assign(icon.style, {\n        color: accentColor,\n        fontSize: '18px',\n        fontWeight: 'bold',\n        minWidth: '20px',\n        textAlign: 'center',\n      });\n    }\n\n    const content = element.querySelector('.feedback-content');\n    if (content) {\n      Object.assign(content.style, {\n        flex: '1',\n        lineHeight: '1.4',\n      });\n    }\n\n    const message = element.querySelector('.feedback-message');\n    if (message) {\n      Object.assign(message.style, {\n        color: 'var(--theme-text)',\n        marginBottom: feedback.actions.length > 0 ? '8px' : '0',\n      });\n    }\n\n    const actions = element.querySelector('.feedback-actions');\n    if (actions) {\n      Object.assign(actions.style, {\n        display: 'flex',\n        gap: '8px',\n        flexWrap: 'wrap',\n      });\n    }\n\n    // Style action buttons\n    element.querySelectorAll('.feedback-action').forEach(btn => {\n      Object.assign(btn.style, {\n        padding: '4px 12px',\n        border: `1px solid ${accentColor}`,\n        backgroundColor: 'transparent',\n        color: accentColor,\n        borderRadius: '4px',\n        fontSize: '12px',\n        cursor: 'pointer',\n        transition: 'all 0.2s ease',\n      });\n\n      btn.addEventListener('mouseenter', () => {\n        btn.style.backgroundColor = accentColor;\n        btn.style.color = 'white';\n      });\n\n      btn.addEventListener('mouseleave', () => {\n        btn.style.backgroundColor = 'transparent';\n        btn.style.color = accentColor;\n      });\n    });\n\n    const closeBtn = element.querySelector('.feedback-close');\n    if (closeBtn) {\n      Object.assign(closeBtn.style, {\n        position: 'absolute',\n        top: '8px',\n        right: '8px',\n        background: 'none',\n        border: 'none',\n        fontSize: '18px',\n        color: 'var(--theme-text)',\n        cursor: 'pointer',\n        width: '24px',\n        height: '24px',\n        borderRadius: '50%',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        opacity: '0.7',\n        transition: 'all 0.2s ease',\n      });\n\n      closeBtn.addEventListener('mouseenter', () => {\n        closeBtn.style.opacity = '1';\n        closeBtn.style.backgroundColor = 'var(--theme-border)';\n      });\n\n      closeBtn.addEventListener('mouseleave', () => {\n        closeBtn.style.opacity = '0.7';\n        closeBtn.style.backgroundColor = 'transparent';\n      });\n    }\n  }\n\n  /**\n   * Setup event handlers for feedback item\n   */\n  setupFeedbackEventHandlers(element, feedback) {\n    // Close button\n    const closeBtn = element.querySelector('.feedback-close');\n    if (closeBtn) {\n      closeBtn.addEventListener('click', () => {\n        this.hideFeedback(feedback.id);\n      });\n    }\n\n    // Action buttons\n    element.querySelectorAll('.feedback-action').forEach(btn => {\n      btn.addEventListener('click', event => {\n        const actionId = btn.getAttribute('data-action');\n        const action = feedback.actions.find(a => a.id === actionId);\n\n        if (action && action.handler) {\n          try {\n            action.handler(feedback, event);\n          } catch (error) {\n            this.errorHandler(error, 'feedback-action');\n          }\n        }\n\n        // Hide feedback after action unless persistent\n        if (!feedback.persistent) {\n          this.hideFeedback(feedback.id);\n        }\n      });\n    });\n\n    // Keyboard navigation\n    element.addEventListener('keydown', event => {\n      if (this.disabled) return;\n\n      if (event.key === 'Escape') {\n        this.hideFeedback(feedback.id);\n      }\n    });\n  }\n\n  /**\n   * Hide specific feedback item\n   */\n  hideFeedback(feedbackId) {\n    const element = this.element.querySelector(\n      `[data-feedback-id=\"${feedbackId}\"]`\n    );\n    if (!element) return;\n\n    if (this.animated) {\n      element.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';\n      element.style.opacity = '0';\n      element.style.transform = this.position.includes('top')\n        ? 'translateY(-20px)'\n        : 'translateY(20px)';\n      element.style.maxHeight = '0';\n      element.style.marginBottom = '0';\n      element.style.padding = '0 16px';\n\n      setTimeout(() => {\n        if (element.parentNode) {\n          element.parentNode.removeChild(element);\n        }\n        this.updateHeader();\n      }, UI_CONSTANTS.CLEANUP_DELAY);\n    } else {\n      element.parentNode?.removeChild(element);\n      this.updateHeader();\n    }\n\n    // Remove from queue\n    this.feedbackQueue = this.feedbackQueue.filter(f => f.id !== feedbackId);\n\n    this.emit('feedbackHidden', { feedbackId });\n  }\n\n  /**\n   * Update header visibility\n   */\n  updateHeader() {\n    const header = this.element.querySelector('.feedback-header');\n    const items = this.element.querySelectorAll('.feedback-item');\n\n    if (header) {\n      header.style.display = items.length > 1 ? 'flex' : 'none';\n\n      if (items.length > 1) {\n        Object.assign(header.style, {\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          padding: '12px 16px',\n          borderBottom: '1px solid var(--theme-border)',\n          marginBottom: '12px',\n        });\n      }\n    }\n  }\n\n  /**\n   * Convenience methods for different feedback types\n   */\n  showSuccess(message, options = {}) {\n    return this.showFeedback(message, 'success', options);\n  }\n\n  showError(message, options = {}) {\n    return this.showFeedback(message, 'error', {\n      ...options,\n      persistent: true,\n    });\n  }\n\n  showWarning(message, options = {}) {\n    return this.showFeedback(message, 'warning', options);\n  }\n\n  showInfo(message, options = {}) {\n    return this.showFeedback(message, 'info', options);\n  }\n\n  /**\n   * Clear all feedback items\n   */\n  clearAll() {\n    const items = this.element.querySelectorAll('.feedback-item');\n    items.forEach(item => {\n      const feedbackId = item.getAttribute('data-feedback-id');\n      this.hideFeedback(feedbackId);\n    });\n\n    this.emit('allFeedbackCleared');\n  }\n\n  /**\n   * Get current feedback count\n   */\n  getCount() {\n    return this.feedbackQueue.length;\n  }\n\n  /**\n   * Check if feedback system has any items\n   */\n  hasItems() {\n    return this.feedbackQueue.length > 0;\n  }\n}\n\n/**\n * Enhanced Button - Modern button component with accessibility and theming\n */\nclass Button extends UIComponent {\n  constructor(config = {}) {\n    super({\n      ...config,\n      ariaRole: 'button',\n      focusable: true,\n      tabIndex: config.disabled ? -1 : 0,\n      styles: {\n        padding: '12px 24px',\n        border: 'none',\n        borderRadius: '8px',\n        fontSize: '14px',\n        fontWeight: '500',\n        fontFamily: 'system-ui, -apple-system, sans-serif',\n        cursor: config.disabled ? 'not-allowed' : 'pointer',\n        minHeight: `${UI_CONSTANTS.TOUCH_TARGET_SIZE}px`,\n        display: 'inline-flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        gap: '8px',\n        textDecoration: 'none',\n        outline: 'none',\n        transition: 'all 0.2s ease',\n        ...config.styles,\n      },\n    });\n\n    this.text = config.text || '';\n    this.icon = config.icon || null;\n    this.variant = config.variant || 'primary'; // primary, secondary, outline, ghost\n    this.size = config.size || 'medium'; // small, medium, large\n    this.disabled = config.disabled === true;\n    this.loading = config.loading === true;\n    this.onClick = config.onClick || (() => {});\n\n    this.createButton();\n    this.applyVariantStyles();\n    this.setupButtonBehavior();\n  }\n\n  /**\n   * Get appropriate element tag\n   */\n  getElementTag() {\n    return 'button';\n  }\n\n  /**\n   * Get enhanced CSS classes\n   */\n  getElementClasses() {\n    const classes = super.getElementClasses();\n    const buttonClasses = [\n      'ui-button',\n      `variant-${this.variant}`,\n      `size-${this.size}`,\n    ];\n\n    if (this.disabled) buttonClasses.push('disabled');\n    if (this.loading) buttonClasses.push('loading');\n\n    return `${classes} ${buttonClasses.join(' ')}`;\n  }\n\n  createButton() {\n    try {\n      this.element.type = 'button';\n      this.element.disabled = this.disabled;\n\n      if (this.ariaLabel) {\n        this.element.setAttribute('aria-label', this.ariaLabel);\n      }\n\n      if (this.disabled) {\n        this.element.setAttribute('aria-disabled', 'true');\n      }\n\n      this.updateButtonContent();\n    } catch (error) {\n      this.errorHandler(error, 'createButton');\n    }\n  }\n\n  /**\n   * Update button content\n   */\n  updateButtonContent() {\n    const content = [];\n\n    if (this.loading) {\n      content.push('<span class=\"button-spinner\" aria-hidden=\"true\"></span>');\n    } else if (this.icon) {\n      content.push(\n        `<span class=\"button-icon\" aria-hidden=\"true\">${this.icon}</span>`\n      );\n    }\n\n    if (this.text) {\n      content.push(`<span class=\"button-text\">${this.text}</span>`);\n    }\n\n    this.element.innerHTML = content.join('');\n\n    // Style the spinner\n    const spinner = this.element.querySelector('.button-spinner');\n    if (spinner) {\n      Object.assign(spinner.style, {\n        animation: 'spin 1s linear infinite',\n        display: 'inline-block',\n      });\n\n      // Add spin animation if not exists\n      if (!document.getElementById('button-spin-animation')) {\n        const style = document.createElement('style');\n        style.id = 'button-spin-animation';\n        style.textContent = `\n                    @keyframes spin {\n                        from { transform: rotate(0deg); }\n                        to { transform: rotate(360deg); }\n                    }\n                `;\n        document.head.appendChild(style);\n      }\n    }\n  }\n\n  /**\n   * Apply variant-specific styles\n   */\n  applyVariantStyles() {\n    const variants = {\n      primary: {\n        backgroundColor: 'var(--theme-primary)',\n        color: 'white',\n        border: '1px solid var(--theme-primary)',\n      },\n      secondary: {\n        backgroundColor: 'var(--theme-border)',\n        color: 'var(--theme-text)',\n        border: '1px solid var(--theme-border)',\n      },\n      outline: {\n        backgroundColor: 'transparent',\n        color: 'var(--theme-primary)',\n        border: '1px solid var(--theme-primary)',\n      },\n      ghost: {\n        backgroundColor: 'transparent',\n        color: 'var(--theme-text)',\n        border: '1px solid transparent',\n      },\n    };\n\n    const sizes = {\n      small: { padding: '8px 16px', fontSize: '12px', minHeight: '32px' },\n      medium: { padding: '12px 24px', fontSize: '14px', minHeight: '44px' },\n      large: { padding: '16px 32px', fontSize: '16px', minHeight: '52px' },\n    };\n\n    const variantStyles = variants[this.variant] || variants.primary;\n    const sizeStyles = sizes[this.size] || sizes.medium;\n\n    Object.assign(this.element.style, variantStyles, sizeStyles);\n\n    if (this.disabled) {\n      this.element.style.opacity = '0.6';\n      this.element.style.cursor = 'not-allowed';\n    }\n  }\n\n  /**\n   * Setup button behavior and interactions\n   */\n  setupButtonBehavior() {\n    if (this.disabled) return;\n\n    // Click handler\n    this.element.addEventListener('click', event => {\n      if (this.loading) return;\n\n      try {\n        this.onClick(event);\n        this.emit('click', { event });\n      } catch (error) {\n        this.errorHandler(error, 'button-click');\n      }\n    });\n\n    // Hover effects\n    this.element.addEventListener('mouseenter', () => {\n      if (this.disabled || this.loading) return;\n\n      this.element.style.transform = 'translateY(-1px)';\n      this.element.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';\n\n      // Variant-specific hover effects\n      if (this.variant === 'primary') {\n        this.element.style.filter = 'brightness(1.1)';\n      } else if (this.variant === 'outline' || this.variant === 'ghost') {\n        this.element.style.backgroundColor = 'var(--theme-primary)';\n        this.element.style.color = 'white';\n      }\n    });\n\n    this.element.addEventListener('mouseleave', () => {\n      if (this.disabled || this.loading) return;\n\n      this.element.style.transform = 'translateY(0)';\n      this.element.style.boxShadow = 'none';\n      this.element.style.filter = 'none';\n\n      // Reset variant styles\n      this.applyVariantStyles();\n    });\n\n    // Active state\n    this.element.addEventListener('mousedown', () => {\n      if (this.disabled || this.loading) return;\n      this.element.style.transform = 'translateY(0) scale(0.98)';\n    });\n\n    this.element.addEventListener('mouseup', () => {\n      if (this.disabled || this.loading) return;\n      this.element.style.transform = 'translateY(-1px) scale(1)';\n    });\n\n    // Keyboard navigation\n    this.element.addEventListener('keydown', event => {\n      if (this.disabled || this.loading) return;\n\n      if (event.key === 'Enter' || event.key === ' ') {\n        event.preventDefault();\n        this.element.click();\n      }\n    });\n  }\n\n  /**\n   * Set button text\n   */\n  setText(text) {\n    this.text = text;\n    this.updateButtonContent();\n  }\n\n  /**\n   * Set button icon\n   */\n  setIcon(icon) {\n    this.icon = icon;\n    this.updateButtonContent();\n  }\n\n  /**\n   * Set loading state\n   */\n  setLoading(loading) {\n    this.loading = loading;\n    this.element.classList.toggle('loading', loading);\n    this.updateButtonContent();\n\n    if (loading) {\n      this.element.setAttribute('aria-busy', 'true');\n    } else {\n      this.element.removeAttribute('aria-busy');\n    }\n  }\n\n  /**\n   * Set disabled state\n   */\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.element.disabled = disabled;\n    this.element.classList.toggle('disabled', disabled);\n\n    if (disabled) {\n      this.element.setAttribute('aria-disabled', 'true');\n      this.element.tabIndex = -1;\n    } else {\n      this.element.removeAttribute('aria-disabled');\n      this.element.tabIndex = 0;\n    }\n\n    this.applyVariantStyles();\n  }\n\n  /**\n   * Set button variant\n   */\n  setVariant(variant) {\n    this.element.classList.remove(`variant-${this.variant}`);\n    this.variant = variant;\n    this.element.classList.add(`variant-${this.variant}`);\n    this.applyVariantStyles();\n  }\n}\n\n/**\n * Enhanced Slider - Modern slider component with accessibility and theming\n */\nclass Slider extends UIComponent {\n  constructor(config = {}) {\n    super({\n      ...config,\n      ariaRole: 'slider',\n      focusable: true,\n      tabIndex: config.disabled ? -1 : 0,\n      styles: {\n        position: 'relative',\n        width: '200px',\n        height: '24px',\n        ...config.styles,\n      },\n    });\n\n    this.min = config.min || 0;\n    this.max = config.max || 100;\n    this.value = Math.max(\n      this.min,\n      Math.min(this.max, config.value || this.min)\n    );\n    this.step = config.step || 1;\n    this.disabled = config.disabled === true;\n    this.label = config.label || '';\n    this.showValue = config.showValue !== false;\n    this.showLabels = config.showLabels === true;\n    this.orientation = config.orientation || 'horizontal'; // horizontal | vertical\n    this.onChange = config.onChange || (() => {});\n\n    this.isDragging = false;\n\n    this.createSlider();\n    this.setupSliderBehavior();\n  }\n\n  /**\n   * Get enhanced CSS classes\n   */\n  getElementClasses() {\n    const classes = super.getElementClasses();\n    const sliderClasses = ['ui-slider', `orientation-${this.orientation}`];\n\n    if (this.disabled) sliderClasses.push('disabled');\n\n    return `${classes} ${sliderClasses.join(' ')}`;\n  }\n\n  createSlider() {\n    try {\n      // Set ARIA attributes\n      this.element.setAttribute('aria-valuemin', this.min);\n      this.element.setAttribute('aria-valuemax', this.max);\n      this.element.setAttribute('aria-valuenow', this.value);\n\n      if (this.label) {\n        this.element.setAttribute('aria-label', this.label);\n      }\n\n      if (this.disabled) {\n        this.element.setAttribute('aria-disabled', 'true');\n      }\n\n      this.element.innerHTML = `\n                ${\n                  this.label && this.showLabels\n                    ? `\n                    <div class=\"slider-label\">${this.label}</div>\n                `\n                    : ''\n                }\n                <div class=\"slider-container\">\n                    <div class=\"slider-track\"></div>\n                    <div class=\"slider-filled\"></div>\n                    <div class=\"slider-thumb\" role=\"slider\"></div>\n                    ${\n                      this.showLabels\n                        ? `\n                        <div class=\"slider-labels\">\n                            <span class=\"slider-min-label\">${this.min}</span>\n                            <span class=\"slider-max-label\">${this.max}</span>\n                        </div>\n                    `\n                        : ''\n                    }\n                </div>\n                ${\n                  this.showValue\n                    ? `\n                    <div class=\"slider-value\" aria-live=\"polite\">${this.value}</div>\n                `\n                    : ''\n                }\n            `;\n\n      this.styleSlider();\n      this.updateSliderPosition();\n    } catch (error) {\n      this.errorHandler(error, 'createSlider');\n    }\n  }\n\n  /**\n   * Style slider components\n   */\n  styleSlider() {\n    const container = this.element.querySelector('.slider-container');\n    const track = this.element.querySelector('.slider-track');\n    const filled = this.element.querySelector('.slider-filled');\n    const thumb = this.element.querySelector('.slider-thumb');\n    const label = this.element.querySelector('.slider-label');\n    const valueDisplay = this.element.querySelector('.slider-value');\n    const labels = this.element.querySelector('.slider-labels');\n\n    if (container) {\n      Object.assign(container.style, {\n        position: 'relative',\n        width: this.orientation === 'horizontal' ? '100%' : '24px',\n        height: this.orientation === 'horizontal' ? '24px' : '200px',\n        margin: this.orientation === 'horizontal' ? '12px 0' : '0 12px',\n      });\n    }\n\n    if (track) {\n      Object.assign(track.style, {\n        position: 'absolute',\n        backgroundColor: 'var(--theme-border)',\n        borderRadius: '12px',\n        ...(this.orientation === 'horizontal'\n          ? {\n              top: '50%',\n              left: '0',\n              right: '0',\n              height: '6px',\n              transform: 'translateY(-50%)',\n            }\n          : {\n              left: '50%',\n              top: '0',\n              bottom: '0',\n              width: '6px',\n              transform: 'translateX(-50%)',\n            }),\n      });\n    }\n\n    if (filled) {\n      Object.assign(filled.style, {\n        position: 'absolute',\n        backgroundColor: 'var(--theme-primary)',\n        borderRadius: '12px',\n        transition: this.animated ? 'all 0.2s ease' : 'none',\n        ...(this.orientation === 'horizontal'\n          ? {\n              top: '50%',\n              left: '0',\n              height: '6px',\n              transform: 'translateY(-50%)',\n            }\n          : {\n              left: '50%',\n              bottom: '0',\n              width: '6px',\n              transform: 'translateX(-50%)',\n            }),\n      });\n    }\n\n    if (thumb) {\n      Object.assign(thumb.style, {\n        position: 'absolute',\n        width: '20px',\n        height: '20px',\n        backgroundColor: 'var(--theme-primary)',\n        borderRadius: '50%',\n        border: '2px solid white',\n        boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\n        cursor: this.disabled ? 'not-allowed' : 'grab',\n        transition: this.animated ? 'all 0.2s ease' : 'none',\n        opacity: this.disabled ? '0.6' : '1',\n        ...(this.orientation === 'horizontal'\n          ? {\n              top: '50%',\n              transform: 'translate(-50%, -50%)',\n            }\n          : {\n              left: '50%',\n              transform: 'translate(-50%, 50%)',\n            }),\n      });\n    }\n\n    if (label) {\n      Object.assign(label.style, {\n        fontSize: '14px',\n        fontWeight: '500',\n        color: 'var(--theme-text)',\n        marginBottom: this.orientation === 'horizontal' ? '8px' : '0',\n        marginRight: this.orientation === 'vertical' ? '8px' : '0',\n      });\n    }\n\n    if (valueDisplay) {\n      Object.assign(valueDisplay.style, {\n        fontSize: '12px',\n        fontWeight: '600',\n        color: 'var(--theme-primary)',\n        textAlign: 'center',\n        marginTop: this.orientation === 'horizontal' ? '8px' : '0',\n        marginLeft: this.orientation === 'vertical' ? '8px' : '0',\n      });\n    }\n\n    if (labels) {\n      Object.assign(labels.style, {\n        display: 'flex',\n        justifyContent: 'space-between',\n        fontSize: '11px',\n        color: 'var(--theme-text)',\n        opacity: '0.7',\n        marginTop: this.orientation === 'horizontal' ? '4px' : '0',\n        ...(this.orientation === 'vertical'\n          ? {\n              flexDirection: 'column',\n              height: '100%',\n              position: 'absolute',\n              left: '100%',\n              top: '0',\n              marginLeft: '8px',\n            }\n          : {}),\n      });\n    }\n  }\n\n  /**\n   * Update slider position based on current value\n   */\n  updateSliderPosition() {\n    const percentage = ((this.value - this.min) / (this.max - this.min)) * 100;\n    const filled = this.element.querySelector('.slider-filled');\n    const thumb = this.element.querySelector('.slider-thumb');\n\n    if (this.orientation === 'horizontal') {\n      if (filled) filled.style.width = `${percentage}%`;\n      if (thumb) thumb.style.left = `${percentage}%`;\n    } else {\n      if (filled) filled.style.height = `${percentage}%`;\n      if (thumb) thumb.style.bottom = `${percentage}%`;\n    }\n  }\n\n  /**\n   * Setup slider behavior and interactions\n   */\n  setupSliderBehavior() {\n    if (this.disabled) return;\n\n    const container = this.element.querySelector('.slider-container');\n    const thumb = this.element.querySelector('.slider-thumb');\n\n    if (!container || !thumb) return;\n\n    // Mouse events\n    thumb.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    container.addEventListener('click', this.handleTrackClick.bind(this));\n\n    // Touch events\n    thumb.addEventListener('touchstart', this.handleTouchStart.bind(this), {\n      passive: false,\n    });\n\n    // Keyboard events\n    this.element.addEventListener('keydown', this.handleKeyDown.bind(this));\n\n    // Focus events\n    this.element.addEventListener('focus', () => {\n      thumb.style.boxShadow =\n        '0 0 0 3px var(--theme-primary)30, 0 2px 4px rgba(0,0,0,0.2)';\n    });\n\n    this.element.addEventListener('blur', () => {\n      thumb.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';\n    });\n  }\n\n  /**\n   * Handle mouse down on thumb\n   */\n  handleMouseDown(event) {\n    if (this.disabled) return;\n\n    event.preventDefault();\n    this.isDragging = true;\n\n    const thumb = this.element.querySelector('.slider-thumb');\n    if (thumb) {\n      thumb.style.cursor = 'grabbing';\n    }\n\n    document.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.addEventListener('mouseup', this.handleMouseUp.bind(this));\n\n    this.emit('dragStart', { value: this.value });\n  }\n\n  /**\n   * Handle mouse move during drag\n   */\n  handleMouseMove(event) {\n    if (!this.isDragging || this.disabled) return;\n\n    this.updateValueFromEvent(event);\n  }\n\n  /**\n   * Handle mouse up to end drag\n   */\n  handleMouseUp(_event) {\n    if (!this.isDragging) return;\n\n    this.isDragging = false;\n\n    const thumb = this.element.querySelector('.slider-thumb');\n    if (thumb) {\n      thumb.style.cursor = 'grab';\n    }\n\n    document.removeEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.removeEventListener('mouseup', this.handleMouseUp.bind(this));\n\n    this.emit('dragEnd', { value: this.value });\n  }\n\n  /**\n   * Handle touch start\n   */\n  handleTouchStart(event) {\n    if (this.disabled) return;\n\n    event.preventDefault();\n    this.isDragging = true;\n\n    document.addEventListener('touchmove', this.handleTouchMove.bind(this), {\n      passive: false,\n    });\n    document.addEventListener('touchend', this.handleTouchEnd.bind(this));\n\n    this.emit('dragStart', { value: this.value });\n  }\n\n  /**\n   * Handle touch move\n   */\n  handleTouchMove(event) {\n    if (!this.isDragging || this.disabled) return;\n\n    event.preventDefault();\n    this.updateValueFromEvent(event.touches[0]);\n  }\n\n  /**\n   * Handle touch end\n   */\n  handleTouchEnd(_event) {\n    if (!this.isDragging) return;\n\n    this.isDragging = false;\n\n    document.removeEventListener('touchmove', this.handleTouchMove.bind(this));\n    document.removeEventListener('touchend', this.handleTouchEnd.bind(this));\n\n    this.emit('dragEnd', { value: this.value });\n  }\n\n  /**\n   * Handle track click\n   */\n  handleTrackClick(event) {\n    if (this.disabled || this.isDragging) return;\n\n    const thumb = event.target.closest('.slider-thumb');\n    if (thumb) return; // Don't handle clicks on the thumb\n\n    this.updateValueFromEvent(event);\n  }\n\n  /**\n   * Handle keyboard navigation\n   */\n  handleKeyDown(event) {\n    if (this.disabled) return;\n\n    let newValue = this.value;\n    const largeStep = this.step * 10;\n\n    switch (event.key) {\n      case 'ArrowRight':\n      case 'ArrowUp':\n        event.preventDefault();\n        newValue = Math.min(this.max, this.value + this.step);\n        break;\n      case 'ArrowLeft':\n      case 'ArrowDown':\n        event.preventDefault();\n        newValue = Math.max(this.min, this.value - this.step);\n        break;\n      case 'PageUp':\n        event.preventDefault();\n        newValue = Math.min(this.max, this.value + largeStep);\n        break;\n      case 'PageDown':\n        event.preventDefault();\n        newValue = Math.max(this.min, this.value - largeStep);\n        break;\n      case 'Home':\n        event.preventDefault();\n        newValue = this.min;\n        break;\n      case 'End':\n        event.preventDefault();\n        newValue = this.max;\n        break;\n      default:\n        return;\n    }\n\n    this.setValue(newValue);\n  }\n\n  /**\n   * Update value from mouse/touch event\n   */\n  updateValueFromEvent(event) {\n    const container = this.element.querySelector('.slider-container');\n    if (!container) return;\n\n    const rect = container.getBoundingClientRect();\n    let percentage;\n\n    if (this.orientation === 'horizontal') {\n      percentage = (event.clientX - rect.left) / rect.width;\n    } else {\n      percentage = 1 - (event.clientY - rect.top) / rect.height;\n    }\n\n    percentage = Math.max(0, Math.min(1, percentage));\n    const newValue = this.min + percentage * (this.max - this.min);\n    const steppedValue = Math.round(newValue / this.step) * this.step;\n\n    this.setValue(steppedValue);\n  }\n\n  /**\n   * Set slider value\n   */\n  setValue(value) {\n    const oldValue = this.value;\n    this.value = Math.max(this.min, Math.min(this.max, value));\n\n    // Update display\n    this.updateSliderPosition();\n\n    // Update ARIA\n    this.element.setAttribute('aria-valuenow', this.value);\n\n    // Update value display\n    const valueDisplay = this.element.querySelector('.slider-value');\n    if (valueDisplay) {\n      valueDisplay.textContent = this.value;\n    }\n\n    // Call onChange if value actually changed\n    if (oldValue !== this.value) {\n      try {\n        this.onChange(this.value, oldValue);\n        this.emit('change', { value: this.value, oldValue });\n      } catch (error) {\n        this.errorHandler(error, 'slider-change');\n      }\n    }\n  }\n\n  /**\n   * Get current value\n   */\n  getValue() {\n    return this.value;\n  }\n\n  /**\n   * Set disabled state\n   */\n  setDisabled(disabled) {\n    this.disabled = disabled;\n    this.element.classList.toggle('disabled', disabled);\n\n    if (disabled) {\n      this.element.setAttribute('aria-disabled', 'true');\n      this.element.tabIndex = -1;\n    } else {\n      this.element.removeAttribute('aria-disabled');\n      this.element.tabIndex = 0;\n    }\n\n    this.styleSlider();\n  }\n}\n\n// Export all UI components\nexport {\n  UIComponent,\n  UIPanel,\n  EthicsDisplay,\n  FeedbackSystem,\n  Button,\n  Slider,\n  UIThemeManager,\n  UIPerformanceMonitor,\n  UI_CONSTANTS,\n  THEME_COLORS,\n};\n","/**\n * Copyright 2025 Armando Sori\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * AccessibilityManager - Enhanced accessibility features for simulations\n * Modern implementation with theme support, performance optimization, and advanced features\n *\n * Features:\n * - WCAG 2.1 AA compliance\n * - Dark mode and theme integration\n * - Performance monitoring\n * - Advanced error handling\n * - Animation management\n * - Touch/gesture support\n * - RTL language support\n *\n * @version 2.0.0\n * @author SimulateAI Team\n */\n\nimport logger from '../utils/logger.js';\n\n// Enhanced constants and configuration\nconst ACCESSIBILITY_CONSTANTS = {\n  ANNOUNCEMENT_DELAY: 100,\n  FOCUS_DELAY: 16,\n  KEYBOARD_REPEAT_DELAY: 200,\n  ANIMATION_DURATION: 250,\n  HIGH_CONTRAST_THRESHOLD: 4.5,\n  TOUCH_TARGET_MIN_SIZE: 44,\n\n  // Screen reader adaptation\n  SCREEN_READER_DELAY_MULTIPLIER: 1.5,\n\n  // Performance and timing\n  FEATURE_DISABLE_TIMEOUT: 30000,\n  FOCUS_HISTORY_LIMIT: 50,\n  ANNOUNCEMENT_TIMEOUT: 2000,\n  ANNOUNCEMENT_CLEAR_DELAY: 1500,\n  ANNOUNCEMENT_MIN_DURATION: 1000,\n  ANNOUNCEMENT_CHAR_MULTIPLIER: 50,\n  GESTURE_TIMEOUT: 5000,\n\n  // Focus indicator dimensions\n  FOCUS_BORDER_OFFSET: 3,\n  FOCUS_BORDER_PADDING: 6,\n\n  // Ethics and performance thresholds\n  ETHICS_SIGNIFICANT_CHANGE: 20,\n  ETHICS_HIGH_PRIORITY: 15,\n  PERFORMANCE_EXCELLENT: 90,\n  PERFORMANCE_GOOD: 75,\n  PERFORMANCE_SATISFACTORY: 60,\n};\n\nconst SCREEN_READER_PATTERNS = {\n  NVDA: /nvda/i,\n  JAWS: /jaws/i,\n  VOICEOVER: /voiceover/i,\n  NARRATOR: /narrator/i,\n  DRAGON: /dragon/i,\n};\n\n/**\n * Enhanced theme management for accessibility features\n */\nclass AccessibilityTheme {\n  static getCurrentTheme() {\n    const prefersHighContrast = window.matchMedia?.(\n      '(prefers-contrast: high)'\n    ).matches;\n    const prefersReducedMotion = window.matchMedia?.(\n      '(prefers-reduced-motion: reduce)'\n    ).matches;\n\n    return {\n      highContrast: prefersHighContrast,\n      reducedMotion: prefersReducedMotion,\n      theme: prefersHighContrast ? 'highContrast' : 'light',\n    };\n  }\n\n  static getFocusStyle(theme = null) {\n    const currentTheme = theme || this.getCurrentTheme();\n\n    if (currentTheme.highContrast) {\n      return {\n        outline: '3px solid #ffff00',\n        outlineOffset: '2px',\n        backgroundColor: 'transparent',\n      };\n    }\n\n    return {\n      outline: '2px solid #007bff',\n      outlineOffset: '2px',\n      backgroundColor: 'rgba(0, 123, 255, 0.1)',\n    };\n  }\n}\n\n/**\n * Performance monitoring for accessibility operations\n */\nclass AccessibilityPerformanceMonitor {\n  static metrics = new Map();\n\n  static startOperation(operationName) {\n    const startTime = performance.now();\n    this.metrics.set(operationName, { startTime, operations: 0 });\n    return startTime;\n  }\n\n  static endOperation(operationName, startTime = null) {\n    const endTime = performance.now();\n    const metric = this.metrics.get(operationName);\n\n    if (metric) {\n      const duration = endTime - (startTime || metric.startTime);\n      metric.operations += 1;\n      metric.lastDuration = duration;\n      metric.averageDuration =\n        ((metric.averageDuration || 0) * (metric.operations - 1) + duration) /\n        metric.operations;\n\n      // Performance warning for slow accessibility operations\n      if (duration > ACCESSIBILITY_CONSTANTS.FOCUS_DELAY * 2) {\n        logger.warn(\n          `Slow accessibility operation: ${operationName} took ${duration.toFixed(2)}ms`\n        );\n      }\n    }\n  }\n\n  static getMetrics() {\n    return Object.fromEntries(this.metrics);\n  }\n}\n\n/**\n * Enhanced error handling for accessibility operations\n */\nclass AccessibilityError extends Error {\n  constructor(message, context = {}, originalError = null) {\n    super(message);\n    this.name = 'AccessibilityError';\n    this.context = context;\n    this.originalError = originalError;\n    this.timestamp = new Date().toISOString();\n    this.userAgent = navigator.userAgent;\n    this.screenReader = AccessibilityManager.detectScreenReaderType();\n  }\n}\n\nclass AccessibilityManager {\n  constructor(container, engine) {\n    this.container = container;\n    this.engine = engine;\n    this.components = new Map();\n    this.focusableElements = [];\n    this.currentFocusIndex = -1;\n    this.keyboardNavigationEnabled = true;\n    this.screenReaderEnabled = this.detectScreenReader();\n\n    // Enhanced state management\n    this.announcements = [];\n    this.announcementDelay = ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_DELAY;\n    this.theme = AccessibilityTheme.getCurrentTheme();\n    this.isHighContrastMode = this.theme.highContrast;\n    this.isReducedMotionMode = this.theme.reducedMotion;\n\n    // Performance monitoring\n    this.performanceMonitor = AccessibilityPerformanceMonitor;\n    this.renderCache = new Map();\n\n    // Advanced features\n    this.gestureHandler = null;\n    this.voiceCommands = new Map();\n    this.keyboardShortcuts = new Map();\n    this.focusHistory = [];\n    this.regionManager = new Map();\n\n    // Error handling\n    this.errorCount = 0;\n    this.lastError = null;\n    this.init();\n  }\n\n  init() {\n    const startTime =\n      this.performanceMonitor.startOperation('accessibility-init');\n\n    try {\n      this.setupContainer();\n      this.setupKeyboardNavigation();\n      this.setupScreenReaderSupport();\n      this.setupFocusManagement();\n      this.setupThemeIntegration();\n      this.setupGestureSupport();\n      this.createAccessibilityOverlay();\n      this.setupPerformanceMonitoring();\n\n      // Listen for theme changes\n      this.setupThemeChangeListeners();\n\n      // Setup voice commands if supported\n      this.setupVoiceCommands();\n\n      logger.info(\n        'Accessibility',\n        'Enhanced AccessibilityManager initialized with advanced features'\n      );\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError(\n          'Failed to initialize AccessibilityManager',\n          { container: this.container.id },\n          error\n        )\n      );\n    } finally {\n      this.performanceMonitor.endOperation('accessibility-init', startTime);\n    }\n  }\n\n  setupContainer() {\n    // Enhanced container setup with theme awareness\n    if (!this.container.hasAttribute('tabindex')) {\n      this.container.setAttribute('tabindex', '0');\n    }\n\n    if (!this.container.hasAttribute('role')) {\n      this.container.setAttribute('role', 'application');\n    }\n\n    if (!this.container.hasAttribute('aria-label')) {\n      this.container.setAttribute(\n        'aria-label',\n        'AI Ethics Simulation Environment'\n      );\n    }\n\n    // Enhanced accessibility attributes\n    this.container.setAttribute(\n      'aria-describedby',\n      'accessibility-description'\n    );\n    this.container.setAttribute('aria-live', 'polite');\n    this.container.setAttribute('aria-atomic', 'false');\n\n    // Theme-aware classes\n    this.container.classList.add('accessibility-enabled');\n    this.updateContainerTheme();\n\n    // Create accessibility description\n    this.createAccessibilityDescription();\n  }\n\n  createAccessibilityDescription() {\n    if (document.getElementById('accessibility-description')) return;\n\n    const description = document.createElement('div');\n    description.id = 'accessibility-description';\n    description.className = 'sr-only';\n    description.textContent =\n      'Interactive AI ethics simulation with keyboard navigation, screen reader support, and voice commands. Press ? for help.';\n    document.body.appendChild(description);\n  }\n\n  updateContainerTheme() {\n    this.container.classList.toggle('high-contrast', this.theme.highContrast);\n    this.container.classList.toggle('reduced-motion', this.theme.reducedMotion);\n\n    // Update CSS custom properties for enhanced theming\n    this.container.style.setProperty(\n      '--accessibility-focus-color',\n      this.theme.highContrast ? '#ffff00' : '#007bff'\n    );\n    this.container.style.setProperty(\n      '--accessibility-bg-color',\n      this.theme.highContrast ? '#000000' : '#ffffff'\n    );\n  }\n\n  setupThemeIntegration() {\n    // Apply theme-specific accessibility enhancements\n    this.applyThemeSpecificStyles();\n\n    // Setup automatic theme detection\n    this.observeThemeChanges();\n  }\n\n  applyThemeSpecificStyles() {\n    const focusStyle = AccessibilityTheme.getFocusStyle(this.theme);\n\n    // Create or update focus style sheet\n    let styleSheet = document.getElementById('accessibility-focus-styles');\n    if (!styleSheet) {\n      styleSheet = document.createElement('style');\n      styleSheet.id = 'accessibility-focus-styles';\n      document.head.appendChild(styleSheet);\n    }\n\n    styleSheet.textContent = `\n            .accessibility-enabled *:focus {\n                outline: ${focusStyle.outline} !important;\n                outline-offset: ${focusStyle.outlineOffset} !important;\n                background-color: ${focusStyle.backgroundColor} !important;\n            }\n            \n            .accessibility-enabled .focus-indicator {\n                border: 3px solid ${this.theme.highContrast ? '#ffff00' : '#007bff'};\n                box-shadow: ${this.theme.highContrast ? 'none' : '0 0 0 1px white'};\n            }\n            \n            .accessibility-enabled .high-contrast {\n                filter: ${this.theme.highContrast ? 'contrast(200%) brightness(150%)' : 'none'};\n            }\n        `;\n  }\n\n  observeThemeChanges() {\n    // Watch for system theme changes\n    const contrastQuery = window.matchMedia('(prefers-contrast: high)');\n    const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n\n    const updateTheme = () => {\n      this.theme = AccessibilityTheme.getCurrentTheme();\n      this.updateContainerTheme();\n      this.applyThemeSpecificStyles();\n      this.updateFocusIndicatorTheme();\n      this.announce(`Theme updated: ${this.theme.theme} mode`);\n    };\n\n    if (contrastQuery.addEventListener) {\n      contrastQuery.addEventListener('change', updateTheme);\n      motionQuery.addEventListener('change', updateTheme);\n    } else {\n      // Fallback for older browsers\n      contrastQuery.addListener(updateTheme);\n      motionQuery.addListener(updateTheme);\n    }\n  }\n\n  setupThemeChangeListeners() {\n    // Custom theme change events\n    document.addEventListener('themechange', event => {\n      this.theme = AccessibilityTheme.getCurrentTheme();\n      this.updateContainerTheme();\n      this.applyThemeSpecificStyles();\n      this.announce(`Application theme changed to ${event.detail.theme}`);\n    });\n  }\n\n  setupGestureSupport() {\n    if (!('ontouchstart' in window)) return;\n\n    this.gestureHandler = {\n      startX: 0,\n      startY: 0,\n      threshold: 50,\n      restraint: 100,\n      allowedTime: 300,\n      startTime: 0,\n    };\n\n    this.container.addEventListener(\n      'touchstart',\n      e => this.handleTouchStart(e),\n      { passive: true }\n    );\n    this.container.addEventListener('touchend', e => this.handleTouchEnd(e), {\n      passive: true,\n    });\n  }\n\n  handleTouchStart(e) {\n    const touch = e.changedTouches[0];\n    this.gestureHandler.startX = touch.pageX;\n    this.gestureHandler.startY = touch.pageY;\n    this.gestureHandler.startTime = new Date().getTime();\n  }\n\n  handleTouchEnd(e) {\n    const touch = e.changedTouches[0];\n    const distX = touch.pageX - this.gestureHandler.startX;\n    const distY = touch.pageY - this.gestureHandler.startY;\n    const elapsedTime = new Date().getTime() - this.gestureHandler.startTime;\n\n    if (elapsedTime <= this.gestureHandler.allowedTime) {\n      if (\n        Math.abs(distX) >= this.gestureHandler.threshold &&\n        Math.abs(distY) <= this.gestureHandler.restraint\n      ) {\n        const direction = distX < 0 ? 'left' : 'right';\n        this.handleSwipeGesture(direction);\n      } else if (\n        Math.abs(distY) >= this.gestureHandler.threshold &&\n        Math.abs(distX) <= this.gestureHandler.restraint\n      ) {\n        const direction = distY < 0 ? 'up' : 'down';\n        this.handleSwipeGesture(direction);\n      }\n    }\n  }\n\n  handleSwipeGesture(direction) {\n    switch (direction) {\n      case 'right':\n        this.handleTabNavigation(false);\n        this.announce('Swiped to next element');\n        break;\n      case 'left':\n        this.handleTabNavigation(true);\n        this.announce('Swiped to previous element');\n        break;\n      case 'up':\n        this.cycleFocusRegions(-1);\n        break;\n      case 'down':\n        this.cycleFocusRegions(1);\n        break;\n    }\n  }\n\n  setupVoiceCommands() {\n    if (\n      !('webkitSpeechRecognition' in window) &&\n      !('SpeechRecognition' in window)\n    ) {\n      return; // Voice commands not supported\n    }\n\n    try {\n      const SpeechRecognition =\n        window.SpeechRecognition || window.webkitSpeechRecognition;\n      this.speechRecognition = new SpeechRecognition();\n      this.speechRecognition.continuous = false;\n      this.speechRecognition.interimResults = false;\n      this.speechRecognition.lang = navigator.language || 'en-US';\n\n      this.setupVoiceCommandMap();\n\n      this.speechRecognition.onresult = event => {\n        const command = event.results[0][0].transcript.toLowerCase().trim();\n        this.processVoiceCommand(command);\n      };\n\n      this.speechRecognition.onerror = event => {\n        logger.warn('Speech recognition error:', event.error);\n      };\n    } catch (error) {\n      logger.warn('Voice commands setup failed:', error);\n    }\n  }\n\n  setupVoiceCommandMap() {\n    this.voiceCommands.set('next', () => this.handleTabNavigation(false));\n    this.voiceCommands.set('previous', () => this.handleTabNavigation(true));\n    this.voiceCommands.set('activate', () => this.activateCurrentElement());\n    this.voiceCommands.set('help', () => this.showKeyboardShortcuts());\n    this.voiceCommands.set('escape', () => this.handleEscape());\n    this.voiceCommands.set('high contrast', () =>\n      this.toggleHighContrastMode()\n    );\n    this.voiceCommands.set('large text', () => this.toggleLargeTextMode());\n  }\n\n  processVoiceCommand(command) {\n    for (const [trigger, action] of this.voiceCommands) {\n      if (command.includes(trigger)) {\n        action();\n        this.announce(`Voice command executed: ${trigger}`);\n        return;\n      }\n    }\n\n    this.announce(\n      'Voice command not recognized. Say \"help\" for available commands.'\n    );\n  }\n\n  setupPerformanceMonitoring() {\n    // Monitor focus performance\n    let focusOperations = 0;\n    const originalFocus = this.focusComponent;\n\n    this.focusComponent = (...args) => {\n      const startTime =\n        this.performanceMonitor.startOperation('focus-component');\n      const result = originalFocus.apply(this, args);\n      this.performanceMonitor.endOperation('focus-component', startTime);\n\n      focusOperations++;\n      if (focusOperations % 100 === 0) {\n        logger.info(\n          'Accessibility Performance:',\n          this.performanceMonitor.getMetrics()\n        );\n      }\n\n      return result;\n    };\n  }\n\n  setupKeyboardNavigation() {\n    // Enhanced keyboard event handling with performance optimization\n    const throttledKeyDown = this.throttle(\n      e => this.handleKeyDown(e),\n      ACCESSIBILITY_CONSTANTS.KEYBOARD_REPEAT_DELAY\n    );\n\n    this.container.addEventListener('keydown', throttledKeyDown);\n    this.container.addEventListener('keyup', e => this.handleKeyUp(e));\n\n    // Enhanced focus management\n    this.container.addEventListener('focus', () => this.onContainerFocus());\n    this.container.addEventListener('blur', () => this.onContainerBlur());\n\n    // Setup advanced keyboard shortcuts\n    this.setupKeyboardShortcuts();\n  }\n\n  setupKeyboardShortcuts() {\n    this.keyboardShortcuts.set('ctrl+shift+?', () =>\n      this.showKeyboardShortcuts()\n    );\n    this.keyboardShortcuts.set('ctrl+shift+h', () =>\n      this.toggleHighContrastMode()\n    );\n    this.keyboardShortcuts.set('ctrl+shift+l', () =>\n      this.toggleLargeTextMode()\n    );\n    this.keyboardShortcuts.set('ctrl+shift+v', () =>\n      this.toggleVoiceCommands()\n    );\n    this.keyboardShortcuts.set('ctrl+shift+r', () =>\n      this.resetAccessibilitySettings()\n    );\n    this.keyboardShortcuts.set('ctrl+shift+f', () =>\n      this.showAccessibilityReport()\n    );\n  }\n\n  toggleVoiceCommands() {\n    if (this.speechRecognition) {\n      if (this.voiceCommandsEnabled) {\n        this.speechRecognition.stop();\n        this.voiceCommandsEnabled = false;\n        this.announce('Voice commands disabled');\n      } else {\n        this.speechRecognition.start();\n        this.voiceCommandsEnabled = true;\n        this.announce(\n          'Voice commands enabled. Say \"help\" for available commands.'\n        );\n      }\n    } else {\n      this.announce('Voice commands not supported in this browser');\n    }\n  }\n\n  showAccessibilityReport() {\n    const metrics = this.performanceMonitor.getMetrics();\n    const componentCount = this.components.size;\n    const focusableCount = this.focusableElements.length;\n\n    const report = `\n            Accessibility Report:\n            - ${componentCount} registered components\n            - ${focusableCount} focusable elements\n            - Theme: ${this.theme.theme}\n            - High contrast: ${this.theme.highContrast ? 'enabled' : 'disabled'}\n            - Reduced motion: ${this.theme.reducedMotion ? 'enabled' : 'disabled'}\n            - Screen reader: ${this.screenReaderEnabled ? 'detected' : 'not detected'}\n            - Voice commands: ${this.voiceCommandsEnabled ? 'available' : 'not available'}\n            - Performance: ${Object.keys(metrics).length} tracked operations\n        `;\n\n    this.announce(report, true);\n    logger.info('Accessibility Report:', {\n      metrics,\n      theme: this.theme,\n      components: componentCount,\n    });\n  }\n\n  resetAccessibilitySettings() {\n    this.setHighContrastMode(false);\n    this.setLargeTextMode(false);\n    this.setKeyboardNavigationEnabled(true);\n\n    if (this.speechRecognition && this.voiceCommandsEnabled) {\n      this.speechRecognition.stop();\n      this.voiceCommandsEnabled = false;\n    }\n    this.announce('Accessibility settings reset to defaults');\n  }\n\n  setupScreenReaderSupport() {\n    // Enhanced screen reader support with multiple announcement regions\n    this.createAnnouncementRegions();\n    this.setupScreenReaderDetection();\n  }\n\n  createAnnouncementRegions() {\n    // Primary announcement region (polite)\n    this.liveRegion = this.createAnnouncementRegion(\n      'polite',\n      'accessibility-announcements'\n    );\n\n    // Urgent announcements region (assertive)\n    this.urgentRegion = this.createAnnouncementRegion(\n      'assertive',\n      'accessibility-urgent'\n    );\n\n    // Status region for ongoing updates\n    this.statusRegion = this.createAnnouncementRegion(\n      'polite',\n      'accessibility-status'\n    );\n    this.statusRegion.setAttribute('aria-atomic', 'false');\n\n    // Log region for detailed information\n    this.logRegion = this.createAnnouncementRegion(\n      'polite',\n      'accessibility-log'\n    );\n    this.logRegion.setAttribute('role', 'log');\n  }\n\n  createAnnouncementRegion(liveType, id) {\n    if (document.getElementById(id)) {\n      return document.getElementById(id);\n    }\n\n    const region = document.createElement('div');\n    region.id = id;\n    region.setAttribute('aria-live', liveType);\n    region.setAttribute('aria-atomic', 'true');\n    region.className = 'sr-only';\n    region.style.cssText = `\n            position: absolute !important;\n            left: -10000px !important;\n            width: 1px !important;\n            height: 1px !important;\n            overflow: hidden !important;\n            clip: rect(1px, 1px, 1px, 1px) !important;\n            white-space: nowrap !important;\n        `;\n    document.body.appendChild(region);\n    return region;\n  }\n\n  setupScreenReaderDetection() {\n    // Enhanced screen reader detection\n    this.screenReaderType = this.detectScreenReaderType();\n    this.screenReaderEnabled = this.screenReaderType !== null;\n\n    // Customize behavior based on detected screen reader\n    if (this.screenReaderType) {\n      this.adaptToScreenReader(this.screenReaderType);\n    }\n  }\n\n  detectScreenReaderType() {\n    const { userAgent } = navigator;\n\n    for (const [type, pattern] of Object.entries(SCREEN_READER_PATTERNS)) {\n      if (pattern.test(userAgent)) {\n        return type.toLowerCase();\n      }\n    }\n\n    // Check for screen reader APIs\n    if (\n      window.speechSynthesis &&\n      window.speechSynthesis.getVoices().length > 0\n    ) {\n      return 'speech-synthesis';\n    }\n\n    // Check for high contrast as screen reader indicator\n    if (\n      window.matchMedia &&\n      window.matchMedia('(prefers-contrast: high)').matches\n    ) {\n      return 'high-contrast-user';\n    }\n\n    return null;\n  }\n\n  adaptToScreenReader(screenReaderType) {\n    switch (screenReaderType) {\n      case 'nvda':\n      case 'jaws':\n        // Optimize for Windows screen readers\n        this.announcementDelay =\n          ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_DELAY *\n          ACCESSIBILITY_CONSTANTS.SCREEN_READER_DELAY_MULTIPLIER;\n        this.verboseMode = true;\n        break;\n      case 'voiceover':\n        // Optimize for macOS VoiceOver\n        this.announcementDelay = ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_DELAY;\n        this.verboseMode = false;\n        break;\n      case 'narrator':\n        // Optimize for Windows Narrator\n        this.announcementDelay = ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_DELAY * 2;\n        this.verboseMode = true;\n        break;\n      default:\n        this.verboseMode = false;\n    }\n\n    logger.info(\n      `Accessibility optimized for ${screenReaderType} screen reader`\n    );\n  }\n\n  setupFocusManagement() {\n    // Track focus changes\n    document.addEventListener('focusin', e => this.onFocusChange(e));\n    document.addEventListener('focusout', e => this.onFocusChange(e));\n  }\n\n  createAccessibilityOverlay() {\n    // Enhanced accessibility overlay with modern features\n    this.overlay = document.createElement('div');\n    this.overlay.className = 'accessibility-overlay';\n    this.overlay.setAttribute('aria-hidden', 'true');\n    this.overlay.style.cssText = `\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            pointer-events: none;\n            z-index: 10000;\n            contain: layout style;\n        `;\n\n    this.container.appendChild(this.overlay);\n\n    // Enhanced focus indicator with theme support\n    this.createFocusIndicator();\n\n    // Create accessibility toolbar\n    this.createAccessibilityToolbar();\n  }\n\n  createFocusIndicator() {\n    this.focusIndicator = document.createElement('div');\n    this.focusIndicator.className = 'focus-indicator';\n    this.focusIndicator.setAttribute('aria-hidden', 'true');\n    this.updateFocusIndicatorTheme();\n\n    this.overlay.appendChild(this.focusIndicator);\n  }\n\n  updateFocusIndicatorTheme() {\n    if (!this.focusIndicator) return;\n\n    this.focusIndicator.style.cssText = `\n            position: absolute;\n            border: 3px solid ${this.theme.highContrast ? '#ffff00' : '#007bff'};\n            border-radius: 4px;\n            box-shadow: ${this.theme.highContrast ? 'none' : '0 0 0 1px white, 0 0 8px rgba(0, 123, 255, 0.3)'};\n            pointer-events: none;\n            transition: ${this.theme.reducedMotion ? 'none' : 'all 0.2s ease'};\n            display: none;\n            z-index: 10001;\n        `;\n  }\n\n  createAccessibilityToolbar() {\n    if (!this.theme.highContrast && !this.isAccessibilityToolbarRequested)\n      return;\n\n    this.accessibilityToolbar = document.createElement('div');\n    this.accessibilityToolbar.className = 'accessibility-toolbar';\n    this.accessibilityToolbar.setAttribute('role', 'toolbar');\n    this.accessibilityToolbar.setAttribute('aria-label', 'Accessibility Tools');\n\n    const toolbarButtons = [\n      {\n        id: 'high-contrast',\n        label: 'Toggle High Contrast',\n        action: () => this.toggleHighContrastMode(),\n      },\n      {\n        id: 'large-text',\n        label: 'Toggle Large Text',\n        action: () => this.toggleLargeTextMode(),\n      },\n      {\n        id: 'keyboard-help',\n        label: 'Show Keyboard Help',\n        action: () => this.showKeyboardShortcuts(),\n      },\n      {\n        id: 'voice-commands',\n        label: 'Toggle Voice Commands',\n        action: () => this.toggleVoiceCommands(),\n      },\n    ];\n\n    toolbarButtons.forEach(button => {\n      const btn = document.createElement('button');\n      btn.id = button.id;\n      btn.textContent = button.label;\n      btn.setAttribute('aria-label', button.label);\n      btn.addEventListener('click', button.action);\n      this.accessibilityToolbar.appendChild(btn);\n    });\n\n    this.accessibilityToolbar.style.cssText = `\n            position: fixed;\n            top: 10px;\n            right: 10px;\n            display: flex;\n            gap: 5px;\n            background: #ffffff;\n            border: 2px solid ${this.theme.highContrast ? '#ffff00' : '#007bff'};\n            border-radius: 4px;\n            padding: 5px;\n            z-index: 10002;\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n        `;\n    document.body.appendChild(this.accessibilityToolbar);\n  }\n\n  // Enhanced component registration with performance monitoring\n  registerComponent(component) {\n    const startTime =\n      this.performanceMonitor.startOperation('register-component');\n\n    try {\n      if (!component || !component.id) {\n        throw new AccessibilityError(\n          'Invalid component for accessibility registration',\n          { component }\n        );\n      }\n\n      const accessibilityConfig =\n        component.accessibilityConfig ||\n        this.getDefaultAccessibilityConfig(component);\n\n      // Enhanced component data with performance tracking\n      const componentData = {\n        component,\n        config: accessibilityConfig,\n        focusable: accessibilityConfig.focusable !== false,\n        description:\n          accessibilityConfig.description ||\n          this.generateComponentDescription(component),\n        role: accessibilityConfig.role || 'button',\n        keyboardActions: accessibilityConfig.keyboardActions || {},\n        registrationTime: Date.now(),\n        focusCount: 0,\n        lastFocused: null,\n      };\n\n      this.components.set(component.id, componentData);\n      this.updateFocusableElements();\n      this.applyAccessibilityAttributes(component, accessibilityConfig);\n\n      // Register with region manager\n      this.registerComponentInRegion(component, accessibilityConfig);\n\n      // Announce registration if verbose mode\n      if (this.verboseMode) {\n        this.announce(`Component registered: ${componentData.description}`);\n      }\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError(\n          'Failed to register component',\n          { componentId: component?.id },\n          error\n        )\n      );\n    } finally {\n      this.performanceMonitor.endOperation('register-component', startTime);\n    }\n  }\n\n  generateComponentDescription(component) {\n    const type = component.constructor.name.toLowerCase();\n    const text = component.text || component.label || component.title || '';\n    const value =\n      component.value !== undefined ? ` with value ${component.value}` : '';\n\n    return `${type}${text ? `: ${text}` : ''}${value}`;\n  }\n\n  registerComponentInRegion(component, config) {\n    const regionName = config.region || 'main';\n\n    if (!this.regionManager.has(regionName)) {\n      this.regionManager.set(regionName, {\n        components: new Set(),\n        focusIndex: -1,\n        description: config.regionDescription || `${regionName} region`,\n      });\n    }\n\n    this.regionManager.get(regionName).components.add(component.id);\n  }\n\n  unregisterComponent(component) {\n    if (component && component.id) {\n      const componentData = this.components.get(component.id);\n      if (componentData && this.verboseMode) {\n        this.announce(`Component unregistered: ${componentData.description}`);\n      }\n\n      this.components.delete(component.id);\n      this.updateFocusableElements();\n\n      // Remove from region manager\n      for (const region of this.regionManager.values()) {\n        region.components.delete(component.id);\n      }\n    }\n  }\n\n  getDefaultAccessibilityConfig(component) {\n    const componentType = component.constructor.name.toLowerCase();\n\n    const defaults = {\n      button: {\n        role: 'button',\n        focusable: true,\n        keyboardActions: { Enter: 'click', Space: 'click' },\n        description: 'Button',\n      },\n      slider: {\n        role: 'slider',\n        focusable: true,\n        keyboardActions: {\n          ArrowLeft: 'decrease',\n          ArrowRight: 'increase',\n          ArrowDown: 'decrease',\n          ArrowUp: 'increase',\n          Home: 'minimum',\n          End: 'maximum',\n        },\n        description: 'Slider',\n      },\n      panel: {\n        role: 'region',\n        focusable: true,\n        keyboardActions: {},\n        description: 'Panel',\n      },\n      tabcontainer: {\n        role: 'tablist',\n        focusable: true,\n        keyboardActions: {\n          ArrowLeft: 'previousTab',\n          ArrowRight: 'nextTab',\n          Home: 'firstTab',\n          End: 'lastTab',\n        },\n        description: 'Tab container',\n      },\n      treeview: {\n        role: 'tree',\n        focusable: true,\n        keyboardActions: {\n          ArrowUp: 'previousNode',\n          ArrowDown: 'nextNode',\n          ArrowLeft: 'collapseNode',\n          ArrowRight: 'expandNode',\n          Enter: 'activateNode',\n          Space: 'toggleNode',\n        },\n        description: 'Tree view',\n      },\n      fileupload: {\n        role: 'button',\n        focusable: true,\n        keyboardActions: { Enter: 'openFileDialog', Space: 'openFileDialog' },\n        description: 'File upload',\n      },\n    };\n\n    return (\n      defaults[componentType] || {\n        role: 'generic',\n        focusable: true,\n        keyboardActions: {},\n        description: 'Interactive element',\n      }\n    );\n  }\n\n  applyAccessibilityAttributes(component, config) {\n    if (!component.element) return;\n\n    const { element } = component;\n\n    try {\n      // Set ARIA attributes with enhanced support\n      this.setAriaAttribute(element, 'role', config.role);\n\n      if (config.focusable) {\n        element.setAttribute(\n          'tabindex',\n          element.hasAttribute('tabindex')\n            ? element.getAttribute('tabindex')\n            : '0'\n        );\n      }\n\n      if (config.description) {\n        this.setAriaAttribute(element, 'aria-label', config.description);\n      }\n\n      // Enhanced ARIA attributes\n      if (config.required) {\n        this.setAriaAttribute(element, 'aria-required', 'true');\n      }\n\n      if (config.expanded !== undefined) {\n        this.setAriaAttribute(\n          element,\n          'aria-expanded',\n          config.expanded.toString()\n        );\n      }\n\n      if (config.selected !== undefined) {\n        this.setAriaAttribute(\n          element,\n          'aria-selected',\n          config.selected.toString()\n        );\n      }\n\n      if (config.pressed !== undefined) {\n        this.setAriaAttribute(\n          element,\n          'aria-pressed',\n          config.pressed.toString()\n        );\n      }\n\n      // Add keyboard event listeners with enhanced error handling\n      this.addKeyboardListeners(element, component, config.keyboardActions);\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError(\n          'Failed to apply accessibility attributes',\n          {\n            componentId: component.id,\n            config,\n          },\n          error\n        )\n      );\n    }\n  }\n\n  setAriaAttribute(element, attribute, value) {\n    if (value !== null && value !== undefined) {\n      element.setAttribute(attribute, value);\n    }\n  }\n\n  addKeyboardListeners(element, component, keyboardActions) {\n    Object.entries(keyboardActions).forEach(([key, action]) => {\n      const listener = e => {\n        if (e.key === key || e.code === key) {\n          e.preventDefault();\n          e.stopPropagation();\n          this.handleComponentKeyboardAction(component, action, e);\n        }\n      };\n\n      element.addEventListener('keydown', listener);\n\n      // Store listener for cleanup\n      if (!component._accessibilityListeners) {\n        component._accessibilityListeners = [];\n      }\n      component._accessibilityListeners.push({\n        element,\n        event: 'keydown',\n        listener,\n      });\n    });\n  }\n\n  updateFocusableElements() {\n    const startTime =\n      this.performanceMonitor.startOperation('update-focusable');\n\n    try {\n      this.focusableElements = Array.from(this.components.values())\n        .filter(\n          item =>\n            item.focusable &&\n            item.component.visible !== false &&\n            !item.component.disabled\n        )\n        .map(item => item.component)\n        .sort((a, b) => {\n          // Sort by tabindex, then by DOM order\n          const aTabIndex = parseInt(\n            a.element?.getAttribute('tabindex') || '0'\n          );\n          const bTabIndex = parseInt(\n            b.element?.getAttribute('tabindex') || '0'\n          );\n\n          if (aTabIndex !== bTabIndex) {\n            return aTabIndex - bTabIndex;\n          }\n\n          // Use DOM order if tabindex is the same\n          if (a.element && b.element && a.element.compareDocumentPosition) {\n            return a.element.compareDocumentPosition(b.element) &\n              Node.DOCUMENT_POSITION_FOLLOWING\n              ? -1\n              : 1;\n          }\n\n          return 0;\n        });\n\n      // Update current focus index if needed\n      if (this.currentFocusIndex >= this.focusableElements.length) {\n        this.currentFocusIndex = this.focusableElements.length - 1;\n      }\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError('Failed to update focusable elements', {}, error)\n      );\n    } finally {\n      this.performanceMonitor.endOperation('update-focusable', startTime);\n    }\n  }\n\n  // Enhanced error handling\n  handleError(error) {\n    this.errorCount++;\n    this.lastError = error;\n\n    logger.error('Accessibility Error:', error);\n\n    // Emit error event for application-level handling\n    if (this.engine && this.engine.emit) {\n      this.engine.emit('accessibility:error', error);\n    }\n\n    // Attempt graceful recovery\n    this.attemptErrorRecovery(error);\n\n    // Rate limiting: if too many errors, temporarily disable features\n    if (this.errorCount > 10) {\n      logger.warn(\n        'High error rate detected, temporarily reducing accessibility features'\n      );\n      this.reduceFeatures();\n    }\n  }\n\n  attemptErrorRecovery(error) {\n    switch (error.context?.operation) {\n      case 'focus':\n        this.currentFocusIndex = -1;\n        break;\n      case 'register-component':\n        // Try to recover component registration\n        if (error.context?.componentId) {\n          setTimeout(() => {\n            const component = this.findComponentById(error.context.componentId);\n            if (component) {\n              this.registerComponent(component);\n            }\n          }, 1000);\n        }\n        break;\n      case 'keyboard':\n        this.keyboardNavigationEnabled = true;\n        break;\n    }\n  }\n\n  reduceFeatures() {\n    this.verboseMode = false;\n    this.announcementDelay *= 2;\n\n    // Re-enable after a delay\n    setTimeout(() => {\n      this.errorCount = 0;\n      this.verboseMode = this.screenReaderType !== null;\n      this.announcementDelay = ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_DELAY;\n    }, ACCESSIBILITY_CONSTANTS.FEATURE_DISABLE_TIMEOUT);\n  }\n\n  findComponentById(id) {\n    const data = this.components.get(id);\n    return data ? data.component : null;\n  }\n\n  // Enhanced keyboard navigation with performance optimization\n  handleKeyDown(e) {\n    if (!this.keyboardNavigationEnabled) return;\n\n    const startTime = this.performanceMonitor.startOperation(\n      'keyboard-navigation'\n    );\n\n    try {\n      // Check for keyboard shortcuts first\n      const shortcutKey = this.getShortcutKey(e);\n      if (this.keyboardShortcuts.has(shortcutKey)) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.keyboardShortcuts.get(shortcutKey)();\n        return;\n      }\n\n      switch (e.key) {\n        case 'Tab':\n          e.preventDefault();\n          this.handleTabNavigation(e.shiftKey);\n          break;\n        case 'Escape':\n          this.handleEscape();\n          break;\n        case 'F6':\n          e.preventDefault();\n          this.cycleFocusRegions(e.shiftKey ? -1 : 1);\n          break;\n        case '?':\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            this.showKeyboardShortcuts();\n          }\n          break;\n        case 'F1':\n          e.preventDefault();\n          this.showAccessibilityHelp();\n          break;\n      }\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError(\n          'Keyboard navigation error',\n          { key: e.key, operation: 'keyboard' },\n          error\n        )\n      );\n    } finally {\n      this.performanceMonitor.endOperation('keyboard-navigation', startTime);\n    }\n  }\n\n  getShortcutKey(e) {\n    const parts = [];\n    if (e.ctrlKey) parts.push('ctrl');\n    if (e.shiftKey) parts.push('shift');\n    if (e.altKey) parts.push('alt');\n    if (e.metaKey) parts.push('meta');\n    parts.push(e.key.toLowerCase());\n    return parts.join('+');\n  }\n\n  showAccessibilityHelp() {\n    const help = `\n            Accessibility Help:\n            \n            Navigation:\n            - Tab/Shift+Tab: Move between elements\n            - Arrow keys: Navigate within components\n            - Enter/Space: Activate elements\n            - Escape: Cancel or close\n            - F6/Shift+F6: Cycle between regions\n            - F1: Show this help\n            \n            Shortcuts:\n            - Ctrl+Shift+?: Show keyboard shortcuts\n            - Ctrl+Shift+H: Toggle high contrast\n            - Ctrl+Shift+L: Toggle large text\n            - Ctrl+Shift+V: Toggle voice commands\n            - Ctrl+Shift+R: Reset accessibility settings\n            - Ctrl+Shift+F: Show accessibility report\n            \n            Voice Commands (if available):\n            - \"Next\" or \"Previous\": Navigate elements\n            - \"Activate\": Activate current element\n            - \"Help\": Show available commands\n            - \"High contrast\": Toggle high contrast mode\n            - \"Large text\": Toggle large text mode\n            \n            Current Settings:\n            - Theme: ${this.theme.theme}\n            - High contrast: ${this.theme.highContrast ? 'on' : 'off'}\n            - Reduced motion: ${this.theme.reducedMotion ? 'on' : 'off'}\n            - Screen reader: ${this.screenReaderEnabled ? 'detected' : 'not detected'}\n            - Voice commands: ${this.voiceCommandsEnabled ? 'enabled' : 'disabled'}\n        `;\n\n    this.announce(help, true);\n  }\n\n  handleTabNavigation(backwards = false) {\n    if (this.focusableElements.length === 0) return;\n\n    const direction = backwards ? -1 : 1;\n    let newIndex = this.currentFocusIndex + direction;\n\n    // Wrap around\n    if (newIndex >= this.focusableElements.length) {\n      newIndex = 0;\n    } else if (newIndex < 0) {\n      newIndex = this.focusableElements.length - 1;\n    }\n\n    this.currentFocusIndex = newIndex;\n    this.focusComponent(this.focusableElements[this.currentFocusIndex]);\n  }\n\n  handleComponentKeyboardAction(component, action, event) {\n    const componentData = this.components.get(component.id);\n    if (!componentData) return;\n\n    const startTime =\n      this.performanceMonitor.startOperation('component-action');\n\n    try {\n      // Update component usage statistics\n      componentData.lastFocused = Date.now();\n      componentData.focusCount++;\n\n      switch (action) {\n        case 'click':\n        case 'activate':\n          this.activateComponent(component, componentData);\n          break;\n\n        case 'increase':\n        case 'decrease':\n          this.adjustComponentValue(component, action, componentData);\n          break;\n\n        case 'minimum':\n        case 'maximum':\n          this.setComponentExtreme(component, action, componentData);\n          break;\n\n        case 'previousTab':\n        case 'nextTab':\n        case 'firstTab':\n        case 'lastTab':\n          this.handleTabAction(component, action, componentData);\n          break;\n\n        case 'previousNode':\n        case 'nextNode':\n        case 'expandNode':\n        case 'collapseNode':\n        case 'activateNode':\n        case 'toggleNode':\n          this.handleTreeAction(component, action, componentData);\n          break;\n\n        case 'openFileDialog':\n          this.handleFileAction(component, action, componentData);\n          break;\n\n        default:\n          // Custom action handling\n          if (component[action] && typeof component[action] === 'function') {\n            component[action](event);\n            this.announce(\n              `${action} performed on ${componentData.description}`\n            );\n          }\n      }\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError(\n          'Component action failed',\n          {\n            componentId: component.id,\n            action,\n            operation: 'component-action',\n          },\n          error\n        )\n      );\n    } finally {\n      this.performanceMonitor.endOperation('component-action', startTime);\n    }\n  }\n\n  activateComponent(component, componentData) {\n    if (component.element && component.element.click) {\n      component.element.click();\n    } else if (component.onClick) {\n      component.onClick();\n    } else if (component.activate) {\n      component.activate();\n    }\n    this.announce(`${componentData.description} activated`);\n  }\n\n  adjustComponentValue(component, action, componentData) {\n    if (component.setValue && component.value !== undefined) {\n      const delta = action === 'increase' ? 1 : -1;\n      const step = component.step || 1;\n      const newValue = Math.max(\n        component.min || 0,\n        Math.min(component.max || 100, component.value + delta * step)\n      );\n      component.setValue(newValue);\n      this.announce(`${componentData.description} ${action}d to ${newValue}`);\n    }\n  }\n\n  setComponentExtreme(component, action, componentData) {\n    if (component.setValue) {\n      const value =\n        action === 'minimum' ? component.min || 0 : component.max || 100;\n      component.setValue(value);\n      this.announce(\n        `${componentData.description} set to ${action} value: ${value}`\n      );\n    }\n  }\n\n  handleTabAction(component, action, componentData) {\n    if (component.handleTabNavigation) {\n      component.handleTabNavigation(action);\n      this.announce(\n        `Tab navigation: ${action} on ${componentData.description}`\n      );\n    }\n  }\n\n  handleTreeAction(component, action, componentData) {\n    if (component[action]) {\n      component[action]();\n      this.announce(`Tree action: ${action} on ${componentData.description}`);\n    }\n  }\n\n  handleFileAction(component, action, componentData) {\n    if (component.openFileDialog) {\n      component.openFileDialog();\n      this.announce(`File dialog opened for ${componentData.description}`);\n    }\n  }\n\n  focusComponent(component) {\n    if (!component || !component.element) return;\n\n    const startTime = this.performanceMonitor.startOperation('focus-component');\n\n    try {\n      // Store focus history\n      this.focusHistory.push({\n        component: component.id,\n        timestamp: Date.now(),\n      });\n\n      // Limit history size\n      if (\n        this.focusHistory.length > ACCESSIBILITY_CONSTANTS.FOCUS_HISTORY_LIMIT\n      ) {\n        this.focusHistory.shift();\n      }\n\n      component.element.focus();\n      this.updateFocusIndicator(component);\n\n      const componentData = this.components.get(component.id);\n      if (componentData) {\n        componentData.lastFocused = Date.now();\n        componentData.focusCount++;\n\n        if (componentData.description) {\n          this.announce(componentData.description);\n        }\n      }\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError(\n          'Focus operation failed',\n          {\n            componentId: component.id,\n            operation: 'focus',\n          },\n          error\n        )\n      );\n    } finally {\n      this.performanceMonitor.endOperation('focus-component', startTime);\n    }\n  }\n\n  updateFocusIndicator(component) {\n    if (!component.element || !this.focusIndicator) return;\n\n    try {\n      const rect = component.element.getBoundingClientRect();\n      const containerRect = this.container.getBoundingClientRect();\n\n      const left =\n        rect.left -\n        containerRect.left -\n        ACCESSIBILITY_CONSTANTS.FOCUS_BORDER_OFFSET;\n      const top =\n        rect.top -\n        containerRect.top -\n        ACCESSIBILITY_CONSTANTS.FOCUS_BORDER_OFFSET;\n      const width = rect.width + ACCESSIBILITY_CONSTANTS.FOCUS_BORDER_PADDING;\n      const height = rect.height + ACCESSIBILITY_CONSTANTS.FOCUS_BORDER_PADDING;\n\n      this.focusIndicator.style.cssText += `\n                display: block;\n                left: ${left}px;\n                top: ${top}px;\n                width: ${width}px;\n                height: ${height}px;\n            `;\n\n      // Ensure focus indicator is visible\n      if (this.theme.reducedMotion) {\n        this.focusIndicator.scrollIntoView({ block: 'nearest' });\n      } else {\n        this.focusIndicator.scrollIntoView({\n          block: 'nearest',\n          behavior: 'smooth',\n        });\n      }\n    } catch (error) {\n      this.handleError(\n        new AccessibilityError(\n          'Focus indicator update failed',\n          {\n            componentId: component.id,\n          },\n          error\n        )\n      );\n    }\n  }\n\n  // Enhanced screen reader announcements with intelligent queuing\n  announce(message, urgent = false, options = {}) {\n    if (!message) return;\n\n    const announcement = {\n      message: String(message).trim(),\n      urgent,\n      timestamp: Date.now(),\n      category: options.category || 'general',\n      priority: urgent ? 'high' : options.priority || 'normal',\n      delay: options.delay || this.announcementDelay,\n      repeat: options.repeat || false,\n    };\n\n    // Check for duplicate announcements\n    if (\n      !options.allowDuplicates &&\n      this.isDuplicateAnnouncement(announcement)\n    ) {\n      return;\n    }\n\n    this.announcements.push(announcement);\n\n    // Process immediately if urgent, otherwise queue\n    if (urgent) {\n      this.processUrgentAnnouncement(announcement);\n    } else {\n      setTimeout(() => this.processAnnouncements(), announcement.delay);\n    }\n  }\n\n  isDuplicateAnnouncement(newAnnouncement) {\n    const recentAnnouncements = this.announcements.filter(\n      a =>\n        Date.now() - a.timestamp < ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_TIMEOUT\n    );\n\n    return recentAnnouncements.some(\n      a =>\n        a.message === newAnnouncement.message &&\n        a.category === newAnnouncement.category\n    );\n  }\n\n  processUrgentAnnouncement(announcement) {\n    if (this.urgentRegion) {\n      this.urgentRegion.textContent = announcement.message;\n\n      setTimeout(() => {\n        if (this.urgentRegion) {\n          this.urgentRegion.textContent = '';\n        }\n      }, ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_CLEAR_DELAY);\n    }\n  }\n\n  processAnnouncements() {\n    if (this.announcements.length === 0) return;\n\n    // Process announcements by priority\n    this.announcements.sort((a, b) => {\n      const priorityOrder = { high: 3, normal: 2, low: 1 };\n      return priorityOrder[b.priority] - priorityOrder[a.priority];\n    });\n\n    const announcement = this.announcements.shift();\n\n    // Select appropriate region based on announcement type\n    let region = this.liveRegion;\n\n    if (announcement.urgent) {\n      region = this.urgentRegion;\n    } else if (announcement.category === 'status') {\n      region = this.statusRegion;\n    } else if (announcement.category === 'log') {\n      region = this.logRegion;\n    }\n\n    if (region) {\n      region.textContent = announcement.message;\n\n      // Clear after announcement with variable timing based on content length\n      const clearDelay = Math.min(\n        ACCESSIBILITY_CONSTANTS.GESTURE_TIMEOUT,\n        Math.max(\n          ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_MIN_DURATION,\n          announcement.message.length *\n            ACCESSIBILITY_CONSTANTS.ANNOUNCEMENT_CHAR_MULTIPLIER\n        )\n      );\n      setTimeout(() => {\n        if (region && region.textContent === announcement.message) {\n          region.textContent = '';\n        }\n      }, clearDelay);\n    }\n\n    // Log announcement for debugging\n    if (this.verboseMode) {\n      logger.info('Accessibility Announcement:', announcement);\n    }\n  }\n\n  // Enhanced region management\n  cycleFocusRegions(direction = 1) {\n    const regionNames = Array.from(this.regionManager.keys());\n    if (regionNames.length <= 1) return;\n\n    const currentRegion = this.getCurrentRegion();\n    let currentIndex = regionNames.indexOf(currentRegion);\n\n    if (currentIndex === -1) currentIndex = 0;\n\n    currentIndex =\n      (currentIndex + direction + regionNames.length) % regionNames.length;\n    const newRegion = regionNames[currentIndex];\n\n    this.focusOnRegion(newRegion);\n\n    const regionData = this.regionManager.get(newRegion);\n    this.announce(`Moved to ${regionData.description}`, false, {\n      category: 'navigation',\n    });\n  }\n\n  getCurrentRegion() {\n    // Determine current region based on focused element\n    if (\n      this.currentFocusIndex >= 0 &&\n      this.focusableElements[this.currentFocusIndex]\n    ) {\n      const focusedComponent = this.focusableElements[this.currentFocusIndex];\n\n      for (const [regionName, regionData] of this.regionManager) {\n        if (regionData.components.has(focusedComponent.id)) {\n          return regionName;\n        }\n      }\n    }\n\n    return 'main';\n  }\n\n  focusOnRegion(regionName) {\n    const regionData = this.regionManager.get(regionName);\n    if (!regionData || regionData.components.size === 0) return;\n\n    // Focus on first component in region\n    const firstComponentId = Array.from(regionData.components)[0];\n    const componentData = this.components.get(firstComponentId);\n\n    if (componentData) {\n      const componentIndex = this.focusableElements.indexOf(\n        componentData.component\n      );\n      if (componentIndex >= 0) {\n        this.currentFocusIndex = componentIndex;\n        this.focusComponent(componentData.component);\n      }\n    }\n  }\n\n  // Enhanced configuration methods with persistence\n  setKeyboardNavigationEnabled(enabled) {\n    this.keyboardNavigationEnabled = enabled;\n    this.announce(\n      `Keyboard navigation ${enabled ? 'enabled' : 'disabled'}`,\n      false,\n      { category: 'settings' }\n    );\n\n    // Persist setting\n    this.saveSetting('keyboardNavigation', enabled);\n  }\n\n  setHighContrastMode(enabled) {\n    this.isHighContrastMode = enabled;\n\n    if (enabled) {\n      this.container.classList.add('high-contrast');\n      document.body.classList.add('high-contrast');\n      this.theme.highContrast = true;\n    } else {\n      this.container.classList.remove('high-contrast');\n      document.body.classList.remove('high-contrast');\n      this.theme.highContrast = false;\n    }\n\n    this.updateContainerTheme();\n    this.applyThemeSpecificStyles();\n    this.updateFocusIndicatorTheme();\n\n    this.announce(\n      `High contrast mode ${enabled ? 'enabled' : 'disabled'}`,\n      false,\n      { category: 'settings' }\n    );\n\n    // Persist setting\n    this.saveSetting('highContrast', enabled);\n  }\n\n  toggleHighContrastMode() {\n    this.setHighContrastMode(!this.isHighContrastMode);\n  }\n\n  setLargeTextMode(enabled) {\n    if (enabled) {\n      this.container.classList.add('large-text');\n      document.body.classList.add('large-text');\n    } else {\n      this.container.classList.remove('large-text');\n      document.body.classList.remove('large-text');\n    }\n\n    this.announce(\n      `Large text mode ${enabled ? 'enabled' : 'disabled'}`,\n      false,\n      { category: 'settings' }\n    );\n\n    // Persist setting\n    this.saveSetting('largeText', enabled);\n  }\n\n  toggleLargeTextMode() {\n    const isEnabled = this.container.classList.contains('large-text');\n    this.setLargeTextMode(!isEnabled);\n  }\n\n  saveSetting(key, value) {\n    try {\n      if (localStorage) {\n        const settings = JSON.parse(\n          localStorage.getItem('accessibilitySettings') || '{}'\n        );\n        settings[key] = value;\n        localStorage.setItem('accessibilitySettings', JSON.stringify(settings));\n      }\n    } catch (error) {\n      logger.warn('Failed to save accessibility setting:', error);\n    }\n  }\n\n  loadSettings() {\n    try {\n      if (localStorage) {\n        const settings = JSON.parse(\n          localStorage.getItem('accessibilitySettings') || '{}'\n        );\n\n        if (settings.keyboardNavigation !== undefined) {\n          this.keyboardNavigationEnabled = settings.keyboardNavigation;\n        }\n\n        if (settings.highContrast) {\n          this.setHighContrastMode(true);\n        }\n\n        if (settings.largeText) {\n          this.setLargeTextMode(true);\n        }\n      }\n    } catch (error) {\n      logger.warn('Failed to load accessibility settings:', error);\n    }\n  }\n\n  // Enhanced utility methods\n  throttle(func, wait) {\n    let timeout;\n    let lastTime = 0;\n\n    return function executedFunction(...args) {\n      const now = Date.now();\n\n      if (now - lastTime >= wait) {\n        func.apply(this, args);\n        lastTime = now;\n      } else {\n        clearTimeout(timeout);\n        timeout = setTimeout(\n          () => {\n            func.apply(this, args);\n            lastTime = Date.now();\n          },\n          wait - (now - lastTime)\n        );\n      }\n    };\n  }\n\n  activateCurrentElement() {\n    if (\n      this.currentFocusIndex >= 0 &&\n      this.focusableElements[this.currentFocusIndex]\n    ) {\n      const component = this.focusableElements[this.currentFocusIndex];\n      this.handleComponentKeyboardAction(component, 'activate', {});\n    }\n  }\n\n  // Enhanced simulation-specific announcements\n  announceEthicsChange(metric, oldValue, newValue, reasoning) {\n    const change = newValue - oldValue;\n    const direction = change > 0 ? 'increased' : 'decreased';\n    const magnitude = Math.abs(change);\n\n    let description = 'slightly';\n    if (magnitude > ACCESSIBILITY_CONSTANTS.ETHICS_SIGNIFICANT_CHANGE)\n      description = 'significantly';\n    else if (magnitude > 10) description = 'moderately';\n\n    const message = `${metric} ${description} ${direction} from ${oldValue} to ${newValue}. ${reasoning}`;\n\n    this.announce(message, false, {\n      category: 'ethics',\n      priority:\n        magnitude > ACCESSIBILITY_CONSTANTS.ETHICS_HIGH_PRIORITY\n          ? 'high'\n          : 'normal',\n    });\n  }\n\n  announceScenarioChange(scenarioTitle, scenarioNumber, totalScenarios) {\n    const message = `Starting scenario ${scenarioNumber} of ${totalScenarios}: ${scenarioTitle}`;\n    this.announce(message, true, { category: 'scenario' });\n  }\n\n  announceSimulationComplete(score, totalMetrics) {\n    const percentage = Math.round((score / totalMetrics) * 100);\n    let performance = 'needs improvement';\n\n    if (percentage >= ACCESSIBILITY_CONSTANTS.PERFORMANCE_EXCELLENT)\n      performance = 'excellent';\n    else if (percentage >= ACCESSIBILITY_CONSTANTS.PERFORMANCE_GOOD)\n      performance = 'good';\n    else if (percentage >= ACCESSIBILITY_CONSTANTS.PERFORMANCE_SATISFACTORY)\n      performance = 'satisfactory';\n\n    const message = `Simulation complete. Final score: ${score} out of ${totalMetrics} (${percentage}%). Performance: ${performance}.`;\n    this.announce(message, true, { category: 'completion' });\n  }\n\n  // Event handlers with enhanced functionality\n  onContainerFocus() {\n    if (this.focusableElements.length > 0 && this.currentFocusIndex === -1) {\n      this.currentFocusIndex = 0;\n      this.focusComponent(this.focusableElements[0]);\n    }\n\n    // Announce entry to application\n    if (this.verboseMode) {\n      this.announce('Entered simulation environment', false, {\n        category: 'navigation',\n      });\n    }\n  }\n\n  onContainerBlur() {\n    if (this.focusIndicator) {\n      this.focusIndicator.style.display = 'none';\n    }\n  }\n\n  onFocusChange(e) {\n    // Track focus changes for analytics and optimization\n    if (e.type === 'focusin') {\n      const component = this.findComponentByElement(e.target);\n      if (component) {\n        this.currentFocusIndex = this.focusableElements.indexOf(component);\n        this.updateFocusIndicator(component);\n\n        // Update component statistics\n        const componentData = this.components.get(component.id);\n        if (componentData) {\n          componentData.lastFocused = Date.now();\n          componentData.focusCount++;\n        }\n      }\n    }\n  }\n\n  findComponentByElement(element) {\n    for (const [, data] of this.components) {\n      if (\n        data.component.element === element ||\n        data.component.element?.contains(element)\n      ) {\n        return data.component;\n      }\n    }\n    return null;\n  }\n\n  // Enhanced utility methods with error handling\n  detectScreenReader() {\n    try {\n      return this.detectScreenReaderType() !== null;\n    } catch (error) {\n      logger.warn('Screen reader detection failed:', error);\n      return false;\n    }\n  }\n\n  handleEscape() {\n    // Enhanced escape handling with context awareness\n    this.announce('Escape pressed', false, { category: 'interaction' });\n\n    // Close any open accessibility toolbar\n    if (\n      this.accessibilityToolbar &&\n      this.accessibilityToolbar.style.display !== 'none'\n    ) {\n      this.accessibilityToolbar.style.display = 'none';\n      this.announce('Accessibility toolbar closed');\n      return;\n    }\n\n    // Reset focus if lost\n    if (this.currentFocusIndex === -1 && this.focusableElements.length > 0) {\n      this.currentFocusIndex = 0;\n      this.focusComponent(this.focusableElements[0]);\n      return;\n    }\n\n    if (this.engine && this.engine.emit) {\n      this.engine.emit('accessibility:escape');\n    }\n  }\n\n  showKeyboardShortcuts() {\n    const shortcuts = `\n            Keyboard Shortcuts:\n            \n            Basic Navigation:\n             Tab/Shift+Tab: Navigate between elements\n             Arrow keys: Navigate within components\n             Enter/Space: Activate buttons and controls\n             Escape: Cancel, close, or reset focus\n             F6/Shift+F6: Cycle between regions\n             F1: Show accessibility help\n            \n            Advanced Shortcuts:\n             Ctrl+Shift+?: Show this shortcuts list\n             Ctrl+Shift+H: Toggle high contrast mode\n             Ctrl+Shift+L: Toggle large text mode\n             Ctrl+Shift+V: Toggle voice commands\n             Ctrl+Shift+R: Reset accessibility settings\n             Ctrl+Shift+F: Show accessibility report\n            \n            Component-Specific:\n             Home/End: First/last item in lists\n             Arrow keys: Navigate trees and tabs\n             Space: Toggle checkboxes and expand/collapse\n             Enter: Activate primary actions\n            \n            Voice Commands (if supported):\n             \"Next\" / \"Previous\": Navigate elements\n             \"Activate\": Activate current element\n             \"High contrast\": Toggle high contrast\n             \"Large text\": Toggle large text\n             \"Help\": Show voice command help\n        `;\n\n    this.announce(shortcuts, true, { category: 'help' });\n  }\n\n  handleKeyUp(e) {\n    // Handle key release events for advanced interactions\n    if (e.key === 'Alt' && this.altKeyPressed) {\n      this.altKeyPressed = false;\n      // Could show accessibility menu on Alt release\n    }\n  }\n\n  // Enhanced cleanup with comprehensive resource management\n  destroy() {\n    const startTime = this.performanceMonitor.startOperation('cleanup');\n\n    try {\n      // Remove event listeners with error handling\n      this.removeEventListeners();\n\n      // Clean up speech recognition\n      if (this.speechRecognition) {\n        try {\n          this.speechRecognition.stop();\n          this.speechRecognition = null;\n        } catch (error) {\n          logger.warn('Speech recognition cleanup failed:', error);\n        }\n      }\n\n      // Remove DOM elements\n      this.removeDOMElements();\n\n      // Clean up component listeners\n      this.cleanupComponentListeners();\n\n      // Clear data structures\n      this.clearDataStructures();\n\n      // Save final settings\n      this.saveFinalSettings();\n\n      logger.info('AccessibilityManager destroyed successfully');\n    } catch (error) {\n      logger.error('Error during AccessibilityManager cleanup:', error);\n    } finally {\n      this.performanceMonitor.endOperation('cleanup', startTime);\n\n      // Final performance report\n      if (this.verboseMode) {\n        logger.info(\n          'Final Accessibility Performance Report:',\n          this.performanceMonitor.getMetrics()\n        );\n      }\n    }\n  }\n\n  removeEventListeners() {\n    try {\n      // Remove container event listeners\n      this.container.removeEventListener('keydown', this.handleKeyDown);\n      this.container.removeEventListener('keyup', this.handleKeyUp);\n      this.container.removeEventListener('focus', this.onContainerFocus);\n      this.container.removeEventListener('blur', this.onContainerBlur);\n\n      // Remove document event listeners\n      document.removeEventListener('focusin', this.onFocusChange);\n      document.removeEventListener('focusout', this.onFocusChange);\n\n      // Remove theme change listeners\n      const contrastQuery = window.matchMedia('(prefers-contrast: high)');\n      const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n\n      if (contrastQuery.removeEventListener) {\n        contrastQuery.removeEventListener('change', this.updateTheme);\n        motionQuery.removeEventListener('change', this.updateTheme);\n      }\n    } catch (error) {\n      logger.warn('Event listener cleanup failed:', error);\n    }\n  }\n\n  removeDOMElements() {\n    const elementsToRemove = [\n      this.liveRegion,\n      this.urgentRegion,\n      this.statusRegion,\n      this.logRegion,\n      this.overlay,\n      this.accessibilityToolbar,\n      document.getElementById('accessibility-description'),\n      document.getElementById('accessibility-focus-styles'),\n    ];\n\n    elementsToRemove.forEach(element => {\n      try {\n        if (element && element.parentNode) {\n          element.parentNode.removeChild(element);\n        }\n      } catch (error) {\n        logger.warn('Failed to remove DOM element:', error);\n      }\n    });\n  }\n\n  cleanupComponentListeners() {\n    for (const [id, componentData] of this.components) {\n      const { component } = componentData;\n\n      if (component._accessibilityListeners) {\n        component._accessibilityListeners.forEach(\n          ({ element, event, listener }) => {\n            try {\n              element.removeEventListener(event, listener);\n            } catch (error) {\n              logger.warn(\n                `Failed to remove listener for component ${id}:`,\n                error\n              );\n            }\n          }\n        );\n\n        delete component._accessibilityListeners;\n      }\n    }\n  }\n\n  clearDataStructures() {\n    this.components.clear();\n    this.focusableElements = [];\n    this.announcements = [];\n    this.focusHistory = [];\n    this.regionManager.clear();\n    this.voiceCommands.clear();\n    this.keyboardShortcuts.clear();\n    this.renderCache.clear();\n  }\n\n  saveFinalSettings() {\n    try {\n      if (localStorage) {\n        const finalReport = {\n          sessionDuration: Date.now() - (this.initTime || Date.now()),\n          totalComponents: this.components.size,\n          totalAnnouncements: this.announcements.length,\n          errorCount: this.errorCount,\n          performanceMetrics: this.performanceMonitor.getMetrics(),\n          lastSession: Date.now(),\n        };\n\n        localStorage.setItem(\n          'accessibilitySessionReport',\n          JSON.stringify(finalReport)\n        );\n      }\n    } catch (error) {\n      logger.warn('Failed to save session report:', error);\n    }\n  }\n\n  // Public API for enhanced accessibility features\n  getAccessibilityReport() {\n    return {\n      isEnabled: true,\n      componentsRegistered: this.components.size,\n      focusableElements: this.focusableElements.length,\n      theme: this.theme,\n      screenReader: {\n        enabled: this.screenReaderEnabled,\n        type: this.screenReaderType,\n      },\n      features: {\n        keyboardNavigation: this.keyboardNavigationEnabled,\n        voiceCommands: this.voiceCommandsEnabled,\n        highContrast: this.isHighContrastMode,\n        largeText: this.container.classList.contains('large-text'),\n      },\n      performance: this.performanceMonitor.getMetrics(),\n      errors: this.errorCount,\n      lastError: this.lastError,\n    };\n  }\n\n  updateAccessibilityConfig(config) {\n    if (config.theme) {\n      this.theme = { ...this.theme, ...config.theme };\n      this.updateContainerTheme();\n    }\n\n    if (config.announcements) {\n      this.announcementDelay =\n        config.announcements.delay || this.announcementDelay;\n      this.verboseMode =\n        config.announcements.verbose !== undefined\n          ? config.announcements.verbose\n          : this.verboseMode;\n    }\n\n    if (config.performance) {\n      // Update performance thresholds\n      Object.assign(ACCESSIBILITY_CONSTANTS, config.performance);\n    }\n\n    this.announce('Accessibility configuration updated', false, {\n      category: 'settings',\n    });\n  }\n}\n\n// Static methods for global accessibility utilities\nAccessibilityManager.detectScreenReaderType = function () {\n  const { userAgent } = navigator;\n\n  for (const [type, pattern] of Object.entries(SCREEN_READER_PATTERNS)) {\n    if (pattern.test(userAgent)) {\n      return type.toLowerCase();\n    }\n  }\n\n  return null;\n};\n\nAccessibilityManager.createGlobalAccessibilityStyles = function () {\n  if (document.getElementById('global-accessibility-styles')) return;\n\n  const styleSheet = document.createElement('style');\n  styleSheet.id = 'global-accessibility-styles';\n  styleSheet.textContent = `\n        /* Global accessibility styles */\n        .sr-only {\n            position: absolute !important;\n            width: 1px !important;\n            height: 1px !important;\n            padding: 0 !important;\n            margin: -1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n        }\n        \n        .accessibility-enabled *:focus {\n            outline: 2px solid #007bff !important;\n            outline-offset: 2px !important;\n        }\n        \n        .high-contrast *:focus {\n            outline: 3px solid #ffff00 !important;\n            outline-offset: 2px !important;\n        }\n        \n        .large-text {\n            font-size: 120% !important;\n            line-height: 1.5 !important;\n        }\n        \n        .reduced-motion * {\n            animation-duration: 0.01ms !important;\n            animation-iteration-count: 1 !important;\n            transition-duration: 0.01ms !important;\n        }\n        \n        @media (prefers-reduced-motion: reduce) {\n            .accessibility-enabled * {\n                animation-duration: 0.01ms !important;\n                animation-iteration-count: 1 !important;\n                transition-duration: 0.01ms !important;\n            }\n        }\n    `;\n\n  document.head.appendChild(styleSheet);\n};\n\n// Initialize global styles when module loads\nif (typeof document !== 'undefined') {\n  if (document.readyState === 'loading') {\n    document.addEventListener(\n      'DOMContentLoaded',\n      AccessibilityManager.createGlobalAccessibilityStyles\n    );\n  } else {\n    AccessibilityManager.createGlobalAccessibilityStyles();\n  }\n}\n\n// Export for ES6 modules\nexport default AccessibilityManager;\n"],"names":["UI_CONSTANTS","THEME_COLORS","UIThemeManager","prefersHighContrast","prefersReducedMotion","element","theme","UIPerformanceMonitor","id","start","duration","logger","__publicField","UIComponent","config","error","baseClasses","baseStyles","style","contrastQuery","motionQuery","handleThemeChange","event","width","isMobile","isTablet","engine","x","y","height","TIMING","callback","options","listeners","index","l","func","delay","timeoutId","args","data","context","text","priority","announcement","deltaTime","_renderer","UIPanel","classes","panelClasses","closeBtn","header","title","content","controls","direction","handle","isResizing","startX","startY","startWidth","startHeight","startLeft","startTop","rect","handleMouseMove","handleMouseUp","deltaX","deltaY","newWidth","newHeight","newLeft","newTop","html","contentEl","firstFocusable","onClick","button","label","min","max","value","onChange","container","labelEl","slider","sliderId","styleSheet","valueDisplay","currentValue","minMaxDisplay","handleInput","e","newValue","debouncedHandler","step","currentVal","EthicsDisplay","displayClasses","summary","metric","name","meterElement","meterContainer","labelId","valueId","formattedValue","color","description","_metric","track","fill","normalized","COMMON","color1","color2","factor","c1","c2","r","g","b","hex","result","values","m","average","sum","val","totalMetrics","gradeText","score","metricName","_options","oldValue","progressBar","newColor","changeText","FeedbackSystem","feedbackClasses","positions","pos","clearButton","message","type","feedback","feedbackElement","typeIcons","typeColors","action","accentColor","icon","actions","btn","actionId","a","feedbackId","f","items","item","ACCESSIBILITY_CONSTANTS","SCREEN_READER_PATTERNS","AccessibilityTheme","AccessibilityPerformanceMonitor","operationName","startTime","endTime","AccessibilityError","originalError","AccessibilityManager","focusStyle","updateTheme","touch","distX","distY","SpeechRecognition","command","trigger","focusOperations","originalFocus","throttledKeyDown","metrics","componentCount","focusableCount","report","liveType","region","userAgent","pattern","screenReaderType","component","accessibilityConfig","componentData","regionName","componentType","attribute","keyboardActions","key","listener","aTabIndex","bTabIndex","shortcutKey","parts","help","backwards","newIndex","delta","containerRect","left","top","urgent","newAnnouncement","priorityOrder","clearDelay","regionNames","currentRegion","currentIndex","newRegion","regionData","focusedComponent","firstComponentId","componentIndex","enabled","isEnabled","settings","wait","timeout","lastTime","now","reasoning","change","magnitude","scenarioTitle","scenarioNumber","totalScenarios","percentage","performance","finalReport"],"mappings":"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"}