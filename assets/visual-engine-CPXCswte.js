var at=Object.defineProperty;var ht=(u,t,e)=>t in u?at(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var B=(u,t,e)=>ht(u,typeof t!="symbol"?t+"":t,e);import{l as x,S as nt,A as ot,c as q,d as lt,W as rt,I as ct}from"./core-Bu-3NiyB.js";import{A as dt}from"./ui-D3JF1NtD.js";const N={DEFAULT_WIDTH:100,DEFAULT_HEIGHT:30,BUTTON_DEFAULT_WIDTH:120,BUTTON_DEFAULT_HEIGHT:40,BUTTON_DEFAULT_BORDER_RADIUS:4,SLIDER_DEFAULT_WIDTH:200,SLIDER_DEFAULT_HEIGHT:20,SLIDER_DEFAULT_VALUE:50,SLIDER_DEFAULT_HANDLE_WIDTH:20,SLIDER_HANDLE_HEIGHT_OFFSET:4,SLIDER_TRACK_QUARTER_DIVISOR:4,SLIDER_HANDLE_Y_OFFSET:2,METER_DEFAULT_WIDTH:200,METER_DEFAULT_HEIGHT:30,LABEL_DEFAULT_WIDTH:100,LABEL_DEFAULT_HEIGHT:20,RANDOM_BASE:36,ID_SUBSTRING_START:2,ID_LENGTH:9};class Q{constructor(t={}){this.id=t.id||this.generateId(),this.x=t.x||0,this.y=t.y||0,this.width=t.width||N.DEFAULT_WIDTH,this.height=t.height||N.DEFAULT_HEIGHT,this.visible=t.visible!==!1,this.interactive=t.interactive!==!1,this.zIndex=t.zIndex||0,this.alpha=t.alpha!==void 0?t.alpha:1,this.rotation=t.rotation||0,this.scale=t.scale||1,this.fill=t.fill||"#ffffff",this.stroke=t.stroke||"#cccccc",this.strokeWidth=t.strokeWidth||1,this.enabled=t.enabled!==!1,this.focused=!1,this.hovered=!1,this.pressed=!1,this.onClick=t.onClick||null,this.onMouseDown=t.onMouseDown||null,this.onMouseUp=t.onMouseUp||null,this.onMouseMove=t.onMouseMove||null,this.onMouseEnter=t.onMouseEnter||null,this.onMouseLeave=t.onMouseLeave||null,this.onFocus=t.onFocus||null,this.onBlur=t.onBlur||null,this.onChange=t.onChange||null,this.scene=null,this.accessibilityConfig=this.getDefaultAccessibilityConfig(),t.accessibilityConfig&&Object.assign(this.accessibilityConfig,t.accessibilityConfig)}generateId(){return`obj_${Math.random().toString(N.RANDOM_BASE).substr(N.ID_SUBSTRING_START,N.ID_LENGTH)}`}getDefaultAccessibilityConfig(){return{role:"button",focusable:!0,description:"Interactive object",keyboardActions:{Enter:"click",Space:"click"}}}containsPoint(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height,right:this.x+this.width,bottom:this.y+this.height}}handleInput(t,e){if(!this.enabled||!this.visible)return!1;switch(t){case"mousedown":if(this.containsPoint(e.x,e.y))return this.pressed=!0,this.onMouseDown&&this.onMouseDown(e),!0;break;case"mouseup":if(this.pressed)return this.pressed=!1,this.onMouseUp&&this.onMouseUp(e),this.containsPoint(e.x,e.y)&&this.onClick&&this.onClick(e),!0;break;case"mousemove":{const i=this.hovered;this.hovered=this.containsPoint(e.x,e.y),this.hovered&&!i?this.onMouseEnter&&this.onMouseEnter(e):!this.hovered&&i&&this.onMouseLeave&&this.onMouseLeave(e),this.hovered&&this.onMouseMove&&this.onMouseMove(e);break}case"keydown":if(this.focused&&this.accessibilityConfig.keyboardActions&&this.accessibilityConfig.keyboardActions[e.key]==="click"&&this.onClick)return this.onClick(e),!0;break}return!1}setEnabled(t){this.enabled=t,this.updateStyle()}setFocused(t){this.focused=t,this.updateStyle(),t&&this.onFocus?this.onFocus():!t&&this.onBlur&&this.onBlur()}updateStyle(){}update(t){}render(t){t.drawRect(this.x,this.y,this.width,this.height,{fill:this.fill,stroke:this.stroke,strokeWidth:this.strokeWidth})}}class ut extends Q{constructor(t={}){super({width:N.BUTTON_DEFAULT_WIDTH,height:N.BUTTON_DEFAULT_HEIGHT,fill:"#007cba",stroke:"#005a87",...t}),this.type="button",this.text=t.text||"Button",this.textColor=t.textColor||"#ffffff",this.font=t.font||"14px Arial",this.borderRadius=t.borderRadius||N.BUTTON_DEFAULT_BORDER_RADIUS,this.colors={normal:{fill:this.fill,stroke:this.stroke},hover:{fill:t.hoverColor||"#0099e6",stroke:this.stroke},pressed:{fill:t.pressedColor||"#004d73",stroke:this.stroke},disabled:{fill:"#cccccc",stroke:"#999999"}},this.accessibilityConfig.description=t.text||"Button"}updateStyle(){this.enabled?this.pressed?(this.fill=this.colors.pressed.fill,this.stroke=this.colors.pressed.stroke):this.hovered?(this.fill=this.colors.hover.fill,this.stroke=this.colors.hover.stroke):(this.fill=this.colors.normal.fill,this.stroke=this.colors.normal.stroke):(this.fill=this.colors.disabled.fill,this.stroke=this.colors.disabled.stroke)}render(t){if(this.updateStyle(),t.type==="canvas")return t.drawRect(this.x,this.y,this.width,this.height,{fill:this.fill,stroke:this.stroke,strokeWidth:this.strokeWidth,borderRadius:this.borderRadius}),t.drawText(this.text,this.x+this.width/2,this.y+this.height/2,{font:this.font,fill:this.textColor,align:"center",baseline:"middle"}),!0;if(t.type==="svg"){const e=t.createSVGElement("g"),i=t.createSVGElement("rect",{x:this.x,y:this.y,width:this.width,height:this.height,fill:this.fill,stroke:this.stroke,"stroke-width":this.strokeWidth,rx:this.borderRadius});e.appendChild(i);const s=t.createSVGElement("text",{x:this.x+this.width/2,y:this.y+this.height/2,"text-anchor":"middle","dominant-baseline":"central",fill:this.textColor,"font-family":"Arial","font-size":"14px"});return s.textContent=this.text,e.appendChild(s),e}return!1}}class ft extends Q{constructor(t={}){super({width:N.SLIDER_DEFAULT_WIDTH,height:N.SLIDER_DEFAULT_HEIGHT,fill:"#e0e0e0",stroke:"#cccccc",...t}),this.type="slider",this.min=t.min||0,this.max=t.max||100,this.value=t.value!==void 0?t.value:N.SLIDER_DEFAULT_VALUE,this.step=t.step||1,this.handleWidth=t.handleWidth||N.SLIDER_DEFAULT_HANDLE_WIDTH,this.handleHeight=t.handleHeight||this.height+N.SLIDER_HANDLE_HEIGHT_OFFSET,this.handleColor=t.handleColor||"#007cba",this.trackColor=t.trackColor||"#f0f0f0",this.fillColor=t.fillColor||"#007cba",this.isDragging=!1,this.dragOffset=0,this.accessibilityConfig={role:"slider",focusable:!0,description:`Slider, value ${this.value}`,keyboardActions:{ArrowLeft:"decrease",ArrowRight:"increase",ArrowDown:"decrease",ArrowUp:"increase"}}}getHandlePosition(){const t=(this.value-this.min)/(this.max-this.min);return this.x+(this.width-this.handleWidth)*t}setValue(t){const e=this.value;this.value=Math.max(this.min,Math.min(this.max,t)),this.value!==e&&this.onChange&&this.onChange(this.value,e),this.accessibilityConfig.description=`Slider, value ${this.value}`}handleInput(t,e){if(!this.enabled||!this.visible)return!1;switch(t){case"mousedown":{const i=this.getHandlePosition(),s={x:i,y:this.y-N.SLIDER_HANDLE_Y_OFFSET,width:this.handleWidth,height:this.handleHeight};if(e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height)return this.isDragging=!0,this.dragOffset=e.x-i,!0;if(this.containsPoint(e.x,e.y)){const a=(e.x-this.x)/this.width,h=this.min+a*(this.max-this.min);return this.setValue(h),!0}break}case"mousemove":if(this.isDragging){const s=(e.x-this.dragOffset-this.x)/(this.width-this.handleWidth),a=this.min+Math.max(0,Math.min(1,s))*(this.max-this.min);return this.setValue(Math.round(a/this.step)*this.step),!0}break;case"mouseup":if(this.isDragging)return this.isDragging=!1,!0;break;case"keydown":if(this.focused){let i=!1;const s=this.step;switch(e.key){case"ArrowLeft":case"ArrowDown":this.setValue(this.value-s),i=!0;break;case"ArrowRight":case"ArrowUp":this.setValue(this.value+s),i=!0;break}if(i)return!0}break}return super.handleInput(t,e)}render(t){const e=this.getHandlePosition(),i=(this.value-this.min)/(this.max-this.min);if(t.type==="canvas"){t.drawRect(this.x,this.y+this.height/N.SLIDER_TRACK_QUARTER_DIVISOR,this.width,this.height/2,{fill:this.trackColor,stroke:this.stroke,strokeWidth:1});const s=this.width*i;return s>0&&t.drawRect(this.x,this.y+this.height/N.SLIDER_TRACK_QUARTER_DIVISOR,s,this.height/2,{fill:this.fillColor}),t.drawRect(e,this.y-N.SLIDER_HANDLE_Y_OFFSET,this.handleWidth,this.handleHeight,{fill:this.handleColor,stroke:"#005a87",strokeWidth:2,borderRadius:2}),t}else if(t.type==="svg"){const s=t.createSVGElement("g"),a=t.createSVGElement("rect",{x:this.x,y:this.y+this.height/N.SLIDER_TRACK_QUARTER_DIVISOR,width:this.width,height:this.height/2,fill:this.trackColor,stroke:this.stroke});if(s.appendChild(a),i>0){const o=t.createSVGElement("rect",{x:this.x,y:this.y+this.height/N.SLIDER_TRACK_QUARTER_DIVISOR,width:this.width*i,height:this.height/2,fill:this.fillColor});s.appendChild(o)}const h=t.createSVGElement("rect",{x:e,y:this.y-N.SLIDER_HANDLE_Y_OFFSET,width:this.handleWidth,height:this.handleHeight,fill:this.handleColor,stroke:"#005a87","stroke-width":2,rx:2});return s.appendChild(h),s}return null}}class Tt extends Q{constructor(t={}){super({width:N.METER_DEFAULT_WIDTH,height:N.METER_DEFAULT_HEIGHT,fill:"#f0f0f0",stroke:"#cccccc",interactive:!1,...t}),this.type="meter",this.min=t.min||0,this.max=t.max||100,this.value=t.value!==void 0?t.value:0,this.label=t.label||"",this.showValue=t.showValue!==!1,this.fillColor=t.fillColor||"#4caf50",this.textColor=t.textColor||"#333333",this.font=t.font||"12px Arial",this.accessibilityConfig={role:"progressbar",focusable:!1,description:`${this.label} progress: ${this.value} of ${this.max}`}}setValue(t){this.value=Math.max(this.min,Math.min(this.max,t)),this.accessibilityConfig.description=`${this.label} progress: ${this.value} of ${this.max}`}render(t){const e=(this.value-this.min)/(this.max-this.min),i=this.width*e;if(t.type==="canvas"){if(t.drawRect(this.x,this.y,this.width,this.height,{fill:this.fill,stroke:this.stroke,strokeWidth:this.strokeWidth}),i>0&&t.drawRect(this.x,this.y,i,this.height,{fill:this.fillColor}),this.label||this.showValue){const s=this.label+(this.showValue?` ${this.value}`:"");t.drawText(s,this.x+this.width/2,this.y+this.height/2,{font:this.font,fill:this.textColor,align:"center",baseline:"middle"})}return t}else if(t.type==="svg"){const s=t.createSVGElement("g"),a=t.createSVGElement("rect",{x:this.x,y:this.y,width:this.width,height:this.height,fill:this.fill,stroke:this.stroke,"stroke-width":this.strokeWidth});if(s.appendChild(a),i>0){const h=t.createSVGElement("rect",{x:this.x,y:this.y,width:i,height:this.height,fill:this.fillColor});s.appendChild(h)}if(this.label||this.showValue){const h=this.label+(this.showValue?` ${this.value}`:""),o=t.createSVGElement("text",{x:this.x+this.width/2,y:this.y+this.height/2,"text-anchor":"middle","dominant-baseline":"central",fill:this.textColor,"font-family":"Arial","font-size":"12px"});o.textContent=h,s.appendChild(o)}return s}return null}}class Et extends Q{constructor(t={}){super({width:N.LABEL_DEFAULT_WIDTH,height:N.LABEL_DEFAULT_HEIGHT,interactive:!1,fill:"transparent",stroke:"none",...t}),this.type="label",this.text=t.text||"Label",this.textColor=t.textColor||"#333333",this.font=t.font||"14px Arial",this.align=t.align||"left",this.accessibilityConfig={role:"text",focusable:!1,description:this.text}}setText(t){this.text=t,this.accessibilityConfig.description=this.text}render(t){return t.type==="canvas"?(t.drawText(this.text,this.x,this.y,{font:this.font,fill:this.textColor,align:this.align}),t):t.type==="svg"?t.createSVGElement("text",{x:this.x,y:this.y,fill:this.textColor,"font-family":"Arial","font-size":"14px","text-anchor":this.align==="center"?"middle":this.align},this.text):null}}/**
 * Enhanced Interactive Objects - Complete object system for SimulateAI
 * Provides sophisticated UI components with accessibility and animations
 *
 * @version 2.0.0
 * @author SimulateAI Team
 * @license Apache-2.0
 */const gt=300,mt="easeInOut",F=2,m={DEFAULT_WIDTH:100,DEFAULT_HEIGHT:50,ID_BASE:36,ID_LENGTH:9,ID_SUBSTRING_START:2,DOUBLE_CLICK_THRESHOLD:500,RIPPLE_DURATION:600,ANIMATION_PRECISION:.1,LOADING_SPINNER_SPEED:2,LOADING_SPINNER_ARC:1.5,SPINNER_RADIUS:8,SPINNER_LINE_WIDTH:2,BUTTON_TEXT_OFFSET:10,BUTTON_SPINNER_OFFSET:30,BUTTON_HOVER_SCALE:1.02,BUTTON_SCALE_DURATION:150,FOCUS_RING_OFFSET:2,FOCUS_RING_EXTRA:3,FOCUS_RING_BUTTON_OFFSET:4,BORDER_WIDTH:2,THICK_BORDER_WIDTH:3,METER_TRACK_Y_RATIO:.4,METER_TRACK_HEIGHT_RATIO:.3,METER_LABEL_Y_RATIO:.3,METER_VALUE_LABEL_Y_RATIO:.9,SLIDER_VALUE_Y_OFFSET:15,SLIDER_LABEL_Y_OFFSET:-5,METER_DEFAULT_WIDTH:200,METER_DEFAULT_HEIGHT:60,METER_DEFAULT_VALUE:50,METER_DEFAULT_MAX:100,BUTTON_DEFAULT_WIDTH:120,BUTTON_DEFAULT_HEIGHT:40,SLIDER_DEFAULT_WIDTH:200,SLIDER_DEFAULT_HEIGHT:40,SLIDER_DEFAULT_VALUE:50,SLIDER_DEFAULT_MAX:100,SLIDER_DEFAULT_STEP:1,SLIDER_DEFAULT_TRACK_HEIGHT:6,SLIDER_DEFAULT_HANDLE_SIZE:20,SCORE_THRESHOLD_EXCELLENT:90,SCORE_THRESHOLD_GOOD:70,SCORE_THRESHOLD_FAIR:50,SCORE_THRESHOLD_POOR:30,RIPPLE_ALPHA:.3},p={HALF:.5,CUBIC_POWER:3,QUARTIC_POWER:4,BOUNCE_N1:7.5625,BOUNCE_D1:2.75,BOUNCE_THRESHOLD_1:1,BOUNCE_THRESHOLD_2:2,BOUNCE_THRESHOLD_3:2.5,BOUNCE_OFFSET_1:1.5,BOUNCE_OFFSET_2:2.25,BOUNCE_OFFSET_3:2.625,BOUNCE_VALUE_1:.75,BOUNCE_VALUE_2:.9375,BOUNCE_VALUE_3:.984375,EASE_IN_OUT_MULTIPLIER:2,EASE_IN_OUT_CUBIC_MULTIPLIER:4,EASE_IN_OUT_QUART_MULTIPLIER:8,EASE_NEGATIVE_MULTIPLIER:-2,EASE_ADDEND:2,EASE_DIVISOR:2};let _t=class{constructor(){this.animations=new Map,this.isRunning=!1,this.rafId=null}add(t,e){this.animations.set(t,e),this.start()}remove(t){this.animations.delete(t),this.animations.size===0&&this.stop()}start(){this.isRunning||(this.isRunning=!0,this.tick())}stop(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.isRunning=!1}tick(){const t=performance.now();for(const[e,i]of this.animations)try{i(t)||this.animations.delete(e)}catch(s){x.error(`Animation error for ${e}:`,s),this.animations.delete(e)}this.animations.size>0?this.rafId=requestAnimationFrame(()=>this.tick()):this.stop()}clear(){this.animations.clear(),this.stop()}};const J=new _t,At=(u,t,e)=>Math.max(t,Math.min(e,u)),It=(u,t,e)=>u+(t-u)*e,w=(u,t=0)=>typeof u=="number"&&!isNaN(u)?u:t,v=(u,t="")=>typeof u=="string"?u:t,et={linear:u=>u,easeIn:u=>u*u,easeOut:u=>1-(1-u)*(1-u),easeInOut:u=>u<p.HALF?p.EASE_IN_OUT_MULTIPLIER*u*u:1-p.EASE_IN_OUT_MULTIPLIER*(1-u)*(1-u),easeInCubic:u=>u*u*u,easeOutCubic:u=>1-Math.pow(1-u,p.CUBIC_POWER),easeInOutCubic:u=>u<p.HALF?p.EASE_IN_OUT_CUBIC_MULTIPLIER*u*u*u:1-Math.pow(p.EASE_NEGATIVE_MULTIPLIER*u+p.EASE_ADDEND,p.CUBIC_POWER)/p.EASE_DIVISOR,easeInQuart:u=>u*u*u*u,easeOutQuart:u=>1-Math.pow(1-u,p.QUARTIC_POWER),easeInOutQuart:u=>u<p.HALF?p.EASE_IN_OUT_QUART_MULTIPLIER*u*u*u*u:1-Math.pow(p.EASE_NEGATIVE_MULTIPLIER*u+p.EASE_ADDEND,p.QUARTIC_POWER)/p.EASE_DIVISOR,bounce:u=>{const t=p.BOUNCE_N1,e=p.BOUNCE_D1;return u<p.BOUNCE_THRESHOLD_1/e?t*u*u:u<p.BOUNCE_THRESHOLD_2/e?t*(u-=p.BOUNCE_OFFSET_1/e)*u+p.BOUNCE_VALUE_1:u<p.BOUNCE_THRESHOLD_3/e?t*(u-=p.BOUNCE_OFFSET_2/e)*u+p.BOUNCE_VALUE_2:t*(u-=p.BOUNCE_OFFSET_3/e)*u+p.BOUNCE_VALUE_3}};class C{constructor(t={}){this.id=v(t.id)||this.generateId(),this.x=w(t.x,0),this.y=w(t.y,0),this.z=w(t.z,0),this.width=w(t.width,m.DEFAULT_WIDTH),this.height=w(t.height,m.DEFAULT_HEIGHT),this.rotation=w(t.rotation,0),this.scaleX=w(t.scaleX,1),this.scaleY=w(t.scaleY,1),this.alpha=w(t.alpha,1),this.visible=t.visible!==!1,this.isInteractive=t.interactive!==!1,this.isDraggable=!!t.draggable,this.isResizable=!!t.resizable,this.isFocusable=t.focusable!==!1,this.isSelectable=!!t.selectable,this.isHovered=!1,this.isFocused=!1,this.isDragging=!1,this.isSelected=!1,this.isPressed=!1,this.isDisabled=!!t.disabled,this.theme=v(t.theme,"default"),this.className=v(t.className),this.style={...t.style},this.ariaLabel=v(t.ariaLabel),this.ariaRole=v(t.ariaRole,"generic"),this.ariaDescribedBy=v(t.ariaDescribedBy),this.ariaExpanded=t.ariaExpanded,this.ariaPressed=t.ariaPressed,this.ariaChecked=t.ariaChecked,this.tabIndex=w(t.tabIndex,this.isInteractive?0:-1),this.eventHandlers=new Map,this.setupDefaultHandlers(t),this.animations=new Map,this.transitions=new Map,this.animationQueue=[],this.parent=null,this.children=[],this.scene=null,this.layout={type:v(t.layout?.type,"absolute"),padding:this.validateSpacing(t.layout?.padding),margin:this.validateSpacing(t.layout?.margin),align:v(t.layout?.align,"start"),justify:v(t.layout?.justify,"start"),flexDirection:v(t.layout?.flexDirection,"row"),flexWrap:v(t.layout?.flexWrap,"nowrap"),gap:w(t.layout?.gap,0)},this.lastRenderTime=0,this.renderCount=0,this.needsRedraw=!0,this.errorHandler=t.errorHandler||this.defaultErrorHandler,this.isDestroyed=!1,this.cleanupTasks=[]}validateSpacing(t){return typeof t=="number"?{top:t,right:t,bottom:t,left:t}:t&&typeof t=="object"?{top:w(t.top,0),right:w(t.right,0),bottom:w(t.bottom,0),left:w(t.left,0)}:{top:0,right:0,bottom:0,left:0}}defaultErrorHandler(t,e){x.error(`Error in ${this.constructor.name} (${this.id}) - ${e}:`,t)}generateId(){return`obj_${Date.now()}_${Math.random().toString(m.ID_BASE).substr(m.ID_SUBSTRING_START,m.ID_LENGTH)}`}setupDefaultHandlers(t){["click","doubleClick","hover","hoverEnd","focus","blur","keyDown","keyUp","mouseDown","mouseUp","mouseMove","drag","dragStart","dragEnd","drop","change","input"].forEach(i=>{const s=`on${i.charAt(0).toUpperCase()}${i.slice(1)}`;typeof t[s]=="function"&&this.on(i,t[s])})}on(t,e){return typeof e!="function"?(this.errorHandler(new Error("Event handler must be a function"),"on"),this):(this.eventHandlers.has(t)||this.eventHandlers.set(t,[]),this.eventHandlers.get(t).push(e),this.cleanupTasks.push(()=>this.off(t,e)),this)}off(t,e){if(this.eventHandlers.has(t)){const i=this.eventHandlers.get(t),s=i.indexOf(e);s>-1&&(i.splice(s,1),i.length===0&&this.eventHandlers.delete(t))}return this}emit(t,e={}){if(this.isDestroyed)return this;if(this.eventHandlers.has(t)){const i={...e,target:this,type:t,timestamp:performance.now(),preventDefault:()=>{i.defaultPrevented=!0},stopPropagation:()=>{i.propagationStopped=!0}};this.eventHandlers.get(t).forEach(s=>{try{i.propagationStopped||s.call(this,i)}catch(a){this.errorHandler(a,`event:${t}`)}})}return this}addChild(t){return t instanceof C?(t.parent&&t.parent.removeChild(t),t.parent=this,t.scene=this.scene,this.children.push(t),this.emit("childAdded",{child:t}),this):(this.errorHandler(new Error("Child must be a BaseObject instance"),"addChild"),this)}removeChild(t){const e=this.children.indexOf(t);return e>-1&&(this.children.splice(e,1),t.parent=null,t.scene=null,this.emit("childRemoved",{child:t})),this}removeAllChildren(){for(;this.children.length>0;)this.removeChild(this.children[0]);return this}findChildById(t){return this.children.find(e=>e.id===t)||null}findChildrenByClass(t){return this.children.filter(e=>e.className.includes(t))}containsPoint(t,e,i=!1){if(!this.visible||this.alpha<=0)return!1;let s=this.getBounds();return i&&(this.rotation!==0||this.scaleX!==1||this.scaleY!==1)&&(s=this.getTransformedBounds()),t>=s.x&&t<=s.right&&e>=s.y&&e<=s.bottom}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height,right:this.x+this.width,bottom:this.y+this.height,centerX:this.x+this.width/2,centerY:this.y+this.height/2}}getTransformedBounds(){const t=this.getBounds(),e=t.width*Math.abs(this.scaleX),i=t.height*Math.abs(this.scaleY);if(this.rotation!==0){const s=Math.abs(Math.cos(this.rotation)),a=Math.abs(Math.sin(this.rotation)),h=e*s+i*a,o=e*a+i*s;return{x:t.centerX-h/2,y:t.centerY-o/2,width:h,height:o,right:t.centerX+h/2,bottom:t.centerY+o/2,centerX:t.centerX,centerY:t.centerY}}return{x:t.centerX-e/2,y:t.centerY-i/2,width:e,height:i,right:t.centerX+e/2,bottom:t.centerY+i/2,centerX:t.centerX,centerY:t.centerY}}intersects(t){if(!(t instanceof C))return!1;const e=this.getBounds(),i=t.getBounds();return!(e.right<i.x||e.x>i.right||e.bottom<i.y||e.y>i.bottom)}handleInput(t,e){if(!this.isInteractive||!this.visible||this.isDisabled||this.isDestroyed)return!1;try{switch(t){case"mousedown":case"pointerdown":return this.handlePointerDown(e);case"mouseup":case"pointerup":return this.handlePointerUp(e);case"mousemove":case"pointermove":return this.handlePointerMove(e);case"keydown":return this.handleKeyDown(e);case"keyup":return this.handleKeyUp(e);case"wheel":return this.handleWheel(e);case"focus":return this.handleFocus(e);case"blur":return this.handleBlur(e);default:return!1}}catch(i){return this.errorHandler(i,`handleInput:${t}`),!1}}handlePointerDown(t){if(this.containsPoint(t.x,t.y)){this.isPressed=!0;const e={...t,localX:t.x-this.x,localY:t.y-this.y};return this.emit("mouseDown",e),this.emit("pointerDown",e),!0}return!1}handlePointerUp(t){if(this.isPressed){if(this.isPressed=!1,this.emit("mouseUp",t),this.emit("pointerUp",t),this.containsPoint(t.x,t.y)){this.emit("click",t);const e=performance.now();this.lastClickTime&&e-this.lastClickTime<m.DOUBLE_CLICK_THRESHOLD?(this.emit("doubleClick",t),this.lastClickTime=0):this.lastClickTime=e}return!0}return!1}handlePointerMove(t){const e=this.isHovered;this.isHovered=this.containsPoint(t.x,t.y);const i={...t,localX:t.x-this.x,localY:t.y-this.y};return this.isHovered&&!e?(this.emit("hover",i),this.emit("mouseEnter",i)):!this.isHovered&&e&&(this.emit("hoverEnd",i),this.emit("mouseLeave",i)),(this.isHovered||this.isDragging)&&(this.emit("mouseMove",i),this.emit("pointerMove",i)),this.isDragging?(this.emit("drag",i),!0):this.isHovered}handleKeyDown(t){if(this.isFocused){switch(this.emit("keyDown",t),t.key){case"Enter":case" ":t.defaultPrevented||this.emit("click",{...t,synthetic:!0});break;case"Escape":this.blur();break}return!0}return!1}handleKeyUp(t){return this.isFocused?(this.emit("keyUp",t),!0):!1}handleWheel(t){return this.containsPoint(t.x,t.y)?(this.emit("wheel",t),!0):!1}handleFocus(t){return!this.isFocused&&this.isFocusable?(this.isFocused=!0,this.emit("focus",t),!0):!1}handleBlur(t){return this.isFocused?(this.isFocused=!1,this.emit("blur",t),!0):!1}focus(){this.isFocusable&&!this.isDisabled&&!this.isDestroyed&&this.handleFocus({synthetic:!0})}blur(){this.isFocused&&this.handleBlur({synthetic:!0})}animate(t,e,i=gt,s=mt){if(this.isDestroyed)return Promise.resolve();if(typeof t=="object"){const a=Object.entries(t).map(([h,o])=>this.animate(h,o,e||i,i||s));return Promise.all(a)}return new Promise((a,h)=>{try{const o=this[t];if(o===void 0){h(new Error(`Property '${t}' not found`));return}const l=performance.now(),r=`${t}_${l}`,E=typeof s=="function"?s:et[s]||et.linear,g=_=>{if(this.isDestroyed)return a(),!1;const I=_-l,S=Math.min(I/i,1),D=E(S);return this[t]=It(o,e,D),this.needsRedraw=!0,S<1?!0:(this.animations.delete(r),a(),!1)};this.animations.set(r,g),J.add(r,g),this.cleanupTasks.push(()=>{J.remove(r),this.animations.delete(r)})}catch(o){this.errorHandler(o,"animate"),h(o)}})}stopAnimations(){for(const t of this.animations.keys())J.remove(t);this.animations.clear()}queueAnimation(t){const e=this.animationQueue.length===0?t():this.animationQueue[this.animationQueue.length-1].then(t);return this.animationQueue.push(e),e.finally(()=>{const i=this.animationQueue.indexOf(e);i>-1&&this.animationQueue.splice(i,1)}),e}update(t){if(!this.isDestroyed)try{for(let e=this.children.length-1;e>=0;e--){const i=this.children[e];i&&typeof i.update=="function"&&i.update(t)}this.onUpdate(t)}catch(e){this.errorHandler(e,"update")}}onUpdate(t){}render(t){if(!(!this.visible||this.alpha<=0||this.isDestroyed))try{this.renderCount++,this.lastRenderTime=performance.now(),t.save(),this.applyTransforms(t),this.renderSelf(t),this.renderChildren(t),t.restore(),this.needsRedraw=!1}catch(e){this.errorHandler(e,"render"),t.restore()}}applyTransforms(t){(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&(t.translate(this.width/2,this.height/2),t.rotate(this.rotation),t.translate(-this.width/2,-this.height/2)),(this.scaleX!==1||this.scaleY!==1)&&(t.translate(this.width/2,this.height/2),t.scale(this.scaleX,this.scaleY),t.translate(-this.width/2,-this.height/2)),this.alpha!==1&&(t.globalAlpha*=this.alpha)}renderChildren(t){for(const e of this.children)e&&typeof e.render=="function"&&e.render(t)}renderSelf(t){}getDebugInfo(){return{id:this.id,className:this.constructor.name,bounds:this.getBounds(),visible:this.visible,interactive:this.isInteractive,children:this.children.length,animations:this.animations.size,renderCount:this.renderCount,lastRenderTime:this.lastRenderTime}}destroy(){if(!this.isDestroyed)try{for(this.isDestroyed=!0,this.emit("destroy"),this.stopAnimations(),this.eventHandlers.clear(),this.cleanupTasks.forEach(t=>{try{t()}catch(e){this.errorHandler(e,"cleanup")}}),this.cleanupTasks=[];this.children.length>0;){const t=this.children[0];this.removeChild(t),typeof t.destroy=="function"&&t.destroy()}this.parent&&this.parent.removeChild(this),this.parent=null,this.scene=null,this.eventHandlers=null,this.animations=null,this.transitions=null}catch(t){this.errorHandler(t,"destroy")}}}class St extends C{constructor(t={}){super({...t,width:t.width||m.METER_DEFAULT_WIDTH,height:t.height||m.METER_DEFAULT_HEIGHT,ariaRole:"progressbar",interactive:!1}),this.category=t.category||"ethics",this.value=t.value||m.METER_DEFAULT_VALUE,this.minValue=t.minValue||0,this.maxValue=t.maxValue||m.METER_DEFAULT_MAX,this.label=t.label||this.category.charAt(0).toUpperCase()+this.category.slice(1),this.showValue=t.showValue!==!1,this.showLabel=t.showLabel!==!1,this.animated=t.animated!==!1,this.colors={excellent:t.colors?.excellent||"#4CAF50",good:t.colors?.good||"#8BC34A",fair:t.colors?.fair||"#FFC107",poor:t.colors?.poor||"#FF9800",critical:t.colors?.critical||"#F44336",background:t.colors?.background||"#E0E0E0",text:t.colors?.text||"#333333"},this.thresholds={excellent:t.thresholds?.excellent||m.SCORE_THRESHOLD_EXCELLENT,good:t.thresholds?.good||m.SCORE_THRESHOLD_GOOD,fair:t.thresholds?.fair||m.SCORE_THRESHOLD_FAIR,poor:t.thresholds?.poor||m.SCORE_THRESHOLD_POOR},this.displayValue=this.value,this.targetValue=this.value,this.ariaLabel=`${this.label} ethics score: ${this.value} out of ${this.maxValue}`}updateScore(t,e=""){const i=Math.max(this.minValue,Math.min(this.maxValue,t));this.animated?(this.targetValue=i,this.animateToTarget()):this.setValue(i),this.emit("scoreUpdate",{oldValue:this.value,newValue:i,reason:e,category:this.category})}setValue(t){this.value=t,this.displayValue=t,this.updateAccessibility()}animateToTarget(){if(Math.abs(this.displayValue-this.targetValue)<m.ANIMATION_PRECISION){this.setValue(this.targetValue);return}const t=this.targetValue-this.displayValue;this.displayValue+=t*m.ANIMATION_PRECISION,requestAnimationFrame(()=>this.animateToTarget())}updateAccessibility(){this.ariaLabel=`${this.label} ethics score: ${Math.round(this.displayValue)} out of ${this.maxValue}`}getScoreColor(){const t=this.displayValue;return t>=this.thresholds.excellent?this.colors.excellent:t>=this.thresholds.good?this.colors.good:t>=this.thresholds.fair?this.colors.fair:t>=this.thresholds.poor?this.colors.poor:this.colors.critical}getScoreLabel(){const t=this.displayValue;return t>=this.thresholds.excellent?"Excellent":t>=this.thresholds.good?"Good":t>=this.thresholds.fair?"Fair":t>=this.thresholds.poor?"Poor":"Critical"}renderSelf(t){const e=(this.displayValue-this.minValue)/(this.maxValue-this.minValue),i=this.width*e;if(t.type==="canvas"&&(t.fillStyle=this.colors.background,t.fillRect(0,this.height*m.METER_TRACK_Y_RATIO,this.width,this.height*m.METER_TRACK_HEIGHT_RATIO),t.fillStyle=this.getScoreColor(),t.fillRect(0,this.height*m.METER_TRACK_Y_RATIO,i,this.height*m.METER_TRACK_HEIGHT_RATIO),this.isFocused&&(t.strokeStyle="#2196F3",t.lineWidth=m.BORDER_WIDTH,t.strokeRect(-2,this.height*m.METER_TRACK_Y_RATIO-m.FOCUS_RING_OFFSET,this.width+m.FOCUS_RING_BUTTON_OFFSET,this.height*m.METER_TRACK_HEIGHT_RATIO+m.FOCUS_RING_BUTTON_OFFSET)),this.showLabel&&(t.fillStyle=this.colors.text,t.font="14px Arial",t.textAlign="left",t.fillText(this.label,0,this.height*m.METER_LABEL_Y_RATIO)),this.showValue)){t.fillStyle=this.colors.text,t.font="12px Arial",t.textAlign="right";const s=`${Math.round(this.displayValue)}/${this.maxValue}`;t.fillText(s,this.width,this.height*m.METER_LABEL_Y_RATIO),t.font="10px Arial",t.fillText(this.getScoreLabel(),this.width,this.height*m.METER_VALUE_LABEL_Y_RATIO)}}}class pt extends C{constructor(t={}){super({...t,width:t.width||m.BUTTON_DEFAULT_WIDTH,height:t.height||m.BUTTON_DEFAULT_HEIGHT,ariaRole:"button"}),this.text=t.text||"Button",this.icon=t.icon||null,this.variant=t.variant||"primary",this.size=t.size||"medium",this.colors=this.getColorScheme(),this.currentColor=this.colors.normal,this.isLoading=!1,this.loadingText=t.loadingText||"Loading...",this.ripples=[],this.setupEventHandlers()}getColorScheme(){const t={primary:{normal:{bg:"#2196F3",text:"#FFFFFF",border:"#2196F3"},hover:{bg:"#1976D2",text:"#FFFFFF",border:"#1976D2"},pressed:{bg:"#0D47A1",text:"#FFFFFF",border:"#0D47A1"},disabled:{bg:"#CCCCCC",text:"#666666",border:"#CCCCCC"}},secondary:{normal:{bg:"#757575",text:"#FFFFFF",border:"#757575"},hover:{bg:"#616161",text:"#FFFFFF",border:"#616161"},pressed:{bg:"#424242",text:"#FFFFFF",border:"#424242"},disabled:{bg:"#CCCCCC",text:"#666666",border:"#CCCCCC"}},outline:{normal:{bg:"transparent",text:"#2196F3",border:"#2196F3"},hover:{bg:"#E3F2FD",text:"#1976D2",border:"#1976D2"},pressed:{bg:"#BBDEFB",text:"#0D47A1",border:"#0D47A1"},disabled:{bg:"transparent",text:"#CCCCCC",border:"#CCCCCC"}}};return t[this.variant]||t.primary}setupEventHandlers(){this.on("hover",()=>{!this.isDisabled&&!this.isPressed&&(this.currentColor=this.colors.hover,this.animate("scaleX",m.BUTTON_HOVER_SCALE,m.BUTTON_SCALE_DURATION),this.animate("scaleY",m.BUTTON_HOVER_SCALE,m.BUTTON_SCALE_DURATION))}),this.on("hoverEnd",()=>{!this.isDisabled&&!this.isPressed&&(this.currentColor=this.colors.normal,this.animate("scaleX",1,m.BUTTON_SCALE_DURATION),this.animate("scaleY",1,m.BUTTON_SCALE_DURATION))}),this.on("mouseDown",t=>{this.isDisabled||(this.isPressed=!0,this.currentColor=this.colors.pressed,this.createRipple(t.localX,t.localY))}),this.on("mouseUp",()=>{this.isDisabled||(this.isPressed=!1,this.currentColor=this.isHovered?this.colors.hover:this.colors.normal)}),this.on("keyDown",t=>{(t.key==="Enter"||t.key===" ")&&!this.isDisabled&&(t.preventDefault(),this.handleClick())})}createRipple(t,e){const i={x:t||this.width/2,y:e||this.height/2,radius:0,maxRadius:Math.max(this.width,this.height),alpha:m.RIPPLE_ALPHA,startTime:performance.now()};this.ripples.push(i),setTimeout(()=>{const s=this.ripples.indexOf(i);s>-1&&this.ripples.splice(s,1)},m.RIPPLE_DURATION)}handleClick(){!this.isDisabled&&!this.isLoading&&this.emit("click",{button:this})}setLoading(t,e=null){this.isLoading=t,e&&(this.loadingText=e),this.isDisabled=t}updateRipples(){const t=performance.now();this.ripples.forEach(e=>{const i=t-e.startTime,s=Math.min(i/m.RIPPLE_DURATION,1);e.radius=e.maxRadius*s,e.alpha=m.RIPPLE_ALPHA*(1-s)})}renderSelf(t){if(t.type!=="canvas")return;this.updateRipples();const e=this.isDisabled?this.colors.disabled:this.currentColor;e.bg!=="transparent"&&(t.fillStyle=e.bg,t.fillRect(0,0,this.width,this.height)),e.border&&(t.strokeStyle=e.border,t.lineWidth=m.BORDER_WIDTH,t.strokeRect(0,0,this.width,this.height)),this.ripples.forEach(h=>{t.save(),t.globalAlpha=h.alpha,t.fillStyle="#FFFFFF",t.beginPath(),t.arc(h.x,h.y,h.radius,0,Math.PI*m.LOADING_SPINNER_SPEED),t.fill(),t.restore()}),this.isFocused&&(t.strokeStyle="#FF9800",t.lineWidth=m.THICK_BORDER_WIDTH,t.strokeRect(-2,-2,this.width+m.FOCUS_RING_BUTTON_OFFSET,this.height+m.FOCUS_RING_BUTTON_OFFSET));const i=this.isLoading?this.loadingText:this.text;t.fillStyle=e.text,t.font=this.getFontSize(),t.textAlign="center",t.textBaseline="middle";const s=this.width/2,a=this.height/2;this.isLoading?(this.renderLoadingSpinner(t,s-m.BUTTON_SPINNER_OFFSET,a),t.fillText(i,s+m.BUTTON_TEXT_OFFSET,a)):t.fillText(i,s,a)}getFontSize(){const t={small:"12px Arial",medium:"14px Arial",large:"16px Arial"};return t[this.size]||t.medium}renderLoadingSpinner(t,e,i){const a=performance.now()/1e3*Math.PI*m.LOADING_SPINNER_SPEED;t.save(),t.translate(e,i),t.rotate(a),t.strokeStyle=this.currentColor.text,t.lineWidth=m.SPINNER_LINE_WIDTH,t.beginPath(),t.arc(0,0,m.SPINNER_RADIUS,0,Math.PI*m.LOADING_SPINNER_ARC),t.stroke(),t.restore()}}class Rt extends C{constructor(t={}){super({...t,width:t.width||m.SLIDER_DEFAULT_WIDTH,height:t.height||m.SLIDER_DEFAULT_HEIGHT,ariaRole:"slider",draggable:!0}),this.min=t.min||0,this.max=t.max||m.SLIDER_DEFAULT_MAX,this.value=Math.max(this.min,Math.min(this.max,t.value||m.SLIDER_DEFAULT_VALUE)),this.step=t.step||m.SLIDER_DEFAULT_STEP,this.label=t.label||"",this.unit=t.unit||"",this.trackHeight=t.trackHeight||m.SLIDER_DEFAULT_TRACK_HEIGHT,this.handleSize=t.handleSize||m.SLIDER_DEFAULT_HANDLE_SIZE,this.showValue=t.showValue!==!1,this.showLabel=t.showLabel!==!1,this.colors={track:t.colors?.track||"#E0E0E0",fill:t.colors?.fill||"#2196F3",handle:t.colors?.handle||"#FFFFFF",handleBorder:t.colors?.handleBorder||"#2196F3",text:t.colors?.text||"#333333"},this.isDraggingHandle=!1,this.dragOffset=0,this.hoverHandle=!1,this.setupEventHandlers(),this.updateAccessibility()}setupEventHandlers(){this.on("mouseDown",t=>{const e=this.getHandlePosition(),i=t.localX;Math.abs(i-e)<=this.handleSize/2?(this.isDraggingHandle=!0,this.dragOffset=i-e,this.emit("dragStart",{value:this.value})):this.jumpToPosition(i)}),this.on("hover",t=>{const e=this.getHandlePosition();this.hoverHandle=Math.abs(t.localX-e)<=this.handleSize/2}),this.on("keyDown",t=>{let e=this.value;switch(t.key){case"ArrowLeft":case"ArrowDown":e=Math.max(this.min,this.value-this.step);break;case"ArrowRight":case"ArrowUp":e=Math.min(this.max,this.value+this.step);break;case"Home":e=this.min;break;case"End":e=this.max;break;default:return}e!==this.value&&(t.preventDefault(),this.setValue(e,!0))})}jumpToPosition(t){const e=this.handleSize/2,i=this.width-this.handleSize,s=Math.max(0,Math.min(1,(t-e)/i)),a=this.min+(this.max-this.min)*s;this.setValue(this.snapToStep(a),!0)}snapToStep(t){return Math.round((t-this.min)/this.step)*this.step+this.min}setValue(t,e=!1){const i=Math.max(this.min,Math.min(this.max,t)),s=this.value;this.value=i,this.updateAccessibility(),e&&s!==i&&this.emit("change",{oldValue:s,newValue:i,percentage:(i-this.min)/(this.max-this.min)})}updateAccessibility(){const t=Math.round((this.value-this.min)/(this.max-this.min)*100);this.ariaLabel=`${this.label||"Slider"}: ${this.value}${this.unit} (${t}%)`}getHandlePosition(){const t=this.handleSize/2,e=this.width-this.handleSize,i=(this.value-this.min)/(this.max-this.min);return t+e*i}renderSelf(t){if(t.type!=="canvas")return;const e=this.height/2-this.trackHeight/2,i=this.getHandlePosition(),s=this.height/2;this.showLabel&&this.label&&(t.fillStyle=this.colors.text,t.font="12px Arial",t.textAlign="left",t.fillText(this.label,0,m.SLIDER_LABEL_Y_OFFSET)),t.fillStyle=this.colors.track,t.fillRect(this.handleSize/2,e,this.width-this.handleSize,this.trackHeight);const a=i-this.handleSize/2;if(t.fillStyle=this.colors.fill,t.fillRect(this.handleSize/2,e,a,this.trackHeight),t.fillStyle=this.colors.handle,t.beginPath(),t.arc(i,s,this.handleSize/2,0,Math.PI*2),t.fill(),t.strokeStyle=this.colors.handleBorder,t.lineWidth=this.hoverHandle||this.isDraggingHandle?m.THICK_BORDER_WIDTH:m.BORDER_WIDTH,t.stroke(),this.isFocused&&(t.strokeStyle="#FF9800",t.lineWidth=m.BORDER_WIDTH,t.beginPath(),t.arc(i,s,this.handleSize/2+m.FOCUS_RING_EXTRA,0,Math.PI*m.LOADING_SPINNER_SPEED),t.stroke()),this.showValue){t.fillStyle=this.colors.text,t.font="11px Arial",t.textAlign="center";const h=`${Math.round(this.value)}${this.unit}`;t.fillText(h,i,this.height+m.SLIDER_VALUE_Y_OFFSET)}}}/**
 * Advanced UI Components - Specialized interactive components for SimulateAI
 * Modern, accessible, and performant UI components
 *
 * @version 2.0.0
 * @author SimulateAI Team
 * @license Apache-2.0
 */const T={DEFAULT_MODAL_WIDTH:400,DEFAULT_MODAL_HEIGHT:300,MODAL_SHADOW_OFFSET:4,MODAL_CLOSE_BUTTON_SIZE:24,MODAL_CLOSE_BUTTON_PADDING:6,DEFAULT_BUTTON_WIDTH:100,DEFAULT_BUTTON_HEIGHT:36,CLOSE_BUTTON_X_PADDING:6,DEFAULT_NAV_WIDTH:250,DEFAULT_NAV_HEIGHT:400,ANIMATION_STAGGER_OFFSET:50,DEFAULT_LINE_HEIGHT:20,ICON_WIDTH:25,BADGE_WIDTH:30,BADGE_MIN_WIDTH:20,BADGE_CHAR_WIDTH:8,BADGE_PADDING:5,BADGE_HEIGHT:16,SUBMENU_INDICATOR_SIZE:15,SUBMENU_ARROW_SIZE:6,SELECTION_SCALE:1.05,FOCUS_SCALE:1.02,ANIMATION_FAST:100,ANIMATION_NORMAL:150,PERFORMANCE_THRESHOLD:16,RANDOM_BASE:36,RANDOM_LENGTH:9,COLOR_SUBSTR_START:4,COLOR_SUBSTR_LENGTH:2,RGB_MAX:255,LUMINANCE_THRESHOLD:.5,LUMINANCE_RED:.299,LUMINANCE_GREEN:.587,LUMINANCE_BLUE:.114,DEFAULT_CHART_WIDTH:400,DEFAULT_CHART_HEIGHT:300,CHART_PADDING_RATIO:.1,CHART_RADIUS_MARGIN:20,CHART_LEGEND_WIDTH:150,CHART_SUBTITLE_Y:35,CHART_POINT_RADIUS:4,CHART_OPACITY:.3,CHART_BAR_WIDTH_RATIO:.8,CHART_LABEL_RADIUS_RATIO:.7,CHART_SCATTER_POINT_RADIUS:5,CHART_LEGEND_ITEM_HEIGHT:20,CHART_LEGEND_INDICATOR_SIZE:15,CHART_LEGEND_INDICATOR_HEIGHT:10,CHART_LEGEND_TEXT_OFFSET:35,CHART_TOOLTIP_HEIGHT:20,CHART_TOOLTIP_RADIUS:4,DEFAULT_FORM_WIDTH:200,DEFAULT_FORM_HEIGHT:40,VALIDATION_DEBOUNCE_TIME:300,FORM_LABEL_HEIGHT:20,FORM_HELP_HEIGHT:20,FORM_MESSAGE_Y_OFFSET:15,FORM_COUNT_Y_OFFSET:30,FORM_CURSOR_OFFSET:4,CHECKBOX_SIZE:18,CHECKBOX_CHECK_MARGIN:4,CHECKBOX_CHECK_OFFSET:6,RADIO_CHECK_RADIUS_DIVISOR:4,TOOLTIP_SHOW_DELAY:500,TOOLTIP_HIDE_DELAY:200,TOOLTIP_MAX_WIDTH:250,TOOLTIP_BASELINE_SIZE:16,TOOLTIP_ANIMATION_IN:200,TOOLTIP_ANIMATION_OUT:150,TOOLTIP_SLIDE_OFFSET:10,ALIGNMENT_CENTER_BASE:50,ANIMATION_FADE_IN:200,ANIMATION_SCALE_IN:200,ANIMATION_SLIDE_IN:200},P={EASE_OUT_CUBIC:"easeOutCubic",EASE_OUT_QUAD:"easeOutQuad",EASE_OUT_BACK:"easeOutBack"},c={MODAL_Z_INDEX:2e3,TOOLTIP_Z_INDEX:3e3,DROPDOWN_Z_INDEX:1500,ANIMATION_DURATION:{FAST:150,NORMAL:300,SLOW:500},COLORS:{PRIMARY:"#2196F3",SECONDARY:"#757575",SUCCESS:"#4CAF50",WARNING:"#FF9800",ERROR:"#F44336",WHITE:"#FFFFFF",BLACK:"#000000",GRAY_50:"#FAFAFA",GRAY_100:"#F5F5F5",GRAY_200:"#EEEEEE",GRAY_300:"#E0E0E0",GRAY_400:"#BDBDBD",GRAY_500:"#9E9E9E",GRAY_600:"#757575",GRAY_700:"#616161",GRAY_800:"#424242",GRAY_900:"#212121"},SPACING:{XS:4,SM:8,MD:16,LG:24,XL:32,XXL:48},BORDER_RADIUS:{SM:4,MD:8,LG:12,XL:16}},L={debugLog(u,t,e=null){typeof window<"u"&&window.DEBUG_MODE&&(e?x[u](`[UI] ${t}:`,e):x[u](`[UI] ${t}`))},generateId(u="ui"){return`${u}_${Date.now()}_${Math.random().toString(T.RANDOM_BASE).substr(2,T.RANDOM_LENGTH)}`},getContrastColor(u){const t=u.replace("#",""),e=parseInt(t.substr(0,2),16),i=parseInt(t.substr(2,2),16),s=parseInt(t.substr(T.COLOR_SUBSTR_START,T.COLOR_SUBSTR_LENGTH),16);return(T.LUMINANCE_RED*e+T.LUMINANCE_GREEN*i+T.LUMINANCE_BLUE*s)/T.RGB_MAX>T.LUMINANCE_THRESHOLD?c.COLORS.BLACK:c.COLORS.WHITE},measureText(u,t,e){e.save(),e.font=t;const i=e.measureText(u);return e.restore(),{width:i.width,height:parseInt(t.match(/\d+/)[0])}},wrapText(u,t,e,i){i.save(),i.font=e;const s=u.split(" "),a=[];let h="";for(const o of s){const l=h+(h?" ":"")+o;i.measureText(l).width>t&&h?(a.push(h),h=o):h=l}return h&&a.push(h),i.restore(),a}};class bt extends C{constructor(t={}){super({...t,width:w(t.width,T.DEFAULT_MODAL_WIDTH),height:w(t.height,T.DEFAULT_MODAL_HEIGHT),ariaRole:"dialog",ariaModal:!0,tabIndex:-1}),this.title=v(t.title,"Dialog"),this.content=v(t.content),this.buttons=Array.isArray(t.buttons)?t.buttons:[{text:"OK",action:"close"}],this.closable=t.closable!==!1,this.backdrop=t.backdrop!==!1,this.animation=v(t.animation,"fade"),this.autoFocus=t.autoFocus!==!1,this.trapFocus=t.trapFocus!==!1,this.closeOnEscape=t.closeOnEscape!==!1,this.closeOnBackdrop=t.closeOnBackdrop!==!1,this.isOpen=!1,this.isAnimating=!1,this.previousFocus=null,this.firstFocusableElement=null,this.lastFocusableElement=null,this.zIndex=c.MODAL_Z_INDEX,this.backdropColor=t.backdropColor||"rgba(0, 0, 0, 0.5)",this.borderRadius=c.BORDER_RADIUS.LG,this.padding=c.SPACING.LG,this.headerHeight=60,this.footerHeight=60,this.bodyHeight=this.height-this.headerHeight-this.footerHeight,this.buttonElements=[],this.focusedButtonIndex=0,this.setupModal()}setupModal(){this.ariaLabel=this.title,this.ariaLabelledBy=`modal-title-${this.id}`,this.ariaDescribedBy=`modal-body-${this.id}`,this.setupEventHandlers(),this.prepareButtons(),this.alpha=0,this.visible=!1}setupEventHandlers(){this.on("keyDown",t=>this.handleKeyDown(t)),this.on("click",t=>this.handleBackdropClick(t)),this.on("animationComplete",()=>{this.isAnimating=!1})}prepareButtons(){this.buttonElements=this.buttons.map((t,e)=>({...t,id:`modal-btn-${this.id}-${e}`,x:0,y:0,width:T.DEFAULT_BUTTON_WIDTH,height:T.DEFAULT_BUTTON_HEIGHT,isFocused:e===0,isHovered:!1,isPressed:!1}))}async open(){if(!(this.isOpen||this.isAnimating))try{this.isAnimating=!0,this.previousFocus=document.activeElement,this.visible=!0,this.isOpen=!0,this.centerOnScreen(),await this.animateIn(),this.autoFocus&&this.focusFirstElement(),this.emit("open",{modal:this})}catch(t){this.errorHandler(t,"open")}finally{this.isAnimating=!1}}async close(){if(!(!this.isOpen||this.isAnimating))try{this.isAnimating=!0,await this.animateOut(),this.visible=!1,this.isOpen=!1,this.previousFocus&&typeof this.previousFocus.focus=="function"&&this.previousFocus.focus(),this.emit("close",{modal:this})}catch(t){this.errorHandler(t,"close")}finally{this.isAnimating=!1}}centerOnScreen(){this.scene?(this.x=(this.scene.width-this.width)/2,this.y=(this.scene.height-this.height)/2):(this.x=(window.innerWidth-this.width)/2,this.y=(window.innerHeight-this.height)/2)}async animateIn(){const t=[];switch(this.animation){case"slide":this.y-=100,t.push(this.animate("y",this.y+100,c.ANIMATION_DURATION.NORMAL,"easeOutCubic"),this.animate("alpha",1,c.ANIMATION_DURATION.NORMAL));break;case"scale":this.scaleX=.8,this.scaleY=.8,t.push(this.animate("scaleX",1,c.ANIMATION_DURATION.NORMAL,"easeOutBack"),this.animate("scaleY",1,c.ANIMATION_DURATION.NORMAL,"easeOutBack"),this.animate("alpha",1,c.ANIMATION_DURATION.NORMAL));break;case"bounce":this.scaleX=.3,this.scaleY=.3,t.push(this.animate("scaleX",1,c.ANIMATION_DURATION.SLOW,"bounce"),this.animate("scaleY",1,c.ANIMATION_DURATION.SLOW,"bounce"),this.animate("alpha",1,c.ANIMATION_DURATION.FAST));break;default:t.push(this.animate("alpha",1,c.ANIMATION_DURATION.NORMAL))}await Promise.all(t)}async animateOut(){return this.animate("alpha",0,c.ANIMATION_DURATION.FAST)}handleKeyDown(t){if(this.isOpen)switch(t.key){case"Escape":this.closeOnEscape&&this.closable&&(t.preventDefault(),this.close());break;case"Tab":this.trapFocus&&this.handleTabNavigation(t);break;case"Enter":case" ":{const e=this.buttonElements[this.focusedButtonIndex];e&&(t.preventDefault(),this.executeButtonAction(e));break}case"ArrowLeft":case"ArrowRight":this.navigateButtons(t.key==="ArrowRight"?1:-1);break}}handleTabNavigation(t){t.preventDefault(),t.shiftKey?this.focusedButtonIndex=Math.max(0,this.focusedButtonIndex-1):this.focusedButtonIndex=Math.min(this.buttonElements.length-1,this.focusedButtonIndex+1),this.updateButtonFocus()}navigateButtons(t){this.focusedButtonIndex=At(this.focusedButtonIndex+t,0,this.buttonElements.length-1),this.updateButtonFocus()}updateButtonFocus(){this.buttonElements.forEach((t,e)=>{t.isFocused=e===this.focusedButtonIndex})}focusFirstElement(){this.buttonElements.length>0&&(this.focusedButtonIndex=0,this.updateButtonFocus())}handleBackdropClick(t){!this.containsPoint(t.x,t.y)&&this.closeOnBackdrop&&this.closable&&this.close()}executeButtonAction(t){try{if(t.action==="close")this.close();else if(typeof t.callback=="function"){const e=t.callback(this,t);e&&typeof e.then=="function"&&e.catch(i=>this.errorHandler(i,"buttonCallback"))}this.emit("buttonClick",{button:t,modal:this})}catch(e){this.errorHandler(e,"executeButtonAction")}}calculateButtonLayout(){const t=c.SPACING.SM,e=this.buttonElements.reduce((h,o)=>h+o.width,0),i=(this.buttonElements.length-1)*t;let a=(this.width-e-i)/2;this.buttonElements.forEach(h=>{h.x=a,h.y=this.height-this.footerHeight+(this.footerHeight-h.height)/2,a+=h.width+t})}renderSelf(t){if(!(t.type!=="canvas"||!this.visible))try{this.backdrop&&this.isOpen&&this.renderBackdrop(t),this.renderModalBackground(t),this.renderHeader(t),this.renderBody(t),this.renderFooter(t),this.isFocused&&this.renderFocusRing(t)}catch(e){this.errorHandler(e,"renderSelf")}}renderBackdrop(t){t.save(),t.setTransform(1,0,0,1,0,0),t.fillStyle=this.backdropColor,t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore()}renderModalBackground(t){t.fillStyle="rgba(0, 0, 0, 0.2)",t.fillRect(T.MODAL_SHADOW_OFFSET,T.MODAL_SHADOW_OFFSET,this.width,this.height),t.fillStyle=c.COLORS.WHITE,t.fillRect(0,0,this.width,this.height),t.strokeStyle=c.COLORS.GRAY_300,t.lineWidth=1,t.strokeRect(0,0,this.width,this.height)}renderHeader(t){t.fillStyle=c.COLORS.GRAY_50,t.fillRect(0,0,this.width,this.headerHeight),t.strokeStyle=c.COLORS.GRAY_200,t.lineWidth=1,t.beginPath(),t.moveTo(0,this.headerHeight),t.lineTo(this.width,this.headerHeight),t.stroke(),t.fillStyle=c.COLORS.GRAY_900,t.font="bold 16px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(this.title,this.padding,0+this.headerHeight/2),this.closable&&this.renderCloseButton(t)}renderCloseButton(t){const e=T.MODAL_CLOSE_BUTTON_SIZE,i=this.width-this.padding-e,s=(this.headerHeight-e)/2;t.fillStyle=this.closeButtonHovered?c.COLORS.GRAY_200:"transparent",t.fillRect(i,s,e,e),t.strokeStyle=c.COLORS.GRAY_600,t.lineWidth=2,t.beginPath(),t.moveTo(i+T.CLOSE_BUTTON_X_PADDING,s+T.CLOSE_BUTTON_X_PADDING),t.lineTo(i+e-T.CLOSE_BUTTON_X_PADDING,s+e-T.CLOSE_BUTTON_X_PADDING),t.moveTo(i+e-T.CLOSE_BUTTON_X_PADDING,s+T.CLOSE_BUTTON_X_PADDING),t.lineTo(i+T.CLOSE_BUTTON_X_PADDING,s+e-T.CLOSE_BUTTON_X_PADDING),t.stroke()}renderBody(t){const e=this.headerHeight;if(t.fillStyle=c.COLORS.WHITE,t.fillRect(0,e,this.width,this.bodyHeight),this.content){t.fillStyle=c.COLORS.GRAY_700,t.font="14px Arial",t.textAlign="left",t.textBaseline="top";const i=this.width-this.padding*2,s=L.wrapText(this.content,i,"14px Arial",t);let a=e+this.padding;s.forEach(h=>{t.fillText(h,this.padding,a),a+=T.DEFAULT_LINE_HEIGHT})}}renderFooter(t){const e=this.height-this.footerHeight;t.fillStyle=c.COLORS.GRAY_50,t.fillRect(0,e,this.width,this.footerHeight),t.strokeStyle=c.COLORS.GRAY_200,t.lineWidth=1,t.beginPath(),t.moveTo(0,e),t.lineTo(this.width,e),t.stroke(),this.calculateButtonLayout(),this.buttonElements.forEach(i=>{this.renderButton(t,i)})}renderButton(t,e){let i=c.COLORS.PRIMARY,s=c.COLORS.WHITE;e.variant==="secondary"&&(i=c.COLORS.GRAY_300,s=c.COLORS.GRAY_700),e.isPressed?i=c.COLORS.GRAY_700:e.isHovered&&(i=e.variant==="secondary"?c.COLORS.GRAY_400:"#1976D2"),t.fillStyle=i,t.fillRect(e.x,e.y,e.width,e.height),e.isFocused?(t.strokeStyle=c.COLORS.WARNING,t.lineWidth=2):(t.strokeStyle=c.COLORS.GRAY_400,t.lineWidth=1),t.strokeRect(e.x,e.y,e.width,e.height),t.fillStyle=s,t.font="14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(e.text,e.x+e.width/2,e.y+e.height/2)}renderFocusRing(t){t.strokeStyle=c.COLORS.PRIMARY,t.lineWidth=F,t.setLineDash([2,2]),t.strokeRect(-F,-F,this.width+F*2,this.height+F*2),t.setLineDash([])}handleInput(t,e){if(!this.isOpen||this.isAnimating)return!1;for(const i of this.buttonElements){const s={x:this.x+i.x,y:this.y+i.y,width:i.width,height:i.height},a=e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height;switch(t){case"mousemove":i.isHovered=a;break;case"mousedown":if(a)return i.isPressed=!0,this.focusedButtonIndex=this.buttonElements.indexOf(i),this.updateButtonFocus(),!0;break;case"mouseup":if(i.isPressed)return i.isPressed=!1,a&&this.executeButtonAction(i),!0;break}}if(this.closable&&t==="mousedown"){const i={x:this.x+this.width-this.padding-T.MODAL_CLOSE_BUTTON_SIZE,y:this.y+(this.headerHeight-T.MODAL_CLOSE_BUTTON_SIZE)/2,width:T.MODAL_CLOSE_BUTTON_SIZE,height:T.MODAL_CLOSE_BUTTON_SIZE};if(e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height)return this.close(),!0}return super.handleInput(t,e)}destroy(){this.isOpen&&this.close(),this.stopAnimations(),super.destroy()}}class Ot extends C{constructor(t={}){super({...t,width:t.width||T.DEFAULT_NAV_WIDTH,height:t.height||T.DEFAULT_NAV_HEIGHT,ariaRole:"navigation"}),this.items=t.items||[],this.orientation=t.orientation||"vertical",this.expandable=t.expandable||!1,this.collapsible=t.collapsible||!1,this.selectedIndex=t.selectedIndex||0,this.multiSelect=t.multiSelect||!1,this.showIcons=t.showIcons!==!1,this.showTooltips=t.showTooltips||!1,this.animationDuration=t.animationDuration||c.ANIMATION.DURATION.FAST,this.isExpanded=t.isExpanded!==!1,this.hoveredIndex=-1,this.focusedIndex=this.selectedIndex,this.selectedIndices=new Set([this.selectedIndex]),this.isAnimating=!1,this.ariaLabel=t.ariaLabel||"Navigation menu",this.ariaOrientation=this.orientation,this.errorHandler=t.errorHandler||this.defaultErrorHandler.bind(this),this.lastRenderTime=0,this.renderCount=0,this.setupNavigation(),this.bindEvents()}setupNavigation(){try{this.menuItems=this.items.map((t,e)=>({...t,index:e,id:`nav-item-${this.id}-${e}`,element:null,isSelected:this.multiSelect?this.selectedIndices.has(e):e===this.selectedIndex,isHovered:!1,isFocused:!1,isDisabled:t.disabled||!1,badge:t.badge||null,submenu:t.submenu||null,tooltip:t.tooltip||null,animationOffset:e*T.ANIMATION_STAGGER_OFFSET})),this.updateAccessibilityAttributes()}catch(t){this.errorHandler(t,"setupNavigation")}}bindEvents(){try{this.on("keyDown",t=>this.handleKeyNavigation(t)),this.on("focus",()=>this.handleFocus()),this.on("blur",()=>this.handleBlur()),this.on("animationStart",()=>{this.isAnimating=!0}),this.on("animationEnd",()=>{this.isAnimating=!1})}catch(t){this.errorHandler(t,"bindEvents")}}addItem(t){try{if(!t||typeof t!="object")throw new Error("Invalid item provided to addItem");const e=this.menuItems.length,i={text:t.text||`Item ${e+1}`,icon:t.icon||null,action:t.action||null,disabled:t.disabled||!1,badge:t.badge||null,submenu:t.submenu||null,tooltip:t.tooltip||null,...t,index:e,id:`nav-item-${this.id}-${e}`,element:null,isSelected:!1,isHovered:!1,isFocused:!1,isDisabled:t.disabled||!1,animationOffset:e*T.ANIMATION_STAGGER_OFFSET};return this.menuItems.push(i),this.updateAccessibilityAttributes(),this.animateItemAddition(i),this.emit("itemAdded",{item:i,index:e}),!0}catch(e){return this.errorHandler(e,"addItem"),!1}}removeItem(t){try{if(t<0||t>=this.menuItems.length)throw new Error(`Invalid index ${t} for removeItem`);const e=this.menuItems[t];return this.menuItems.splice(t,1),this.menuItems.forEach((i,s)=>{i.index=s,i.id=`nav-item-${this.id}-${s}`}),this.selectedIndex>=t&&(this.selectedIndex=Math.max(0,this.selectedIndex-1)),this.updateAccessibilityAttributes(),this.emit("itemRemoved",{item:e,index:t}),!0}catch(e){return this.errorHandler(e,"removeItem"),!1}}selectItem(t,e=!1){try{if(t<0||t>=this.menuItems.length)throw new Error(`Invalid index ${t} for selectItem`);const i=this.menuItems[t];if(i.isDisabled)return;if(this.multiSelect&&e?this.selectedIndices.has(t)?(this.selectedIndices.delete(t),i.isSelected=!1):(this.selectedIndices.add(t),i.isSelected=!0):(this.clearSelection(),this.selectedIndex=t,this.selectedIndices.clear(),this.selectedIndices.add(t),i.isSelected=!0),this.updateSelectionState(),i.action&&typeof i.action=="function"){const s=i.action(i,this);s&&typeof s.then=="function"&&s.catch(a=>this.errorHandler(a,"itemAction"))}this.animateSelection(i),this.emit("itemSelected",{item:i,index:t,selectedIndices:Array.from(this.selectedIndices),multiSelect:this.multiSelect&&e})}catch(i){this.errorHandler(i,"selectItem")}}clearSelection(){this.menuItems.forEach(t=>{t.isSelected=!1}),this.selectedIndices.clear()}updateSelectionState(){this.menuItems.forEach((t,e)=>{t.isSelected=this.selectedIndices.has(e)})}handleKeyNavigation(t){try{if(this.isAnimating)return;const e=this.orientation==="vertical",i=e?"ArrowDown":"ArrowRight",s=e?"ArrowUp":"ArrowLeft";switch(t.key){case i:t.preventDefault(),this.navigateToNextItem();break;case s:t.preventDefault(),this.navigateToPreviousItem();break;case"Enter":case" ":t.preventDefault(),this.activateCurrentItem(t.ctrlKey||t.metaKey);break;case"Home":t.preventDefault(),this.navigateToFirstItem();break;case"End":t.preventDefault(),this.navigateToLastItem();break;case"Escape":this.collapsible&&this.collapse();break;case"Tab":break;default:this.handleCharacterNavigation(t.key);break}}catch(e){this.errorHandler(e,"handleKeyNavigation")}}navigateToNextItem(){const t=this.focusedIndex;let e=t;do e=(e+1)%this.menuItems.length;while(this.menuItems[e].isDisabled&&e!==t);(e!==t||!this.menuItems[e].isDisabled)&&(this.focusedIndex=e,this.updateFocus())}navigateToPreviousItem(){const t=this.focusedIndex;let e=t;do e=e===0?this.menuItems.length-1:e-1;while(this.menuItems[e].isDisabled&&e!==t);(e!==t||!this.menuItems[e].isDisabled)&&(this.focusedIndex=e,this.updateFocus())}navigateToFirstItem(){for(let t=0;t<this.menuItems.length;t++)if(!this.menuItems[t].isDisabled){this.focusedIndex=t,this.updateFocus();break}}navigateToLastItem(){for(let t=this.menuItems.length-1;t>=0;t--)if(!this.menuItems[t].isDisabled){this.focusedIndex=t,this.updateFocus();break}}activateCurrentItem(t=!1){this.focusedIndex>=0&&this.focusedIndex<this.menuItems.length&&this.selectItem(this.focusedIndex,t)}handleCharacterNavigation(t){if(t.length!==1||t<" ")return;const e=t.toLowerCase(),i=(this.focusedIndex+1)%this.menuItems.length;for(let s=0;s<this.menuItems.length;s++){const a=(i+s)%this.menuItems.length,h=this.menuItems[a];if(!h.isDisabled&&h.text&&h.text.toLowerCase().startsWith(e)){this.focusedIndex=a,this.updateFocus();break}}}updateFocus(){try{this.menuItems.forEach((t,e)=>{const i=t.isFocused;t.isFocused=e===this.focusedIndex,t.isFocused&&!i&&this.animateFocus(t)}),this.emit("focusChanged",{focusedIndex:this.focusedIndex,focusedItem:this.menuItems[this.focusedIndex]})}catch(t){this.errorHandler(t,"updateFocus")}}handleFocus(){(this.focusedIndex<0||this.focusedIndex>=this.menuItems.length)&&(this.focusedIndex=this.selectedIndex>=0?this.selectedIndex:0),this.updateFocus()}handleBlur(){this.menuItems.forEach(t=>{t.isFocused=!1})}expand(){this.isExpanded||this.isAnimating||(this.isExpanded=!0,this.animateExpansion(!0),this.emit("expanded"))}collapse(){!this.isExpanded||this.isAnimating||(this.isExpanded=!1,this.animateExpansion(!1),this.emit("collapsed"))}toggle(){this.isExpanded?this.collapse():this.expand()}animateItemAddition(t){this.animationsEnabled&&this.animate("alpha",1,this.animationDuration,{from:0,delay:t.animationOffset,easing:P.EASE_OUT_CUBIC})}animateSelection(t){this.animationsEnabled&&this.animate("scale",T.SELECTION_SCALE,T.ANIMATION_FAST,{from:1,yoyo:!0,easing:P.EASE_OUT_QUAD})}animateFocus(t){this.animationsEnabled&&(t.focusScale=t.focusScale||1,this.animate("focusScale",T.FOCUS_SCALE,T.ANIMATION_NORMAL,{from:1,target:t,easing:P.EASE_OUT_QUAD}))}animateExpansion(t){if(!this.animationsEnabled)return;const e=t?this.originalHeight:0;this.animate("height",e,this.animationDuration,{easing:P.EASE_OUT_CUBIC})}updateAccessibilityAttributes(){this.ariaLabel=`Navigation menu with ${this.menuItems.length} items`,this.selectedIndices.size>0&&(this.ariaLabel+=`, ${this.selectedIndices.size} selected`)}handleInput(t,e){try{if(!this.visible||this.isAnimating)return!1;const{x:i,y:s}=e,a=this.orientation==="vertical"?this.height/this.menuItems.length:this.height,h=this.orientation==="horizontal"?this.width/this.menuItems.length:this.width;let o=-1;for(let l=0;l<this.menuItems.length;l++){const r=this.orientation==="horizontal"?l*h:0,E=this.orientation==="vertical"?l*a:0;if(i>=this.x+r&&i<=this.x+r+h&&s>=this.y+E&&s<=this.y+E+a){o=l;break}}switch(this.menuItems.forEach((l,r)=>{l.isHovered=r===o}),t){case"mousemove":o!==this.hoveredIndex&&(this.hoveredIndex=o,this.emit("hoverChanged",{hoveredIndex:o,hoveredItem:this.menuItems[o]}));break;case"mousedown":case"touchstart":if(o>=0)return this.focusedIndex=o,this.updateFocus(),!0;break;case"mouseup":case"touchend":if(o>=0)return this.selectItem(o,e.ctrlKey||e.metaKey),!0;break}return super.handleInput(t,e)}catch(i){return this.errorHandler(i,"handleInput"),!1}}renderSelf(t){if(!(t.type!=="canvas"||!this.visible))try{const e=performance.now();if(this.alpha<=0||this.scale<=0)return;const i=this.orientation==="vertical"?this.height/this.menuItems.length:this.height,s=this.orientation==="horizontal"?this.width/this.menuItems.length:this.width;this.renderMenuBackground(t),this.menuItems.forEach((h,o)=>{(this.isExpanded||!this.collapsible)&&this.renderMenuItem(t,h,o,s,i)}),this.isFocused&&this.focusedIndex>=0&&this.renderFocusRing(t,s,i);const a=performance.now()-e;this.lastRenderTime=a,this.renderCount++,a>T.PERFORMANCE_THRESHOLD&&L.debugLog("warn",`NavigationMenu render took ${a.toFixed(2)}ms`)}catch(e){this.errorHandler(e,"renderSelf")}}renderMenuBackground(t){t.fillStyle=c.COLORS.WHITE,t.fillRect(0,0,this.width,this.height),t.strokeStyle=c.COLORS.GRAY_300,t.lineWidth=1,t.strokeRect(0,0,this.width,this.height),t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillRect(2,2,this.width,this.height)}renderMenuItem(t,e,i,s,a){const h=this.orientation==="horizontal"?i*s:0,o=this.orientation==="vertical"?i*a:0;let l=c.COLORS.WHITE;e.isDisabled?l=c.COLORS.GRAY_100:e.isSelected?l=c.COLORS.PRIMARY:e.isFocused?l=c.COLORS.PRIMARY_LIGHT:e.isHovered&&(l=c.COLORS.GRAY_50),t.fillStyle=l,t.fillRect(h,o,s,a),t.strokeStyle=c.COLORS.GRAY_200,t.lineWidth=1,t.strokeRect(h,o,s,a),e.isFocused&&(t.strokeStyle=c.COLORS.PRIMARY,t.lineWidth=2,t.strokeRect(h+1,o+1,s-2,a-2));const r=e.isSelected?c.COLORS.WHITE:e.isDisabled?c.COLORS.GRAY_400:c.COLORS.GRAY_900;t.fillStyle=r,t.font=`${e.isSelected?"bold ":""}14px Arial`,t.textAlign="left",t.textBaseline="middle";let E=h+c.SPACING.SM;const g=o+a/2;this.showIcons&&e.icon&&(t.fillText(e.icon,E,g),E+=T.ICON_WIDTH);const _=s-(E-h)-c.SPACING.SM-(e.badge?T.BADGE_WIDTH:0),I=L.truncateText(e.text,_,t.font,t);if(t.fillText(I,E,g),e.badge&&this.renderBadge(t,e.badge,h+s-T.ICON_WIDTH,o+T.BADGE_PADDING),e.submenu){const S=h+s-T.SUBMENU_INDICATOR_SIZE,D=o+a/2;this.renderSubmenuIndicator(t,S,D,e.isSelected)}}renderBadge(t,e,i,s){const a=String(e),h=Math.max(T.BADGE_MIN_WIDTH,a.length*T.BADGE_CHAR_WIDTH);t.fillStyle=c.COLORS.DANGER,L.fillRoundedRect(t,i-h/2,s,h,T.BADGE_HEIGHT,c.BORDER_RADIUS.SM),t.fillStyle=c.COLORS.WHITE,t.font="bold 10px Arial",t.textAlign="center",t.fillText(a,i,s+c.SPACING.SM)}renderSubmenuIndicator(t,e,i,s){const h=s?c.COLORS.WHITE:c.COLORS.GRAY_600;t.fillStyle=h,t.beginPath(),t.moveTo(e-6,i-6),t.lineTo(e+6,i),t.lineTo(e-6,i+6),t.closePath(),t.fill()}renderFocusRing(t,e,i){const s=this.menuItems[this.focusedIndex];if(!s)return;const a=this.orientation==="horizontal"?s.index*e:0,h=this.orientation==="vertical"?s.index*i:0;t.strokeStyle=c.COLORS.WARNING,t.lineWidth=F,t.setLineDash([2,2]),t.strokeRect(a-F,h-F,e+F*2,i+F*2),t.setLineDash([])}getAccessibilityDescription(){const t=this.selectedIndices.size,e=this.menuItems.length,i=this.menuItems.filter(s=>!s.isDisabled).length;return`Navigation menu with ${e} items, ${i} enabled, ${t} selected. Currently ${this.isExpanded?"expanded":"collapsed"}. Orientation: ${this.orientation}.`}defaultErrorHandler(t,e){L.debugLog("error",`NavigationMenu error in ${e}`,t),this.emit("error",{error:t,context:e,component:"NavigationMenu"})}destroy(){try{this.stopAnimations(),this.clearTimers(),this.menuItems=[],this.selectedIndices.clear(),super.destroy()}catch(t){this.errorHandler(t,"destroy")}}}class Ct extends C{constructor(t={}){super({...t,width:t.width||T.DEFAULT_CHART_WIDTH,height:t.height||T.DEFAULT_CHART_HEIGHT,ariaRole:"img"}),this.type=t.type||"line",this.data=t.data||[],this.labels=t.labels||[],this.title=t.title||"",this.subtitle=t.subtitle||"",this.showLegend=t.showLegend!==!1,this.showAxis=t.showAxis!==!1,this.showGrid=t.showGrid!==!1,this.showTooltips=t.showTooltips!==!1,this.interactive=t.interactive!==!1,this.animated=t.animated!==!1,this.colors=t.colors||[c.COLORS.PRIMARY,c.COLORS.SUCCESS,c.COLORS.WARNING,c.COLORS.DANGER,c.COLORS.INFO,"#9C27B0","#607D8B","#795548"],this.margin=t.margin||{top:50,right:40,bottom:50,left:70},this.chartWidth=this.width-this.margin.left-this.margin.right,this.chartHeight=this.height-this.margin.top-this.margin.bottom,this.animationProgress=0,this.isAnimating=!1,this.hoveredDataPoint=null,this.selectedDataPoints=new Set,this.errorHandler=t.errorHandler||this.defaultErrorHandler.bind(this),this.lastRenderTime=0,this.renderCount=0,this.processedData=null,this.scales=null,this.legend=null,this.tooltip=null,this.setupChart(),this.bindEvents()}setupChart(){try{this.validateData(),this.processData(),this.calculateScales(),this.setupLegend(),this.setupTooltip(),this.updateAccessibilityAttributes(),this.animated&&this.startEntranceAnimation()}catch(t){this.errorHandler(t,"setupChart")}}bindEvents(){try{this.interactive&&(this.on("mousemove",t=>this.handleMouseMove(t)),this.on("mousedown",t=>this.handleMouseDown(t)),this.on("mouseup",t=>this.handleMouseUp(t)),this.on("keyDown",t=>this.handleKeyDown(t)))}catch(t){this.errorHandler(t,"bindEvents")}}validateData(){if(!Array.isArray(this.data))throw new Error("Chart data must be an array");if(this.data.length===0)throw new Error("Chart data cannot be empty");switch(this.type){case"pie":if(!this.data.every(t=>typeof t=="number"&&t>=0))throw new Error("Pie chart data must be positive numbers");break;case"line":case"area":case"bar":if(Array.isArray(this.data[0])){if(!this.data.every(t=>Array.isArray(t)&&t.every(e=>typeof e=="number")))throw new Error("Multi-series data must be arrays of numbers")}else if(!this.data.every(t=>typeof t=="number"))throw new Error("Line/Bar chart data must be numbers");break;case"scatter":if(!this.data.every(t=>Array.isArray(t)&&t.length>=2&&typeof t[0]=="number"&&typeof t[1]=="number"))throw new Error("Scatter plot data must be [x, y] coordinate pairs");break}}processData(){try{switch(this.type){case"line":case"area":case"bar":this.processSeriesData();break;case"pie":this.processPieData();break;case"scatter":this.processScatterData();break}}catch(t){this.errorHandler(t,"processData")}}processSeriesData(){Array.isArray(this.data[0])||(this.data=[this.data]);const t=this.data.flat();this.minValue=Math.min(...t),this.maxValue=Math.max(...t),this.avgValue=t.reduce((s,a)=>s+a,0)/t.length;const i=(this.maxValue-this.minValue)*T.CHART_PADDING_RATIO;this.minValue=Math.max(0,this.minValue-i),this.maxValue=this.maxValue+i,this.processedData=this.data.map((s,a)=>({values:s,color:this.colors[a%this.colors.length],label:this.labels[a]||`Series ${a+1}`,visible:!0,opacity:1}))}processPieData(){const t=this.data.reduce((i,s)=>i+s,0);if(t===0)throw new Error("Pie chart total cannot be zero");this.processedData=this.data.map((i,s)=>({value:i,percentage:i/t*100,angle:i/t*2*Math.PI,color:this.colors[s%this.colors.length],label:this.labels[s]||`Slice ${s+1}`,visible:!0,opacity:1}));let e=0;this.processedData.forEach(i=>{i.startAngle=e,i.endAngle=e+i.angle,e+=i.angle})}processScatterData(){this.minX=Math.min(...this.data.map(a=>a[0])),this.maxX=Math.max(...this.data.map(a=>a[0])),this.minY=Math.min(...this.data.map(a=>a[1])),this.maxY=Math.max(...this.data.map(a=>a[1]));const t=this.maxX-this.minX,e=this.maxY-this.minY,i=t*T.CHART_PADDING_RATIO,s=e*T.CHART_PADDING_RATIO;this.minX-=i,this.maxX+=i,this.minY-=s,this.maxY+=s,this.processedData=this.data.map((a,h)=>({x:a[0],y:a[1],color:this.colors[h%this.colors.length],label:this.labels[h]||`Point ${h+1}`,visible:!0,opacity:1}))}calculateScales(){try{switch(this.type){case"line":case"area":case"bar":this.xScale=this.chartWidth/(this.processedData[0].values.length-1),this.yScale=this.chartHeight/(this.maxValue-this.minValue);break;case"scatter":this.xScale=this.chartWidth/(this.maxX-this.minX),this.yScale=this.chartHeight/(this.maxY-this.minY);break;case"pie":this.radius=Math.min(this.chartWidth,this.chartHeight)/2-T.CHART_RADIUS_MARGIN;break}}catch(t){this.errorHandler(t,"calculateScales")}}setupLegend(){this.showLegend&&(this.legend={x:this.width-T.CHART_LEGEND_WIDTH,y:this.margin.top,width:140,itemHeight:20,items:this.processedData.map(t=>({color:t.color,label:t.label,visible:t.visible}))})}setupTooltip(){this.showTooltips&&(this.tooltip={visible:!1,x:0,y:0,content:"",width:"auto",height:"auto"})}startEntranceAnimation(){this.animationsEnabled&&(this.animationProgress=0,this.isAnimating=!0,this.animate("animationProgress",1,c.ANIMATION.DURATION.SLOW,{easing:P.EASE_OUT_CUBIC,onComplete:()=>{this.isAnimating=!1,this.emit("animationComplete")}}))}handleMouseMove(t){try{if(!this.interactive)return;const{x:e,y:i}=t,s=e-this.x-this.margin.left,a=i-this.y-this.margin.top,h=this.findDataPointAt(s,a);h!==this.hoveredDataPoint&&(this.hoveredDataPoint=h,h&&this.showTooltips?this.showTooltip(h,e,i):this.hideTooltip(),this.emit("dataPointHover",{dataPoint:h,x:s,y:a}))}catch(e){this.errorHandler(e,"handleMouseMove")}}handleMouseDown(t){try{if(!this.interactive)return;const{x:e,y:i}=t,s=e-this.x-this.margin.left,a=i-this.y-this.margin.top,h=this.findDataPointAt(s,a);h&&(t.ctrlKey||t.metaKey?this.selectedDataPoints.has(h)?this.selectedDataPoints.delete(h):this.selectedDataPoints.add(h):(this.selectedDataPoints.clear(),this.selectedDataPoints.add(h)),this.emit("dataPointSelect",{dataPoint:h,selectedPoints:Array.from(this.selectedDataPoints)}))}catch(e){this.errorHandler(e,"handleMouseDown")}}handleMouseUp(t){}handleKeyDown(t){try{if(!this.interactive)return;switch(t.key){case"Escape":this.selectedDataPoints.clear(),this.hideTooltip(),this.emit("selectionCleared");break;case"Enter":case" ":this.hoveredDataPoint&&(this.selectedDataPoints.clear(),this.selectedDataPoints.add(this.hoveredDataPoint),this.emit("dataPointSelect",{dataPoint:this.hoveredDataPoint,selectedPoints:Array.from(this.selectedDataPoints)}));break}}catch(e){this.errorHandler(e,"handleKeyDown")}}findDataPointAt(t,e){switch(this.type){case"line":case"area":return this.findLineDataPoint(t,e,10);case"bar":return this.findBarDataPoint(t,e);case"pie":return this.findPieDataPoint(t,e);case"scatter":return this.findScatterDataPoint(t,e,10);default:return null}}findLineDataPoint(t,e,i){for(const s of this.processedData)for(let a=0;a<s.values.length;a++){const h=a*this.xScale,o=this.chartHeight-(s.values[a]-this.minValue)*this.yScale;if(Math.sqrt(Math.pow(t-h,2)+Math.pow(e-o,2))<=i)return{series:s.label,index:a,value:s.values[a],x:h,y:o,color:s.color}}return null}findBarDataPoint(t,e){const i=this.chartWidth/this.processedData[0].values.length,s=Math.floor(t/i);if(s>=0&&s<this.processedData[0].values.length)for(const a of this.processedData){const h=a.values[s],o=(h-this.minValue)*this.yScale,l=this.chartHeight-o;if(e>=l&&e<=this.chartHeight)return{series:a.label,index:s,value:h,x:s*i+i/2,y:l+o/2,color:a.color}}return null}findPieDataPoint(t,e){const i=this.chartWidth/2,s=this.chartHeight/2;if(Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2))<=this.radius){const h=Math.atan2(e-s,t-i),o=h<0?h+2*Math.PI:h;for(const l of this.processedData)if(o>=l.startAngle&&o<=l.endAngle)return{label:l.label,value:l.value,percentage:l.percentage,color:l.color,angle:o}}return null}findScatterDataPoint(t,e,i){for(const s of this.processedData){const a=(s.x-this.minX)*this.xScale,h=this.chartHeight-(s.y-this.minY)*this.yScale;if(Math.sqrt(Math.pow(t-a,2)+Math.pow(e-h,2))<=i)return{...s,screenX:a,screenY:h}}return null}showTooltip(t,e,i){this.tooltip&&(this.tooltip.visible=!0,this.tooltip.x=e+10,this.tooltip.y=i-10,this.tooltip.content=this.formatTooltipContent(t))}hideTooltip(){this.tooltip&&(this.tooltip.visible=!1)}formatTooltipContent(t){switch(this.type){case"pie":return`${t.label}: ${t.value} (${t.percentage.toFixed(1)}%)`;case"scatter":return`${t.label}: (${t.x}, ${t.y})`;default:return`${t.series}: ${t.value}`}}renderSelf(t){if(!(t.type!=="canvas"||!this.visible))try{const e=performance.now();switch(t.fillStyle=c.COLORS.WHITE,t.fillRect(0,0,this.width,this.height),this.renderTitles(t),t.save(),t.beginPath(),t.rect(this.margin.left,this.margin.top,this.chartWidth,this.chartHeight),t.clip(),this.showGrid&&this.type!=="pie"&&this.renderGrid(t),this.showAxis&&this.type!=="pie"&&this.renderAxes(t),this.type){case"line":this.renderLineChart(t);break;case"area":this.renderAreaChart(t);break;case"bar":this.renderBarChart(t);break;case"pie":this.renderPieChart(t);break;case"scatter":this.renderScatterPlot(t);break}t.restore(),this.showLegend&&this.renderLegend(t),this.tooltip&&this.tooltip.visible&&this.renderTooltip(t);const i=performance.now()-e;this.lastRenderTime=i,this.renderCount++,i>T.PERFORMANCE_THRESHOLD&&L.debugLog("warn",`Chart render took ${i.toFixed(2)}ms`)}catch(e){this.errorHandler(e,"renderSelf")}}renderTitles(t){this.title&&(t.fillStyle=c.COLORS.GRAY_900,t.font="bold 18px Arial",t.textAlign="center",t.textBaseline="top",t.fillText(this.title,this.width/2,10)),this.subtitle&&(t.fillStyle=c.COLORS.GRAY_600,t.font="14px Arial",t.textAlign="center",t.textBaseline="top",t.fillText(this.subtitle,this.width/2,T.CHART_SUBTITLE_Y))}renderGrid(t){t.strokeStyle=c.COLORS.GRAY_200,t.lineWidth=1,t.setLineDash([2,2]);const e=5;for(let i=0;i<=e;i++){const s=this.margin.top+i/e*this.chartHeight;t.beginPath(),t.moveTo(this.margin.left,s),t.lineTo(this.margin.left+this.chartWidth,s),t.stroke()}if(this.type!=="pie"){const i=this.type==="bar"?this.processedData[0].values.length:Math.min(10,this.processedData[0].values.length);for(let s=0;s<=i;s++){const a=this.margin.left+s/i*this.chartWidth;t.beginPath(),t.moveTo(a,this.margin.top),t.lineTo(a,this.margin.top+this.chartHeight),t.stroke()}}t.setLineDash([])}renderAxes(t){t.strokeStyle=c.COLORS.GRAY_400,t.lineWidth=2,t.beginPath(),t.moveTo(this.margin.left,this.margin.top),t.lineTo(this.margin.left,this.margin.top+this.chartHeight),t.stroke(),t.beginPath(),t.moveTo(this.margin.left,this.margin.top+this.chartHeight),t.lineTo(this.margin.left+this.chartWidth,this.margin.top+this.chartHeight),t.stroke(),t.fillStyle=c.COLORS.GRAY_700,t.font="12px Arial",t.textAlign="right",t.textBaseline="middle";const e=5;for(let i=0;i<=e;i++){const s=this.minValue+i/e*(this.maxValue-this.minValue),a=this.margin.top+this.chartHeight-i/e*this.chartHeight;t.fillText(s.toFixed(1),this.margin.left-10,a)}this.labels.length>0&&(t.textAlign="center",t.textBaseline="top",this.labels.forEach((i,s)=>{const a=this.margin.left+s/(this.labels.length-1)*this.chartWidth,h=this.margin.top+this.chartHeight+10;t.fillText(i,a,h)}))}renderLineChart(t){this.processedData.forEach((e,i)=>{e.visible&&(t.strokeStyle=e.color,t.lineWidth=3,t.lineCap="round",t.lineJoin="round",t.globalAlpha=e.opacity*(this.animated?this.animationProgress:1),t.beginPath(),e.values.forEach((s,a)=>{const h=this.margin.left+a*this.xScale,o=this.margin.top+this.chartHeight-(s-this.minValue)*this.yScale;a===0?t.moveTo(h,o):t.lineTo(h,o)}),t.stroke(),e.values.forEach((s,a)=>{const h=this.margin.left+a*this.xScale,o=this.margin.top+this.chartHeight-(s-this.minValue)*this.yScale;t.fillStyle=e.color,t.beginPath(),t.arc(h,o,T.CHART_POINT_RADIUS,0,2*Math.PI),t.fill();const l={series:e.label,index:a,value:s,x:h-this.margin.left,y:o-this.margin.top};this.selectedDataPoints.has(l)&&(t.strokeStyle=c.COLORS.WARNING,t.lineWidth=2,t.stroke())}),t.globalAlpha=1)})}renderAreaChart(t){this.processedData.forEach((e,i)=>{if(!e.visible)return;t.fillStyle=e.color,t.globalAlpha=T.CHART_OPACITY*e.opacity*(this.animated?this.animationProgress:1),t.beginPath(),t.moveTo(this.margin.left,this.margin.top+this.chartHeight),e.values.forEach((a,h)=>{const o=this.margin.left+h*this.xScale,l=this.margin.top+this.chartHeight-(a-this.minValue)*this.yScale;t.lineTo(o,l)});const s=this.margin.left+(e.values.length-1)*this.xScale;t.lineTo(s,this.margin.top+this.chartHeight),t.closePath(),t.fill(),t.globalAlpha=1,this.renderLineChart(t)})}renderBarChart(t){const e=this.chartWidth/this.processedData[0].values.length,i=e/this.processedData.length*T.CHART_BAR_WIDTH_RATIO;this.processedData.forEach((s,a)=>{s.visible&&(t.fillStyle=s.color,t.globalAlpha=s.opacity*(this.animated?this.animationProgress:1),s.values.forEach((h,o)=>{const l=this.margin.left+o*e+a*i,r=(h-this.minValue)*this.yScale,E=this.margin.top+this.chartHeight-r;t.fillRect(l,E,i,r);const g={series:s.label,index:o,value:h,x:l+i/2-this.margin.left,y:E+r/2-this.margin.top};this.selectedDataPoints.has(g)&&(t.strokeStyle=c.COLORS.WARNING,t.lineWidth=3,t.strokeRect(l,E,i,r))}),t.globalAlpha=1)})}renderPieChart(t){const e=this.margin.left+this.chartWidth/2,i=this.margin.top+this.chartHeight/2;this.processedData.forEach((s,a)=>{if(!s.visible)return;const h=this.radius*(this.animated?this.animationProgress:1);t.fillStyle=s.color,t.globalAlpha=s.opacity,t.beginPath(),t.moveTo(e,i),t.arc(e,i,h,s.startAngle,s.endAngle),t.closePath(),t.fill(),t.strokeStyle=c.COLORS.WHITE,t.lineWidth=2,t.stroke(),this.selectedDataPoints.has(s)&&(t.strokeStyle=c.COLORS.WARNING,t.lineWidth=4,t.stroke());const o=(s.startAngle+s.endAngle)/2,l=h*T.CHART_LABEL_RADIUS_RATIO,r=e+Math.cos(o)*l,E=i+Math.sin(o)*l;t.fillStyle=c.COLORS.WHITE,t.font="bold 12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(`${s.percentage.toFixed(1)}%`,r,E),t.globalAlpha=1})}renderScatterPlot(t){this.processedData.forEach((e,i)=>{if(!e.visible)return;const s=this.margin.left+(e.x-this.minX)*this.xScale,a=this.margin.top+this.chartHeight-(e.y-this.minY)*this.yScale;t.fillStyle=e.color,t.globalAlpha=e.opacity*(this.animated?this.animationProgress:1),t.beginPath(),t.arc(s,a,T.CHART_SCATTER_POINT_RADIUS,0,2*Math.PI),t.fill(),this.selectedDataPoints.has(e)&&(t.strokeStyle=c.COLORS.WARNING,t.lineWidth=3,t.stroke()),t.globalAlpha=1})}renderLegend(t){if(!this.legend)return;const{x:e,y:i,width:s,itemHeight:a,items:h}=this.legend;t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillRect(e,i,s,h.length*a+T.CHART_LEGEND_ITEM_HEIGHT),t.strokeStyle=c.COLORS.GRAY_300,t.lineWidth=1,t.strokeRect(e,i,s,h.length*a+T.CHART_LEGEND_ITEM_HEIGHT),h.forEach((o,l)=>{const r=i+10+l*a;t.fillStyle=o.color,t.fillRect(e+c.SPACING.MD/2,r+c.SPACING.XS,T.CHART_LEGEND_INDICATOR_SIZE,T.CHART_LEGEND_INDICATOR_HEIGHT),t.fillStyle=o.visible?c.COLORS.GRAY_900:c.COLORS.GRAY_400,t.font="12px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(o.label,e+T.CHART_LEGEND_TEXT_OFFSET,r+c.SPACING.MD/2)})}renderTooltip(t){if(!this.tooltip||!this.tooltip.visible)return;const{x:e,y:i,content:s}=this.tooltip;t.font="12px Arial";const a=t.measureText(s).width,h=8,o=a+h*2,l=T.CHART_TOOLTIP_HEIGHT+h*2;t.fillStyle="rgba(0, 0, 0, 0.8)",L.fillRoundedRect(t,e,i,o,l,T.CHART_TOOLTIP_RADIUS),t.fillStyle=c.COLORS.WHITE,t.textAlign="left",t.textBaseline="middle",t.fillText(s,e+h,i+l/2)}updateAccessibilityAttributes(){this.ariaLabel=this.getAccessibilityDescription()}getAccessibilityDescription(){const t=this.type==="pie"?this.processedData.length:this.processedData.reduce((e,i)=>e+i.values.length,0);return`${this.type} chart titled "${this.title}" with ${t} data points. ${this.subtitle?`${this.subtitle} `:""}Interactive: ${this.interactive?"yes":"no"}.`}defaultErrorHandler(t,e){L.debugLog("error",`Chart error in ${e}`,t),this.emit("error",{error:t,context:e,component:"Chart"})}destroy(){try{this.stopAnimations(),this.processedData=null,this.selectedDataPoints.clear(),this.hoveredDataPoint=null,super.destroy()}catch(t){this.errorHandler(t,"destroy")}}}class Dt extends C{constructor(t={}){super({...t,width:t.width||T.DEFAULT_FORM_WIDTH,height:t.height||T.DEFAULT_FORM_HEIGHT,ariaRole:"group"}),this.label=t.label||"",this.type=t.type||"text",this.value=t.value||"",this.placeholder=t.placeholder||"",this.required=t.required||!1,this.disabled=t.disabled||!1,this.readonly=t.readonly||!1,this.maxLength=t.maxLength||null,this.minLength=t.minLength||null,this.pattern=t.pattern||null,this.options=t.options||[],this.multiSelect=t.multiSelect||!1,this.validation=t.validation||null,this.validateOnChange=t.validateOnChange!==!1,this.validateOnBlur=t.validateOnBlur!==!1,this.showCharacterCount=t.showCharacterCount||!1,this.helpText=t.helpText||"",this.isValid=!0,this.errorMessage="",this.warningMessage="",this.successMessage="",this.isFocused=!1,this.isDirty=!1,this.isTouched=!1,this.isAnimating=!1,this.validationRules=new Map,this.asyncValidation=t.asyncValidation||null,this.validationDebounceTime=t.validationDebounceTime||T.VALIDATION_DEBOUNCE_TIME,this.validationTimer=null,this.ariaDescribedBy=[],this.fieldId=t.fieldId||`field-${this.id}`,this.errorId=`${this.fieldId}-error`,this.helpId=`${this.fieldId}-help`,this.errorHandler=t.errorHandler||this.defaultErrorHandler.bind(this),this.lastRenderTime=0,this.renderCount=0,this.setupField(),this.setupValidation(),this.bindEvents()}setupField(){try{["select","radio","checkbox"].includes(this.type)&&this.processOptions(),this.updateAccessibilityAttributes(),this.validateOnChange&&this.validate()}catch(t){this.errorHandler(t,"setupField")}}setupValidation(){try{switch(this.required&&this.addValidationRule("required",t=>this.type==="checkbox"?{isValid:t===!0,message:"This field is required"}:{isValid:!(!t||t.toString().trim()===""),message:"This field is required"}),this.minLength!==null&&this.addValidationRule("minLength",t=>({isValid:(t?t.toString().length:0)>=this.minLength,message:`Minimum length is ${this.minLength} characters`})),this.maxLength!==null&&this.addValidationRule("maxLength",t=>({isValid:(t?t.toString().length:0)<=this.maxLength,message:`Maximum length is ${this.maxLength} characters`})),this.pattern&&this.addValidationRule("pattern",t=>t?{isValid:new RegExp(this.pattern).test(t.toString()),message:"Please enter a valid format"}:{isValid:!0,message:""}),this.type){case"email":this.addValidationRule("email",t=>t?{isValid:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),message:"Please enter a valid email address"}:{isValid:!0,message:""});break;case"number":this.addValidationRule("number",t=>t?{isValid:!isNaN(t)&&isFinite(t),message:"Please enter a valid number"}:{isValid:!0,message:""});break}}catch(t){this.errorHandler(t,"setupValidation")}}bindEvents(){try{this.on("focus",()=>this.handleFocus()),this.on("blur",()=>this.handleBlur()),this.on("input",t=>this.handleFieldInput(t)),this.on("change",t=>this.handleChange(t)),this.on("keyDown",t=>this.handleKeyDown(t))}catch(t){this.errorHandler(t,"bindEvents")}}processOptions(){this.processedOptions=this.options.map((t,e)=>typeof t=="string"?{value:t,label:t,disabled:!1,selected:!1,id:`${this.fieldId}-option-${e}`}:{value:t.value,label:t.label||t.value,disabled:t.disabled||!1,selected:t.selected||!1,id:`${this.fieldId}-option-${e}`,...t})}addValidationRule(t,e){this.validationRules.set(t,e)}removeValidationRule(t){this.validationRules.delete(t)}setValue(t,e=!1){try{const i=this.value;this.value=t,this.isDirty=!0,!e&&this.validateOnChange&&this.debouncedValidate(),this.emit("change",{value:t,oldValue:i,isValid:this.isValid,field:this}),this.showCharacterCount&&this.updateCharacterCount()}catch(i){this.errorHandler(i,"setValue")}}async validate(){try{this.clearMessages();let t=!0,e="";for(const[i,s]of this.validationRules)try{const a=s(this.value);a.isValid||(t=!1,e||(e=a.message))}catch(a){L.debugLog("warn",`Validation rule '${i}' failed`,a)}if(this.validation&&typeof this.validation=="function")try{const i=this.validation(this.value,this);i&&!i.isValid&&(t=!1,e||(e=i.message||"Invalid value"))}catch(i){L.debugLog("warn","Custom validation failed",i),t=!1,e||(e="Validation error occurred")}if(this.asyncValidation&&typeof this.asyncValidation=="function")try{const i=await this.asyncValidation(this.value,this);i&&!i.isValid&&(t=!1,e||(e=i.message||"Invalid value"))}catch(i){L.debugLog("warn","Async validation failed",i),t=!1,e||(e="Async validation error occurred")}return this.isValid=t,this.errorMessage=e,this.updateAccessibilityAttributes(),this.emit("validation",{isValid:this.isValid,message:this.errorMessage,field:this}),this.isValid}catch(t){return this.errorHandler(t,"validate"),!1}}debouncedValidate(){this.validationTimer&&clearTimeout(this.validationTimer),this.validationTimer=setTimeout(()=>{this.validate()},this.validationDebounceTime)}clearMessages(){this.errorMessage="",this.warningMessage="",this.successMessage=""}setSuccessMessage(t){this.clearMessages(),this.successMessage=t,this.isValid=!0}setWarningMessage(t){this.warningMessage=t}setErrorMessage(t){this.clearMessages(),this.errorMessage=t,this.isValid=!1}handleFocus(){try{this.isFocused=!0,this.animateFocus(!0),this.emit("fieldFocus",{field:this})}catch(t){this.errorHandler(t,"handleFocus")}}handleBlur(){try{this.isFocused=!1,this.isTouched=!0,this.animateFocus(!1),this.validateOnBlur&&this.validate(),this.emit("fieldBlur",{field:this})}catch(t){this.errorHandler(t,"handleBlur")}}handleFieldInput(t){try{const e=t.value;this.setValue(e)}catch(e){this.errorHandler(e,"handleFieldInput")}}handleChange(t){try{(this.type==="select"||this.type==="radio")&&this.setValue(t.value)}catch(e){this.errorHandler(e,"handleChange")}}handleKeyDown(t){try{switch(t.key){case"Enter":if(this.type==="textarea")return;t.preventDefault(),this.emit("submit",{field:this,value:this.value});break;case"Escape":this.blur();break;case"Tab":break;default:this.handleTypeSpecificKeys(t);break}}catch(e){this.errorHandler(e,"handleKeyDown")}}handleTypeSpecificKeys(t){switch(this.type){case"number":!/[0-9\-+.,]/.test(t.key)&&!["Backspace","Delete","ArrowLeft","ArrowRight","Home","End"].includes(t.key)&&t.preventDefault();break;case"select":case"radio":this.handleSelectableKeyDown(t);break}}handleSelectableKeyDown(t){if(!this.processedOptions||this.processedOptions.length===0)return;const e=this.processedOptions.findIndex(s=>s.value===this.value);let i=e;switch(t.key){case"ArrowDown":t.preventDefault(),i=Math.min(e+1,this.processedOptions.length-1);break;case"ArrowUp":t.preventDefault(),i=Math.max(e-1,0);break;case"Home":t.preventDefault(),i=0;break;case"End":t.preventDefault(),i=this.processedOptions.length-1;break}i!==e&&!this.processedOptions[i].disabled&&this.setValue(this.processedOptions[i].value)}updateCharacterCount(){if(!this.showCharacterCount)return;const t=this.value?this.value.toString().length:0;this.characterCount={current:t,max:this.maxLength,remaining:this.maxLength?this.maxLength-t:null}}animateFocus(t){if(!this.animationsEnabled)return;this.isAnimating=!0;const e=t?T.FOCUS_SCALE:1;this.animate("focusScale",e,T.ANIMATION_NORMAL,{from:this.focusScale||1,easing:P.EASE_OUT_QUAD,onComplete:()=>{this.isAnimating=!1}})}updateAccessibilityAttributes(){this.ariaDescribedBy=[],this.helpText&&this.ariaDescribedBy.push(this.helpId),!this.isValid&&this.errorMessage&&this.ariaDescribedBy.push(this.errorId),this.ariaInvalid=!this.isValid,this.ariaRequired=this.required,this.ariaDisabled=this.disabled,this.ariaReadonly=this.readonly}handleInput(t,e){try{if(!this.visible||this.disabled)return!1;const i=this.containsPoint(e.x,e.y);switch(t){case"mousedown":case"touchstart":if(i)return this.focus(),!0;break;case"mousemove":this.type==="select"&&this.processedOptions&&this.updateOptionHover(e);break}return super.handleInput(t,e)}catch(i){return this.errorHandler(i,"handleInput"),!1}}updateOptionHover(t){}renderSelf(t){if(!(t.type!=="canvas"||!this.visible))try{const e=performance.now();switch(this.type){case"text":case"email":case"password":case"number":this.renderTextInput(t);break;case"textarea":this.renderTextarea(t);break;case"select":this.renderSelect(t);break;case"checkbox":this.renderCheckbox(t);break;case"radio":this.renderRadioGroup(t);break}this.renderLabel(t),this.renderMessages(t),this.showCharacterCount&&this.characterCount&&this.renderCharacterCount(t),this.isFocused&&!this.disabled&&this.renderFocusRing(t);const i=performance.now()-e;this.lastRenderTime=i,this.renderCount++,i>T.PERFORMANCE_THRESHOLD&&L.debugLog("warn",`FormField render took ${i.toFixed(2)}ms`)}catch(e){this.errorHandler(e,"renderSelf")}}renderTextInput(t){const e=this.label?T.FORM_LABEL_HEIGHT:0,i=this.height-e-(this.errorMessage||this.helpText?T.FORM_HELP_HEIGHT:0);let s=this.disabled?c.COLORS.GRAY_100:c.COLORS.WHITE;this.readonly&&(s=c.COLORS.GRAY_50);const a=this.focusScale||1,h=this.width*a,o=i*a,l=(this.width-h)/2,r=(i-o)/2;t.fillStyle=s,t.fillRect(l,e+r,h,o);let E=c.COLORS.GRAY_300,g=1;this.isValid?this.isFocused?(E=c.COLORS.PRIMARY,g=2):this.successMessage?E=c.COLORS.SUCCESS:this.warningMessage&&(E=c.COLORS.WARNING):(E=c.COLORS.DANGER,g=2),t.strokeStyle=E,t.lineWidth=g,t.strokeRect(l,e+r,h,o);const _=this.value||this.placeholder,I=!this.value&&this.placeholder;if(_){t.fillStyle=this.disabled?c.COLORS.GRAY_400:I?c.COLORS.GRAY_500:c.COLORS.GRAY_900,t.font=`${I?"italic ":""}14px Arial`,t.textAlign="left",t.textBaseline="middle";const S=this.type==="password"&&this.value?"•".repeat(this.value.length):_,D=c.SPACING.SM,O=h-D*2,M=L.truncateText(S,O,t.font,t);t.fillText(M,l+D,e+r+o/2)}this.isFocused&&!this.readonly&&!this.disabled&&this.renderCursor(t,l,e+r,o)}renderTextarea(t){this.renderTextInput(t)}renderSelect(t){const e=this.label?T.FORM_LABEL_HEIGHT:0,i=this.height-e-(this.errorMessage||this.helpText?T.FORM_HELP_HEIGHT:0);this.renderTextInput(t);const s=8,a=this.width-c.SPACING.SM-s,h=e+i/2;t.fillStyle=this.disabled?c.COLORS.GRAY_400:c.COLORS.GRAY_600,t.beginPath(),t.moveTo(a,h-s/2),t.lineTo(a+s,h-s/2),t.lineTo(a+s/2,h+s/2),t.closePath(),t.fill()}renderCheckbox(t){const e=T.CHECKBOX_SIZE,i=this.label?T.FORM_LABEL_HEIGHT:(this.height-e)/2;t.fillStyle=this.disabled?c.COLORS.GRAY_100:c.COLORS.WHITE,t.fillRect(0,i,e,e);let s=c.COLORS.GRAY_300;this.isValid?this.isFocused&&(s=c.COLORS.PRIMARY):s=c.COLORS.DANGER,t.strokeStyle=s,t.lineWidth=this.isFocused?2:1,t.strokeRect(0,i,e,e),this.value===!0&&(t.strokeStyle=c.COLORS.PRIMARY,t.lineWidth=2,t.lineCap="round",t.beginPath(),t.moveTo(T.CHECKBOX_CHECK_MARGIN,i+e/2),t.lineTo(e/2,i+e-T.CHECKBOX_CHECK_OFFSET),t.lineTo(e-T.CHECKBOX_CHECK_MARGIN,i+T.CHECKBOX_CHECK_OFFSET),t.stroke()),this.label&&(t.fillStyle=this.disabled?c.COLORS.GRAY_400:c.COLORS.GRAY_900,t.font="14px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(this.label,e+c.SPACING.SM,i+e/2))}renderRadioGroup(t){if(!this.processedOptions)return;const e=18,i=25,s=this.label?T.FORM_LABEL_HEIGHT:0;this.processedOptions.forEach((a,h)=>{const o=s+h*i,l=this.value===a.value;t.fillStyle=a.disabled?c.COLORS.GRAY_100:c.COLORS.WHITE,t.beginPath(),t.arc(e/2,o+e/2,e/2,0,2*Math.PI),t.fill();let r=c.COLORS.GRAY_300;this.isValid?this.isFocused&&l&&(r=c.COLORS.PRIMARY):r=c.COLORS.DANGER,t.strokeStyle=r,t.lineWidth=this.isFocused&&l?2:1,t.stroke(),l&&(t.fillStyle=c.COLORS.PRIMARY,t.beginPath(),t.arc(e/2,o+e/2,e/T.RADIO_CHECK_RADIUS_DIVISOR,0,2*Math.PI),t.fill()),t.fillStyle=a.disabled?c.COLORS.GRAY_400:c.COLORS.GRAY_900,t.font="14px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(a.label,e+c.SPACING.SM,o+e/2)})}renderLabel(t){if(!this.label||this.type==="checkbox")return;t.fillStyle=this.disabled?c.COLORS.GRAY_400:c.COLORS.GRAY_700,t.font=`${this.required?"bold ":""}12px Arial`,t.textAlign="left",t.textBaseline="top";let e=this.label;this.required&&(e+=" *"),t.fillText(e,0,0)}renderMessages(t){const e=this.height-T.FORM_MESSAGE_Y_OFFSET;this.errorMessage?(t.fillStyle=c.COLORS.DANGER,t.font="11px Arial",t.textAlign="left",t.textBaseline="top",t.fillText(this.errorMessage,0,e)):this.successMessage?(t.fillStyle=c.COLORS.SUCCESS,t.font="11px Arial",t.textAlign="left",t.textBaseline="top",t.fillText(this.successMessage,0,e)):this.warningMessage?(t.fillStyle=c.COLORS.WARNING,t.font="11px Arial",t.textAlign="left",t.textBaseline="top",t.fillText(this.warningMessage,0,e)):this.helpText&&(t.fillStyle=c.COLORS.GRAY_500,t.font="11px Arial",t.textAlign="left",t.textBaseline="top",t.fillText(this.helpText,0,e))}renderCharacterCount(t){if(!this.characterCount)return;const e=this.characterCount.max?`${this.characterCount.current}/${this.characterCount.max}`:this.characterCount.current.toString(),i=this.characterCount.max&&this.characterCount.current>this.characterCount.max;t.fillStyle=i?c.COLORS.DANGER:c.COLORS.GRAY_500,t.font="10px Arial",t.textAlign="right",t.textBaseline="top",t.fillText(e,this.width,this.height-T.FORM_COUNT_Y_OFFSET)}renderCursor(t,e,i,s){const a=e+c.SPACING.SM+(this.value?t.measureText(this.value).width:0);t.strokeStyle=c.COLORS.PRIMARY,t.lineWidth=1,t.beginPath(),t.moveTo(a,i+T.FORM_CURSOR_OFFSET),t.lineTo(a,i+s-T.FORM_CURSOR_OFFSET),t.stroke()}renderFocusRing(t){const e=this.label?T.FORM_LABEL_HEIGHT:0,i=this.height-e-(this.errorMessage||this.helpText?T.FORM_HELP_HEIGHT:0);t.strokeStyle=c.COLORS.WARNING,t.lineWidth=F,t.setLineDash([2,2]),t.strokeRect(-F,e-F,this.width+F*2,i+F*2),t.setLineDash([])}getAccessibilityDescription(){let t=`${this.type} field`;return this.label&&(t+=` labeled "${this.label}"`),this.required&&(t+=", required"),this.disabled&&(t+=", disabled"),this.readonly&&(t+=", read-only"),this.isValid||(t+=", invalid"),t}defaultErrorHandler(t,e){L.debugLog("error",`FormField error in ${e}`,t),this.emit("error",{error:t,context:e,component:"FormField"})}destroy(){try{this.validationTimer&&clearTimeout(this.validationTimer),this.stopAnimations(),this.validationRules.clear(),super.destroy()}catch(t){this.errorHandler(t,"destroy")}}}class Nt extends C{constructor(t={}){super({...t,width:t.width||"auto",height:t.height||"auto",ariaRole:"tooltip"}),this.content=t.content||"",this.target=t.target||null,this.position=t.position||"top",this.showDelay=t.showDelay||T.TOOLTIP_SHOW_DELAY,this.hideDelay=t.hideDelay||T.TOOLTIP_HIDE_DELAY,this.offset=t.offset||10,this.maxWidth=t.maxWidth||T.TOOLTIP_MAX_WIDTH,this.theme=t.theme||"dark",this.allowHtml=t.allowHtml||!1,this.interactive=t.interactive||!1,this.followCursor=t.followCursor||!1,this.persistent=t.persistent||!1,this.arrow=t.arrow!==!1,this.animation=t.animation||"fade",this.isVisible=!1,this.isAnimating=!1,this.showTimer=null,this.hideTimer=null,this.currentPosition=this.position,this.calculatedDimensions={width:0,height:0},this.arrowPosition={x:0,y:0,direction:"up"},this.errorHandler=t.errorHandler||this.defaultErrorHandler.bind(this),this.lastRenderTime=0,this.renderCount=0,this.viewportBounds=null,this.autoPositionPadding=10,this.touchStartTime=0,this.longPressDuration=500,this.longPressTimer=null,this.setupTooltip(),this.bindEvents()}setupTooltip(){try{this.target&&this.bindTargetEvents(),this.updateViewportBounds(),this.calculateDimensions(),this.updateAccessibilityAttributes()}catch(t){this.errorHandler(t,"setupTooltip")}}bindEvents(){try{typeof window<"u"&&(window.addEventListener("resize",()=>this.updateViewportBounds()),window.addEventListener("scroll",()=>this.updatePosition()))}catch(t){this.errorHandler(t,"bindEvents")}}bindTargetEvents(){if(this.target)try{this.target.on("mouseenter",t=>this.handleTargetMouseEnter(t)),this.target.on("mouseleave",t=>this.handleTargetMouseLeave(t)),this.target.on("mousemove",t=>this.handleTargetMouseMove(t)),this.target.on("touchstart",t=>this.handleTargetTouchStart(t)),this.target.on("touchend",t=>this.handleTargetTouchEnd(t)),this.target.on("touchcancel",t=>this.handleTargetTouchCancel(t)),this.target.on("focus",()=>this.handleTargetFocus()),this.target.on("blur",()=>this.handleTargetBlur()),this.target.on("keydown",t=>this.handleTargetKeyDown(t))}catch(t){this.errorHandler(t,"bindTargetEvents")}}setContent(t){try{this.content=t,this.calculateDimensions(),this.isVisible&&this.updatePosition()}catch(e){this.errorHandler(e,"setContent")}}setTarget(t){try{this.target&&this.unbindTargetEvents(),this.target=t,t&&this.bindTargetEvents()}catch(e){this.errorHandler(e,"setTarget")}}unbindTargetEvents(){this.target&&(this.target.off("mouseenter"),this.target.off("mouseleave"),this.target.off("mousemove"),this.target.off("touchstart"),this.target.off("touchend"),this.target.off("touchcancel"),this.target.off("focus"),this.target.off("blur"),this.target.off("keydown"))}calculateDimensions(){try{if(!this.content){this.calculatedDimensions={width:0,height:0};return}const e=document.createElement("canvas").getContext("2d");e.font=this.getFont();const i=this.wrapText(this.content,this.maxWidth,e),s=this.getLineHeight(),a=this.getPadding(),h=Math.max(...i.map(l=>e.measureText(l).width)),o=i.length*s;this.calculatedDimensions={width:Math.min(h+a.horizontal,this.maxWidth),height:o+a.vertical,lines:i},this.width=this.calculatedDimensions.width,this.height=this.calculatedDimensions.height}catch(t){this.errorHandler(t,"calculateDimensions")}}wrapText(t,e,i){const s=t.split(" "),a=[];let h="";for(const o of s){const l=h?`${h} ${o}`:o;i.measureText(l).width>e&&h?(a.push(h),h=o):h=l}return h&&a.push(h),a}getFont(){return"12px Arial"}getLineHeight(){return T.TOOLTIP_BASELINE_SIZE}getPadding(){return{horizontal:c.SPACING.SM*2,vertical:c.SPACING.XS*2,top:c.SPACING.XS,right:c.SPACING.SM,bottom:c.SPACING.XS,left:c.SPACING.SM}}updateViewportBounds(){try{typeof window<"u"?this.viewportBounds={width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX||0,scrollY:window.scrollY||0}:this.viewportBounds={width:1920,height:1080,scrollX:0,scrollY:0}}catch(t){this.errorHandler(t,"updateViewportBounds")}}scheduleShow(t){try{if(this.clearTimers(),this.isVisible)return;this.showTimer=setTimeout(()=>{this.show(t)},this.showDelay)}catch(e){this.errorHandler(e,"scheduleShow")}}scheduleHide(){try{if(this.clearTimers(),!this.isVisible||this.persistent)return;this.hideTimer=setTimeout(()=>{this.hide()},this.hideDelay)}catch(t){this.errorHandler(t,"scheduleHide")}}clearTimers(){this.showTimer&&(clearTimeout(this.showTimer),this.showTimer=null),this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null),this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)}show(t){try{if(this.isVisible||this.isAnimating||!this.content)return;this.calculateDimensions(),this.calculatePosition(t),this.isVisible=!0,this.isAnimating=!0,this.startEntranceAnimation(),this.emit("show",{tooltip:this})}catch(e){this.errorHandler(e,"show")}}hide(){try{if(!this.isVisible||this.isAnimating)return;this.isAnimating=!0,this.startExitAnimation().then(()=>{this.isVisible=!1,this.isAnimating=!1,this.emit("hide",{tooltip:this})})}catch(t){this.errorHandler(t,"hide")}}toggle(t){this.isVisible?this.hide():this.show(t)}calculatePosition(t){try{if(!this.target&&!t)return;let e;if(this.followCursor&&t)e={x:t.x||t.clientX||0,y:t.y||t.clientY||0,width:0,height:0};else if(this.target)e=this.target.getBounds?this.target.getBounds():{x:this.target.x||0,y:this.target.y||0,width:this.target.width||0,height:this.target.height||0};else return;let i=this.tryPosition(this.position,e);(this.position==="auto"||!i.fits)&&this.viewportBounds&&(i=this.findBestPosition(e)),this.x=i.x,this.y=i.y,this.currentPosition=i.direction,this.arrowPosition=i.arrow}catch(e){this.errorHandler(e,"calculatePosition")}}tryPosition(t,e){const i={width:this.calculatedDimensions.width,height:this.calculatedDimensions.height};let s,a,h,o,l;switch(t){case"top":s=e.x+e.width/2-i.width/2,a=e.y-i.height-this.offset,h=i.width/2,o=i.height,l="down";break;case"bottom":s=e.x+e.width/2-i.width/2,a=e.y+e.height+this.offset,h=i.width/2,o=0,l="up";break;case"left":s=e.x-i.width-this.offset,a=e.y+e.height/2-i.height/2,h=i.width,o=i.height/2,l="right";break;case"right":s=e.x+e.width+this.offset,a=e.y+e.height/2-i.height/2,h=0,o=i.height/2,l="left";break;default:return this.tryPosition("top",e)}const r=this.checkViewportFit(s,a,i.width,i.height);return{x:s,y:a,direction:t,fits:r,arrow:{x:h,y:o,direction:l}}}findBestPosition(t){const i=["top","bottom","right","left"].map(a=>{const h=this.tryPosition(a,t);return h.score=this.scorePosition(h,t),h});i.sort((a,h)=>h.score-a.score);const s=i[0];return this.adjustPositionToFit(s)}scorePosition(t,e){let i=0;t.fits&&(i+=100);const s=e.x+e.width/2,a=e.y+e.height/2,h=t.x+this.calculatedDimensions.width/2,o=t.y+this.calculatedDimensions.height/2,l=T.ALIGNMENT_CENTER_BASE-Math.min(T.ALIGNMENT_CENTER_BASE,Math.abs(s-h)+Math.abs(a-o));return i+=l,(t.direction==="top"||t.direction==="bottom")&&(i+=10),i}adjustPositionToFit(t){if(!this.viewportBounds)return t;let{x:e,y:i}=t;const s=this.autoPositionPadding;return e<s?e=s:e+this.calculatedDimensions.width>this.viewportBounds.width-s&&(e=this.viewportBounds.width-this.calculatedDimensions.width-s),i<s?i=s:i+this.calculatedDimensions.height>this.viewportBounds.height-s&&(i=this.viewportBounds.height-this.calculatedDimensions.height-s),{...t,x:e,y:i,fits:!0}}checkViewportFit(t,e,i,s){if(!this.viewportBounds)return!0;const a=this.autoPositionPadding;return t>=a&&e>=a&&t+i<=this.viewportBounds.width-a&&e+s<=this.viewportBounds.height-a}updatePosition(t){this.isVisible&&!this.isAnimating&&this.calculatePosition(t)}startEntranceAnimation(){return!this.animationsEnabled||this.animation==="none"?(this.isAnimating=!1,Promise.resolve()):new Promise(t=>{switch(this.animation){case"fade":this.alpha=0,this.animate("alpha",1,T.TOOLTIP_ANIMATION_IN,{easing:P.EASE_OUT_QUAD,onComplete:()=>{this.isAnimating=!1,t()}});break;case"scale":this.scale=0,this.animate("scale",1,T.TOOLTIP_ANIMATION_IN,{easing:P.EASE_OUT_BACK,onComplete:()=>{this.isAnimating=!1,t()}});break;case"slide":{const e=this.currentPosition==="top"||this.currentPosition==="bottom"?this.currentPosition==="top"?-10:T.TOOLTIP_SLIDE_OFFSET:this.currentPosition==="left"?-10:T.TOOLTIP_SLIDE_OFFSET;this.currentPosition==="top"||this.currentPosition==="bottom"?(this.y+=e,this.animate("y",this.y-e,T.TOOLTIP_ANIMATION_IN,{easing:P.EASE_OUT_QUAD,onComplete:()=>{this.isAnimating=!1,t()}})):(this.x+=e,this.animate("x",this.x-e,T.TOOLTIP_ANIMATION_IN,{easing:P.EASE_OUT_QUAD,onComplete:()=>{this.isAnimating=!1,t()}}));break}default:this.isAnimating=!1,t();break}})}startExitAnimation(){return!this.animationsEnabled||this.animation==="none"?Promise.resolve():new Promise(t=>{switch(this.animation){case"fade":this.animate("alpha",0,T.TOOLTIP_ANIMATION_OUT,{easing:P.EASE_IN_QUAD,onComplete:t});break;case"scale":this.animate("scale",0,T.TOOLTIP_ANIMATION_OUT,{easing:P.EASE_IN_BACK,onComplete:t});break;case"slide":{const e=this.currentPosition==="top"||this.currentPosition==="bottom"?this.currentPosition==="top"?-10:T.TOOLTIP_SLIDE_OFFSET:this.currentPosition==="left"?-10:T.TOOLTIP_SLIDE_OFFSET;this.currentPosition==="top"||this.currentPosition==="bottom"?this.animate("y",this.y+e,T.TOOLTIP_ANIMATION_OUT,{easing:P.EASE_IN_QUAD,onComplete:t}):this.animate("x",this.x+e,T.TOOLTIP_ANIMATION_OUT,{easing:P.EASE_IN_QUAD,onComplete:t});break}default:t();break}})}handleTargetMouseEnter(t){this.scheduleShow(t)}handleTargetMouseLeave(t){this.interactive||this.scheduleHide()}handleTargetMouseMove(t){this.followCursor&&this.isVisible&&this.updatePosition(t)}handleTargetTouchStart(t){this.touchStartTime=Date.now(),this.longPressTimer=setTimeout(()=>{this.show(t)},this.longPressDuration)}handleTargetTouchEnd(t){this.clearTimers(),Date.now()-this.touchStartTime<this.longPressDuration&&this.toggle(t)}handleTargetTouchCancel(t){this.clearTimers(),this.scheduleHide()}handleTargetFocus(){this.scheduleShow()}handleTargetBlur(){this.scheduleHide()}handleTargetKeyDown(t){t.key==="Escape"&&this.isVisible&&this.hide()}updateAccessibilityAttributes(){this.ariaLabel=this.content,this.ariaLive="polite",this.ariaAtomic=!0}renderSelf(t){if(!(t.type!=="canvas"||!this.visible||!this.isVisible))try{const e=performance.now();if(this.alpha<=0||this.scale<=0)return;t.save(),this.scale!==1&&t.scale(this.scale,this.scale),t.globalAlpha=this.alpha,this.renderBackground(t),this.arrow&&this.renderArrow(t),this.renderContent(t),t.restore();const i=performance.now()-e;this.lastRenderTime=i,this.renderCount++,i>T.PERFORMANCE_THRESHOLD&&L.debugLog("warn",`Tooltip render took ${i.toFixed(2)}ms`)}catch(e){this.errorHandler(e,"renderSelf")}}renderBackground(t){const e=this.getBackgroundColor(),i=this.getBorderColor(),s=6;t.fillStyle="rgba(0, 0, 0, 0.1)",L.fillRoundedRect(t,2,2,this.width,this.height,s),t.fillStyle=e,L.fillRoundedRect(t,0,0,this.width,this.height,s),i&&(t.strokeStyle=i,t.lineWidth=1,L.strokeRoundedRect(t,0,0,this.width,this.height,s))}getBackgroundColor(){switch(this.theme){case"light":return c.COLORS.WHITE;case"dark":return"rgba(0, 0, 0, 0.9)";default:return"rgba(0, 0, 0, 0.8)"}}getBorderColor(){switch(this.theme){case"light":return c.COLORS.GRAY_300;default:return null}}getTextColor(){switch(this.theme){case"light":return c.COLORS.GRAY_900;case"dark":default:return c.COLORS.WHITE}}renderArrow(t){if(!this.arrowPosition)return;const{x:e,y:i,direction:s}=this.arrowPosition,a=6,h=this.getBackgroundColor();switch(t.fillStyle=h,t.beginPath(),s){case"up":t.moveTo(e-a,i),t.lineTo(e+a,i),t.lineTo(e,i-a);break;case"down":t.moveTo(e-a,i),t.lineTo(e+a,i),t.lineTo(e,i+a);break;case"left":t.moveTo(e,i-a),t.lineTo(e,i+a),t.lineTo(e-a,i);break;case"right":t.moveTo(e,i-a),t.lineTo(e,i+a),t.lineTo(e+a,i);break}t.closePath(),t.fill();const o=this.getBorderColor();o&&(t.strokeStyle=o,t.lineWidth=1,t.stroke())}renderContent(t){if(!this.content||!this.calculatedDimensions.lines)return;const e=this.getPadding(),i=this.getLineHeight(),s=this.getTextColor();t.fillStyle=s,t.font=this.getFont(),t.textAlign="left",t.textBaseline="top",this.calculatedDimensions.lines.forEach((a,h)=>{const o=e.left,l=e.top+h*i;t.fillText(a,o,l)})}getAccessibilityDescription(){return`Tooltip with content: "${this.content}". Position: ${this.currentPosition}. ${this.isVisible?"Currently visible":"Currently hidden"}.`}defaultErrorHandler(t,e){L.debugLog("error",`Tooltip error in ${e}`,t),this.emit("error",{error:t,context:e,component:"Tooltip"})}destroy(){try{this.clearTimers(),this.isVisible&&this.hide(),this.target&&this.unbindTargetEvents(),typeof window<"u"&&(window.removeEventListener("resize",this.updateViewportBounds),window.removeEventListener("scroll",this.updatePosition)),this.stopAnimations(),super.destroy()}catch(t){this.errorHandler(t,"destroy")}}}const A={DATA_TABLE_DEFAULT_WIDTH:600,DATA_TABLE_DEFAULT_HEIGHT:400,DATA_TABLE_DEFAULT_PAGE_SIZE:25,DATA_TABLE_DEFAULT_HEADER_HEIGHT:40,DATA_TABLE_DEFAULT_ROW_HEIGHT:30,DATA_TABLE_SORT_INDICATOR_OFFSET:20,DATA_TABLE_PAGINATION_HEIGHT:30,DATA_TABLE_PAGINATION_TEXT_OFFSET:10,DATA_TABLE_PAGINATION_TEXT_Y_OFFSET:15,DATA_TABLE_PAGINATION_BUTTON_Y_OFFSET:5,DATA_TABLE_PAGINATION_PREV_X_OFFSET:140,DATA_TABLE_PAGINATION_NEXT_X_OFFSET:70,DATA_TABLE_PAGINATION_BUTTON_HEIGHT:20,DATA_TABLE_PAGINATION_BUTTON_WIDTH:60,DATA_TABLE_PAGINATION_BUTTON_TEXT_X_OFFSET:30,DATA_TABLE_PAGINATION_BUTTON_TEXT_Y_OFFSET:10,NOTIFICATION_TOAST_DEFAULT_WIDTH:320,NOTIFICATION_TOAST_DEFAULT_HEIGHT:80,NOTIFICATION_TOAST_DEFAULT_DURATION:5e3,NOTIFICATION_TOAST_DEFAULT_Y:20,NOTIFICATION_TOAST_DEFAULT_X_OFFSET:20,NOTIFICATION_TOAST_REMOVE_DELAY:300,NOTIFICATION_TOAST_BORDER_WIDTH:4,NOTIFICATION_TOAST_ICON_X:25,NOTIFICATION_TOAST_MESSAGE_X:50,NOTIFICATION_TOAST_DISMISS_X_OFFSET:15,NOTIFICATION_TOAST_PROGRESS_HEIGHT:2,NOTIFICATION_TOAST_PROGRESS_ALPHA:.3,LOADING_SPINNER_DEFAULT_WIDTH:100,LOADING_SPINNER_DEFAULT_HEIGHT:100,LOADING_SPINNER_DEFAULT_ANIMATION_SPEED:2,LOADING_SPINNER_FRAME_TIME:16.67,LOADING_SPINNER_FRAME_TIME_DIVISOR:1e3,LOADING_SPINNER_MESSAGE_Y_OFFSET:15,LOADING_SPINNER_CANCEL_Y_OFFSET:40,LOADING_SPINNER_CANCEL_BUTTON_WIDTH:60,LOADING_SPINNER_CANCEL_BUTTON_HEIGHT:25,LOADING_SPINNER_CANCEL_BUTTON_X_OFFSET:30,LOADING_SPINNER_CANCEL_BUTTON_TEXT_Y_OFFSET:12,LOADING_SPINNER_LINE_WIDTH:3,LOADING_SPINNER_PROGRESS_LINE_WIDTH:4,LOADING_SPINNER_ARC_END_MULTIPLIER:1.5,LOADING_SPINNER_OVERLAY_ALPHA:.8,SPINNER_SIZE_SMALL:20,SPINNER_SIZE_MEDIUM:40,SPINNER_SIZE_LARGE:60};class yt extends C{constructor(t={}){super({...t,width:t.width||A.DATA_TABLE_DEFAULT_WIDTH,height:t.height||A.DATA_TABLE_DEFAULT_HEIGHT,ariaRole:"table"}),this.columns=t.columns||[],this.data=t.data||[],this.sortColumn=t.sortColumn||null,this.sortDirection=t.sortDirection||"asc",this.selectedRows=new Set(t.selectedRows||[]),this.currentPage=t.currentPage||1,this.pageSize=t.pageSize||A.DATA_TABLE_DEFAULT_PAGE_SIZE,this.pagination=t.pagination!==!1,this.selectable=t.selectable!==!1,this.filterable=t.filterable!==!1,this.headerHeight=t.headerHeight||A.DATA_TABLE_DEFAULT_HEADER_HEIGHT,this.rowHeight=t.rowHeight||A.DATA_TABLE_DEFAULT_ROW_HEIGHT,this.borderColor=t.borderColor||"#CCCCCC",this.headerBackground=t.headerBackground||"#F5F5F5",this.alternateRowColor=t.alternateRowColor||"#FAFAFA",this.selectedRowColor=t.selectedRowColor||"#E3F2FD",this.filters=new Map,this.scrollTop=0,this.hoveredRow=-1,this.setupTable()}setupTable(){this.visibleRows=Math.floor((this.height-this.headerHeight)/this.rowHeight),this.totalPages=Math.ceil(this.getFilteredData().length/this.pageSize),this.on("click",t=>this.handleClick(t)),this.on("mouseMove",t=>this.handleMouseMove(t)),this.on("keyDown",t=>this.handleKeyDown(t)),this.on("scroll",t=>this.handleScroll(t))}getFilteredData(){let t=[...this.data];for(const[e,i]of this.filters)i&&i.trim()!==""&&(t=t.filter(s=>{const a=s[e];return String(a).toLowerCase().includes(i.toLowerCase())}));return this.sortColumn&&t.sort((e,i)=>{const s=e[this.sortColumn],a=i[this.sortColumn];let h=0;return s<a?h=-1:s>a&&(h=1),this.sortDirection==="desc"?-h:h}),t}getCurrentPageData(){const t=this.getFilteredData(),e=(this.currentPage-1)*this.pageSize,i=Math.min(e+this.pageSize,t.length);return t.slice(e,i)}sortByColumn(t){this.sortColumn===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.emit("sort",{column:t,direction:this.sortDirection})}selectRow(t,e=!1){this.selectable&&(e||this.selectedRows.clear(),this.selectedRows.has(t)?this.selectedRows.delete(t):this.selectedRows.add(t),this.emit("selectionChange",{selectedRows:Array.from(this.selectedRows)}))}setFilter(t,e){e&&e.trim()!==""?this.filters.set(t,e):this.filters.delete(t),this.currentPage=1,this.emit("filter",{column:t,value:e})}goToPage(t){this.currentPage=Math.max(1,Math.min(t,this.totalPages)),this.emit("pageChange",{page:this.currentPage})}handleClick(t){const{localX:e,localY:i}=t;if(i<=this.headerHeight){const h=Math.floor(e/(this.width/this.columns.length)),o=this.columns[h];o&&o.sortable!==!1&&this.sortByColumn(o.key);return}const s=Math.floor((i-this.headerHeight)/this.rowHeight),a=(this.currentPage-1)*this.pageSize+s;s>=0&&s<this.getCurrentPageData().length&&this.selectRow(a,t.ctrlKey||t.metaKey)}handleMouseMove(t){const{localY:e}=t,i=Math.floor((e-this.headerHeight)/this.rowHeight);i!==this.hoveredRow&&(this.hoveredRow=i)}handleKeyDown(t){switch(t.key){case"ArrowUp":break;case"ArrowDown":break;case"Enter":case" ":break;case"PageUp":this.goToPage(this.currentPage-1);break;case"PageDown":this.goToPage(this.currentPage+1);break}}renderSelf(t){t.type==="canvas"&&(this.renderTable(t),this.renderHeader(t),this.renderRows(t),this.pagination&&this.renderPagination(t))}renderTable(t){t.fillStyle="#FFFFFF",t.fillRect(0,0,this.width,this.height),t.strokeStyle=this.borderColor,t.lineWidth=1,t.strokeRect(0,0,this.width,this.height)}renderHeader(t){t.fillStyle=this.headerBackground,t.fillRect(0,0,this.width,this.headerHeight),t.strokeStyle=this.borderColor,t.lineWidth=1,t.beginPath(),t.moveTo(0,this.headerHeight),t.lineTo(this.width,this.headerHeight),t.stroke();const e=this.width/this.columns.length;this.columns.forEach((i,s)=>{const a=s*e;if(s>0&&(t.beginPath(),t.moveTo(a,0),t.lineTo(a,this.headerHeight),t.stroke()),t.fillStyle="#333333",t.font="bold 12px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(i.title||i.key,a+10,this.headerHeight/2),this.sortColumn===i.key){const h=a+e-A.DATA_TABLE_SORT_INDICATOR_OFFSET,o=this.headerHeight/2,l=this.sortDirection==="asc"?"▲":"▼";t.font="10px Arial",t.textAlign="center",t.fillText(l,h,o)}})}renderRows(t){const e=this.getCurrentPageData(),i=this.width/this.columns.length;e.forEach((s,a)=>{const h=this.headerHeight+a*this.rowHeight,o=(this.currentPage-1)*this.pageSize+a;let l="#FFFFFF";this.selectedRows.has(o)?l=this.selectedRowColor:a%2===1?l=this.alternateRowColor:a===this.hoveredRow&&(l="#F0F0F0"),t.fillStyle=l,t.fillRect(0,h,this.width,this.rowHeight),t.strokeStyle=this.borderColor,t.lineWidth=.5,t.beginPath(),t.moveTo(0,h+this.rowHeight),t.lineTo(this.width,h+this.rowHeight),t.stroke(),this.columns.forEach((r,E)=>{const g=E*i,_=s[r.key];E>0&&(t.beginPath(),t.moveTo(g,h),t.lineTo(g,h+this.rowHeight),t.stroke()),t.fillStyle="#333333",t.font="11px Arial",t.textAlign="left",t.textBaseline="middle";let I=_;r.format&&typeof r.format=="function"?I=r.format(_):r.type==="number"&&typeof _=="number"&&(I=_.toFixed(2)),t.fillText(String(I||""),g+10,h+this.rowHeight/2)})})}renderPagination(t){const e=this.height-A.DATA_TABLE_PAGINATION_HEIGHT,i=this.getFilteredData().length;t.fillStyle="#F9F9F9",t.fillRect(0,e,this.width,A.DATA_TABLE_PAGINATION_HEIGHT);const s=(this.currentPage-1)*this.pageSize+1,a=Math.min(this.currentPage*this.pageSize,i),h=`${s}-${a} of ${i}`;t.fillStyle="#666666",t.font="11px Arial",t.textAlign="left",t.fillText(h,A.DATA_TABLE_PAGINATION_TEXT_OFFSET,e+A.DATA_TABLE_PAGINATION_TEXT_Y_OFFSET);const o=A.DATA_TABLE_PAGINATION_BUTTON_WIDTH,l=e+A.DATA_TABLE_PAGINATION_BUTTON_Y_OFFSET,r=this.width-A.DATA_TABLE_PAGINATION_PREV_X_OFFSET,E=this.width-A.DATA_TABLE_PAGINATION_NEXT_X_OFFSET;t.fillStyle=this.currentPage>1?"#2196F3":"#CCCCCC",t.fillRect(r,l,o,A.DATA_TABLE_PAGINATION_BUTTON_HEIGHT),t.fillStyle="#FFFFFF",t.textAlign="center",t.fillText("Previous",r+A.DATA_TABLE_PAGINATION_BUTTON_TEXT_X_OFFSET,l+A.DATA_TABLE_PAGINATION_BUTTON_TEXT_Y_OFFSET),t.fillStyle=this.currentPage<this.totalPages?"#2196F3":"#CCCCCC",t.fillRect(E,l,o,A.DATA_TABLE_PAGINATION_BUTTON_HEIGHT),t.fillStyle="#FFFFFF",t.fillText("Next",E+A.DATA_TABLE_PAGINATION_BUTTON_TEXT_X_OFFSET,l+A.DATA_TABLE_PAGINATION_BUTTON_TEXT_Y_OFFSET)}setData(t){this.data=t,this.selectedRows.clear(),this.currentPage=1,this.totalPages=Math.ceil(this.getFilteredData().length/this.pageSize),this.emit("dataChange",{data:t})}getSelectedData(){const t=this.getFilteredData();return Array.from(this.selectedRows).map(e=>t[e]).filter(Boolean)}exportData(t="json"){const e=this.getFilteredData();if(t==="csv"){const i=this.columns.map(a=>a.title||a.key).join(","),s=e.map(a=>this.columns.map(h=>a[h.key]).join(",")).join(`
`);return`${i}
${s}`}return JSON.stringify(e,null,2)}}class Lt extends C{constructor(t={}){super({...t,width:t.width||A.NOTIFICATION_TOAST_DEFAULT_WIDTH,height:t.height||A.NOTIFICATION_TOAST_DEFAULT_HEIGHT,ariaRole:"alert"}),this.message=t.message||"Notification",this.type=t.type||"info",this.duration=t.duration||A.NOTIFICATION_TOAST_DEFAULT_DURATION,this.dismissible=t.dismissible!==!1,this.actions=t.actions||[],this.icon=t.icon||this.getDefaultIcon(),this.isVisible=!1,this.progress=0,this.startTime=null,this.setupToast()}getDefaultIcon(){const t={success:"✓",error:"✗",warning:"⚠",info:"ℹ"};return t[this.type]||t.info}setupToast(){this.y=this.y||A.NOTIFICATION_TOAST_DEFAULT_Y,this.x=this.x||window.innerWidth-this.width-A.NOTIFICATION_TOAST_DEFAULT_X_OFFSET,this.show()}show(){this.isVisible=!0,this.startTime=performance.now(),this.emit("show",this),this.duration>0&&setTimeout(()=>{this.hide()},this.duration)}hide(){this.isVisible=!1,this.emit("hide",this),setTimeout(()=>{this.emit("remove",this)},A.NOTIFICATION_TOAST_REMOVE_DELAY)}renderSelf(t){if(!this.isVisible||t.type!=="canvas")return;if(this.duration>0&&this.startTime){const i=performance.now()-this.startTime;this.progress=Math.min(i/this.duration,1)}const e=this.getTypeColors();if(t.fillStyle=e.background,t.fillRect(0,0,this.width,this.height),t.fillStyle=e.accent,t.fillRect(0,0,A.NOTIFICATION_TOAST_BORDER_WIDTH,this.height),t.fillStyle=e.accent,t.font="16px Arial",t.textAlign="center",t.fillText(this.icon,A.NOTIFICATION_TOAST_ICON_X,this.height/2),t.fillStyle=e.text,t.font="13px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(this.message,A.NOTIFICATION_TOAST_MESSAGE_X,this.height/2),this.dismissible&&(t.fillStyle=e.text,t.font="14px Arial",t.textAlign="center",t.fillText("×",this.width-A.NOTIFICATION_TOAST_DISMISS_X_OFFSET,this.height/2)),this.duration>0){const i=this.width*this.progress;t.fillStyle=e.accent,t.globalAlpha=A.NOTIFICATION_TOAST_PROGRESS_ALPHA,t.fillRect(0,this.height-A.NOTIFICATION_TOAST_PROGRESS_HEIGHT,i,A.NOTIFICATION_TOAST_PROGRESS_HEIGHT),t.globalAlpha=1}}getTypeColors(){const t={success:{background:"#E8F5E8",accent:"#4CAF50",text:"#2E7D32"},error:{background:"#FFEBEE",accent:"#F44336",text:"#C62828"},warning:{background:"#FFF3E0",accent:"#FF9800",text:"#E65100"},info:{background:"#E3F2FD",accent:"#2196F3",text:"#1565C0"}};return t[this.type]||t.info}}class Ht extends C{constructor(t={}){super({...t,width:t.width||A.LOADING_SPINNER_DEFAULT_WIDTH,height:t.height||A.LOADING_SPINNER_DEFAULT_HEIGHT,ariaRole:"progressbar"}),this.message=t.message||"Loading...",this.size=t.size||"medium",this.progress=t.progress||null,this.cancellable=t.cancellable||!1,this.overlay=t.overlay!==!1,this.rotation=0,this.animationSpeed=t.animationSpeed||A.LOADING_SPINNER_DEFAULT_ANIMATION_SPEED,this.setupSpinner()}setupSpinner(){const t={small:{spinner:A.SPINNER_SIZE_SMALL,font:"11px Arial"},medium:{spinner:A.SPINNER_SIZE_MEDIUM,font:"13px Arial"},large:{spinner:A.SPINNER_SIZE_LARGE,font:"15px Arial"}},e=t[this.size]||t.medium;this.spinnerSize=e.spinner,this.font=e.font,this.startAnimation()}startAnimation(){const t=()=>{this.visible&&(this.rotation+=this.animationSpeed*(A.LOADING_SPINNER_FRAME_TIME/A.LOADING_SPINNER_FRAME_TIME_DIVISOR)*Math.PI*2,requestAnimationFrame(t))};t()}setProgress(t){this.progress=Math.max(0,Math.min(1,t)),this.emit("progressChange",{progress:this.progress})}renderSelf(t){if(t.type!=="canvas")return;this.overlay&&(t.fillStyle=`rgba(255, 255, 255, ${A.LOADING_SPINNER_OVERLAY_ALPHA})`,t.fillRect(0,0,this.width,this.height));const e=this.width/2,i=this.height/2;if(this.progress===null?this.renderIndeterminateSpinner(t,e,i):this.renderProgressCircle(t,e,i),this.message&&(t.fillStyle="#666666",t.font=this.font,t.textAlign="center",t.textBaseline="top",t.fillText(this.message,e,i+this.spinnerSize/2+A.LOADING_SPINNER_MESSAGE_Y_OFFSET)),this.progress!==null){const s=`${Math.round(this.progress*100)}%`;t.fillStyle="#333333",t.font=this.font,t.textAlign="center",t.textBaseline="middle",t.fillText(s,e,i)}if(this.cancellable){const s=i+this.spinnerSize/2+A.LOADING_SPINNER_CANCEL_Y_OFFSET;t.fillStyle="#F44336",t.fillRect(e-A.LOADING_SPINNER_CANCEL_BUTTON_X_OFFSET,s,A.LOADING_SPINNER_CANCEL_BUTTON_WIDTH,A.LOADING_SPINNER_CANCEL_BUTTON_HEIGHT),t.fillStyle="#FFFFFF",t.font="11px Arial",t.textAlign="center",t.fillText("Cancel",e,s+A.LOADING_SPINNER_CANCEL_BUTTON_TEXT_Y_OFFSET)}}renderIndeterminateSpinner(t,e,i){const s=this.spinnerSize/2;t.save(),t.translate(e,i),t.rotate(this.rotation),t.strokeStyle="#2196F3",t.lineWidth=A.LOADING_SPINNER_LINE_WIDTH,t.beginPath(),t.arc(0,0,s,0,Math.PI*A.LOADING_SPINNER_ARC_END_MULTIPLIER),t.stroke(),t.restore()}renderProgressCircle(t,e,i){const s=this.spinnerSize/2;if(t.strokeStyle="#E0E0E0",t.lineWidth=A.LOADING_SPINNER_PROGRESS_LINE_WIDTH,t.beginPath(),t.arc(e,i,s,0,Math.PI*2),t.stroke(),this.progress>0){const a=this.progress*Math.PI*2;t.strokeStyle="#2196F3",t.lineWidth=A.LOADING_SPINNER_PROGRESS_LINE_WIDTH,t.beginPath(),t.arc(e,i,s,-Math.PI/2,-Math.PI/2+a),t.stroke()}}}const f={EASING_HALF_POINT:.5,EASING_CURVE_FACTOR:4,EASING_CUBIC_POWER:3,BOUNCE_DIVISOR:2.75,BOUNCE_MULTIPLIER:7.5625,BOUNCE_THRESHOLD_1:1.5,BOUNCE_THRESHOLD_2:2.25,BOUNCE_THRESHOLD_3:2.625,BOUNCE_OFFSET_1:.75,BOUNCE_OFFSET_2:.9375,BOUNCE_OFFSET_3:.984375,BOUNCE_RANGE_1:2.5,MEMORY_WARNING_MB:50,BYTES_PER_KB:1024,TAB_CONTAINER_DEFAULT_WIDTH:600,TAB_CONTAINER_DEFAULT_HEIGHT:400,TAB_DEFAULT_HEIGHT:40,TAB_MAX_DEFAULT:20,TAB_MIN_HEIGHT:20,TAB_CLOSE_BUTTON_SIZE:20,TAB_CLOSE_BUTTON_OFFSET:15,TAB_BADGE_OFFSET:35,TAB_BADGE_Y_OFFSET:5,TAB_BADGE_RADIUS:8,TAB_ICON_OFFSET:20,TAB_TEXT_PADDING:30,TAB_CONTENT_PADDING:20,TAB_BORDER_OFFSET:3,TAB_BORDER_WIDTH:3,ANIMATION_SCALE_MIN:.8,ANIMATION_SCALE_RANGE:.2,ANIMATION_FADE_DIVISOR:2,ANIMATION_FADE_OFFSET:.5,PROGRESS_STEPPER_DEFAULT_WIDTH:600,PROGRESS_STEPPER_DEFAULT_HEIGHT:80,PROGRESS_STEP_CENTER_OFFSET:.5,PROGRESS_LIGHTEN_FACTOR:.1,PROGRESS_RADIUS_OFFSET:4,PROGRESS_SCALE_FACTOR:.2,PROGRESS_RADIUS_PADDING:25,PROGRESS_CIRCLE_BORDER:3,PROGRESS_TEXT_OFFSET_X:15,PROGRESS_TEXT_OFFSET_Y:5,PROGRESS_DESCRIPTION_Y_OFFSET:20,COLOR_MAX_VALUE:255,COLOR_RED_SHIFT:16,COLOR_GREEN_SHIFT:8,COLOR_GREEN_MASK:255,COLOR_BLUE_MASK:255,SPLIT_PANE_DEFAULT_WIDTH:600,SPLIT_PANE_DEFAULT_HEIGHT:400,SPLIT_MIN_RATIO:.1,SPLIT_MAX_RATIO:.9,SPLIT_DEFAULT_RATIO:.5,SPLIT_MIN_SIZE:50,SPLIT_SPLITTER_SIZE:6,SPLIT_KEYBOARD_ADJUSTMENT:.05,SPLIT_COLLAPSED_RATIO:.05,SPLIT_EXPANDED_RATIO:.95,SPLIT_CENTER_THRESHOLD:.5,TREE_VIEW_DEFAULT_WIDTH:300,TREE_VIEW_DEFAULT_HEIGHT:400,TREE_INDENT_SIZE:20,TREE_GRIP_SPACING:4,TREE_GRIP_SIZE:3,TREE_DASH_SIZE:3,TREE_SELECTION_PADDING:4,TREE_NODE_HEIGHT:24,TREE_MIN_NODE_HEIGHT:16,TREE_EXPAND_AREA_SIZE:16,TREE_TEXT_OFFSET:20,TREE_ICON_OFFSET:4,TREE_FOCUS_BORDER_OFFSET:4,TREE_SCROLLBAR_MIN_HEIGHT:20,FILE_UPLOAD_DEFAULT_WIDTH:400,FILE_UPLOAD_DEFAULT_HEIGHT:200,FILE_UPLOAD_MAX_SIZE_MB:10,FILE_UPLOAD_BYTES_PER_KB:1024,FILE_UPLOAD_PROGRESS_INCREMENT:.1,FILE_UPLOAD_DASH_SIZE:5,FILE_UPLOAD_ICON_Y_OFFSET:30,FILE_UPLOAD_BUTTON_Y_OFFSET:30,FILE_UPLOAD_FILE_NAME_X:35,FILE_UPLOAD_SIZE_TEXT_OFFSET:50,FILE_UPLOAD_REMOVE_BUTTON_OFFSET:20,FILE_UPLOAD_PROGRESS_MARGIN:20,FILE_UPLOAD_PROGRESS_TEXT_Y_OFFSET:5};var tt;let X=(tt=class{static getCurrentTheme(){return window.matchMedia&&window.matchMedia("(prefers-contrast: high)").matches?"highContrast":"light"}static getColor(t,e=null){const i=e||this.getCurrentTheme();return this.themes[i]?.[t]||this.themes.light[t]||"#000000"}static getAllColors(t=null){const e=t||this.getCurrentTheme();return{...this.themes[e]}}},B(tt,"themes",{light:{background:"#ffffff",backgroundSecondary:"#f8f9fa",backgroundDisabled:"#e9ecef",text:"#212529",textSecondary:"#6c757d",disabled:"#adb5bd",primary:"#007bff",primaryHover:"#0056b3",primaryText:"#ffffff",primaryBorder:"#0056b3",border:"#dee2e6",borderActive:"#007bff",shadow:"rgba(0, 0, 0, 0.1)",overlay:"rgba(0, 0, 0, 0.5)",success:"#28a745",successHover:"#218838",warning:"#ffc107",warningHover:"#e0a800",danger:"#dc3545",dangerHover:"#c82333",focus:"#007bff",selection:"#e3f2fd",hover:"#f5f5f5",tabBackground:"#f8f9fa",tabActive:"#ffffff",tabBorder:"#dee2e6",tabHover:"#e9ecef",treeExpander:"#6c757d",treeSelected:"#007bff",treeHover:"#f8f9fa",progressTrack:"#e9ecef",progressFill:"#007bff",progressComplete:"#28a745",uploadBorder:"#007bff",uploadHover:"#e3f2fd",uploadError:"#dc3545"},dark:{background:"#1a1a1a",backgroundSecondary:"#2d2d2d",backgroundDisabled:"#404040",text:"#ffffff",textSecondary:"#b3b3b3",disabled:"#666666",primary:"#4dabf7",primaryHover:"#339af0",primaryText:"#000000",primaryBorder:"#339af0",border:"#404040",borderActive:"#4dabf7",shadow:"rgba(0, 0, 0, 0.3)",overlay:"rgba(0, 0, 0, 0.7)",success:"#51cf66",successHover:"#40c057",warning:"#ffd43b",warningHover:"#fab005",danger:"#ff6b6b",dangerHover:"#fa5252",focus:"#4dabf7",selection:"#1c7ed6",hover:"#2d2d2d",tabBackground:"#2d2d2d",tabActive:"#1a1a1a",tabBorder:"#404040",tabHover:"#333333",treeExpander:"#b3b3b3",treeSelected:"#4dabf7",treeHover:"#2d2d2d",progressTrack:"#404040",progressFill:"#4dabf7",progressComplete:"#51cf66",uploadBorder:"#4dabf7",uploadHover:"#1c7ed6",uploadError:"#ff6b6b"},highContrast:{background:"#000000",backgroundSecondary:"#1a1a1a",backgroundDisabled:"#333333",text:"#ffffff",textSecondary:"#cccccc",disabled:"#666666",primary:"#ffffff",primaryHover:"#cccccc",primaryText:"#000000",primaryBorder:"#ffffff",border:"#ffffff",borderActive:"#ffff00",shadow:"rgba(255, 255, 255, 0.3)",overlay:"rgba(0, 0, 0, 0.8)",success:"#00ff00",successHover:"#00cc00",warning:"#ffff00",warningHover:"#cccc00",danger:"#ff0000",dangerHover:"#cc0000",focus:"#ffff00",selection:"#0000ff",hover:"#333333",tabBackground:"#1a1a1a",tabActive:"#000000",tabBorder:"#ffffff",tabHover:"#333333",treeExpander:"#ffffff",treeSelected:"#ffff00",treeHover:"#333333",progressTrack:"#333333",progressFill:"#ffffff",progressComplete:"#00ff00",uploadBorder:"#ffffff",uploadHover:"#333333",uploadError:"#ff0000"}}),tt);var Z;let $=(Z=class{static createInstance(t){const e={startMeasurement:i=>this.startMeasurement(t,i),endMeasurement:i=>this.endMeasurement(t,i),getMetrics:()=>this.getMetrics(t)};return this.instances.set(t,e),e}static startMeasurement(t,e){const i=`${t}-${e}`;this.measurements.set(i,{startTime:performance.now(),startMemory:this.getMemoryUsage()})}static endMeasurement(t,e){const i=`${t}-${e}`,s=this.measurements.get(i);if(s){const a=performance.now(),h=this.getMemoryUsage(),o={duration:a-s.startTime,memoryDelta:h-s.startMemory,timestamp:new Date().toISOString()};return this.measurements.delete(i),o.duration>K.renderTime&&x.warn(`Performance warning: ${e} took ${o.duration.toFixed(2)}ms in ${t}`),o}return null}static getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize:0}static getMetrics(t){return{activeOperations:Array.from(this.measurements.entries()).filter(([i])=>i.startsWith(t)).map(([i,s])=>({operation:i.split("-")[1],...s})).length,totalMemory:this.getMemoryUsage()}}},B(Z,"instances",new Map),B(Z,"measurements",new Map),Z),H=class st extends Error{constructor(t,e,i={}){super(t),this.name="ComponentError",this.component=e,this.context=i,this.timestamp=new Date().toISOString(),this.stack=new Error().stack}static create(t,e,i){return new st(t,e,i)}toString(){return`${this.name} in ${this.component}: ${this.message}`}};var j;let y=(j=class{static animate(t,e,i,s={}){const a=++this.animationId,h={id:a,target:t,from:{...e},to:{...i},duration:s.duration||it.duration,easing:s.easing||it.easing,startTime:performance.now(),onUpdate:s.onUpdate||(()=>{}),onComplete:s.onComplete||(()=>{})};return this.activeAnimations.set(a,h),this.runAnimation(h),a}static runAnimation(t){const e=()=>{const i=performance.now()-t.startTime,s=Math.min(i/t.duration,1),a=this.applyEasing(s,t.easing),h={};for(const o in t.from){const l=t.from[o],r=t.to[o];h[o]=l+(r-l)*a}t.onUpdate(h,s),s>=1?(t.onComplete(),this.activeAnimations.delete(t.id)):requestAnimationFrame(e)};e()}static applyEasing(t,e){const i={linear:s=>s,easeIn:s=>s*s,easeOut:s=>1-Math.pow(1-s,2),easeInOut:s=>s<f.EASING_HALF_POINT?2*s*s:-1+(f.EASING_CURVE_FACTOR-2*s)*s,easeOutCubic:s=>1-Math.pow(1-s,f.EASING_CUBIC_POWER),bounce:s=>s<1/f.BOUNCE_DIVISOR?f.BOUNCE_MULTIPLIER*s*s:s<2/f.BOUNCE_DIVISOR?f.BOUNCE_MULTIPLIER*(s-=f.BOUNCE_THRESHOLD_1/f.BOUNCE_DIVISOR)*s+f.BOUNCE_OFFSET_1:s<f.BOUNCE_RANGE_1/f.BOUNCE_DIVISOR?f.BOUNCE_MULTIPLIER*(s-=f.BOUNCE_THRESHOLD_2/f.BOUNCE_DIVISOR)*s+f.BOUNCE_OFFSET_2:f.BOUNCE_MULTIPLIER*(s-=f.BOUNCE_THRESHOLD_3/f.BOUNCE_DIVISOR)*s+f.BOUNCE_OFFSET_3};return i[e]?i[e](t):t}static cancelAnimation(t){this.activeAnimations.delete(t)}static cancelAllAnimations(){this.activeAnimations.clear()}},B(j,"activeAnimations",new Map),B(j,"animationId",0),j);const it={duration:250,easing:"easeOutCubic"},K={renderTime:16,eventThrottle:16};class wt extends C{constructor(t={}){super({...t,width:t.width||f.TAB_CONTAINER_DEFAULT_WIDTH,height:t.height||f.TAB_CONTAINER_DEFAULT_HEIGHT,ariaRole:"tablist",ariaLabel:t.ariaLabel||"Tab Container"}),this.validateOptions(t),this.tabs=t.tabs||[],this.activeTabIndex=t.activeTab||0,this.tabHeight=t.tabHeight||f.TAB_DEFAULT_HEIGHT,this.closeable=t.closeable!==!1,this.reorderable=t.reorderable!==!1,this.maxTabs=t.maxTabs||f.TAB_MAX_DEFAULT,this.disabled=t.disabled||!1,this.theme=t.theme||X.getCurrentTheme(),this.hoveredTabIndex=-1,this.draggedTabIndex=-1,this.dragOffset={x:0,y:0},this.focusedTabIndex=-1,this.isDragging=!1,this.animationState={tabTransitions:new Map,contentFade:0},this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),K.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler(),this.performanceMonitor=$.createInstance("TabContainer");try{this.setupTabs(),this.setupEventHandlers(),this.setupAccessibility(),this.setupResizeObserver()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.maxTabs&&(typeof t.maxTabs!="number"||t.maxTabs<1))throw new H("maxTabs must be a positive number","TabContainer");if(t.tabHeight&&(typeof t.tabHeight!="number"||t.tabHeight<f.TAB_MIN_HEIGHT))throw new H(`tabHeight must be at least ${f.TAB_MIN_HEIGHT} pixels`,"TabContainer");if(t.tabs&&!Array.isArray(t.tabs))throw new H("tabs must be an array","TabContainer")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowLeft:()=>this.navigateTab(-1),ArrowRight:()=>this.navigateTab(1),Home:()=>this.navigateToTab("first"),End:()=>this.navigateToTab("last"),Enter:()=>this.activateFocusedTab(),Space:()=>this.activateFocusedTab(),Delete:()=>this.closeFocusedTab(),Escape:()=>this.handleEscape()}}createErrorHandler(){return{handle:(t,e)=>{const i=new H(t.message||"Unknown error","TabContainer",{context:e,originalError:t});x.error("TabContainer Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"tab-management":this.validateTabState();break;case"animation":this.animationState.tabTransitions.clear(),y.cancelAllAnimations();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","tablist"),this.setAttribute("aria-multiselectable","false"),this.setAttribute("aria-orientation","horizontal"),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupResizeObserver(){"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{this.clearRenderCache(),this.throttledRender()}),this.element&&this.resizeObserver.observe(this.element))}setupTabs(){try{this.tabs.length===0&&this.tabs.push({id:"default",title:"Tab 1",content:"Default content",closeable:!1}),this.tabs=this.tabs.map((t,e)=>({id:t.id||`tab-${e}`,title:t.title||`Tab ${e+1}`,content:t.content||"",closeable:t.closeable!==!1&&this.closeable,icon:t.icon||null,badge:t.badge||null,disabled:t.disabled||!1,ariaControls:`tabpanel-${t.id||e}`,ariaSelected:!1,...t})),this.validateTabState(),this.updateTabAccessibility()}catch(t){this.errorHandler.handle(t,"tab-setup")}}validateTabState(){this.tabs.length===0&&this.tabs.push({id:"fallback",title:"Default Tab",content:"",closeable:!1}),this.activeTabIndex=Math.max(0,Math.min(this.activeTabIndex,this.tabs.length-1)),this.focusedTabIndex>=this.tabs.length&&(this.focusedTabIndex=this.activeTabIndex)}updateTabAccessibility(){this.tabs.forEach((t,e)=>{t.ariaSelected=e===this.activeTabIndex})}setupEventHandlers(){const t={click:this.handleClick.bind(this),mouseMove:this.handleMouseMove.bind(this),mouseDown:this.handleMouseDown.bind(this),mouseUp:this.handleMouseUp.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async addTab(t,e=-1){try{if(this.tabs.length>=this.maxTabs)return this.announceChange("Maximum number of tabs reached"),!1;const i={id:t.id||`tab-${Date.now()}`,title:t.title||"New Tab",content:t.content||"",closeable:t.closeable!==!1&&this.closeable,icon:t.icon||null,badge:t.badge||null,disabled:t.disabled||!1,ariaControls:`tabpanel-${t.id||Date.now()}`,ariaSelected:!1,...t};let s;return e>=0&&e<this.tabs.length?(this.tabs.splice(e,0,i),s=e,e<=this.activeTabIndex&&this.activeTabIndex++):(this.tabs.push(i),s=this.tabs.length-1),this.prefersReducedMotion()||await this.animateTabInsertion(s),this.updateTabAccessibility(),this.clearRenderCache(),this.announceChange(`Tab "${i.title}" added`),this.emit("tabAdded",{tab:i,index:s}),!0}catch(i){return this.errorHandler.handle(i,"addTab"),!1}}async removeTab(t){try{if(t<0||t>=this.tabs.length||this.tabs.length<=1)return!1;const e=this.tabs[t];return e.closeable?(this.prefersReducedMotion()||await this.animateTabRemoval(t),this.tabs.splice(t,1),t<this.activeTabIndex?this.activeTabIndex--:t===this.activeTabIndex&&(this.activeTabIndex=Math.min(this.activeTabIndex,this.tabs.length-1)),this.focusedTabIndex>=this.tabs.length&&(this.focusedTabIndex=Math.max(0,this.tabs.length-1)),this.updateTabAccessibility(),this.clearRenderCache(),this.announceChange(`Tab "${e.title}" removed`),this.emit("tabRemoved",{tab:e,index:t}),!0):(this.announceChange("Tab cannot be closed"),!1)}catch(e){return this.errorHandler.handle(e,"removeTab"),!1}}async setActiveTab(t){try{if(t>=0&&t<this.tabs.length&&!this.tabs[t].disabled){const e=this.activeTabIndex;this.activeTabIndex=t,this.focusedTabIndex=t,!this.prefersReducedMotion()&&e!==t&&await this.animateContentTransition(e,t),this.updateTabAccessibility(),this.clearRenderCache();const i=this.tabs[t];this.announceChange(`Tab "${i.title}" activated`),this.emit("tabChanged",{previousIndex:e,activeIndex:t,tab:i})}}catch(e){this.errorHandler.handle(e,"setActiveTab")}}updateTab(t,e){try{if(t>=0&&t<this.tabs.length){const i={...this.tabs[t]};Object.assign(this.tabs[t],e),e.title&&this.announceChange(`Tab renamed to "${e.title}"`),this.clearRenderCache(),this.emit("tabUpdated",{index:t,tab:this.tabs[t],updates:e,oldTab:i})}}catch(i){this.errorHandler.handle(i,"updateTab")}}handleClick(t){const{localX:e,localY:i}=t;if(i<=this.tabHeight){const s=this.getTabIndexFromX(e);if(s>=0&&s<this.tabs.length){const a=this.tabs[s],h=this.getTabBounds(s);a.closeable&&e>=h.x+h.width-f.TAB_CLOSE_BUTTON_SIZE?this.removeTab(s):a.disabled||this.setActiveTab(s)}}}handleMouseMove(t){const{localX:e,localY:i}=t;if(i<=this.tabHeight?this.hoveredTabIndex=this.getTabIndexFromX(e):this.hoveredTabIndex=-1,this.draggedTabIndex>=0&&this.reorderable){const s=this.getTabIndexFromX(e);s>=0&&s!==this.draggedTabIndex&&(this.reorderTab(this.draggedTabIndex,s),this.draggedTabIndex=s)}}handleMouseDown(t){const{localX:e,localY:i}=t;if(i<=this.tabHeight&&this.reorderable){const s=this.getTabIndexFromX(e);s>=0&&s<this.tabs.length&&(this.draggedTabIndex=s,this.dragOffset.x=e-this.getTabBounds(s).x)}}handleMouseUp(t){this.draggedTabIndex=-1,this.dragOffset={x:0,y:0}}handleKeyDown(t){switch(t.key){case"ArrowLeft":this.activeTabIndex>0&&this.setActiveTab(this.activeTabIndex-1);break;case"ArrowRight":this.activeTabIndex<this.tabs.length-1&&this.setActiveTab(this.activeTabIndex+1);break;case"Home":this.setActiveTab(0);break;case"End":this.setActiveTab(this.tabs.length-1);break;case"Delete":this.tabs[this.activeTabIndex]?.closeable&&this.removeTab(this.activeTabIndex);break}}getTabIndexFromX(t){const e=this.width/this.tabs.length;return Math.floor(t/e)}getTabBounds(t){const e=this.width/this.tabs.length;return{x:t*e,y:0,width:e,height:this.tabHeight}}reorderTab(t,e){if(t===e)return;const i=this.tabs.splice(t,1)[0];this.tabs.splice(e,0,i),this.activeTabIndex===t?this.activeTabIndex=e:t<this.activeTabIndex&&e>=this.activeTabIndex?this.activeTabIndex--:t>this.activeTabIndex&&e<=this.activeTabIndex&&this.activeTabIndex++,this.emit("tabReordered",{fromIndex:t,toIndex:e,tab:i})}renderSelf(t){t.type==="canvas"&&(this.renderTabHeaders(t),this.renderActiveContent(t))}renderTabHeaders(t){this.tabs.forEach((e,i)=>{const s=this.getTabBounds(i),a=i===this.activeTabIndex,h=i===this.hoveredTabIndex;let o=this.tabBackgroundColor;a?o=this.activeTabColor:h&&(o="#e9ecef"),t.fillStyle=o,t.fillRect(s.x,s.y,s.width,s.height),t.strokeStyle=this.tabBorderColor,t.lineWidth=1,t.strokeRect(s.x,s.y,s.width,s.height),a&&(t.fillStyle="#007bff",t.fillRect(s.x,s.y+s.height-f.TAB_BORDER_OFFSET,s.width,f.TAB_BORDER_WIDTH));let r=s.x+10;e.icon&&(t.fillStyle=e.disabled?"#999999":"#333333",t.font="14px Arial",t.textAlign="left",t.fillText(e.icon,r,s.y+s.height/2+2),r+=f.TAB_ICON_OFFSET),t.fillStyle=e.disabled?"#999999":"#333333",t.font=a?"bold 12px Arial":"12px Arial",t.textAlign="left",t.textBaseline="middle";const E=s.width-(r-s.x)-f.TAB_TEXT_PADDING;let{title:g}=e;if(t.measureText(g).width>E){const I="...",S=t.measureText(I).width,D=E-S;let O=0,M=g.length;for(;O<M;){const U=Math.floor((O+M+1)/2);t.measureText(g.substring(0,U)).width<=D?O=U:M=U-1}g=g.substring(0,O)+I}if(t.fillText(g,r,s.y+s.height/2),e.badge){const I=s.x+s.width-f.TAB_BADGE_OFFSET,S=s.y+f.TAB_BADGE_Y_OFFSET;t.fillStyle="#dc3545",t.beginPath(),t.arc(I,S,f.TAB_BADGE_RADIUS,0,Math.PI*2),t.fill(),t.fillStyle="#ffffff",t.font="bold 10px Arial",t.textAlign="center",t.fillText(e.badge,I,S+1)}if(e.closeable){const I=s.x+s.width-f.TAB_CLOSE_BUTTON_OFFSET,S=s.y+s.height/2;t.fillStyle=h?"#dc3545":"#666666",t.font="12px Arial",t.textAlign="center",t.fillText("×",I,S)}})}renderActiveContent(t){const e=this.tabHeight,i=this.height-this.tabHeight;if(t.fillStyle=this.contentBackgroundColor,t.fillRect(0,e,this.width,i),t.strokeStyle=this.tabBorderColor,t.lineWidth=1,t.strokeRect(0,e,this.width,i),this.activeTabIndex>=0&&this.activeTabIndex<this.tabs.length){const s=this.tabs[this.activeTabIndex];typeof s.content=="string"&&(t.fillStyle="#333333",t.font="14px Arial",t.textAlign="left",t.textBaseline="top",t.fillText(s.content,f.TAB_CONTENT_PADDING,e+f.TAB_CONTENT_PADDING))}}async animateTabInsertion(t){return y.createAnimation({duration:300,easing:"easeOutCubic",onUpdate:s=>{this.animationState.tabTransitions.set(t,{type:"insert",progress:s,scale:f.ANIMATION_SCALE_MIN+f.ANIMATION_SCALE_RANGE*s,opacity:s}),this.invalidate()},onComplete:()=>{this.animationState.tabTransitions.delete(t),this.invalidate()}}).start()}async animateTabRemoval(t){return y.createAnimation({duration:200,easing:"easeInCubic",onUpdate:s=>{this.animationState.tabTransitions.set(t,{type:"remove",progress:1-s,scale:1-f.ANIMATION_SCALE_RANGE*s,opacity:1-s}),this.invalidate()},onComplete:()=>{this.animationState.tabTransitions.delete(t),this.invalidate()}}).start()}async animateContentTransition(t,e){return this.animationState.contentFade=1,y.createAnimation({duration:250,easing:"easeInOutCubic",onUpdate:a=>{this.animationState.contentFade=a<f.ANIMATION_FADE_OFFSET?1-a*f.ANIMATION_FADE_DIVISOR:(a-f.ANIMATION_FADE_OFFSET)*f.ANIMATION_FADE_DIVISOR,this.invalidate()},onComplete:()=>{this.animationState.contentFade=1,this.invalidate()}}).start()}navigateTab(t){const e=this.focusedTabIndex+t;e>=0&&e<this.tabs.length&&(this.focusedTabIndex=e,this.updateFocusVisuals())}navigateToTab(t){switch(t){case"first":this.focusedTabIndex=0;break;case"last":this.focusedTabIndex=this.tabs.length-1;break}this.updateFocusVisuals()}activateFocusedTab(){this.focusedTabIndex>=0&&this.focusedTabIndex<this.tabs.length&&this.setActiveTab(this.focusedTabIndex)}closeFocusedTab(){this.focusedTabIndex>=0&&this.focusedTabIndex<this.tabs.length&&this.tabs[this.focusedTabIndex].closeable&&this.removeTab(this.focusedTabIndex)}handleEscape(){this.focusedTabIndex=this.activeTabIndex,this.updateFocusVisuals()}updateFocusVisuals(){if(this.invalidate(),this.focusedTabIndex>=0&&this.focusedTabIndex<this.tabs.length){const t=this.tabs[this.focusedTabIndex];this.announceChange(`Focused on tab "${t.title}"`)}}handleFocusIn(){this.focusedTabIndex===-1&&(this.focusedTabIndex=this.activeTabIndex),this.updateFocusVisuals()}handleFocusOut(){this.updateFocusVisuals()}announceChange(t){this.announcer&&(this.announcer.textContent=t)}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}clearRenderCache(){this.renderCache.clear(),this.invalidate()}throttle(t,e){let i;return function(...a){const h=()=>{clearTimeout(i),t(...a)};clearTimeout(i),i=setTimeout(h,e)}}reset(){this.activeTabIndex=0,this.focusedTabIndex=0,this.hoveredTabIndex=-1,this.draggedTabIndex=-1,this.animationState.tabTransitions.clear(),this.animationState.contentFade=1,this.clearRenderCache(),this.validateTabState()}destroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.animationState.tabTransitions.clear(),y.cancelAllAnimations(),this.renderCache.clear(),super.destroy()}getActiveTab(){return this.tabs[this.activeTabIndex]}getTabById(t){return this.tabs.find(e=>e.id===t)}getTabIndex(t){return this.tabs.findIndex(e=>e.id===t)}getTabs(){return[...this.tabs]}getTabCount(){return this.tabs.length}isTabCloseable(t){return this.tabs[t]?.closeable||!1}setTabCloseable(t,e){this.tabs[t]&&(this.tabs[t].closeable=e,this.clearRenderCache())}setTheme(t){this.theme=t,this.clearRenderCache(),this.emit("themeChanged",{theme:t})}}class xt extends C{constructor(t={}){super({...t,width:t.width||f.PROGRESS_STEPPER_DEFAULT_WIDTH,height:t.height||f.PROGRESS_STEPPER_DEFAULT_HEIGHT,ariaRole:"progressbar",ariaLabel:t.ariaLabel||"Progress Steps"}),this.validateOptions(t),this.steps=t.steps||[],this.currentStep=Math.max(0,Math.min(t.currentStep||0,this.steps.length-1)),this.orientation=t.orientation||"horizontal",this.allowStepClick=t.allowStepClick!==!1,this.showStepNumbers=t.showStepNumbers!==!1,this.showLabels=t.showLabels!==!1,this.disabled=t.disabled||!1,this.theme=t.theme||X.getCurrentTheme(),this.hoveredStepIndex=-1,this.focusedStepIndex=-1,this.animatingSteps=new Set,this.progressPercentage=0,this.animationState={stepTransitions:new Map,progressAnimation:null},this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),K.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler(),this.performanceMonitor=$.createInstance("ProgressStepper");try{this.setupSteps(),this.setupEventHandlers(),this.setupAccessibility(),this.updateProgress()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.currentStep&&(typeof t.currentStep!="number"||t.currentStep<0))throw new H("currentStep must be a non-negative number","ProgressStepper");if(t.orientation&&!["horizontal","vertical"].includes(t.orientation))throw new H('orientation must be "horizontal" or "vertical"',"ProgressStepper");if(t.steps&&!Array.isArray(t.steps))throw new H("steps must be an array","ProgressStepper")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowLeft:()=>this.navigateStep(-1),ArrowRight:()=>this.navigateStep(1),ArrowUp:()=>this.navigateStep(-1),ArrowDown:()=>this.navigateStep(1),Home:()=>this.navigateToStep("first"),End:()=>this.navigateToStep("last"),Enter:()=>this.activateFocusedStep(),Space:()=>this.activateFocusedStep(),Escape:()=>this.handleEscape()}}createErrorHandler(){return{handle:(t,e)=>{const i=new H(t.message||"Unknown error","ProgressStepper",{context:e,originalError:t});x.error("ProgressStepper Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"step-management":this.validateStepState();break;case"animation":this.animationState.stepTransitions.clear(),this.animatingSteps.clear(),y.cancelAllAnimations();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","progressbar"),this.setAttribute("aria-valuemin","0"),this.setAttribute("aria-valuemax",this.steps.length-1),this.setAttribute("aria-valuenow",this.currentStep),this.setAttribute("aria-valuetext",this.getStepDescription(this.currentStep)),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupSteps(){try{this.steps.length===0&&this.steps.push({id:"default",title:"Step 1",description:"Default step",completed:!1}),this.steps=this.steps.map((t,e)=>({id:t.id||`step-${e}`,title:t.title||`Step ${e+1}`,description:t.description||"",completed:t.completed||!1,disabled:t.disabled||!1,icon:t.icon||null,optional:t.optional||!1,...t})),this.validateStepState(),this.updateStepAccessibility()}catch(t){this.errorHandler.handle(t,"step-setup")}}validateStepState(){this.steps.length===0&&this.steps.push({id:"fallback",title:"Default Step",description:"",completed:!1}),this.currentStep=Math.max(0,Math.min(this.currentStep,this.steps.length-1)),this.focusedStepIndex>=this.steps.length&&(this.focusedStepIndex=this.currentStep)}updateStepAccessibility(){this.setAttribute("aria-valuenow",this.currentStep),this.setAttribute("aria-valuetext",this.getStepDescription(this.currentStep)),this.progressPercentage=this.steps.length>1?this.currentStep/(this.steps.length-1)*100:100}getStepDescription(t){if(t>=0&&t<this.steps.length){const e=this.steps[t],i=e.completed?"completed":t===this.currentStep?"current":"pending";return`${e.title}, ${i}. ${e.description||""}`.trim()}return""}setupEventHandlers(){const t={click:this.handleClick.bind(this),mouseMove:this.handleMouseMove.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async goToStep(t){try{if(t>=0&&t<this.steps.length){const e=this.steps[t];if(!e.disabled&&(this.allowStepClick||t<=this.getLastCompletedStep()+1)){const i=this.currentStep;this.currentStep=t,this.focusedStepIndex=t,!this.prefersReducedMotion()&&i!==t&&await this.animateStepTransition(i,t),this.updateProgress(),this.updateStepAccessibility(),this.clearRenderCache(),this.announceChange(`Moved to ${e.title}`),this.emit("stepChanged",{previousStep:i,currentStep:t,step:this.steps[t]})}}}catch(e){this.errorHandler.handle(e,"goToStep")}}async nextStep(){this.currentStep<this.steps.length-1&&await this.goToStep(this.currentStep+1)}async previousStep(){this.currentStep>0&&await this.goToStep(this.currentStep-1)}async completeStep(t=this.currentStep){try{if(t>=0&&t<this.steps.length){this.steps[t].completed=!0,this.prefersReducedMotion()||await this.animateStepCompletion(t),this.updateProgress(),this.clearRenderCache();const e=this.steps[t];this.announceChange(`${e.title} completed`),this.emit("stepCompleted",{stepIndex:t,step:this.steps[t]})}}catch(e){this.errorHandler.handle(e,"completeStep")}}getLastCompletedStep(){for(let t=this.steps.length-1;t>=0;t--)if(this.steps[t].completed)return t;return-1}getStepStatus(t){const e=this.steps[t];return e.completed?"completed":t===this.currentStep?"active":e.disabled?"disabled":"inactive"}async animateStepTransition(t,e){return y.createAnimation({duration:300,easing:"easeOutCubic",onUpdate:a=>{this.animationState.stepTransitions.set("transition",{fromIndex:t,toIndex:e,progress:a}),this.invalidate()},onComplete:()=>{this.animationState.stepTransitions.delete("transition"),this.invalidate()}}).start()}async animateStepCompletion(t){return this.animatingSteps.add(t),y.createAnimation({duration:500,easing:"easeOutElastic",onUpdate:s=>{this.animationState.stepTransitions.set(`completion-${t}`,{type:"complete",index:t,progress:s,scale:1+f.PROGRESS_SCALE_FACTOR*Math.sin(s*Math.PI)}),this.invalidate()},onComplete:()=>{this.animationState.stepTransitions.delete(`completion-${t}`),this.animatingSteps.delete(t),this.invalidate()}}).start()}updateProgress(){const t=this.steps.filter(e=>e.completed).length;if(this.progressPercentage=this.steps.length>0?t/this.steps.length*100:0,!this.prefersReducedMotion()&&this.animationState.progressAnimation&&y.cancelAnimation(this.animationState.progressAnimation),this.prefersReducedMotion())this.setAttribute("aria-valuenow",this.currentStep);else{const e=this.getAttribute("aria-valuenow")||0,i=this.currentStep;this.animationState.progressAnimation=y.createAnimation({duration:400,easing:"easeOutCubic",onUpdate:s=>{const a=e+(i-e)*s;this.setAttribute("aria-valuenow",Math.round(a))},onComplete:()=>{this.animationState.progressAnimation=null}}),this.animationState.progressAnimation.start()}}handleClick(t){try{if(!this.allowStepClick||this.disabled)return;const e=this.getStepIndexFromPosition(t.localX,t.localY);e>=0&&this.goToStep(e)}catch(e){this.errorHandler.handle(e,"handleClick")}}handleMouseMove(t){const e=this.getStepIndexFromPosition(t.localX,t.localY);e!==this.hoveredStepIndex&&(this.hoveredStepIndex=e,this.invalidate())}handleKeyDown(t){if(this.disabled)return;const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),e())}handleFocus(){this.focusedStepIndex===-1&&(this.focusedStepIndex=this.currentStep),this.invalidate()}handleBlur(){this.invalidate()}navigateStep(t){const e=this.focusedStepIndex+t;e>=0&&e<this.steps.length&&(this.focusedStepIndex=e,this.updateFocusVisuals())}navigateToStep(t){switch(t){case"first":this.focusedStepIndex=0;break;case"last":this.focusedStepIndex=this.steps.length-1;break}this.updateFocusVisuals()}activateFocusedStep(){this.focusedStepIndex>=0&&this.focusedStepIndex<this.steps.length&&this.goToStep(this.focusedStepIndex)}handleEscape(){this.focusedStepIndex=this.currentStep,this.updateFocusVisuals()}updateFocusVisuals(){if(this.invalidate(),this.focusedStepIndex>=0&&this.focusedStepIndex<this.steps.length){const t=this.steps[this.focusedStepIndex];this.announceChange(`Focused on ${t.title}`)}}handleFocusIn(){this.focusedStepIndex===-1&&(this.focusedStepIndex=this.currentStep),this.updateFocusVisuals()}handleFocusOut(){this.updateFocusVisuals()}getStepIndexFromPosition(t,e){try{if(this.orientation==="horizontal"){const i=this.width/this.steps.length,s=Math.floor(t/i);return s>=0&&s<this.steps.length?s:-1}else{const i=this.height/this.steps.length,s=Math.floor(e/i);return s>=0&&s<this.steps.length?s:-1}}catch(i){return this.errorHandler.handle(i,"getStepIndexFromPosition"),-1}}renderSelf(t){if(t.type==="canvas")try{const e=X.themes[this.theme];this.orientation==="horizontal"?this.renderHorizontalStepper(t,e):this.renderVerticalStepper(t,e)}catch(e){this.errorHandler.handle(e,"render")}}renderHorizontalStepper(t,e){const i=this.width/this.steps.length,s=this.height/2,a=15,h=s;for(let o=0;o<this.steps.length-1;o++){const l=(o+1)*i-i/2+a,r=(o+1)*i+i/2-a,E=this.steps[o].completed&&this.steps[o+1].completed,g=o===this.currentStep-1||o===this.currentStep,_=t.createLinearGradient(l,h,r,h);E?(_.addColorStop(0,e.progressComplete),_.addColorStop(1,e.progressComplete)):g?(_.addColorStop(0,e.progressFill),_.addColorStop(1,e.border)):(_.addColorStop(0,e.progressTrack),_.addColorStop(1,e.progressTrack)),t.strokeStyle=_,t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(l,h),t.lineTo(r,h),t.stroke()}this.steps.forEach((o,l)=>{const r=(l+f.PROGRESS_STEP_CENTER_OFFSET)*i,E=this.getStepStatus(l),g=l===this.hoveredStepIndex,_=l===this.focusedStepIndex;let I=1;const S=this.animationState.stepTransitions.get(`completion-${l}`);S&&({scale:I}=S);const D=a*I;let O=e.progressTrack,M=e.border,U=e.textSecondary;switch(E){case"completed":O=e.progressComplete,M=e.progressComplete,U=e.background;break;case"active":O=e.progressFill,M=e.progressFill,U=e.background;break;case"disabled":O=e.backgroundDisabled,M=e.disabled,U=e.disabled;break}if(g&&!o.disabled&&(O=this.lightenColor(O,f.PROGRESS_LIGHTEN_FACTOR)),_&&(t.strokeStyle=e.focus,t.lineWidth=3,t.beginPath(),t.arc(r,s,D+f.PROGRESS_RADIUS_OFFSET,0,Math.PI*2),t.stroke()),t.fillStyle=O,t.strokeStyle=M,t.lineWidth=2,t.beginPath(),t.arc(r,s,D,0,Math.PI*2),t.fill(),t.stroke(),o.completed?(t.fillStyle=U,t.font="bold 14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("✓",r,s)):this.showStepNumbers?(t.fillStyle=U,t.font="bold 12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText((l+1).toString(),r,s)):o.icon&&(t.fillStyle=U,t.font="14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(o.icon,r,s)),this.showLabels&&o.title){t.fillStyle=E==="active"?e.text:e.textSecondary,t.font=E==="active"?"bold 11px Arial":"11px Arial",t.textAlign="center",t.textBaseline="top";const z=i-10;let{title:W}=o;if(t.measureText(W).width>z){for(;t.measureText(`${W}...`).width>z&&W.length>0;)W=W.slice(0,-1);W=`${W}...`}t.fillText(W,r,s+D+10),o.optional&&(t.fillStyle=e.textSecondary,t.font="9px Arial",t.fillText("(optional)",r,s+D+f.PROGRESS_RADIUS_PADDING))}})}renderVerticalStepper(t,e){const i=this.height/this.steps.length,s=30,a=12;for(let h=0;h<this.steps.length-1;h++){const o=(h+1)*i-i/2+a,l=(h+1)*i+i/2-a,r=this.steps[h].completed&&this.steps[h+1].completed;t.strokeStyle=r?e.progressComplete:e.progressTrack,t.lineWidth=3,t.lineCap="round",t.beginPath(),t.moveTo(s,o),t.lineTo(s,l),t.stroke()}this.steps.forEach((h,o)=>{const l=(o+f.PROGRESS_STEP_CENTER_OFFSET)*i,r=this.getStepStatus(o),E=o===this.hoveredStepIndex,g=o===this.focusedStepIndex;let _=e.progressTrack,I=e.border,S=e.textSecondary;switch(r){case"completed":_=e.progressComplete,I=e.progressComplete,S=e.background;break;case"active":_=e.progressFill,I=e.progressFill,S=e.background;break;case"disabled":_=e.backgroundDisabled,I=e.disabled,S=e.disabled;break}E&&!h.disabled&&(_=this.lightenColor(_,f.PROGRESS_LIGHTEN_FACTOR)),g&&(t.strokeStyle=e.focus,t.lineWidth=3,t.beginPath(),t.arc(s,l,a+f.PROGRESS_CIRCLE_BORDER,0,Math.PI*2),t.stroke()),t.fillStyle=_,t.strokeStyle=I,t.lineWidth=2,t.beginPath(),t.arc(s,l,a,0,Math.PI*2),t.fill(),t.stroke(),h.completed?(t.fillStyle=S,t.font="bold 12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("✓",s,l)):this.showStepNumbers&&(t.fillStyle=S,t.font="bold 10px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText((o+1).toString(),s,l)),this.showLabels&&h.title&&(t.fillStyle=r==="active"?e.text:e.textSecondary,t.font=r==="active"?"bold 12px Arial":"12px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(h.title,s+a+f.PROGRESS_TEXT_OFFSET_X,l-f.PROGRESS_TEXT_OFFSET_Y),h.description&&(t.fillStyle=e.textSecondary,t.font="10px Arial",t.fillText(h.description,s+a+f.PROGRESS_TEXT_OFFSET_X,l+10)),h.optional&&(t.fillStyle=e.textSecondary,t.font="italic 9px Arial",t.fillText("(optional)",s+a+f.PROGRESS_TEXT_OFFSET_X,l+f.PROGRESS_DESCRIPTION_Y_OFFSET)))})}lightenColor(t,e){const i=parseInt(t.replace("#",""),16),s=Math.min(f.COLOR_MAX_VALUE,Math.floor((i>>f.COLOR_RED_SHIFT)+e*f.COLOR_MAX_VALUE)),a=Math.min(f.COLOR_MAX_VALUE,Math.floor((i>>f.COLOR_GREEN_SHIFT&f.COLOR_GREEN_MASK)+e*f.COLOR_MAX_VALUE)),h=Math.min(f.COLOR_MAX_VALUE,Math.floor((i&f.COLOR_BLUE_MASK)+e*f.COLOR_MAX_VALUE));return`rgb(${s}, ${a}, ${h})`}announceChange(t){this.announcer&&(this.announcer.textContent=t)}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}clearRenderCache(){this.renderCache.clear(),this.invalidate()}throttle(t,e){let i;return function(...a){const h=()=>{clearTimeout(i),t(...a)};clearTimeout(i),i=setTimeout(h,e)}}reset(){this.currentStep=0,this.focusedStepIndex=0,this.hoveredStepIndex=-1,this.animatingSteps.clear(),this.animationState.stepTransitions.clear(),this.steps.forEach(t=>{t.completed=!1}),this.updateProgress(),this.updateStepAccessibility(),this.clearRenderCache(),this.announceChange("Progress reset"),this.emit("reset")}destroy(){this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.animationState.stepTransitions.clear(),this.animatingSteps.clear(),y.cancelAllAnimations(),this.renderCache.clear(),super.destroy()}getCurrentStep(){return this.steps[this.currentStep]}getProgress(){const t=this.steps.filter(e=>e.completed).length;return this.steps.length>0?t/this.steps.length:0}getProgressPercentage(){return this.progressPercentage}getSteps(){return[...this.steps]}getStepCount(){return this.steps.length}addStep(t,e=-1){try{const i={id:t.id||`step-${Date.now()}`,title:t.title||"New Step",description:t.description||"",completed:t.completed||!1,disabled:t.disabled||!1,icon:t.icon||null,optional:t.optional||!1,...t};return e>=0&&e<this.steps.length?(this.steps.splice(e,0,i),e<=this.currentStep&&this.currentStep++):this.steps.push(i),this.validateStepState(),this.updateStepAccessibility(),this.clearRenderCache(),this.emit("stepAdded",{step:i,index:e>=0?e:this.steps.length-1}),!0}catch(i){return this.errorHandler.handle(i,"addStep"),!1}}removeStep(t){try{if(t>=0&&t<this.steps.length&&this.steps.length>1){const e=this.steps.splice(t,1)[0];return t<this.currentStep?this.currentStep--:t===this.currentStep&&this.currentStep>=this.steps.length&&(this.currentStep=this.steps.length-1),this.validateStepState(),this.updateStepAccessibility(),this.clearRenderCache(),this.emit("stepRemoved",{step:e,index:t}),!0}return!1}catch(e){return this.errorHandler.handle(e,"removeStep"),!1}}updateStep(t,e){try{if(t>=0&&t<this.steps.length){const i={...this.steps[t]};return Object.assign(this.steps[t],e),this.clearRenderCache(),this.emit("stepUpdated",{index:t,step:this.steps[t],updates:e,oldStep:i}),!0}return!1}catch(i){return this.errorHandler.handle(i,"updateStep"),!1}}setTheme(t){this.theme=t,this.clearRenderCache(),this.emit("themeChanged",{theme:t})}}class Mt extends C{constructor(t={}){super({...t,width:t.width||f.SPLIT_PANE_DEFAULT_WIDTH,height:t.height||f.SPLIT_PANE_DEFAULT_HEIGHT,ariaRole:"separator",ariaLabel:t.ariaLabel||"Split Pane"}),this.validateOptions(t),this.orientation=t.orientation||"horizontal",this.split=Math.max(f.SPLIT_MIN_RATIO,Math.min(f.SPLIT_MAX_RATIO,t.split||f.SPLIT_DEFAULT_RATIO)),this.minSize=t.minSize||f.SPLIT_MIN_SIZE,this.splitterSize=t.splitterSize||f.SPLIT_SPLITTER_SIZE,this.resizable=t.resizable!==!1,this.collapsible=t.collapsible||!1,this.disabled=t.disabled||!1,this.theme=t.theme||X.getCurrentTheme(),this.leftPane=t.leftPane||null,this.rightPane=t.rightPane||null,this.isResizing=!1,this.isHovering=!1,this.isFocused=!1,this.startMousePos=0,this.startSplit=0,this.collapsed=null,this.animatedSplit=this.split,this.animationState={splitTransition:null,collapseAnimation:null},this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),K.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler(),this.performanceMonitor=$.createInstance("SplitPane");try{this.setupEventHandlers(),this.setupAccessibility(),this.updateAccessibility()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.split&&(typeof t.split!="number"||t.split<0||t.split>1))throw new H("split must be a number between 0 and 1","SplitPane");if(t.orientation&&!["horizontal","vertical"].includes(t.orientation))throw new H('orientation must be "horizontal" or "vertical"',"SplitPane");if(t.minSize&&(typeof t.minSize!="number"||t.minSize<0))throw new H("minSize must be a non-negative number","SplitPane")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowLeft:()=>this.adjustSplit(-.05),ArrowRight:()=>this.adjustSplit(f.SPLIT_KEYBOARD_ADJUSTMENT),ArrowUp:()=>this.adjustSplit(-.05),ArrowDown:()=>this.adjustSplit(f.SPLIT_KEYBOARD_ADJUSTMENT),Home:()=>this.setSplit(f.SPLIT_MIN_RATIO),End:()=>this.setSplit(f.SPLIT_MAX_RATIO),Enter:()=>this.toggleCollapse(),Space:()=>this.toggleCollapse(),Escape:()=>this.handleEscape()}}createErrorHandler(){return{handle:(t,e)=>{const i=new H(t.message||"Unknown error","SplitPane",{context:e,originalError:t});x.error("SplitPane Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"resize":this.isResizing=!1,this.split=Math.max(f.SPLIT_MIN_RATIO,Math.min(f.SPLIT_MAX_RATIO,this.split));break;case"animation":this.animationState.splitTransition=null,this.animationState.collapseAnimation=null,y.cancelAllAnimations();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","separator"),this.setAttribute("aria-orientation",this.orientation),this.setAttribute("aria-valuemin","10"),this.setAttribute("aria-valuemax","90"),this.setAttribute("aria-valuenow",Math.round(this.split*100)),this.setAttribute("aria-valuetext",this.getSplitDescription()),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}updateAccessibility(){this.setAttribute("aria-valuenow",Math.round(this.split*100)),this.setAttribute("aria-valuetext",this.getSplitDescription())}getSplitDescription(){const t=Math.round(this.split*100),e=this.orientation==="horizontal"?"left":"top";return`${e} pane ${t}%, ${e==="left"?"right":"bottom"} pane ${100-t}%`}setupEventHandlers(){const t={mouseDown:this.handleMouseDown.bind(this),mouseMove:this.handleMouseMove.bind(this),mouseUp:this.handleMouseUp.bind(this),dblclick:this.handleDoubleClick.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async setSplit(t,e=!0){try{const i=Math.max(f.SPLIT_MIN_RATIO,Math.min(f.SPLIT_MAX_RATIO,t));if(i===this.split)return;const s=this.split;e&&!this.prefersReducedMotion()?await this.animateSplitChange(s,i):(this.split=i,this.animatedSplit=i),this.updateAccessibility(),this.clearRenderCache(),this.announceChange(`Split adjusted to ${Math.round(i*100)}%`),this.emit("splitChanged",{oldSplit:s,newSplit:i})}catch(i){this.errorHandler.handle(i,"setSplit")}}adjustSplit(t){const e=this.split+t;this.setSplit(e)}async toggleCollapse(){if(this.collapsible)try{if(this.collapsed)await this.expand();else{const t=this.split>f.SPLIT_CENTER_THRESHOLD;await this.collapse(t?"left":"right")}}catch(t){this.errorHandler.handle(t,"toggleCollapse")}}async collapse(t){if(!(!this.collapsible||this.collapsed===t))try{const e=t==="left"?f.SPLIT_COLLAPSED_RATIO:f.SPLIT_EXPANDED_RATIO;this.prefersReducedMotion()?(this.split=e,this.animatedSplit=e):await this.animateCollapse(this.split,e),this.collapsed=t,this.updateAccessibility(),this.clearRenderCache(),this.announceChange(`${t} pane collapsed`),this.emit("paneCollapsed",{side:t})}catch(e){this.errorHandler.handle(e,"collapse")}}async expand(){if(this.collapsed)try{this.prefersReducedMotion()?(this.split=.5,this.animatedSplit=.5):await this.animateCollapse(this.split,.5);const e=this.collapsed;this.collapsed=null,this.updateAccessibility(),this.clearRenderCache(),this.announceChange(`${e} pane expanded`),this.emit("paneExpanded",{side:e})}catch(t){this.errorHandler.handle(t,"expand")}}async animateSplitChange(t,e){const s=y.createAnimation({duration:250,easing:"easeOutCubic",onUpdate:a=>{this.animatedSplit=t+(e-t)*a,this.invalidate()},onComplete:()=>{this.split=e,this.animatedSplit=e,this.animationState.splitTransition=null,this.invalidate()}});return this.animationState.splitTransition=s,s.start()}async animateCollapse(t,e){const s=y.createAnimation({duration:300,easing:"easeInOutCubic",onUpdate:a=>{this.animatedSplit=t+(e-t)*a,this.invalidate()},onComplete:()=>{this.split=e,this.animatedSplit=e,this.animationState.collapseAnimation=null,this.invalidate()}});return this.animationState.collapseAnimation=s,s.start()}getSplitterBounds(){const t=this.animatedSplit||this.split;return this.orientation==="horizontal"?{x:this.width*t-this.splitterSize/2,y:0,width:this.splitterSize,height:this.height}:{x:0,y:this.height*t-this.splitterSize/2,width:this.width,height:this.splitterSize}}getLeftPaneBounds(){if(this.collapsed==="left")return{x:0,y:0,width:0,height:0};if(this.collapsed==="right")return{x:0,y:0,width:this.width,height:this.height};if(this.orientation==="horizontal")return{x:0,y:0,width:this.width*this.split-this.splitterSize/2,height:this.height};{const t=this.height*this.split;return{x:0,y:0,width:this.width,height:t-this.splitterSize/2}}}getRightPaneBounds(){if(this.collapsed==="right")return{x:0,y:0,width:0,height:0};if(this.collapsed==="left")return{x:0,y:0,width:this.width,height:this.height};if(this.orientation==="horizontal"){const t=this.width*this.split;return{x:t+this.splitterSize/2,y:0,width:this.width-t-this.splitterSize/2,height:this.height}}else{const t=this.height*this.split;return{x:0,y:t+this.splitterSize/2,width:this.width,height:this.height-t-this.splitterSize/2}}}isPointInSplitter(t,e){const i=this.getSplitterBounds();return t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height}handleMouseDown(t){try{if(!this.resizable||this.disabled)return;const{localX:e,localY:i}=t;this.isPointInSplitter(e,i)&&(this.isResizing=!0,this.startSplit=this.split,this.orientation==="horizontal"?this.startMousePos=e:this.startMousePos=i,this.announceChange("Started resizing split pane"),this.emit("resizeStart",{split:this.split}),t.stopPropagation())}catch(e){this.errorHandler.handle(e,"handleMouseDown")}}handleMouseMove(t){try{const{localX:e,localY:i}=t;if(this.isResizing){const a=(this.orientation==="horizontal"?e:i)-this.startMousePos,h=this.orientation==="horizontal"?this.width:this.height,o=a/h;let l=this.startSplit+o;const r=this.minSize/h;l=Math.max(r,Math.min(1-r,l)),this.split=l,this.animatedSplit=l,this.updateAccessibility(),this.clearRenderCache(),this.emit("resize",{split:l})}else{const s=this.isHovering;this.isHovering=this.isPointInSplitter(e,i),s!==this.isHovering&&this.invalidate(),this.resizable&&this.isHovering?document.body.style.cursor=this.orientation==="horizontal"?"col-resize":"row-resize":document.body.style.cursor="default"}}catch(e){this.errorHandler.handle(e,"handleMouseMove")}}handleMouseUp(t){try{this.isResizing&&(this.isResizing=!1,document.body.style.cursor="default",this.announceChange(`Split adjusted to ${Math.round(this.split*100)}%`),this.emit("resizeEnd",{split:this.split}))}catch(e){this.errorHandler.handle(e,"handleMouseUp")}}handleDoubleClick(t){try{const{localX:e,localY:i}=t;this.isPointInSplitter(e,i)&&this.collapsible&&this.toggleCollapse()}catch(e){this.errorHandler.handle(e,"handleDoubleClick")}}handleKeyDown(t){if(this.disabled)return;const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),e())}handleFocus(){this.isFocused=!0,this.invalidate()}handleBlur(){this.isFocused=!1,this.invalidate(),document.body.style.cursor="default"}handleFocusIn(){this.isFocused=!0,this.invalidate()}handleFocusOut(){this.isFocused=!1,this.invalidate()}handleEscape(){this.isResizing&&(this.isResizing=!1,this.split=this.startSplit,this.animatedSplit=this.startSplit,this.updateAccessibility(),this.clearRenderCache(),document.body.style.cursor="default",this.announceChange("Resize cancelled"),this.emit("resizeCancel"))}renderSelf(t){if(t.type==="canvas")try{const e=X.themes[this.theme];this.renderPanes(t,e),this.renderSplitter(t,e),this.isFocused&&this.renderFocusIndicator(t,e)}catch(e){this.errorHandler.handle(e,"render")}}renderPanes(t,e){const i=this.getLeftPaneBounds(),s=this.getRightPaneBounds();t.fillStyle=e.background,t.fillRect(i.x,i.y,i.width,i.height),t.fillStyle=e.backgroundSecondary,t.fillRect(s.x,s.y,s.width,s.height),t.strokeStyle=e.border,t.lineWidth=1,t.strokeRect(i.x,i.y,i.width,i.height),t.strokeRect(s.x,s.y,s.width,s.height),this.leftPane&&typeof this.leftPane.render=="function"&&(t.save(),t.translate(i.x,i.y),t.beginPath(),t.rect(0,0,i.width,i.height),t.clip(),this.leftPane.render(t),t.restore()),this.rightPane&&typeof this.rightPane.render=="function"&&(t.save(),t.translate(s.x,s.y),t.beginPath(),t.rect(0,0,s.width,s.height),t.clip(),this.rightPane.render(t),t.restore())}renderSplitter(t,e){const i=this.getSplitterBounds();let s=e.border;this.isResizing?s=e.borderActive:this.isHovering&&(s=e.hover),t.fillStyle=s,t.fillRect(i.x,i.y,i.width,i.height);const a=e.textSecondary;if(t.fillStyle=a,this.orientation==="horizontal"){const h=i.x+i.width/2,o=i.y+i.height/2;for(let l=-2;l<=2;l++){const r=o+l*f.TREE_GRIP_SPACING;t.fillRect(h-1,r-1,2,2),(this.isHovering||this.isResizing)&&(t.fillRect(h-f.TREE_GRIP_SIZE,r-1,1,2),t.fillRect(h+2,r-1,1,2))}}else{const h=i.x+i.width/2,o=i.y+i.height/2;for(let l=-2;l<=2;l++){const r=h+l*f.TREE_GRIP_SPACING;t.fillRect(r-1,o-1,2,2),(this.isHovering||this.isResizing)&&(t.fillRect(r-1,o-f.TREE_GRIP_SIZE,2,1),t.fillRect(r-1,o+2,2,1))}}}renderFocusIndicator(t,e){const i=this.getSplitterBounds();t.strokeStyle=e.focus,t.lineWidth=2,t.setLineDash([f.TREE_DASH_SIZE,f.TREE_DASH_SIZE]),t.strokeRect(i.x-2,i.y-2,i.width+f.TREE_SELECTION_PADDING,i.height+f.TREE_SELECTION_PADDING),t.setLineDash([])}announceChange(t){this.announcer&&(this.announcer.textContent=t)}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}clearRenderCache(){this.renderCache.clear(),this.invalidate()}throttle(t,e){let i;return function(...a){const h=()=>{clearTimeout(i),t(...a)};clearTimeout(i),i=setTimeout(h,e)}}reset(){this.split=.5,this.animatedSplit=.5,this.collapsed=null,this.isResizing=!1,this.isHovering=!1,this.isFocused=!1,this.animationState.splitTransition=null,this.animationState.collapseAnimation=null,y.cancelAllAnimations(),this.updateAccessibility(),this.clearRenderCache(),this.announceChange("Split pane reset"),this.emit("reset")}destroy(){this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.animationState.splitTransition=null,this.animationState.collapseAnimation=null,y.cancelAllAnimations(),this.renderCache.clear(),document.body.style.cursor="default",super.destroy()}setLeftPane(t){this.leftPane=t,this.clearRenderCache(),this.emit("paneChanged",{pane:"left",content:t})}setRightPane(t){this.rightPane=t,this.clearRenderCache(),this.emit("paneChanged",{pane:"right",content:t})}getSplit(){return this.split}isCollapsed(){return this.collapsed}setOrientation(t){["horizontal","vertical"].includes(t)&&t!==this.orientation&&(this.orientation=t,this.setAttribute("aria-orientation",t),this.clearRenderCache(),this.emit("orientationChanged",{orientation:t}))}setTheme(t){this.theme=t,this.clearRenderCache(),this.emit("themeChanged",{theme:t})}}class Ft extends C{constructor(t={}){super({...t,width:t.width||f.TREE_VIEW_DEFAULT_WIDTH,height:t.height||f.TREE_VIEW_DEFAULT_HEIGHT,ariaRole:"tree",ariaLabel:t.ariaLabel||"Tree View"}),this.validateOptions(t),this.data=t.data||[],this.selectedNode=t.selectedNode||null,this.expandedNodes=new Set(t.expandedNodes||[]),this.multiSelect=t.multiSelect||!1,this.selectedNodes=new Set,this.disabled=t.disabled||!1,this.showLines=t.showLines!==!1,this.showIcons=t.showIcons!==!1,this.indentSize=t.indentSize||f.TREE_INDENT_SIZE,this.nodeHeight=t.nodeHeight||f.TREE_NODE_HEIGHT,this.theme=t.theme||X.getCurrentTheme(),this.hoveredNode=null,this.focusedNode=null,this.draggedNode=null,this.dropTarget=null,this.animatingNodes=new Set,this.scrollPosition={x:0,y:0},this.animationState={expandAnimations:new Map,collapseAnimations:new Map},this.renderCache=new Map,this.virtualizedItems=[],this.visibleRange={start:0,end:0},this.throttledRender=this.throttle(this.render.bind(this),K.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler(),this.performanceMonitor=$.createInstance("TreeView");try{this.setupNodes(),this.setupEventHandlers(),this.setupAccessibility(),this.updateVirtualization()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.data&&!Array.isArray(t.data))throw new H("data must be an array","TreeView");if(t.indentSize&&(typeof t.indentSize!="number"||t.indentSize<0))throw new H("indentSize must be a non-negative number","TreeView");if(t.nodeHeight&&(typeof t.nodeHeight!="number"||t.nodeHeight<f.TREE_MIN_NODE_HEIGHT))throw new H("nodeHeight must be at least 16 pixels","TreeView")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowUp:()=>this.navigateNode(-1),ArrowDown:()=>this.navigateNode(1),ArrowLeft:()=>this.collapseOrNavigateUp(),ArrowRight:()=>this.expandOrNavigateDown(),Home:()=>this.navigateToNode("first"),End:()=>this.navigateToNode("last"),Enter:()=>this.activateFocusedNode(),Space:()=>this.toggleFocusedNode(),Escape:()=>this.handleEscape(),"*":()=>this.expandAll()}}createErrorHandler(){return{handle:(t,e)=>{const i=new H(t.message||"Unknown error","TreeView",{context:e,originalError:t});x.error("TreeView Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"node-management":this.validateNodeState();break;case"animation":this.animationState.expandAnimations.clear(),this.animationState.collapseAnimations.clear(),this.animatingNodes.clear(),y.cancelAllAnimations();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","tree"),this.setAttribute("aria-multiselectable",this.multiSelect.toString()),this.setAttribute("aria-activedescendant",""),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupNodes(){try{this.data=this.normalizeNodes(this.data),this.updateVirtualization(),this.validateNodeState()}catch(t){this.errorHandler.handle(t,"node-setup")}}normalizeNodes(t,e=null,i=0){return t.map((s,a)=>{const h={id:s.id||`node-${i}-${a}`,label:s.label||s.text||`Node ${a+1}`,children:s.children||[],parent:e,level:i,expanded:this.expandedNodes.has(s.id),selected:this.selectedNodes.has(s.id),disabled:s.disabled||!1,icon:s.icon||null,data:s.data||{},...s};return h.children.length>0&&(h.children=this.normalizeNodes(h.children,h,i+1)),h})}validateNodeState(){this.selectedNode&&!this.findNodeById(this.selectedNode)&&(this.selectedNode=null);const t=new Set;for(const e of this.selectedNodes)this.findNodeById(e)&&t.add(e);this.selectedNodes=t,this.focusedNode&&!this.findNodeById(this.focusedNode)&&(this.focusedNode=null)}setupEventHandlers(){const t={click:this.handleClick.bind(this),mouseMove:this.handleMouseMove.bind(this),keyDown:this.handleKeyDown.bind(this),wheel:this.handleWheel.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}buildVisibleNodes(){this.visibleNodes=[],this.buildVisibleNodesRecursive(this.data,0)}buildVisibleNodesRecursive(t,e){for(const i of t){const s=i.id||`node-${e}-${this.visibleNodes.length}`;this.visibleNodes.push({...i,level:e,id:s}),i.children&&this.expandedNodes.has(s)&&this.buildVisibleNodesRecursive(i.children,e+1)}}getNodeAtPosition(t){const e=t+this.scrollY,i=Math.floor(e/this.nodeHeight);return i>=0&&i<this.visibleNodes.length?{node:this.visibleNodes[i],index:i}:null}toggleNode(t){this.expandedNodes.has(t)?this.collapseNode(t):this.expandNode(t)}selectNode(t,e=!1){this.multiSelect&&e?this.selectedNodes.has(t)?this.selectedNodes.delete(t):this.selectedNodes.add(t):(this.selectedNodes.clear(),this.selectedNodes.add(t),this.selectedNode=t),this.emit("nodeSelected",{nodeId:t,selectedNodes:Array.from(this.selectedNodes)})}findNode(t,e=this.data){for(const i of e){if(i.id===t)return i;if(i.children){const s=this.findNode(t,i.children);if(s)return s}}return null}handleClick(t){const{localY:e}=t,i=this.getNodeAtPosition(e);if(i){const{node:s}=i,a=s.level*this.indentSize;s.children&&t.localX>=a&&t.localX<=a+f.TREE_EXPAND_AREA_SIZE?this.toggleNode(s.id):this.selectNode(s.id,t.ctrlKey||t.metaKey)}}handleMouseMove(t){const e=this.getNodeAtPosition(t.localY);this.hoveredNode=e?e.node.id:null}handleWheel(t){const e=Math.max(0,this.visibleNodes.length*this.nodeHeight-this.height);this.scrollY=Math.max(0,Math.min(e,this.scrollY+t.deltaY))}navigateNode(t){if(!this.visibleNodes.length)return;let e=this.focusedNode?this.visibleNodes.findIndex(s=>s.id===this.focusedNode):-1;e===-1?e=0:e=Math.max(0,Math.min(this.visibleNodes.length-1,e+t));const i=this.visibleNodes[e];this.setFocusedNode(i.id),this.scrollToNode(i.id),this.announceChange(`Focused: ${i.label}`)}navigateToNode(t){if(!this.visibleNodes.length)return;let e;switch(t){case"first":e=0;break;case"last":e=this.visibleNodes.length-1;break;default:return}const i=this.visibleNodes[e];this.setFocusedNode(i.id),this.scrollToNode(i.id),this.announceChange(`Moved to ${t}: ${i.label}`)}collapseOrNavigateUp(){const t=this.findNodeById(this.focusedNode);t&&(t.children&&t.children.length>0&&this.expandedNodes.has(t.id)?(this.collapseNode(t.id),this.announceChange(`Collapsed: ${t.label}`)):t.parent&&(this.setFocusedNode(t.parent.id),this.scrollToNode(t.parent.id),this.announceChange(`Moved to parent: ${t.parent.label}`)))}expandOrNavigateDown(){const t=this.findNodeById(this.focusedNode);if(t&&t.children&&t.children.length>0)if(!this.expandedNodes.has(t.id))this.expandNode(t.id),this.announceChange(`Expanded: ${t.label}`);else{const e=t.children[0];e&&(this.setFocusedNode(e.id),this.scrollToNode(e.id),this.announceChange(`Moved to child: ${e.label}`))}}activateFocusedNode(){this.focusedNode&&(this.selectNode(this.focusedNode),this.emit("nodeActivated",{nodeId:this.focusedNode}))}toggleFocusedNode(){this.focusedNode&&this.toggleNode(this.focusedNode)}handleEscape(){this.selectedNodes.clear(),this.selectedNode=null,this.updateAccessibility(),this.announceChange("Selection cleared"),this.emit("selectionCleared")}setFocusedNode(t){this.focusedNode=t,this.setAttribute("aria-activedescendant",t||""),this.invalidate()}scrollToNode(t){const e=this.visibleNodes.findIndex(h=>h.id===t);if(e===-1)return;const i=e*this.nodeHeight,s=this.scrollY,a=this.scrollY+this.height;i<s?this.scrollY=i:i+this.nodeHeight>a&&(this.scrollY=i+this.nodeHeight-this.height),this.invalidate()}expandNode(t,e=!0){const i=this.findNodeById(t);!i||!i.children||i.children.length===0||(this.expandedNodes.add(t),e&&!this.prefersReducedMotion()?this.animateNodeExpansion(t):this.updateVirtualization(),this.emit("nodeExpanded",{nodeId:t,node:i}))}collapseNode(t,e=!0){const i=this.findNodeById(t);i&&(this.expandedNodes.delete(t),this.clearChildSelections(i),e&&!this.prefersReducedMotion()?this.animateNodeCollapse(t):this.updateVirtualization(),this.emit("nodeCollapsed",{nodeId:t,node:i}))}clearChildSelections(t){const e=i=>{for(const s of i)this.selectedNodes.delete(s.id),s.children&&e(s.children)};t.children&&e(t.children)}animateNodeExpansion(t){if(this.animatingNodes.has(t))return;this.animatingNodes.add(t);const e=y.animate({duration:300,easing:"easeOutCubic",onUpdate:i=>{this.invalidate()},onComplete:()=>{this.animatingNodes.delete(t),this.updateVirtualization(),this.invalidate()}});this.animationState.expandAnimations.set(t,e)}animateNodeCollapse(t){if(this.animatingNodes.has(t))return;this.animatingNodes.add(t);const e=y.animate({duration:300,easing:"easeInCubic",onUpdate:i=>{this.invalidate()},onComplete:()=>{this.animatingNodes.delete(t),this.updateVirtualization(),this.invalidate()}});this.animationState.collapseAnimations.set(t,e)}updateVirtualization(){this.buildVisibleNodes(),this.updateVisibleRange(),this.clearRenderCache()}updateVisibleRange(){const e=Math.max(0,Math.floor(this.scrollY/this.nodeHeight)-5),i=Math.min(this.visibleNodes.length-1,Math.ceil((this.scrollY+this.height)/this.nodeHeight)+5);this.visibleRange={start:e,end:i}}findNodeById(t,e=this.data){for(const i of e){if(i.id===t)return i;if(i.children){const s=this.findNodeById(t,i.children);if(s)return s}}return null}handleFocusIn(){this.isFocused=!0,!this.focusedNode&&this.visibleNodes.length>0&&this.setFocusedNode(this.visibleNodes[0].id),this.invalidate()}handleFocusOut(){this.isFocused=!1,this.invalidate()}handleFocus(){this.handleFocusIn()}handleBlur(){this.handleFocusOut()}renderSelf(t){const e=this.performanceMonitor.startOperation("render");try{if(t.type!=="canvas")return;const i=this.theme.getColors();t.fillStyle=i.background,t.fillRect(0,0,this.width,this.height),this.updateVisibleRange(),t.save(),t.beginPath(),t.rect(0,0,this.width,this.height),t.clip();for(let s=this.visibleRange.start;s<=this.visibleRange.end;s++)if(s>=0&&s<this.visibleNodes.length){const a=this.visibleNodes[s],h=s*this.nodeHeight-this.scrollY;h+this.nodeHeight>=0&&h<=this.height&&this.renderNode(t,a,h,i)}t.restore(),this.needsScrollbar()&&this.renderScrollbar(t,i),this.isFocused&&this.focusedNode&&this.renderFocusIndicator(t,i)}catch(i){this.errorHandler.handle(i,"render")}finally{this.performanceMonitor.endOperation("render",e)}}renderNode(t,e,i,s){const a=`${e.id}-${i}-${e.selected}-${e.expanded}-${this.hoveredNode===e.id}`;if(this.renderCache.has(a))return;const h=e.level*this.indentSize,o=this.selectedNodes.has(e.id),l=this.hoveredNode===e.id,r=this.focusedNode===e.id;o?(t.fillStyle=s.primary,t.globalAlpha=.2,t.fillRect(0,i,this.width,this.nodeHeight),t.globalAlpha=1):l&&(t.fillStyle=s.surface,t.fillRect(0,i,this.width,this.nodeHeight)),this.showLines&&this.renderConnectionLines(t,e,h,i,s),e.children&&e.children.length>0&&this.renderExpandIcon(t,e,h,i,s);let E=h+f.TREE_TEXT_OFFSET;this.showIcons&&e.icon&&(E=this.renderNodeIcon(t,e,E,i,s)),this.renderNodeText(t,e,E,i,s,o),r&&this.renderNodeFocusIndicator(t,i,s),this.renderCache.set(a,!0)}renderConnectionLines(t,e,i,s,a){t.strokeStyle=a.border,t.lineWidth=1,t.setLineDash([2,2]),e.level>0&&(t.beginPath(),t.moveTo(i-10,s),t.lineTo(i-10,s+this.nodeHeight/2),t.stroke(),t.beginPath(),t.moveTo(i-10,s+this.nodeHeight/2),t.lineTo(i,s+this.nodeHeight/2),t.stroke()),t.setLineDash([])}renderExpandIcon(t,e,i,s,a){const h=i+f.TREE_ICON_OFFSET,o=s+this.nodeHeight/2,l=this.expandedNodes.has(e.id);t.fillStyle=a.text,t.font="10px Arial",t.textAlign="center",t.textBaseline="middle";const r=l?"▼":"▶";t.fillText(r,h,o)}renderNodeIcon(t,e,i,s,a){return t.fillStyle=a.text,t.font="14px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText(e.icon,i,s+this.nodeHeight/2),i+f.TREE_TEXT_OFFSET}renderNodeText(t,e,i,s,a,h){t.fillStyle=h?a.primaryText:a.text,t.font=`${h?"bold ":""}13px Arial`,t.textAlign="left",t.textBaseline="middle";const o=this.width-i-10;let l=e.label||e.title||e.name||e.id;if(t.measureText(l).width>o){for(;l.length>0&&t.measureText(`${l}...`).width>o;)l=l.slice(0,-1);l+="..."}t.fillText(l,i,s+this.nodeHeight/2)}renderNodeFocusIndicator(t,e,i){t.strokeStyle=i.focus,t.lineWidth=2,t.setLineDash([2,2]),t.strokeRect(2,e+1,this.width-f.TREE_FOCUS_BORDER_OFFSET,this.nodeHeight-2),t.setLineDash([])}renderFocusIndicator(t,e){if(!this.focusedNode)return;const i=this.visibleNodes.findIndex(a=>a.id===this.focusedNode);if(i===-1)return;const s=i*this.nodeHeight-this.scrollY;this.renderNodeFocusIndicator(t,s,e)}needsScrollbar(){return this.visibleNodes.length*this.nodeHeight>this.height}renderScrollbar(t,e){const s=this.width-8;t.fillStyle=e.surface,t.fillRect(s,0,8,this.height);const a=this.visibleNodes.length*this.nodeHeight,h=Math.max(f.TREE_SCROLLBAR_MIN_HEIGHT,this.height/a*this.height),o=a-this.height,l=o>0?this.scrollY/o*(this.height-h):0;t.fillStyle=e.primary,t.globalAlpha=.6,t.fillRect(s+1,l,6,h),t.globalAlpha=1}handleKeyDown(t){if(this.disabled)return;const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),t.stopPropagation(),e())}updateAccessibility(){this.setAttribute("aria-multiselectable",this.multiSelect.toString()),this.setAttribute("aria-disabled",this.disabled.toString()),this.focusedNode?this.setAttribute("aria-activedescendant",this.focusedNode):this.removeAttribute("aria-activedescendant")}announceChange(t){this.announcer&&(this.announcer.textContent=t)}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}clearRenderCache(){this.renderCache.clear(),this.invalidate()}throttle(t,e){let i;return function(...a){const h=()=>{clearTimeout(i),t(...a)};clearTimeout(i),i=setTimeout(h,e)}}reset(){this.selectedNodes.clear(),this.selectedNode=null,this.focusedNode=null,this.hoveredNode=null,this.scrollY=0,this.scrollX=0,this.animationState.expandAnimations.clear(),this.animationState.collapseAnimations.clear(),this.animatingNodes.clear(),y.cancelAllAnimations(),this.updateAccessibility(),this.clearRenderCache(),this.announceChange("Tree view reset"),this.emit("reset")}destroy(){this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.animationState.expandAnimations.clear(),this.animationState.collapseAnimations.clear(),y.cancelAllAnimations(),this.renderCache.clear(),super.destroy()}setData(t){this.data=Array.isArray(t)?t:[],this.setupNodes(),this.announceChange(`Tree updated with ${this.visibleNodes.length} items`),this.emit("dataChanged",{data:this.data})}getSelectedNodes(){return Array.from(this.selectedNodes).map(t=>this.findNodeById(t)).filter(Boolean)}setSelectedNodes(t){if(this.selectedNodes.clear(),Array.isArray(t))for(const e of t)this.findNodeById(e)&&this.selectedNodes.add(e);this.selectedNode=this.selectedNodes.size>0?Array.from(this.selectedNodes)[0]:null,this.updateAccessibility(),this.invalidate(),this.emit("selectionChanged",{selectedNodes:this.getSelectedNodes()})}expandAll(){const t=e=>{for(const i of e)i.children&&i.children.length>0&&(this.expandedNodes.add(i.id),t(i.children))};t(this.data),this.updateVirtualization(),this.announceChange("All nodes expanded"),this.emit("allExpanded")}collapseAll(){this.expandedNodes.clear(),this.updateVirtualization(),this.announceChange("All nodes collapsed"),this.emit("allCollapsed")}setTheme(t){this.theme=t,this.clearRenderCache(),this.emit("themeChanged",{theme:t})}setMultiSelect(t){if(this.multiSelect=t,this.updateAccessibility(),!t&&this.selectedNodes.size>1){const e=Array.from(this.selectedNodes)[0];this.selectedNodes.clear(),e&&(this.selectedNodes.add(e),this.selectedNode=e)}this.invalidate(),this.emit("multiSelectChanged",{enabled:t})}}class vt extends C{constructor(t={}){super({...t,width:t.width||f.FILE_UPLOAD_DEFAULT_WIDTH,height:t.height||f.FILE_UPLOAD_DEFAULT_HEIGHT,ariaRole:"button",ariaLabel:t.ariaLabel||"File Upload Area"}),this.validateOptions(t),this.multiple=t.multiple||!1,this.accept=t.accept||"*/*",this.maxFileSize=t.maxFileSize||f.FILE_UPLOAD_MAX_SIZE_MB*f.FILE_UPLOAD_BYTES_PER_KB*f.FILE_UPLOAD_BYTES_PER_KB,this.maxFiles=t.maxFiles||(this.multiple?10:1),this.disabled=t.disabled||!1,this.allowDirectories=t.allowDirectories||!1,this.theme=t.theme||X.getCurrentTheme(),this.uploadText=t.uploadText||"Drop files here or click to upload",this.browseText=t.browseText||"Browse Files",this.errorMessages={fileSize:"File size exceeds maximum allowed size",fileType:"File type is not supported",maxFiles:"Maximum number of files exceeded",...t.errorMessages},this.files=[],this.isDragOver=!1,this.isUploading=!1,this.uploadProgress=new Map,this.totalProgress=0,this.errors=new Map,this.completedUploads=new Set,this.animationState={dragAnimation:null,progressAnimations:new Map},this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),K.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler(),this.performanceMonitor=$.createInstance("FileUpload");try{this.setupEventHandlers(),this.setupAccessibility(),this.setupFileInput()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.maxFileSize&&(typeof t.maxFileSize!="number"||t.maxFileSize<=0))throw new H("maxFileSize must be a positive number","FileUpload");if(t.maxFiles&&(typeof t.maxFiles!="number"||t.maxFiles<1))throw new H("maxFiles must be at least 1","FileUpload")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{Enter:()=>this.triggerFileSelect(),Space:()=>this.triggerFileSelect(),Escape:()=>this.handleEscape()}}createErrorHandler(){return{handle:(t,e)=>{const i=new H(t.message||"Unknown error","FileUpload",{context:e,originalError:t});x.error("FileUpload Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"file-validation":this.clearErrors();break;case"upload":this.isUploading=!1,this.uploadProgress.clear();break;case"animation":this.animationState.dragAnimation=null,this.animationState.progressAnimations.clear(),y.cancelAllAnimations();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","button"),this.setAttribute("aria-label",this.multiple?"Upload multiple files":"Upload file"),this.setAttribute("aria-describedby",this.uploadText),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupFileInput(){this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.multiple,this.fileInput.accept=this.accept,this.allowDirectories&&(this.fileInput.webkitdirectory=!0),this.fileInput.style.display="none",this.fileInput.addEventListener("change",t=>{this.handleFileInputChange(t)}),document.body.appendChild(this.fileInput)}setupEventHandlers(){this.on("click",t=>this.handleClick(t)),this.on("dragEnter",t=>this.handleDragEnter(t)),this.on("dragOver",t=>this.handleDragOver(t)),this.on("dragLeave",t=>this.handleDragLeave(t)),this.on("drop",t=>this.handleDrop(t))}addFiles(t){const e=Array.from(t),i=e.filter(s=>this.validateFile(s));this.multiple?this.files=[...this.files,...i].slice(0,this.maxFiles):this.files=i.slice(0,1),this.emit("filesAdded",{files:i}),i.length!==e.length&&this.emit("filesRejected",{rejected:e.filter(s=>!this.validateFile(s))})}validateFile(t){return!(t.size>this.maxFileSize||this.accept!=="*/*"&&!this.accept.split(",").map(s=>s.trim()).some(s=>s.startsWith(".")?t.name.toLowerCase().endsWith(s.toLowerCase()):t.type===s||t.type.startsWith(s.replace("*",""))))}removeFile(t){if(t>=0&&t<this.files.length){const e=this.files.splice(t,1)[0];this.emit("fileRemoved",{file:e,index:t})}}clearFiles(){this.files=[],this.emit("filesCleared")}startUpload(){this.files.length===0||this.isUploading||(this.isUploading=!0,this.uploadProgress=0,this.emit("uploadStarted",{files:this.files}),this.simulateUpload())}simulateUpload(){const t=setInterval(()=>{this.uploadProgress+=Math.random()*f.FILE_UPLOAD_PROGRESS_INCREMENT,this.uploadProgress>=1?(this.uploadProgress=1,this.isUploading=!1,clearInterval(t),this.emit("uploadCompleted",{files:this.files})):this.emit("uploadProgress",{progress:this.uploadProgress})},100)}handleClick(t){this.disabled||this.emit("browseRequested")}handleDragEnter(t){this.disabled||(t.preventDefault?.(),this.isDragOver=!0)}handleDragOver(t){this.disabled||(t.preventDefault?.(),this.isDragOver=!0)}handleDragLeave(t){this.disabled||(this.isDragOver=!1)}handleDrop(t){this.disabled||(t.preventDefault?.(),this.isDragOver=!1,t.dataTransfer?.files&&this.addFiles(t.dataTransfer.files))}renderSelf(t){if(t.type!=="canvas")return;let{backgroundColor:e}=this;this.isDragOver?e=this.dragOverColor:this.disabled&&(e="#f8f9fa"),t.fillStyle=e,t.fillRect(0,0,this.width,this.height),t.strokeStyle=this.isDragOver?"#007bff":this.borderColor,t.lineWidth=this.isDragOver?2:1,t.setLineDash(this.isDragOver?[f.FILE_UPLOAD_DASH_SIZE,f.FILE_UPLOAD_DASH_SIZE]:[]),t.strokeRect(0,0,this.width,this.height),t.setLineDash([]),this.files.length===0?this.renderEmptyState(t):this.renderFileList(t),this.isUploading&&this.renderUploadProgress(t)}renderEmptyState(t){const e=this.width/2,i=this.height/2;if(t.fillStyle=this.iconColor,t.font="48px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("📁",e,i-f.FILE_UPLOAD_ICON_Y_OFFSET),t.fillStyle=this.disabled?"#999999":this.textColor,t.font="14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.uploadText,e,i+10),!this.disabled){const h=e-60,o=i+f.FILE_UPLOAD_BUTTON_Y_OFFSET;t.fillStyle="#007bff",t.fillRect(h,o,120,32),t.fillStyle="#ffffff",t.font="12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.browseText,e,o+32/2)}}renderFileList(t){t.fillStyle=this.textColor,t.font="12px Arial",t.textAlign="left",t.textBaseline="middle",this.files.forEach((s,a)=>{const h=10+a*30;t.fillText("📄",10,h+30/2),t.fillText(s.name,f.FILE_UPLOAD_FILE_NAME_X,h+30/2);const o=this.formatFileSize(s.size);t.fillStyle="#666666",t.textAlign="right",t.fillText(o,this.width-f.FILE_UPLOAD_SIZE_TEXT_OFFSET,h+30/2),t.fillStyle="#dc3545",t.textAlign="center",t.fillText("×",this.width-f.FILE_UPLOAD_REMOVE_BUTTON_OFFSET,h+30/2),t.fillStyle=this.textColor,t.textAlign="left"})}renderUploadProgress(t){const i=this.height-4-10;t.fillStyle="#e9ecef",t.fillRect(10,i,this.width-f.FILE_UPLOAD_PROGRESS_MARGIN,4),t.fillStyle="#007bff",t.fillRect(10,i,(this.width-f.FILE_UPLOAD_PROGRESS_MARGIN)*this.uploadProgress,4),t.fillStyle=this.textColor,t.font="11px Arial",t.textAlign="center",t.textBaseline="bottom",t.fillText(`Uploading... ${Math.round(this.uploadProgress*100)}%`,this.width/2,i-f.FILE_UPLOAD_PROGRESS_TEXT_Y_OFFSET)}formatFileSize(t){if(t===0)return"0 B";const e=1024,i=["B","KB","MB","GB"],s=Math.floor(Math.log(t)/Math.log(e));return`${parseFloat((t/Math.pow(e,s)).toFixed(1))} ${i[s]}`}getFiles(){return[...this.files]}hasFiles(){return this.files.length>0}getErrors(){return new Map(this.errors)}setMultiple(t){this.multiple=t,this.fileInput&&(this.fileInput.multiple=t),this.setAttribute("aria-label",t?"Upload multiple files":"Upload file")}setAccept(t){this.accept=t,this.fileInput&&(this.fileInput.accept=t)}setMaxFileSize(t){this.maxFileSize=t}getUploadProgress(){return this.totalProgress}setTheme(t){this.theme=t,this.clearRenderCache(),this.emit("themeChanged",{theme:t})}}/**
 * Input and Utility Components - Modern Implementation
 * Advanced implementation of ColorPicker, DateTimePicker, NumberInput, Accordion, Drawer, and SearchBox
 * with accessibility, performance optimization, error handling, and modern features
 *
 * Features:
 * - Full ARIA accessibility support
 * - Dark mode and theme adaptation
 * - Performance monitoring and optimization
 * - Error handling and validation
 * - Animation management
 * - Memory cleanup
 * - Keyboard navigation
 * - Touch/gesture support
 * - RTL language support
 *
 * @version 2.0.0
 * @author SimulateAI Team
 * @license Apache-2.0
 */const n={MEMORY_WARNING_MB:50,BYTES_PER_KB:1024,DEFAULT_COLOR_PICKER_WIDTH:280,DEFAULT_COLOR_PICKER_HEIGHT:320,HUE_ADJUSTMENT_STEP:5,SATURATION_ADJUSTMENT_STEP:5,LIGHTNESS_ADJUSTMENT_STEP:5,HEX_COLOR_LENGTH:6,HEX_BLUE_OFFSET:4,RGB_CHANNEL_COUNT:3,RGB_MAX_VALUE:255,HUE_MAX_DEGREES:360,SATURATION_MAX_PERCENT:100,LIGHTNESS_MAX_PERCENT:100,HUE_SECTOR_COUNT:6,HUE_THIRD:3,HSL_MIDPOINT:.5,HUE_BLUE_OFFSET:4,DEGREES_TO_RADIANS_FACTOR:180,HSL_DIVISOR_SIX:6,HSL_DIVISOR_THREE:3,HSL_DIVISOR_TWO:2,HEX_BASE:16,SATURATION_THRESHOLD_LOW:10,LIGHTNESS_THRESHOLD_HIGH:90,LIGHTNESS_THRESHOLD_LOW:10,HUE_RED_MIN:345,HUE_RED_MAX:15,HUE_ORANGE_MAX:45,HUE_YELLOW_MAX:75,HUE_GREEN_MAX:165,HUE_CYAN_MAX:195,HUE_BLUE_MAX:255,HUE_PURPLE_MAX:285,HUE_MAGENTA_MAX:315,EASE_THRESHOLD:.5,EASE_MULTIPLIER:2,EASE_NEGATIVE_MULTIPLIER:-2,DEFAULT_ACCORDION_WIDTH:400,DEFAULT_ACCORDION_HEIGHT:300,DEFAULT_HEADER_HEIGHT:40,DEFAULT_ANIMATION_DURATION:300,FIRST_ITEM_INDEX:0,NO_FOCUSED_ITEM:-1,COLOR_WHEEL_Y_START:50,COLOR_WHEEL_Y_END:200,COLOR_WHEEL_CENTER_Y:125,COLOR_WHEEL_RADIUS:80,LIGHTNESS_SLIDER_Y:220,ALPHA_SLIDER_Y:250,SLIDER_HEIGHT:20,SLIDER_MARGIN:20,LIGHTNESS_SLIDER_Y_MIN:220,LIGHTNESS_SLIDER_Y_MAX:240,ALPHA_SLIDER_Y_MIN:250,ALPHA_SLIDER_Y_MAX:270,PRESET_Y:280,PRESET_HEIGHT:20,CURRENT_COLOR_HEIGHT:20,CURRENT_COLOR_MARGIN_BOTTOM:40,FOCUS_INDICATOR_OFFSET:2,FOCUS_INDICATOR_BORDER:4,CLOSE_TIMEOUT:150,WHEEL_STEP_DELTA:5,WHEEL_STEP_DELTA_NEGATIVE:-5,COLOR_WHEEL_LIGHTNESS_DEFAULT:50,COLOR_INDICATOR_RADIUS:6,COLOR_INDICATOR_CENTER_RADIUS:3,RGBA_CHANNELS:4,ALPHA_CHANNEL_OFFSET:3,INDICATOR_HEIGHT_OFFSET:8,SLIDER_START_MARGIN:20,SLIDER_INDICATOR_WIDTH:8,SLIDER_INDICATOR_OFFSET:4,PRESET_BORDER_OFFSET:1,PRESET_BORDER_SIZE:3,PRESET_BORDER_HEIGHT:2,PRESET_NAME_LENGTH:3,COLOR_DISPLAY_MARGIN:40,INSTRUCTION_MARGIN:5,INSTRUCTION_LINE_HEIGHT:12,ACCORDION_PADDING:24,ACCORDION_MIN_HEIGHT:60,ACCORDION_ICON_MARGIN:12,ACCORDION_ICON_SIZE:20,ACCORDION_TEXT_MARGIN:12,ACCORDION_CONTENT_PADDING:12,ACCORDION_LINE_HEIGHT:16,EASE_IN_OUT_THRESHOLD:.5,EASE_IN_OUT_MULTIPLIER:4,DATETIMEPICKER_DEFAULT_WIDTH:320,DATETIMEPICKER_DEFAULT_HEIGHT:280,DATETIMEPICKER_HEADER_HEIGHT:40,DATETIMEPICKER_NAV_BUTTON_SIZE:40,DATETIMEPICKER_TIME_BUTTON_WIDTH:80,DATETIMEPICKER_CALENDAR_TOP_OFFSET:70,DAYS_PER_WEEK:7,MONTHS_PER_YEAR:12,HOURS_IN_12_FORMAT:12,MINUTES_PER_HOUR:60,TIME_SELECTOR_RADIUS_FACTOR:.6,ACCORDION_STROKE_OFFSET:2,ACCORDION_STROKE_BORDER:4,DATETIMEPICKER_HEADER_RENDER_HEIGHT:40,DATETIMEPICKER_TEXT_MARGIN:12,DATETIMEPICKER_ICON_MARGIN:20,DATETIMEPICKER_TIME_BUTTON_LABEL_OFFSET:50,DATETIMEPICKER_DAY_LABEL_Y:55,DATETIMEPICKER_LINE_Y:65,DATETIMEPICKER_CELL_MARGIN:2,DATETIMEPICKER_CELL_BORDER:4,DATETIMEPICKER_INSTRUCTION_MARGIN:5,DATETIMEPICKER_INSTRUCTION_OFFSET:45,DATETIMEPICKER_INSTRUCTION_LINE_HEIGHT:12,DATETIMEPICKER_CENTER_OFFSET:20,DATETIMEPICKER_HOUR_ANGLE_DEGREES:30,DATETIMEPICKER_START_ANGLE_DEGREES:90,DATETIMEPICKER_DEGREES_TO_RADIANS:180,DATETIMEPICKER_HOUR_TICK_OUTER:15,DATETIMEPICKER_HOUR_TICK_INNER:8,DATETIMEPICKER_DISABLED_OVERLAY_HEIGHT:40,DATETIMEPICKER_FOCUS_STROKE_WIDTH:2,DATETIMEPICKER_FOCUS_STROKE_OFFSET:2,DATETIMEPICKER_FOCUS_STROKE_BORDER:4,DATETIMEPICKER_FOCUS_STROKE_HEIGHT:36,CALENDAR_GRID_COLUMNS:7,CALENDAR_CELL_PADDING:2,CALENDAR_CELL_BORDER:4,CALENDAR_INSTRUCTION_Y_OFFSET:5,CALENDAR_INSTRUCTION_Y_BASE:45,CALENDAR_INSTRUCTION_LINE_SPACING:12,CLOCK_HOURS_COUNT:12,CLOCK_MINUTES_COUNT:60,CLOCK_MINUTE_STEP:5,CLOCK_HOUR_ANGLE_STEP:30,CLOCK_START_ANGLE_OFFSET:90,CLOCK_ANGLE_TO_RADIANS:180,CLOCK_MAJOR_TICK_OUTER:15,CLOCK_MAJOR_TICK_INNER:8,CLOCK_HOUR_TEXT_RADIUS:25,CLOCK_MAJOR_TICK_MODULO:3,CLOCK_MAJOR_TICK_WIDTH:3,CLOCK_MINOR_TICK_WIDTH:1,CLOCK_TWELVE_HOUR_DISPLAY:12,CLOCK_QUARTER_HOUR_MINUTES:15,CLOCK_MINUTE_ANGLE_STEP:6,CLOCK_MINOR_TICK_OUTER:10,CLOCK_MINOR_TICK_INNER:5,CLOCK_HOUR_HAND_RADIUS_FACTOR:.5,CLOCK_MINUTE_HAND_RADIUS_FACTOR:.8,CLOCK_HOUR_INDICATOR_RADIUS:8,CLOCK_MINUTE_INDICATOR_RADIUS:6,CLOCK_CENTER_DOT_RADIUS:4,DIGITAL_TIME_WIDTH:120,DIGITAL_TIME_HEIGHT:30,DIGITAL_TIME_OFFSET_X:60,DIGITAL_TIME_OFFSET_Y:50,DIGITAL_TIME_TEXT_Y:35,TIME_INSTRUCTION_MARGIN:5,TIME_INSTRUCTION_LINE_HEIGHT:12,NUMBER_INPUT_DEFAULT_WIDTH:150,NUMBER_INPUT_DEFAULT_HEIGHT:40,NUMBER_INPUT_CONTROL_WIDTH:20,NUMBER_INPUT_TEXT_MARGIN:8,NUMBER_INPUT_CURSOR_OFFSET:2,NUMBER_INPUT_CURSOR_MARGIN:8,NUMBER_INPUT_BLINK_INTERVAL:500,NUMBER_INPUT_QUARTER_HEIGHT:4,NUMBER_INPUT_THREE_QUARTER_HEIGHT:3,NUMBER_INPUT_REPEAT_INITIAL_DELAY:500,NUMBER_INPUT_REPEAT_INTERVAL:150,NUMBER_INPUT_FOCUS_BORDER:4,ACCORDION_DEFAULT_WIDTH:300,ACCORDION_DEFAULT_HEIGHT:600,TOOLTIP_OFFSET_DISTANCE:3,CLOSE_BUTTON_SIZE:30,CLOSE_BUTTON_RADIUS:12,TOOLTIP_HEADER_HEIGHT:50,TOOLTIP_CONTENT_LINE_HEIGHT:20,TOOLTIP_BORDER_DASH:3,TOOLTIP_ANIMATION_ALPHA:.5,TOOLTIP_SHADOW_OFFSET:60,TOOLTIP_SHADOW_WIDTH:40,TOOLTIP_PADDING:16,EASING_CUBIC_POWER:3,CONTENT_PARTS_RGB:3,SEARCHBOX_DEFAULT_WIDTH:300,SEARCHBOX_DEFAULT_HEIGHT:40,SEARCHBOX_DEBOUNCE_DELAY:300,SEARCHBOX_MAX_SUGGESTIONS:5,SEARCHBOX_CLEAR_BUTTON_WIDTH:70,SEARCHBOX_CLEAR_BUTTON_OFFSET:45,SEARCHBOX_SEARCH_BUTTON_WIDTH:40,SEARCHBOX_SUGGESTION_HEIGHT:30,SEARCHBOX_SUGGESTION_ANIMATION_DELAY:150,SEARCHBOX_BUTTON_SPACING:80,SEARCHBOX_BUTTON_POSITION:55,SEARCHBOX_SEARCH_ICON_OFFSET:30,SEARCHBOX_CURSOR_MARGIN:8,SEARCHBOX_BUTTON_HEIGHT_OFFSET:4,SEARCHBOX_CURSOR_BLINK_FREQUENCY:.005,SEARCHBOX_CURSOR_OPACITY_FACTOR:.5,SEARCHBOX_CURSOR_OPACITY_BASE:.5,SEARCHBOX_SUGGESTION_ICON_OFFSET:12,SEARCHBOX_HIGHLIGHT_Y_OFFSET:8,SEARCHBOX_HIGHLIGHT_HEIGHT:16},Y={renderTime:16,memoryWarning:n.MEMORY_WARNING_MB*n.BYTES_PER_KB*n.BYTES_PER_KB,eventThrottle:16},Pt={duration:300,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)",fillMode:"forwards"},V={log(u,t,e=null){typeof window<"u"&&window.DEBUG_MODE&&(e?window.console[u](`[InputUtility] ${t}:`,e):window.console[u](`[InputUtility] ${t}`))},warn(u,t){this.log("warn",u,t)},error(u,t){this.log("error",u,t)},componentError(u,t,e=""){this.error(`${u} Error${e?` (${e})`:""}`,t)},performanceWarning(u,t,e){this.warn(`${u} Performance Warning`,{metric:t,threshold:e})}};class d{static getCurrentTheme(){const t=window.matchMedia;return t&&t("(prefers-contrast: high)").matches?this.themes.highContrast:this.themes.light}static getColor(t,e=null){const i=e||this.getCurrentTheme();return i[t]||i.text}}B(d,"themes",{light:{background:"#ffffff",surface:"#f8f9fa",primary:"#007bff",secondary:"#6c757d",text:"#333333",textSecondary:"#6c757d",border:"#dee2e6",focus:"#007bff",error:"#dc3545",warning:"#ffc107",success:"#28a745",disabled:"#e9ecef"},dark:{background:"#1a1a1a",surface:"#2d2d2d",primary:"#4da6ff",secondary:"#9da5b4",text:"#e0e0e0",textSecondary:"#9da5b4",border:"#404040",focus:"#4da6ff",error:"#ff5f5f",warning:"#ffcc02",success:"#4caf50",disabled:"#404040"},highContrast:{background:"#000000",surface:"#1a1a1a",primary:"#ffffff",secondary:"#cccccc",text:"#ffffff",textSecondary:"#cccccc",border:"#ffffff",focus:"#ffff00",error:"#ff0000",warning:"#ffff00",success:"#00ff00",disabled:"#666666"}});class G{static startMonitoring(t){this.isMonitoring&&this.metrics.set(t,{renderStart:performance.now(),memoryStart:this.getMemoryUsage()})}static endMonitoring(t){if(!this.isMonitoring||!this.metrics.has(t))return;const e=this.metrics.get(t),i=performance.now()-e.renderStart,s=this.getMemoryUsage();i>Y.renderTime&&V.warn(`Component ${t} render time exceeded threshold: ${i}ms`),s>Y.memoryWarning&&V.warn(`High memory usage detected: ${s/n.BYTES_PER_KB/n.BYTES_PER_KB}MB`),this.metrics.delete(t)}static getMemoryUsage(){return performance.memory?performance.memory.usedJSHeapSize:0}static enable(){this.isMonitoring=!0}static disable(){this.isMonitoring=!1,this.metrics.clear()}}B(G,"metrics",new Map),B(G,"isMonitoring",!1);class b extends Error{constructor(t,e,i={}){super(t),this.name="ComponentError",this.component=e,this.context=i,this.timestamp=new Date().toISOString()}}class k{static animate(t,e,i={}){const s={...Pt,...i},a=`${t.id||"unknown"}_${Date.now()}`;return new Promise((h,o)=>{try{const l={target:t,properties:e,config:s,startTime:performance.now(),resolve:h,reject:o};this.activeAnimations.set(a,l),this.startAnimationLoop(),setTimeout(()=>{this.activeAnimations.has(a)&&(this.activeAnimations.delete(a),h())},s.duration)}catch(l){o(new b("Animation failed",t.constructor.name,{error:l}))}})}static startAnimationLoop(){if(this.rafId)return;const t=()=>{const e=performance.now();for(const[i,s]of this.activeAnimations){const a=e-s.startTime,h=Math.min(a/s.config.duration,1),o=this.applyEasing(h,s.config.easing);for(const[l,r]of Object.entries(s.properties)){const E=s.target[l]||0,g=r-E;s.target[l]=E+g*o}h>=1&&(this.activeAnimations.delete(i),s.resolve())}this.activeAnimations.size>0?this.rafId=requestAnimationFrame(t):this.rafId=null};this.rafId=requestAnimationFrame(t)}static applyEasing(t,e){switch(e){case"ease-in":return t*t;case"ease-out":return 1-Math.pow(1-t,2);case"ease-in-out":return t<n.EASE_THRESHOLD?n.EASE_MULTIPLIER*t*t:1-Math.pow(n.EASE_NEGATIVE_MULTIPLIER*t+n.EASE_MULTIPLIER,n.EASE_MULTIPLIER)/n.EASE_MULTIPLIER;default:return t}}static cancelAnimation(t){for(const[e,i]of this.activeAnimations)i.target===t&&(this.activeAnimations.delete(e),i.reject(new b("Animation cancelled",t.constructor.name)))}static cleanup(){this.activeAnimations.clear(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}}B(k,"activeAnimations",new Map),B(k,"rafId",null);class Ut extends C{constructor(t={}){super({...t,width:t.width||n.DEFAULT_COLOR_PICKER_WIDTH,height:t.height||n.DEFAULT_COLOR_PICKER_HEIGHT,ariaRole:"button",ariaLabel:t.ariaLabel||"Color picker"}),this.validateOptions(t),this.value=t.value||"#ff0000",this.format=t.format||"hex",this.showAlpha=t.showAlpha!==!1,this.showPresets=t.showPresets!==!1,this.disabled=t.disabled||!1,this.presets=t.presets||this.getDefaultPresets(),this.theme=t.theme||d.getCurrentTheme(),this.borderColor=t.borderColor||d.getColor("border",this.theme),this.backgroundColor=t.backgroundColor||d.getColor("background",this.theme),this.isOpen=!1,this.hue=0,this.saturation=100,this.lightness=50,this.alpha=1,this.lastValidColor=this.value,this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),Y.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.animationState={isAnimating:!1,openProgress:this.isOpen?1:0},this.errorHandler=this.createErrorHandler();try{this.parseColor(),this.setupEventHandlers(),this.setupAccessibility(),this.setupResizeObserver()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){const e=["hex","rgb","hsl","hsv"];if(t.format&&!e.includes(t.format))throw new b(`Invalid color format: ${t.format}`,"ColorPicker");t.value&&!this.isValidColor(t.value)&&V.warn(`Invalid initial color value: ${t.value}, using default`)}getDefaultPresets(){return[{color:"#ff0000",name:"Red"},{color:"#00ff00",name:"Green"},{color:"#0000ff",name:"Blue"},{color:"#ffff00",name:"Yellow"},{color:"#ff00ff",name:"Magenta"},{color:"#00ffff",name:"Cyan"},{color:"#000000",name:"Black"},{color:"#ffffff",name:"White"},{color:"#808080",name:"Gray"},{color:"#800000",name:"Maroon"},{color:"#008000",name:"Dark Green"},{color:"#000080",name:"Navy"}]}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowLeft:()=>this.adjustHue(-5),ArrowRight:()=>this.adjustHue(n.HUE_ADJUSTMENT_STEP),ArrowUp:()=>this.adjustLightness(n.LIGHTNESS_ADJUSTMENT_STEP),ArrowDown:()=>this.adjustLightness(-5),"Shift+ArrowUp":()=>this.adjustSaturation(n.SATURATION_ADJUSTMENT_STEP),"Shift+ArrowDown":()=>this.adjustSaturation(-5),Enter:()=>this.confirmSelection(),Escape:()=>this.close(),Tab:t=>this.handleTabNavigation(t)}}createErrorHandler(){return{handle:(t,e)=>{const i=new b(t.message||"Unknown error","ColorPicker",{context:e,originalError:t});V.error("ColorPicker Error",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"color-parsing":this.value=this.lastValidColor,this.parseColor();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupEventHandlers(){const t={click:this.handleClick.bind(this),mouseMove:this.handleMouseMove.bind(this),mouseDown:this.handleMouseDown.bind(this),mouseUp:this.handleMouseUp.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this),wheel:this.handleWheel.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}setupAccessibility(){this.setAttribute("aria-expanded",this.isOpen.toString()),this.setAttribute("aria-haspopup","dialog"),this.setAttribute("aria-valuemin","0"),this.setAttribute("aria-valuemax","360"),this.setAttribute("aria-valuenow",this.hue.toString()),this.setAttribute("aria-valuetext",this.getColorDescription()),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupResizeObserver(){"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{this.clearRenderCache(),this.throttledRender()}),this.element&&this.resizeObserver.observe(this.element))}parseColor(){try{const t=this.value;if(!this.isValidColor(t))throw new Error(`Invalid color format: ${t}`);t.startsWith("#")?this.parseHexColor(t):t.startsWith("rgb")?this.parseRgbColor(t):t.startsWith("hsl")&&this.parseHslColor(t),this.lastValidColor=this.value}catch(t){this.errorHandler.handle(t,"color-parsing")}}parseHexColor(t){const e=t.slice(1),i=parseInt(e.substr(0,2),16),s=parseInt(e.substr(2,2),16),a=parseInt(e.substr(n.HEX_BLUE_OFFSET,2),16);if(isNaN(i)||isNaN(s)||isNaN(a))throw new Error("Invalid hex color format");const h=this.rgbToHsl(i,s,a);this.hue=h.h,this.saturation=h.s,this.lightness=h.l}parseRgbColor(t){const e=t.match(/rgba?\(([^)]+)\)/);if(!e)throw new Error("Invalid RGB color format");const i=e[1].split(",").map(r=>parseFloat(r.trim()));if(i.length<n.RGB_CHANNEL_COUNT||i.some(isNaN))throw new Error("Invalid RGB values");const[s,a,h,o=1]=i,l=this.rgbToHsl(s,a,h);this.hue=l.h,this.saturation=l.s,this.lightness=l.l,this.alpha=o}parseHslColor(t){const e=t.match(/hsla?\(([^)]+)\)/);if(!e)throw new Error("Invalid HSL color format");const i=e[1].split(",").map(l=>parseFloat(l.trim()));if(i.length<n.RGB_CHANNEL_COUNT||i.some(isNaN))throw new Error("Invalid HSL values");const[s,a,h,o=1]=i;this.hue=s,this.saturation=a,this.lightness=h,this.alpha=o}isValidColor(t){if(typeof t!="string")return!1;const e=/^#[0-9A-Fa-f]{6}$/,i=/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(?:,\s*[\d.]+\s*)?\)$/,s=/^hsla?\(\s*\d+\s*,\s*\d+%?\s*,\s*\d+%?\s*(?:,\s*[\d.]+\s*)?\)$/;return e.test(t)||i.test(t)||s.test(t)}rgbToHsl(t,e,i){t=Math.max(0,Math.min(n.RGB_MAX_VALUE,t))/n.RGB_MAX_VALUE,e=Math.max(0,Math.min(n.RGB_MAX_VALUE,e))/n.RGB_MAX_VALUE,i=Math.max(0,Math.min(n.RGB_MAX_VALUE,i))/n.RGB_MAX_VALUE;const s=Math.max(t,e,i),a=Math.min(t,e,i);let h,o;const l=(s+a)/2;if(s===a)h=o=0;else{const r=s-a;switch(o=l>n.HSL_MIDPOINT?r/(2-s-a):r/(s+a),s){case t:h=(e-i)/r+(e<i?n.HUE_SECTOR_COUNT:0);break;case e:h=(i-t)/r+2;break;case i:h=(t-e)/r+n.HUE_BLUE_OFFSET;break}h/=n.HUE_SECTOR_COUNT}return{h:Math.round(h*n.HUE_MAX_DEGREES),s:Math.round(o*n.SATURATION_MAX_PERCENT),l:Math.round(l*n.LIGHTNESS_MAX_PERCENT)}}hslToRgb(t,e,i){t=(t%n.HUE_MAX_DEGREES+n.HUE_MAX_DEGREES)%n.HUE_MAX_DEGREES,e=Math.max(0,Math.min(n.SATURATION_MAX_PERCENT,e))/n.SATURATION_MAX_PERCENT,i=Math.max(0,Math.min(n.LIGHTNESS_MAX_PERCENT,i))/n.LIGHTNESS_MAX_PERCENT;const s=(l,r,E)=>(E<0&&(E+=1),E>1&&(E-=1),E<1/n.HSL_DIVISOR_SIX?l+(r-l)*n.HSL_DIVISOR_SIX*E:E<1/n.HSL_DIVISOR_TWO?r:E<n.HSL_DIVISOR_TWO/n.HSL_DIVISOR_THREE?l+(r-l)*(n.HSL_DIVISOR_TWO/n.HSL_DIVISOR_THREE-E)*n.HSL_DIVISOR_SIX:l);let a,h,o;if(e===0)a=h=o=i;else{const l=i<n.HSL_MIDPOINT?i*(1+e):i+e-i*e,r=n.HSL_DIVISOR_TWO*i-l;a=s(r,l,t/n.HUE_MAX_DEGREES+1/n.HSL_DIVISOR_THREE),h=s(r,l,t/n.HUE_MAX_DEGREES),o=s(r,l,t/n.HUE_MAX_DEGREES-1/n.HSL_DIVISOR_THREE)}return{r:Math.round(a*n.RGB_MAX_VALUE),g:Math.round(h*n.RGB_MAX_VALUE),b:Math.round(o*n.RGB_MAX_VALUE)}}updateValue(){try{const t=this.hslToRgb(this.hue,this.saturation,this.lightness),e=this.value;switch(this.format){case"hex":this.value=this.rgbToHex(t.r,t.g,t.b);break;case"rgb":this.value=this.showAlpha?`rgba(${t.r}, ${t.g}, ${t.b}, ${this.alpha})`:`rgb(${t.r}, ${t.g}, ${t.b})`;break;case"hsl":this.value=this.showAlpha?`hsla(${Math.round(this.hue)}, ${Math.round(this.saturation)}%, ${Math.round(this.lightness)}%, ${this.alpha})`:`hsl(${Math.round(this.hue)}, ${Math.round(this.saturation)}%, ${Math.round(this.lightness)}%)`;break;case"hsv":{const i=this.hslToHsv(this.hue,this.saturation,this.lightness);this.value=`hsv(${Math.round(i.h)}, ${Math.round(i.s)}%, ${Math.round(i.v)}%)`;break}}e!==this.value&&(this.lastValidColor=this.value,this.updateAccessibility(),this.announceColorChange(),this.emit("colorChanged",{value:this.value,hsl:{h:this.hue,s:this.saturation,l:this.lightness},alpha:this.alpha,rgb:t}))}catch(t){this.errorHandler.handle(t,"value-update")}}rgbToHex(t,e,i){const s=a=>{const h=Math.round(Math.max(0,Math.min(n.RGB_MAX_VALUE,a))).toString(n.HEX_BASE);return h.length===1?`0${h}`:h};return`#${s(t)}${s(e)}${s(i)}`}hslToHsv(t,e,i){e/=100,i/=100;const s=i+e*Math.min(i,1-i),a=s===0?0:2*(1-i/s);return{h:t,s:a*100,v:s*100}}updateAccessibility(){this.setAttribute("aria-valuenow",this.hue.toString()),this.setAttribute("aria-valuetext",this.getColorDescription())}getColorDescription(){return`${this.getColorName()}, hue ${Math.round(this.hue)} degrees, saturation ${Math.round(this.saturation)} percent, lightness ${Math.round(this.lightness)} percent`}getColorName(){const{hue:t}=this;return this.saturation<n.SATURATION_THRESHOLD_LOW?this.lightness>n.LIGHTNESS_THRESHOLD_HIGH?"white":this.lightness<n.LIGHTNESS_THRESHOLD_LOW?"black":"gray":t<n.HUE_RED_MAX||t>=n.HUE_RED_MIN?"red":t<n.HUE_ORANGE_MAX?"orange":t<n.HUE_YELLOW_MAX?"yellow":t<n.HUE_GREEN_MAX?"green":t<n.HUE_CYAN_MAX?"cyan":t<n.HUE_BLUE_MAX?"blue":t<n.HUE_PURPLE_MAX?"purple":t<n.HUE_MAGENTA_MAX?"magenta":"pink"}announceColorChange(){this.announcer.textContent=`Color changed to ${this.getColorDescription()}`}handleClick(t){try{if(this.disabled)return;const{localX:e,localY:i}=t;this.isOpen?this.handleColorSelection(e,i):this.open()}catch(e){this.errorHandler.handle(e,"click-handler")}}async open(){if(!(this.isOpen||this.disabled))try{this.isOpen=!0,this.setAttribute("aria-expanded","true"),this.prefersReducedMotion()?this.animationState.openProgress=1:await k.animate(this.animationState,{openProgress:1},{duration:200,easing:"ease-out"}),this.emit("opened"),this.announcer.textContent="Color picker opened"}catch(t){this.errorHandler.handle(t,"open")}}async close(){if(this.isOpen)try{this.isOpen=!1,this.setAttribute("aria-expanded","false"),this.prefersReducedMotion()?this.animationState.openProgress=0:await k.animate(this.animationState,{openProgress:0},{duration:150,easing:"ease-in"}),this.emit("closed"),this.announcer.textContent="Color picker closed"}catch(t){this.errorHandler.handle(t,"close")}}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}handleColorSelection(t,e){try{if(e>=n.COLOR_WHEEL_Y_START&&e<n.COLOR_WHEEL_Y_END){const i=this.width/2,s=125,a=80,h=t-i,o=e-s,l=Math.sqrt(h*h+o*o);l<=a&&(this.hue=(Math.atan2(o,h)*n.DEGREES_TO_RADIANS_FACTOR/Math.PI+n.HUE_MAX_DEGREES)%n.HUE_MAX_DEGREES,this.saturation=Math.min(100,l/a*100),this.updateValue())}if(e>=n.LIGHTNESS_SLIDER_Y_MIN&&e<=n.LIGHTNESS_SLIDER_Y_MAX&&t>=n.SLIDER_MARGIN&&t<=this.width-n.SLIDER_MARGIN&&(this.lightness=Math.max(0,Math.min(n.LIGHTNESS_MAX_PERCENT,(t-n.SLIDER_MARGIN)/(this.width-n.SLIDER_MARGIN*2)*n.LIGHTNESS_MAX_PERCENT)),this.updateValue()),this.showAlpha&&e>=n.ALPHA_SLIDER_Y_MIN&&e<=n.ALPHA_SLIDER_Y_MAX&&t>=n.SLIDER_MARGIN&&t<=this.width-n.SLIDER_MARGIN&&(this.alpha=Math.max(0,Math.min(1,(t-n.SLIDER_MARGIN)/(this.width-n.SLIDER_MARGIN*2))),this.updateValue()),this.showPresets&&e>=n.PRESET_Y){const i=(this.width-n.SLIDER_MARGIN*2)/this.presets.length,s=Math.floor((t-n.SLIDER_MARGIN)/i);s>=0&&s<this.presets.length&&this.setValue(this.presets[s].color||this.presets[s])}}catch(i){this.errorHandler.handle(i,"color-selection")}}adjustHue(t){this.hue=(this.hue+t+n.HUE_MAX_DEGREES)%n.HUE_MAX_DEGREES,this.updateValue()}adjustSaturation(t){this.saturation=Math.max(0,Math.min(100,this.saturation+t)),this.updateValue()}adjustLightness(t){this.lightness=Math.max(0,Math.min(100,this.lightness+t)),this.updateValue()}confirmSelection(){this.emit("colorConfirmed",{value:this.value}),this.close()}handleKeyDown(t){try{if(this.disabled)return;const{key:e,shiftKey:i,ctrlKey:s,metaKey:a}=t,h=[i&&"Shift",(s||a)&&"Ctrl",e].filter(Boolean).join("+"),o=this.keyboardHandler[h]||this.keyboardHandler[e];o&&(t.preventDefault(),o(t))}catch(e){this.errorHandler.handle(e,"keyboard-handler")}}handleTabNavigation(t){const e=this.getFocusableElements(),i=e.indexOf(t.target);if(t.shiftKey){const s=i>0?i-1:e.length-1;e[s]?.focus()}else{const s=i<e.length-1?i+1:0;e[s]?.focus()}t.preventDefault()}getFocusableElements(){return Array.from(this.element?.querySelectorAll('[tabindex]:not([tabindex="-1"])')||[])}handleMouseMove(t){if(!(!this.isMouseDown||this.disabled))try{const{localX:e,localY:i}=t;this.handleColorSelection(e,i)}catch(e){this.errorHandler.handle(e,"mouse-move")}}handleMouseDown(t){if(!this.disabled)try{this.isMouseDown=!0;const{localX:e,localY:i}=t;this.handleColorSelection(e,i),this.addGlobalMouseHandlers()}catch(e){this.errorHandler.handle(e,"mouse-down")}}handleMouseUp(){this.isMouseDown=!1,this.removeGlobalMouseHandlers()}addGlobalMouseHandlers(){this.globalMouseMove=this.handleMouseMove.bind(this),this.globalMouseUp=this.handleMouseUp.bind(this),document.addEventListener("mousemove",this.globalMouseMove),document.addEventListener("mouseup",this.globalMouseUp)}removeGlobalMouseHandlers(){this.globalMouseMove&&(document.removeEventListener("mousemove",this.globalMouseMove),this.globalMouseMove=null),this.globalMouseUp&&(document.removeEventListener("mouseup",this.globalMouseUp),this.globalMouseUp=null)}handleFocus(){this.isFocused=!0,this.emit("focus")}handleBlur(){this.isFocused=!1,this.emit("blur"),this.isOpen&&!this.persistent&&setTimeout(()=>this.close(),n.CLOSE_TIMEOUT)}handleWheel(t){if(!(!this.isFocused||this.disabled))try{t.preventDefault();const e=t.deltaY>0?n.WHEEL_STEP_DELTA_NEGATIVE:n.WHEEL_STEP_DELTA;t.shiftKey?this.adjustSaturation(e):t.ctrlKey||t.metaKey?this.adjustLightness(e):this.adjustHue(e)}catch(e){this.errorHandler.handle(e,"wheel-handler")}}handleFocusIn(){this.setAttribute("aria-describedby","color-picker-instructions"),this.announcer.textContent="Use arrow keys to adjust color, Shift+arrows for saturation, Ctrl+arrows for lightness"}handleFocusOut(){this.removeAttribute("aria-describedby")}renderSelf(t){if(t.type==="canvas")try{G.startMonitoring("ColorPicker"),!this.isOpen&&this.animationState.openProgress===0?this.renderPreview(t):this.renderPicker(t),G.endMonitoring("ColorPicker")}catch(e){this.errorHandler.handle(e,"render")}}renderPreview(t){const e=`preview_${this.value}_${this.width}_${this.height}_${this.disabled}`;if(this.renderCache.has(e)){const a=this.renderCache.get(e);t.drawImage(a,0,0);return}const i=new OffscreenCanvas(this.width,this.height),s=i.getContext("2d");this.drawPreview(s),this.renderCache.set(e,i),t.drawImage(i,0,0)}drawPreview(t){const e=t.createLinearGradient(0,0,this.width,0);e.addColorStop(0,this.value),e.addColorStop(1,this.value),t.fillStyle=e,t.fillRect(0,0,this.width,this.height);const i=this.disabled?d.getColor("disabled",this.theme):this.isFocused?d.getColor("focus",this.theme):d.getColor("border",this.theme);t.strokeStyle=i,t.lineWidth=this.isFocused?2:1,t.strokeRect(0,0,this.width,this.height),t.fillStyle=d.getColor("textSecondary",this.theme),t.font="12px Arial",t.textAlign="right",t.textBaseline="middle",t.fillText("▼",this.width-10,this.height/2),this.isFocused&&this.drawFocusIndicator(t),this.disabled&&(t.fillStyle="rgba(255, 255, 255, 0.5)",t.fillRect(0,0,this.width,this.height))}drawFocusIndicator(t){t.strokeStyle=d.getColor("focus",this.theme),t.lineWidth=2,t.setLineDash([2,2]),t.strokeRect(n.FOCUS_INDICATOR_OFFSET,n.FOCUS_INDICATOR_OFFSET,this.width-n.FOCUS_INDICATOR_BORDER,this.height-n.FOCUS_INDICATOR_BORDER),t.setLineDash([])}renderPicker(t){const e=this.animationState.openProgress;t.globalAlpha=e,t.fillStyle=d.getColor("background",this.theme),t.fillRect(0,0,this.width,this.height),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(0,0,this.width,this.height),this.renderColorWheel(t),this.renderLightnessSlider(t),this.showAlpha&&this.renderAlphaSlider(t),this.showPresets&&this.renderPresets(t),this.renderCurrentColor(t),this.renderInstructions(t),t.globalAlpha=1}renderColorWheel(t){const e=this.width/2,i=125,s=80,a=t.createImageData(s*2,s*2),{data:h}=a;for(let o=0;o<s*2;o++)for(let l=0;l<s*2;l++){const r=l-s,E=o-s,g=Math.sqrt(r*r+E*E);if(g<=s){const I=(Math.atan2(E,r)*n.DEGREES_TO_RADIANS_FACTOR/Math.PI+n.HUE_MAX_DEGREES)%n.HUE_MAX_DEGREES,S=Math.min(100,g/s*100),D=this.hslToRgb(I,S,n.COLOR_WHEEL_LIGHTNESS_DEFAULT),O=(o*s*2+l)*n.RGBA_CHANNELS;h[O]=D.r,h[O+1]=D.g,h[O+2]=D.b,h[O+n.ALPHA_CHANNEL_OFFSET]=n.RGB_MAX_VALUE}}t.putImageData(a,e-s,i-s),this.renderColorIndicator(t,e,i,s)}renderColorIndicator(t,e,i,s){const a=this.hue*Math.PI/n.DEGREES_TO_RADIANS_FACTOR,h=this.saturation/100*s,o=e+Math.cos(a)*h,l=i+Math.sin(a)*h;t.strokeStyle="#ffffff",t.lineWidth=3,t.beginPath(),t.arc(o,l,n.COLOR_INDICATOR_RADIUS,0,Math.PI*2),t.stroke(),t.strokeStyle="#000000",t.lineWidth=1,t.beginPath(),t.arc(o,l,n.COLOR_INDICATOR_RADIUS,0,Math.PI*2),t.stroke(),t.fillStyle=this.value,t.beginPath(),t.arc(o,l,n.COLOR_INDICATOR_CENTER_RADIUS,0,Math.PI*2),t.fill()}renderLightnessSlider(t){const e=n.LIGHTNESS_SLIDER_Y,i=n.SLIDER_HEIGHT,s=n.SLIDER_START_MARGIN,a=this.width-n.SLIDER_START_MARGIN,h=50,o=(a-s)/h;for(let r=0;r<h;r++){const E=r/(h-1)*100,g=this.hslToRgb(this.hue,this.saturation,E);t.fillStyle=`rgb(${g.r}, ${g.g}, ${g.b})`,t.fillRect(s+r*o,e,o+1,i)}t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(s,e,a-s,i);const l=s+this.lightness/100*(a-s);this.renderSliderIndicator(t,l,e,i)}renderAlphaSlider(t){const e=n.ALPHA_SLIDER_Y,i=n.SLIDER_HEIGHT,s=n.SLIDER_START_MARGIN,a=this.width-n.SLIDER_START_MARGIN;this.renderCheckerboard(t,s,e,a-s,i);const h=this.hslToRgb(this.hue,this.saturation,this.lightness),o=t.createLinearGradient(s,e,a,e);o.addColorStop(0,`rgba(${h.r}, ${h.g}, ${h.b}, 0)`),o.addColorStop(1,`rgba(${h.r}, ${h.g}, ${h.b}, 1)`),t.fillStyle=o,t.fillRect(s,e,a-s,i),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(s,e,a-s,i);const l=s+this.alpha*(a-s);this.renderSliderIndicator(t,l,e,i)}renderCheckerboard(t,e,i,s,a){const o=Math.ceil(s/8),l=Math.ceil(a/8);for(let r=0;r<o;r++)for(let E=0;E<l;E++){const g=(r+E)%2===0;t.fillStyle=g?"#ffffff":"#e0e0e0",t.fillRect(e+r*8,i+E*8,8,8)}}renderSliderIndicator(t,e,i,s){const a=n.SLIDER_INDICATOR_WIDTH,h=s+n.INDICATOR_HEIGHT_OFFSET,o=e-a/2,l=i-n.SLIDER_INDICATOR_OFFSET;t.fillStyle="rgba(0, 0, 0, 0.2)",t.fillRect(o+1,l+1,a,h),t.fillStyle="#ffffff",t.fillRect(o,l,a,h),t.strokeStyle="#000000",t.lineWidth=1,t.strokeRect(o,l,a,h),t.beginPath(),t.moveTo(e,i+s+n.SLIDER_INDICATOR_OFFSET),t.lineTo(e-n.SLIDER_INDICATOR_OFFSET,i+s+n.INDICATOR_HEIGHT_OFFSET),t.lineTo(e+n.SLIDER_INDICATOR_OFFSET,i+s+n.INDICATOR_HEIGHT_OFFSET),t.closePath(),t.fill(),t.stroke()}renderPresets(t){const a=(this.width-n.COLOR_DISPLAY_MARGIN)/this.presets.length;this.presets.forEach((h,o)=>{const l=20+o*a,r=h.color||h,E=r===this.value;t.fillStyle=r,t.fillRect(l+n.PRESET_BORDER_OFFSET,280+n.PRESET_BORDER_OFFSET,a-n.PRESET_BORDER_SIZE,20-n.PRESET_BORDER_HEIGHT),t.strokeStyle=E?d.getColor("focus",this.theme):d.getColor("border",this.theme),t.lineWidth=E?2:1,t.strokeRect(l+n.PRESET_BORDER_OFFSET,280+n.PRESET_BORDER_OFFSET,a-n.PRESET_BORDER_SIZE,20-n.PRESET_BORDER_HEIGHT),h.name&&this.isFocused&&(t.fillStyle=d.getColor("text",this.theme),t.font="10px Arial",t.textAlign="center",t.textBaseline="top",t.fillText(h.name.substring(0,n.PRESET_NAME_LENGTH),l+a/2,302))})}renderCurrentColor(t){const e=n.SLIDER_START_MARGIN,i=this.height-n.COLOR_DISPLAY_MARGIN,s=this.width-n.COLOR_DISPLAY_MARGIN,a=20;this.renderCheckerboard(t,e,i,s,a),t.fillStyle=this.value,t.fillRect(e,i,s,a),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(e,i,s,a),t.fillStyle=d.getColor("text",this.theme),t.font="11px monospace",t.textAlign="center",t.textBaseline="top",t.fillText(this.value,this.width/2,i+a+2)}renderInstructions(t){if(!this.isFocused)return;const e=["Arrow keys: Adjust hue/lightness","Shift+Arrows: Adjust saturation","Enter: Confirm, Esc: Cancel"];t.fillStyle=d.getColor("textSecondary",this.theme),t.font="10px Arial",t.textAlign="left",t.textBaseline="top",e.forEach((i,s)=>{t.fillText(i,n.INSTRUCTION_MARGIN,n.INSTRUCTION_MARGIN+s*n.INSTRUCTION_LINE_HEIGHT)})}clearRenderCache(){this.renderCache.clear()}throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}getValue(){return this.value}async setValue(t){try{if(!this.isValidColor(t))throw new b(`Invalid color value: ${t}`,"ColorPicker");const e=this.value;this.value=t,this.parseColor(),this.clearRenderCache(),e!==this.value&&this.emit("colorChanged",{value:this.value,oldValue:e,hsl:{h:this.hue,s:this.saturation,l:this.lightness},alpha:this.alpha})}catch(e){this.errorHandler.handle(e,"setValue")}}getColorComponents(){return{hue:this.hue,saturation:this.saturation,lightness:this.lightness,alpha:this.alpha,rgb:this.hslToRgb(this.hue,this.saturation,this.lightness)}}setColorComponents({hue:t,saturation:e,lightness:i,alpha:s}){t!==void 0&&(this.hue=Math.max(0,Math.min(n.HUE_MAX_DEGREES,t))),e!==void 0&&(this.saturation=Math.max(0,Math.min(100,e))),i!==void 0&&(this.lightness=Math.max(0,Math.min(100,i))),s!==void 0&&(this.alpha=Math.max(0,Math.min(1,s))),this.updateValue()}reset(){this.value="#ff0000",this.hue=0,this.saturation=100,this.lightness=50,this.alpha=1,this.isOpen=!1,this.animationState.openProgress=0,this.clearRenderCache(),this.emit("reset")}enable(){this.disabled=!1,this.setAttribute("tabindex","0"),this.clearRenderCache(),this.emit("enabled")}disable(){this.disabled=!0,this.setAttribute("tabindex","-1"),this.close(),this.clearRenderCache(),this.emit("disabled")}destroy(){try{k.cancelAnimation(this),this.removeGlobalMouseHandlers(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.clearRenderCache(),this.debounceTimer&&clearTimeout(this.debounceTimer),super.destroy?.(),this.emit("destroyed")}catch(t){V.componentError("ColorPicker",t,"cleanup")}}}class Bt extends C{constructor(t={}){super({...t,width:t.width||n.DEFAULT_ACCORDION_WIDTH,height:t.height||n.DEFAULT_ACCORDION_HEIGHT,ariaRole:"region",ariaLabel:t.ariaLabel||"Accordion"}),this.validateOptions(t),this.items=t.items||[],this.allowMultiple=t.allowMultiple||!1,this.expandedItems=new Set(t.expandedItems||[]),this.animationDuration=t.animationDuration||n.DEFAULT_ANIMATION_DURATION,this.disabled=t.disabled||!1,this.theme=t.theme||d.getCurrentTheme(),this.headerHeight=t.headerHeight||n.DEFAULT_HEADER_HEIGHT,this.animatingItems=new Map,this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),Y.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.focusedItemIndex=-1,this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler();try{this.setupItems(),this.setupEventHandlers(),this.setupAccessibility(),this.setupResizeObserver()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.items&&!Array.isArray(t.items))throw new b("Items must be an array","Accordion");if(t.animationDuration&&(typeof t.animationDuration!="number"||t.animationDuration<0))throw new b("Animation duration must be a positive number","Accordion")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowUp:()=>this.navigateToItem(-1),ArrowDown:()=>this.navigateToItem(1),Home:()=>this.navigateToItem("first"),End:()=>this.navigateToItem("last"),Enter:()=>this.toggleFocusedItem(),Space:()=>this.toggleFocusedItem(),Escape:()=>this.collapseAll()}}createErrorHandler(){return{handle:(t,e)=>{const i=new b(t.message||"Unknown error","Accordion",{context:e,originalError:t});V.error("Accordion Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"animation":this.animatingItems.clear();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","region"),this.setAttribute("aria-multiselectable",this.allowMultiple.toString()),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupResizeObserver(){"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{this.clearRenderCache(),this.throttledRender()}),this.element&&this.resizeObserver.observe(this.element))}setupItems(){this.items=this.items.map((t,e)=>({id:t.id||`item-${e}`,title:t.title||`Item ${e+1}`,content:t.content||"",icon:t.icon||null,disabled:t.disabled||!1,level:t.level||1,...t})),this.items.forEach((t,e)=>{t.headerId=`accordion-header-${this.id}-${e}`,t.panelId=`accordion-panel-${this.id}-${e}`})}setupEventHandlers(){const t={click:this.handleClick.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async expandItem(t){try{const e=this.items.find(i=>i.id===t);if(!e||e.disabled||this.expandedItems.has(t))return;this.allowMultiple||await this.collapseAll(),this.expandedItems.add(t),this.prefersReducedMotion()||await this.animateItem(t,"expand"),this.updateItemAccessibility(e,!0),this.announceChange(`${e.title} expanded`),this.emit("itemExpanded",{itemId:t,item:e})}catch(e){this.errorHandler.handle(e,"expand-item")}}async collapseItem(t){try{const e=this.items.find(i=>i.id===t);if(!e||!this.expandedItems.has(t))return;this.expandedItems.delete(t),this.prefersReducedMotion()||await this.animateItem(t,"collapse"),this.updateItemAccessibility(e,!1),this.announceChange(`${e.title} collapsed`),this.emit("itemCollapsed",{itemId:t,item:e})}catch(e){this.errorHandler.handle(e,"collapse-item")}}async toggleItem(t){this.expandedItems.has(t)?await this.collapseItem(t):await this.expandItem(t)}async animateItem(t,e){const i={type:e,startTime:performance.now(),duration:this.animationDuration};return this.animatingItems.set(t,i),new Promise(s=>{const a=()=>{const h=performance.now()-i.startTime;Math.min(h/this.animationDuration,1)>=1?(this.animatingItems.delete(t),s()):requestAnimationFrame(a)};a()})}updateItemAccessibility(t,e){if(this.element){const i=this.element.querySelector(`#${t.headerId}`),s=this.element.querySelector(`#${t.panelId}`);i&&i.setAttribute("aria-expanded",e.toString()),s&&s.setAttribute("aria-hidden",(!e).toString())}}navigateToItem(t){try{const e=this.items.filter(s=>!s.disabled);if(e.length===0)return;let i;switch(t){case"first":i=0;break;case"last":i=e.length-1;break;case 1:i=Math.min(this.focusedItemIndex+1,e.length-1);break;case-1:i=Math.max(this.focusedItemIndex-1,0);break;default:return}this.focusedItemIndex=i,this.updateFocusedItem()}catch(e){this.errorHandler.handle(e,"navigation")}}updateFocusedItem(){const e=this.items.filter(i=>!i.disabled)[this.focusedItemIndex];e&&(this.announceChange(`Focused on ${e.title}`),this.emit("itemFocused",{item:e}))}toggleFocusedItem(){const e=this.items.filter(i=>!i.disabled)[this.focusedItemIndex];e&&this.toggleItem(e.id)}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}announceChange(t){this.announcer&&(this.announcer.textContent=t)}getItemHeight(t){try{const e=this.expandedItems.has(t.id),i=this.animatingItems.get(t.id);if(!i)return e?this.getContentHeight(t):0;const s=performance.now()-i.startTime,a=Math.min(s/i.duration,1),h=this.getContentHeight(t),o=this.easeInOut(a);return i.type==="expand"?h*o:h*(1-o)}catch(e){return this.errorHandler.handle(e,"height-calculation"),0}}getContentHeight(t){if(!t.content)return 0;const e=16,i=24,s=t.content.split(`
`);let a=0;const h=this.width-n.ACCORDION_PADDING,l=new OffscreenCanvas(1,1).getContext("2d");l.font="12px Arial",s.forEach(E=>{const g=this.wrapText(l,E,h);a+=g.length});const r=a*e+i;return Math.max(n.ACCORDION_MIN_HEIGHT,r)}handleKeyDown(t){if(!this.disabled)try{const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),e())}catch(e){this.errorHandler.handle(e,"keyboard-navigation")}}handleFocusIn(){this.isFocused=!0,this.focusedItemIndex=this.focusedItemIndex>=0?this.focusedItemIndex:0,this.updateFocusedItem()}handleFocusOut(){this.isFocused=!1,this.focusedItemIndex=-1}async expandAll(){try{if(this.allowMultiple){const t=this.items.filter(e=>!e.disabled).map(e=>this.expandItem(e.id));await Promise.all(t),this.emit("allExpanded")}}catch(t){this.errorHandler.handle(t,"expand-all")}}async collapseAll(){try{const t=Array.from(this.expandedItems).map(e=>this.collapseItem(e));await Promise.all(t),this.emit("allCollapsed")}catch(t){this.errorHandler.handle(t,"collapse-all")}}clearRenderCache(){this.renderCache.clear()}throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}destroy(){try{k.cancelAnimation(this),this.animatingItems.clear(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.clearRenderCache(),this.debounceTimer&&clearTimeout(this.debounceTimer),super.destroy?.(),this.emit("destroyed")}catch(t){V.error("Error during Accordion cleanup:",t)}}easeInOut(t){return t<n.EASE_IN_OUT_THRESHOLD?n.EASE_MULTIPLIER*t*t:-1+(n.EASE_IN_OUT_MULTIPLIER-n.EASE_MULTIPLIER*t)*t}getItemBounds(t){let e=0;for(let i=0;i<t;i++)e+=this.headerHeight+this.getItemHeight(this.items[i]);return{x:0,y:e,width:this.width,headerHeight:this.headerHeight,contentHeight:this.getItemHeight(this.items[t])}}getItemFromPosition(t){let e=0;for(let i=0;i<this.items.length;i++){const s=this.headerHeight+this.getItemHeight(this.items[i]);if(t>=e&&t<e+s){const a=t<e+this.headerHeight;return{item:this.items[i],index:i,isInHeader:a}}e+=s}return null}handleClick(t){const{localY:e}=t,i=this.getItemFromPosition(e);i&&i.isInHeader&&this.toggleItem(i.item.id)}renderSelf(t){t.type==="canvas"&&(this.items.forEach((e,i)=>{const s=this.getItemBounds(i),a=this.expandedItems.has(e.id);this.renderItemHeader(t,e,s,a),(a||this.animatingItems.has(e.id))&&this.renderItemContent(t,e,s)}),this.updateAnimations())}renderItemHeader(t,e,i,s){const a=s?d.getColor("primaryHover",this.theme):d.getColor("background",this.theme);t.fillStyle=a,t.fillRect(i.x,i.y,i.width,i.headerHeight),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(i.x,i.y,i.width,i.headerHeight),this.focusedItemIndex>=0&&this.items[this.focusedItemIndex]===e&&(t.strokeStyle=d.getColor("focus",this.theme),t.lineWidth=2,t.setLineDash([2,2]),t.strokeRect(i.x+n.ACCORDION_STROKE_OFFSET,i.y+n.ACCORDION_STROKE_OFFSET,i.width-n.ACCORDION_STROKE_BORDER,i.headerHeight-n.ACCORDION_STROKE_BORDER),t.setLineDash([]));const h=i.x+n.ACCORDION_ICON_MARGIN,o=i.y+i.headerHeight/2;t.fillStyle=e.disabled?d.getColor("disabled",this.theme):d.getColor("textSecondary",this.theme),t.font="12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(s?"▼":"▶",h,o);let l=h+n.ACCORDION_ICON_SIZE;e.icon&&(t.fillStyle=e.disabled?d.getColor("disabled",this.theme):d.getColor("primary",this.theme),t.fillText(e.icon,l,o),l+=n.ACCORDION_ICON_SIZE),t.fillStyle=e.disabled?d.getColor("disabled",this.theme):d.getColor("text",this.theme),t.font=s?"bold 13px Arial":"13px Arial",t.textAlign="left",t.textBaseline="middle";const r=i.width-l-n.ACCORDION_ICON_MARGIN,E=this.truncateText(t,e.title,r);t.fillText(E,l,o),e.disabled&&(t.fillStyle="rgba(255, 255, 255, 0.6)",t.fillRect(i.x,i.y,i.width,i.headerHeight))}truncateText(t,e,i){if(t.measureText(e).width<=i)return e;const a="...";let h=e;for(;t.measureText(h+a).width>i&&h.length>0;)h=h.slice(0,-1);return h+a}renderItemContent(t,e,i){const s=i.y+i.headerHeight,{contentHeight:a}=i;if(a<=0)return;t.fillStyle=d.getColor("backgroundSecondary",this.theme),t.fillRect(i.x,s,i.width,a),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(i.x,s,i.width,a),t.fillStyle=d.getColor("text",this.theme),t.font="12px Arial",t.textAlign="left",t.textBaseline="top";const h=e.content.split(`
`),o=i.width-n.ACCORDION_PADDING;h.forEach((l,r)=>{this.wrapText(t,l,o).forEach((g,_)=>{const I=r+_;t.fillText(g,i.x+n.ACCORDION_ICON_MARGIN,s+n.ACCORDION_ICON_MARGIN+I*n.ACCORDION_LINE_HEIGHT)})})}wrapText(t,e,i){const s=e.split(" "),a=[];let h="";for(const o of s){const l=h+(h?" ":"")+o;t.measureText(l).width>i&&h?(a.push(h),h=o):h=l}return h&&a.push(h),a.length?a:[""]}updateAnimations(){const t=Date.now(),e=[];for(const[i,s]of this.animatingItems)t-s.startTime>=s.duration&&e.push(i);e.forEach(i=>{this.animatingItems.delete(i)}),this.animatingItems.size>0&&requestAnimationFrame(()=>this.updateAnimations())}addItem(t,e=-1){const i={id:t.id||`item-${Date.now()}`,title:t.title||"New Item",content:t.content||"",icon:t.icon||null,disabled:t.disabled||!1,...t};e>=0&&e<this.items.length?this.items.splice(e,0,i):this.items.push(i),this.emit("itemAdded",{item:i,index:e})}removeItem(t){const e=this.items.findIndex(i=>i.id===t);if(e>=0){const i=this.items.splice(e,1)[0];this.expandedItems.delete(t),this.animatingItems.delete(t),this.emit("itemRemoved",{item:i,index:e})}}updateItem(t,e){const i=this.items.find(s=>s.id===t);i&&(Object.assign(i,e),this.emit("itemUpdated",{itemId:t,item:i,updates:e}))}}class kt extends C{constructor(t={}){super({...t,width:t.width||n.DATETIMEPICKER_DEFAULT_WIDTH,height:t.height||n.DATETIMEPICKER_DEFAULT_HEIGHT,ariaRole:"application",ariaLabel:t.ariaLabel||"Date Time Picker"}),this.validateOptions(t),this.value=t.value?new Date(t.value):new Date,this.format=t.format||"MM/DD/YYYY",this.showTime=t.showTime!==!1,this.show24Hour=t.show24Hour||!1,this.minDate=t.minDate?new Date(t.minDate):null,this.maxDate=t.maxDate?new Date(t.maxDate):null,this.disabled=t.disabled||!1,this.locale=t.locale||"en-US",this.theme=t.theme||d.getCurrentTheme(),this.isOpen=!1,this.currentView="calendar",this.displayMonth=this.value.getMonth(),this.displayYear=this.value.getFullYear(),this.selectedHour=this.value.getHours(),this.selectedMinute=this.value.getMinutes(),this.focusedDate=new Date(this.value),this.animationState={openProgress:0},this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),Y.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler();try{this.setupEventHandlers(),this.setupAccessibility(),this.setupResizeObserver()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.value&&!(t.value instanceof Date)&&isNaN(new Date(t.value)))throw new b("Invalid date value provided","DateTimePicker");if(t.minDate&&t.maxDate&&new Date(t.minDate)>new Date(t.maxDate))throw new b("minDate cannot be greater than maxDate","DateTimePicker")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowLeft:()=>this.currentView==="calendar"?this.navigateDay(-1):null,ArrowRight:()=>this.currentView==="calendar"?this.navigateDay(1):null,ArrowUp:()=>this.currentView==="calendar"?this.navigateDay(-7):null,ArrowDown:()=>this.currentView==="calendar"?this.navigateDay(n.DAYS_PER_WEEK):null,Enter:()=>this.confirmSelection(),Escape:()=>this.close(),Home:()=>this.goToToday(),End:()=>this.goToEndOfMonth(),PageUp:()=>this.navigateMonth(-1),PageDown:()=>this.navigateMonth(1),Tab:t=>this.handleTabNavigation(t)}}createErrorHandler(){return{handle:(t,e)=>{const i=new b(t.message||"Unknown error","DateTimePicker",{context:e,originalError:t});V.error("DateTimePicker Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"animation":this.animationState.openProgress=this.isOpen?1:0;break;case"render":this.clearRenderCache();break;case"navigation":this.focusedDate=new Date(this.value);break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","application"),this.setAttribute("aria-label","Date and time picker"),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("keydown",t=>this.handleKeyDown(t)),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupResizeObserver(){"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{this.clearRenderCache(),this.throttledRender()}),this.element&&this.resizeObserver.observe(this.element))}setupEventHandlers(){const t={click:this.handleClick.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async open(){if(!(this.isOpen||this.disabled))try{this.isOpen=!0,this.focusedDate=new Date(this.value),this.prefersReducedMotion()?this.animationState.openProgress=1:await this.animateOpen(),this.announceChange("Date picker opened"),this.emit("opened")}catch(t){this.errorHandler.handle(t,"open")}}async close(){if(this.isOpen)try{this.isOpen=!1,this.prefersReducedMotion()?this.animationState.openProgress=0:await this.animateClose(),this.announceChange("Date picker closed"),this.emit("closed")}catch(t){this.errorHandler.handle(t,"close")}}async animateOpen(){return k.animate(this,{duration:200,easing:"ease-out",update:t=>{this.animationState.openProgress=t}})}async animateClose(){return k.animate(this,{duration:150,easing:"ease-in",update:t=>{this.animationState.openProgress=1-t}})}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}announceChange(t){this.announcer&&(this.announcer.textContent=t)}formatDate(t){try{const e={year:"numeric",month:"2-digit",day:"2-digit"};switch(this.format){case"DD/MM/YYYY":return t.toLocaleDateString(this.locale,e).split("/").reverse().join("/");case"YYYY-MM-DD":return t.toISOString().split("T")[0];default:return t.toLocaleDateString(this.locale,e)}}catch(e){return this.errorHandler.handle(e,"format-date"),""}}formatTime(t,e){try{if(this.show24Hour)return`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`;{const i=t>=n.HOURS_IN_12_FORMAT?"PM":"AM";return`${t%n.HOURS_IN_12_FORMAT||n.HOURS_IN_12_FORMAT}:${String(e).padStart(2,"0")} ${i}`}}catch(i){return this.errorHandler.handle(i,"format-time"),""}}getDaysInMonth(t,e){return new Date(e,t+1,0).getDate()}getFirstDayOfMonth(t,e){return new Date(e,t,1).getDay()}isDateDisabled(t){return!!(this.minDate&&t<this.minDate||this.maxDate&&t>this.maxDate)}isToday(t){const e=new Date;return t.toDateString()===e.toDateString()}isSameDate(t,e){return t.toDateString()===e.toDateString()}navigateDay(t){try{const e=new Date(this.focusedDate);e.setDate(e.getDate()+t),this.isDateDisabled(e)||(this.focusedDate=e,this.updateDisplayMonth(),this.announceChange(`Focused on ${this.formatDate(this.focusedDate)}`))}catch(e){this.errorHandler.handle(e,"navigate-day")}}navigateMonth(t){try{this.displayMonth+=t,this.displayMonth<0?(this.displayMonth=11,this.displayYear--):this.displayMonth>n.MONTHS_PER_YEAR-1&&(this.displayMonth=0,this.displayYear++),this.focusedDate=new Date(this.displayYear,this.displayMonth,Math.min(this.focusedDate.getDate(),this.getDaysInMonth(this.displayMonth,this.displayYear))),this.announceChange(`Viewing ${this.getMonthNames()[this.displayMonth]} ${this.displayYear}`),this.clearRenderCache()}catch(e){this.errorHandler.handle(e,"navigate-month")}}updateDisplayMonth(){const t=this.focusedDate.getMonth(),e=this.focusedDate.getFullYear();(t!==this.displayMonth||e!==this.displayYear)&&(this.displayMonth=t,this.displayYear=e,this.clearRenderCache())}goToToday(){try{const t=new Date;this.focusedDate=t,this.displayMonth=t.getMonth(),this.displayYear=t.getFullYear(),this.announceChange("Navigated to today"),this.clearRenderCache()}catch(t){this.errorHandler.handle(t,"go-to-today")}}goToEndOfMonth(){try{const t=this.getDaysInMonth(this.displayMonth,this.displayYear);this.focusedDate=new Date(this.displayYear,this.displayMonth,t),this.announceChange(`Navigated to end of month: ${this.formatDate(this.focusedDate)}`)}catch(t){this.errorHandler.handle(t,"go-to-end-of-month")}}confirmSelection(){try{this.currentView==="calendar"?(this.selectDate(this.focusedDate),this.showTime?(this.currentView="time",this.announceChange("Switched to time selection")):this.close()):this.currentView==="time"&&(this.updateDateTime(),this.close())}catch(t){this.errorHandler.handle(t,"confirm-selection")}}selectDate(t){try{this.isDateDisabled(t)||(this.value=new Date(t),this.value.setHours(this.selectedHour,this.selectedMinute,0,0),this.emit("dateChanged",{value:this.value}),this.announceChange(`Selected ${this.formatDate(this.value)}`))}catch(e){this.errorHandler.handle(e,"select-date")}}getMonthNames(){return["January","February","March","April","May","June","July","August","September","October","November","December"]}handleClick(t){if(!this.disabled)try{const{localX:e,localY:i}=t;if(!this.isOpen){this.open();return}this.currentView==="calendar"?this.handleCalendarClick(e,i):this.currentView==="time"&&this.handleTimeClick(e,i)}catch(e){this.errorHandler.handle(e,"click-handler")}}handleCalendarClick(t,e){try{if(e<n.DATETIMEPICKER_HEADER_HEIGHT){t<n.DATETIMEPICKER_NAV_BUTTON_SIZE?this.navigateMonth(-1):t>this.width-n.DATETIMEPICKER_NAV_BUTTON_SIZE?this.navigateMonth(1):this.showTime&&t>this.width-n.DATETIMEPICKER_TIME_BUTTON_WIDTH&&(this.currentView="time",this.announceChange("Switched to time selection"));return}const i=e-n.DATETIMEPICKER_CALENDAR_TOP_OFFSET,s=this.width/n.DAYS_PER_WEEK,a=30;if(i>=0){const h=Math.floor(t/s),o=Math.floor(i/a),l=this.getFirstDayOfMonth(this.displayMonth,this.displayYear),r=o*n.DAYS_PER_WEEK+h-l+1,E=this.getDaysInMonth(this.displayMonth,this.displayYear);if(r>=1&&r<=E){const g=new Date(this.displayYear,this.displayMonth,r);this.isDateDisabled(g)||(this.focusedDate=g,this.selectDate(g),this.showTime||this.close())}}}catch(i){this.errorHandler.handle(i,"calendar-click")}}handleTimeClick(t,e){try{const i=this.width/2,s=this.height/2,a=80,h=t-i,o=e-s,l=Math.sqrt(h*h+o*o);if(l<=a){const E=(Math.atan2(o,h)+Math.PI*2)%(Math.PI*2);l<a*n.TIME_SELECTOR_RADIUS_FACTOR?(this.selectedHour=Math.floor(E/(Math.PI*2)*n.HOURS_IN_12_FORMAT),!this.show24Hour&&this.selectedHour===0&&(this.selectedHour=12)):this.selectedMinute=Math.floor(E/(Math.PI*2)*n.MINUTES_PER_HOUR),this.updateDateTime()}e<n.DATETIMEPICKER_HEADER_HEIGHT&&t<n.DATETIMEPICKER_TIME_BUTTON_WIDTH&&(this.currentView="calendar",this.announceChange("Switched to calendar view"))}catch(i){this.errorHandler.handle(i,"time-click")}}handleKeyDown(t){if(!this.disabled)try{if(!this.isOpen){(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.open());return}const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),e(t))}catch(e){this.errorHandler.handle(e,"keyboard-handler")}}handleTabNavigation(t){const e=this.getFocusableElements(),i=e.indexOf(t.target);t.shiftKey?i<=0&&(t.preventDefault(),e[e.length-1]?.focus()):i>=e.length-1&&(t.preventDefault(),e[0]?.focus())}getFocusableElements(){return Array.from(this.element?.querySelectorAll('[tabindex]:not([tabindex="-1"])')||[])}handleFocus(){this.isFocused=!0,this.emit("focus")}handleBlur(){this.isFocused=!1,this.emit("blur"),this.isOpen&&!this.persistent&&setTimeout(()=>this.close(),n.CLOSE_TIMEOUT)}handleFocusIn(){this.setAttribute("aria-describedby","date-picker-instructions"),this.announcer.textContent="Use arrow keys to navigate dates, Enter to select, Escape to close"}handleFocusOut(){this.removeAttribute("aria-describedby")}updateDateTime(){try{this.value.setHours(this.selectedHour),this.value.setMinutes(this.selectedMinute),this.emit("dateChanged",{value:this.value}),this.announceChange(`Time updated to ${this.formatTime(this.selectedHour,this.selectedMinute)}`)}catch(t){this.errorHandler.handle(t,"update-date-time")}}renderSelf(t){if(t.type==="canvas")try{G.startMonitoring("DateTimePicker"),!this.isOpen&&this.animationState.openProgress===0?this.renderInputField(t):this.renderPicker(t),G.endMonitoring("DateTimePicker")}catch(e){this.errorHandler.handle(e,"render")}}renderInputField(t){const e=`input_${this.formatDate(this.value)}_${this.width}_${this.height}_${this.disabled}`;if(this.renderCache.has(e)){const a=this.renderCache.get(e);t.drawImage(a,0,0);return}const i=new OffscreenCanvas(this.width,n.DATETIMEPICKER_HEADER_RENDER_HEIGHT),s=i.getContext("2d");this.drawInputField(s),this.renderCache.set(e,i),t.drawImage(i,0,0)}drawInputField(t){t.fillStyle=this.disabled?d.getColor("disabled",this.theme):d.getColor("background",this.theme),t.fillRect(0,0,this.width,n.DATETIMEPICKER_HEADER_RENDER_HEIGHT);const e=this.disabled?d.getColor("border",this.theme):this.isFocused?d.getColor("focus",this.theme):d.getColor("border",this.theme);t.strokeStyle=e,t.lineWidth=this.isFocused?2:1,t.strokeRect(0,0,this.width,n.DATETIMEPICKER_HEADER_RENDER_HEIGHT),t.fillStyle=this.disabled?d.getColor("textDisabled",this.theme):d.getColor("text",this.theme),t.font="14px Arial",t.textAlign="left",t.textBaseline="middle";let i=this.formatDate(this.value);this.showTime&&(i+=` ${this.formatTime(this.selectedHour,this.selectedMinute)}`),t.fillText(i,n.DATETIMEPICKER_TEXT_MARGIN,n.DATETIMEPICKER_ICON_MARGIN),t.fillStyle=d.getColor("textSecondary",this.theme),t.font="16px Arial",t.textAlign="right",t.fillText("📅",this.width-n.DATETIMEPICKER_TEXT_MARGIN,n.DATETIMEPICKER_ICON_MARGIN),this.isFocused&&this.drawFocusIndicator(t),this.disabled&&(t.fillStyle="rgba(255, 255, 255, 0.5)",t.fillRect(0,0,this.width,n.DATETIMEPICKER_DISABLED_OVERLAY_HEIGHT))}drawFocusIndicator(t){t.strokeStyle=d.getColor("focus",this.theme),t.lineWidth=n.DATETIMEPICKER_FOCUS_STROKE_WIDTH,t.setLineDash([n.DATETIMEPICKER_FOCUS_STROKE_OFFSET,n.DATETIMEPICKER_FOCUS_STROKE_OFFSET]),t.strokeRect(n.DATETIMEPICKER_FOCUS_STROKE_OFFSET,n.DATETIMEPICKER_FOCUS_STROKE_OFFSET,this.width-n.DATETIMEPICKER_FOCUS_STROKE_BORDER,n.DATETIMEPICKER_FOCUS_STROKE_HEIGHT),t.setLineDash([])}renderPicker(t){const e=this.animationState.openProgress;t.globalAlpha=e,t.fillStyle=d.getColor("background",this.theme),t.fillRect(0,0,this.width,this.height),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(0,0,this.width,this.height),t.shadowColor="rgba(0, 0, 0, 0.1)",t.shadowBlur=10,t.shadowOffsetY=5,this.currentView==="calendar"?this.renderCalendar(t):this.renderTimePicker(t),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetY=0,t.globalAlpha=1}renderCalendar(t){this.renderCalendarHeader(t),this.renderDayLabels(t),this.renderCalendarGrid(t),this.isFocused&&this.renderInstructions(t)}renderCalendarHeader(t){t.fillStyle=d.getColor("primary",this.theme),t.fillRect(0,0,this.width,n.DATETIMEPICKER_HEADER_RENDER_HEIGHT);const e=this.getMonthNames();t.fillStyle=d.getColor("onPrimary",this.theme),t.font="bold 14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(`${e[this.displayMonth]} ${this.displayYear}`,this.width/2,n.DATETIMEPICKER_ICON_MARGIN),t.font="16px Arial",t.textAlign="center",t.fillText("‹",n.DATETIMEPICKER_ICON_MARGIN,n.DATETIMEPICKER_ICON_MARGIN),t.fillText("›",this.width-n.DATETIMEPICKER_ICON_MARGIN,n.DATETIMEPICKER_ICON_MARGIN),this.showTime&&(t.font="12px Arial",t.textAlign="right",t.fillText("Time",this.width-n.DATETIMEPICKER_TIME_BUTTON_LABEL_OFFSET,n.DATETIMEPICKER_ICON_MARGIN))}renderDayLabels(t){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=this.width/n.CALENDAR_GRID_COLUMNS;t.fillStyle=d.getColor("textSecondary",this.theme),t.font="bold 12px Arial",t.textAlign="center",t.textBaseline="middle",e.forEach((s,a)=>{const h=a*i+i/2;t.fillText(s,h,n.DATETIMEPICKER_DAY_LABEL_Y)}),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.beginPath(),t.moveTo(0,n.DATETIMEPICKER_LINE_Y),t.lineTo(this.width,n.DATETIMEPICKER_LINE_Y),t.stroke()}renderCalendarGrid(t){const e=this.width/n.CALENDAR_GRID_COLUMNS,i=30,s=70,a=this.getFirstDayOfMonth(this.displayMonth,this.displayYear),h=this.getDaysInMonth(this.displayMonth,this.displayYear);for(let o=1;o<=h;o++){const l=a+o-1,r=Math.floor(l/n.CALENDAR_GRID_COLUMNS),g=l%n.CALENDAR_GRID_COLUMNS*e,_=s+r*i,I=new Date(this.displayYear,this.displayMonth,o),S=this.isSameDate(this.value,I),D=this.isSameDate(this.focusedDate,I),O=this.isToday(I),M=this.isDateDisabled(I);S?(t.fillStyle=d.getColor("primary",this.theme),t.fillRect(g+n.CALENDAR_CELL_PADDING,_+n.CALENDAR_CELL_PADDING,e-n.CALENDAR_CELL_BORDER,i-n.CALENDAR_CELL_BORDER)):D?(t.fillStyle=d.getColor("primaryLight",this.theme),t.fillRect(g+n.CALENDAR_CELL_PADDING,_+n.CALENDAR_CELL_PADDING,e-n.CALENDAR_CELL_BORDER,i-n.CALENDAR_CELL_BORDER)):O&&(t.fillStyle=d.getColor("warning",this.theme),t.fillRect(g+n.CALENDAR_CELL_PADDING,_+n.CALENDAR_CELL_PADDING,e-n.CALENDAR_CELL_BORDER,i-n.CALENDAR_CELL_BORDER)),D&&(t.strokeStyle=d.getColor("focus",this.theme),t.lineWidth=2,t.setLineDash([2,2]),t.strokeRect(g+1,_+1,e-2,i-2),t.setLineDash([])),t.fillStyle=M?d.getColor("textDisabled",this.theme):S?d.getColor("onPrimary",this.theme):O?d.getColor("onWarning",this.theme):d.getColor("text",this.theme),t.font=S?"bold 14px Arial":"14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(o.toString(),g+e/2,_+i/2),M&&(t.fillStyle="rgba(128, 128, 128, 0.5)",t.fillRect(g+n.CALENDAR_CELL_PADDING,_+n.CALENDAR_CELL_PADDING,e-n.CALENDAR_CELL_BORDER,i-n.CALENDAR_CELL_BORDER))}}renderInstructions(t){const e=["Arrow keys: Navigate","Enter: Select, Esc: Close","Home: Today, PgUp/PgDn: Month"];t.fillStyle=d.getColor("textSecondary",this.theme),t.font="10px Arial",t.textAlign="left",t.textBaseline="top",e.forEach((i,s)=>{t.fillText(i,n.CALENDAR_INSTRUCTION_Y_OFFSET,this.height-n.CALENDAR_INSTRUCTION_Y_BASE+s*n.CALENDAR_INSTRUCTION_LINE_SPACING)})}renderTimePicker(t){this.renderTimeHeader(t),this.renderClockFace(t),this.renderDigitalTime(t),this.isFocused&&this.renderTimeInstructions(t)}renderTimeHeader(t){t.fillStyle=d.getColor("primary",this.theme),t.fillRect(0,0,this.width,n.DATETIMEPICKER_HEADER_RENDER_HEIGHT),t.fillStyle=d.getColor("onPrimary",this.theme),t.font="14px Arial",t.textAlign="left",t.textBaseline="middle",t.fillText("← Calendar",n.DATETIMEPICKER_TEXT_MARGIN,n.DATETIMEPICKER_ICON_MARGIN);const e=this.formatTime(this.selectedHour,this.selectedMinute);t.textAlign="center",t.font="bold 16px Arial",t.fillText(e,this.width/2,n.DATETIMEPICKER_ICON_MARGIN)}renderClockFace(t){const e=this.width/2,i=this.height/2+n.DATETIMEPICKER_CENTER_OFFSET,s=80;t.fillStyle=d.getColor("backgroundSecondary",this.theme),t.beginPath(),t.arc(e,i,s,0,Math.PI*2),t.fill(),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=2,t.beginPath(),t.arc(e,i,s,0,Math.PI*2),t.stroke();for(let g=0;g<n.CLOCK_HOURS_COUNT;g++){const _=(g*n.CLOCK_HOUR_ANGLE_STEP-n.CLOCK_START_ANGLE_OFFSET)*Math.PI/n.CLOCK_ANGLE_TO_RADIANS,I=e+Math.cos(_)*(s-n.CLOCK_MAJOR_TICK_OUTER),S=i+Math.sin(_)*(s-n.CLOCK_MAJOR_TICK_OUTER),D=e+Math.cos(_)*(s-n.CLOCK_MAJOR_TICK_INNER),O=i+Math.sin(_)*(s-n.CLOCK_MAJOR_TICK_INNER);t.strokeStyle=d.getColor("textSecondary",this.theme),t.lineWidth=g%n.CLOCK_MAJOR_TICK_MODULO===0?n.CLOCK_MAJOR_TICK_WIDTH:n.CLOCK_MINOR_TICK_WIDTH,t.beginPath(),t.moveTo(I,S),t.lineTo(D,O),t.stroke();const M=g===0?n.CLOCK_TWELVE_HOUR_DISPLAY:g,U=e+Math.cos(_)*(s-n.CLOCK_HOUR_TEXT_RADIUS),z=i+Math.sin(_)*(s-n.CLOCK_HOUR_TEXT_RADIUS);t.fillStyle=d.getColor("text",this.theme),t.font=g%n.CLOCK_MAJOR_TICK_MODULO===0?"bold 14px Arial":"12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(M.toString(),U,z)}for(let g=0;g<n.CLOCK_MINUTES_COUNT;g+=n.CLOCK_MINUTE_STEP)if(g%n.CLOCK_QUARTER_HOUR_MINUTES!==0){const _=(g*n.CLOCK_MINUTE_ANGLE_STEP-n.CLOCK_START_ANGLE_OFFSET)*Math.PI/n.CLOCK_ANGLE_TO_RADIANS,I=e+Math.cos(_)*(s-n.CLOCK_MINOR_TICK_OUTER),S=i+Math.sin(_)*(s-n.CLOCK_MINOR_TICK_OUTER),D=e+Math.cos(_)*(s-n.CLOCK_MINOR_TICK_INNER),O=i+Math.sin(_)*(s-n.CLOCK_MINOR_TICK_INNER);t.strokeStyle=d.getColor("textSecondary",this.theme),t.lineWidth=1,t.beginPath(),t.moveTo(I,S),t.lineTo(D,O),t.stroke()}const a=(this.selectedHour%n.CLOCK_HOURS_COUNT*n.CLOCK_HOUR_ANGLE_STEP-n.CLOCK_START_ANGLE_OFFSET)*Math.PI/n.CLOCK_ANGLE_TO_RADIANS,h=e+Math.cos(a)*(s*n.CLOCK_HOUR_HAND_RADIUS_FACTOR),o=i+Math.sin(a)*(s*n.CLOCK_HOUR_HAND_RADIUS_FACTOR);t.fillStyle=d.getColor("primary",this.theme),t.beginPath(),t.arc(h,o,n.CLOCK_HOUR_INDICATOR_RADIUS,0,Math.PI*2),t.fill(),t.strokeStyle=d.getColor("primary",this.theme),t.lineWidth=4,t.beginPath(),t.moveTo(e,i),t.lineTo(h,o),t.stroke();const l=(this.selectedMinute*n.CLOCK_MINUTE_ANGLE_STEP-n.CLOCK_START_ANGLE_OFFSET)*Math.PI/n.CLOCK_ANGLE_TO_RADIANS,r=e+Math.cos(l)*(s*n.CLOCK_MINUTE_HAND_RADIUS_FACTOR),E=i+Math.sin(l)*(s*n.CLOCK_MINUTE_HAND_RADIUS_FACTOR);t.fillStyle=d.getColor("secondary",this.theme),t.beginPath(),t.arc(r,E,n.CLOCK_MINUTE_INDICATOR_RADIUS,0,Math.PI*2),t.fill(),t.strokeStyle=d.getColor("secondary",this.theme),t.lineWidth=3,t.beginPath(),t.moveTo(e,i),t.lineTo(r,E),t.stroke(),t.fillStyle=d.getColor("text",this.theme),t.beginPath(),t.arc(e,i,n.CLOCK_CENTER_DOT_RADIUS,0,Math.PI*2),t.fill()}renderDigitalTime(t){const e=this.formatTime(this.selectedHour,this.selectedMinute);t.fillStyle=d.getColor("background",this.theme),t.fillRect(this.width/2-n.DIGITAL_TIME_OFFSET_X,this.height-n.DIGITAL_TIME_OFFSET_Y,n.DIGITAL_TIME_WIDTH,n.DIGITAL_TIME_HEIGHT),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(this.width/2-n.DIGITAL_TIME_OFFSET_X,this.height-n.DIGITAL_TIME_OFFSET_Y,n.DIGITAL_TIME_WIDTH,n.DIGITAL_TIME_HEIGHT),t.fillStyle=d.getColor("text",this.theme),t.font="bold 18px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText(e,this.width/2,this.height-n.DIGITAL_TIME_TEXT_Y)}renderTimeInstructions(t){const e=["Click clock: Set time","Enter: Confirm, Esc: Cancel"];t.fillStyle=d.getColor("textSecondary",this.theme),t.font="10px Arial",t.textAlign="left",t.textBaseline="top",e.forEach((i,s)=>{t.fillText(i,n.TIME_INSTRUCTION_MARGIN,n.TIME_INSTRUCTION_MARGIN+s*n.TIME_INSTRUCTION_LINE_HEIGHT)})}clearRenderCache(){this.renderCache.clear()}throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}getValue(){return new Date(this.value)}async setValue(t){try{const e=new Date(t);if(isNaN(e.getTime()))throw new b(`Invalid date value: ${t}`,"DateTimePicker");if(this.isDateDisabled(e))throw new b("Date is disabled","DateTimePicker");const i=new Date(this.value);this.value=e,this.selectedHour=e.getHours(),this.selectedMinute=e.getMinutes(),this.displayMonth=e.getMonth(),this.displayYear=e.getFullYear(),this.focusedDate=new Date(e),this.clearRenderCache(),i.getTime()!==this.value.getTime()&&this.emit("dateChanged",{value:this.value,oldValue:i,formatted:{date:this.formatDate(this.value),time:this.formatTime(this.selectedHour,this.selectedMinute)}})}catch(e){this.errorHandler.handle(e,"setValue")}}reset(){const t=new Date;this.value=t,this.selectedHour=t.getHours(),this.selectedMinute=t.getMinutes(),this.displayMonth=t.getMonth(),this.displayYear=t.getFullYear(),this.focusedDate=new Date(t),this.isOpen=!1,this.currentView="calendar",this.animationState.openProgress=0,this.clearRenderCache(),this.emit("reset")}enable(){this.disabled=!1,this.setAttribute("tabindex","0"),this.clearRenderCache(),this.emit("enabled")}disable(){this.disabled=!0,this.setAttribute("tabindex","-1"),this.close(),this.clearRenderCache(),this.emit("disabled")}destroy(){try{k.cancelAnimation(this),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.clearRenderCache(),this.debounceTimer&&clearTimeout(this.debounceTimer),super.destroy?.(),this.emit("destroyed")}catch(t){x.error("Error during DateTimePicker cleanup:",t)}}}class Gt extends C{constructor(t={}){super({...t,width:t.width||n.NUMBER_INPUT_DEFAULT_WIDTH,height:t.height||n.NUMBER_INPUT_DEFAULT_HEIGHT,ariaRole:"spinbutton",ariaLabel:t.ariaLabel||"Number Input"}),this.validateOptions(t),this.value=t.value||0,this.min=t.min!==void 0?t.min:-1/0,this.max=t.max!==void 0?t.max:1/0,this.step=t.step||1,this.precision=t.precision||0,this.placeholder=t.placeholder||"",this.disabled=t.disabled||!1,this.showControls=t.showControls!==!1,this.allowDecimals=t.allowDecimals!==!1,this.prefix=t.prefix||"",this.suffix=t.suffix||"",this.theme=t.theme||d.getCurrentTheme(),this.isFocused=!1,this.isEditing=!1,this.editingValue="",this.isMouseDownOnControl=!1,this.repeatInterval=null,this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),Y.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler();try{this.setupEventHandlers(),this.setupAccessibility(),this.setupResizeObserver()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.min!==void 0&&t.max!==void 0&&t.min>t.max)throw new b("min cannot be greater than max","NumberInput");if(t.step!==void 0&&(typeof t.step!="number"||t.step<=0))throw new b("step must be a positive number","NumberInput");if(t.precision!==void 0&&(!Number.isInteger(t.precision)||t.precision<0))throw new b("precision must be a non-negative integer","NumberInput")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{ArrowUp:()=>this.increment(),ArrowDown:()=>this.decrement(),Enter:()=>this.commitEdit(),Escape:()=>this.cancelEdit(),Home:()=>this.setValue(this.min),End:()=>this.setValue(this.max),PageUp:()=>this.setValue(this.value+this.step*10),PageDown:()=>this.setValue(this.value-this.step*10)}}createErrorHandler(){return{handle:(t,e)=>{const i=new b(t.message||"Unknown error","NumberInput",{context:e,originalError:t});x.error("NumberInput Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"validation":this.value=this.clampValue(this.value);break;case"render":this.clearRenderCache();break;case"editing":this.cancelEdit();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","spinbutton"),this.setAttribute("aria-valuemin",this.min.toString()),this.setAttribute("aria-valuemax",this.max.toString()),this.setAttribute("aria-valuenow",this.value.toString()),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.on("valueChanged",({value:t})=>{this.setAttribute("aria-valuenow",t.toString())}),this.addEventListener("keydown",t=>this.handleKeyDown(t)),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupResizeObserver(){"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{this.clearRenderCache(),this.throttledRender()}),this.element&&this.resizeObserver.observe(this.element))}setupEventHandlers(){const t={click:this.handleClick.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this),wheel:this.handleWheel.bind(this),mouseDown:this.handleMouseDown.bind(this),mouseUp:this.handleMouseUp.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async setValue(t,e=!0){try{const i=this.parseValue(t);if(i===null)throw new b(`Invalid numeric value: ${t}`,"NumberInput");const s=this.value;this.value=this.clampValue(i),this.clearRenderCache(),s!==this.value&&(this.emit("valueChanged",{value:this.value,oldValue:s,formatted:this.formatValue(this.value)}),e&&this.announceChange(`Value changed to ${this.formatValue(this.value)}`))}catch(i){this.errorHandler.handle(i,"setValue")}}parseValue(t){if(typeof t=="number")return t;if(typeof t=="string"){let e=t;this.prefix&&e.startsWith(this.prefix)&&(e=e.substring(this.prefix.length)),this.suffix&&e.endsWith(this.suffix)&&(e=e.substring(0,e.length-this.suffix.length));const i=parseFloat(e.trim());return isNaN(i)?null:i}return null}clampValue(t){let e=Math.max(this.min,Math.min(this.max,t));if(this.step!==1){const i=Math.round((e-this.min)/this.step);e=this.min+i*this.step}return this.precision>0?e=parseFloat(e.toFixed(this.precision)):e=Math.round(e),e}formatValue(t){let e;return this.precision>0?e=t.toFixed(this.precision):e=Math.round(t).toString(),this.prefix+e+this.suffix}increment(){try{this.setValue(this.value+this.step),this.announceChange(`Incremented to ${this.formatValue(this.value)}`)}catch(t){this.errorHandler.handle(t,"increment")}}decrement(){try{this.setValue(this.value-this.step),this.announceChange(`Decremented to ${this.formatValue(this.value)}`)}catch(t){this.errorHandler.handle(t,"decrement")}}startRepeating(t){this.stopRepeating();const e=()=>{t==="increment"?this.increment():this.decrement(),this.repeatInterval=setTimeout(e,n.NUMBER_INPUT_REPEAT_INTERVAL)};this.repeatInterval=setTimeout(e,n.NUMBER_INPUT_REPEAT_INITIAL_DELAY)}stopRepeating(){this.repeatInterval&&(clearTimeout(this.repeatInterval),this.repeatInterval=null)}announceChange(t){this.announcer&&(this.announcer.textContent=t)}handleClick(t){if(!this.disabled)try{const{localX:e,localY:i}=t;this.showControls&&e>this.width-n.NUMBER_INPUT_CONTROL_WIDTH?i<this.height/2?this.increment():this.decrement():this.startEditing()}catch(e){this.errorHandler.handle(e,"click-handler")}}handleMouseDown(t){if(!this.disabled)try{const{localX:e,localY:i}=t;if(this.showControls&&e>this.width-n.NUMBER_INPUT_CONTROL_WIDTH){this.isMouseDownOnControl=!0;const s=i<this.height/2?"increment":"decrement";this.startRepeating(s),t.preventDefault()}}catch(e){this.errorHandler.handle(e,"mouse-down")}}handleMouseUp(){this.isMouseDownOnControl&&(this.isMouseDownOnControl=!1,this.stopRepeating())}handleKeyDown(t){if(!this.disabled)try{if(this.isEditing)switch(t.key){case"Enter":this.commitEdit();break;case"Escape":this.cancelEdit();break;case"Backspace":this.editingValue=this.editingValue.slice(0,-1);break;default:this.isValidInput(t.key)&&(this.editingValue+=t.key)}else{const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),e())}}catch(e){this.errorHandler.handle(e,"keyboard-handler")}}handleFocus(){this.isFocused=!0,this.emit("focus")}handleBlur(){this.isFocused=!1,this.isEditing&&this.commitEdit(),this.emit("blur")}handleWheel(t){if(!(this.disabled||!this.isFocused))try{t.preventDefault(),t.deltaY<0?this.increment():this.decrement()}catch(e){this.errorHandler.handle(e,"wheel-handler")}}handleFocusIn(){this.setAttribute("aria-describedby","number-input-instructions"),this.announcer.textContent="Use arrow keys to adjust value, Enter to edit directly"}handleFocusOut(){this.removeAttribute("aria-describedby")}isValidInput(t){return!(!(this.allowDecimals?"0123456789.-":"0123456789-").includes(t)||t==="."&&this.editingValue.includes(".")||t==="-"&&(this.editingValue.includes("-")||this.editingValue.length>0))}startEditing(){try{this.isEditing=!0,this.editingValue=this.formatValue(this.value),this.announceChange("Editing mode activated")}catch(t){this.errorHandler.handle(t,"start-editing")}}commitEdit(){try{const t=this.parseValue(this.editingValue);t!==null&&this.setValue(t,!1),this.isEditing=!1,this.editingValue="",this.announceChange("Edit committed")}catch(t){this.errorHandler.handle(t,"commit-edit")}}cancelEdit(){try{this.isEditing=!1,this.editingValue="",this.announceChange("Edit cancelled")}catch(t){this.errorHandler.handle(t,"cancel-edit")}}renderSelf(t){if(t.type==="canvas")try{G.startMonitoring("NumberInput"),t.fillStyle=this.disabled?d.getColor("disabled",this.theme):d.getColor("background",this.theme),t.fillRect(0,0,this.width,this.height);const e=this.disabled?d.getColor("border",this.theme):this.isFocused?d.getColor("focus",this.theme):d.getColor("border",this.theme);t.strokeStyle=e,t.lineWidth=this.isFocused?2:1,t.strokeRect(0,0,this.width,this.height);const i=this.isEditing?this.editingValue:this.formatValue(this.value),s=this.disabled?d.getColor("textDisabled",this.theme):d.getColor("text",this.theme);t.fillStyle=s,t.font="14px Arial",t.textAlign="left",t.textBaseline="middle";const a=i||this.placeholder;!i&&this.placeholder&&(t.fillStyle=d.getColor("textSecondary",this.theme),t.font="italic 14px Arial"),t.fillText(a,n.NUMBER_INPUT_TEXT_MARGIN,this.height/2),this.showControls&&this.renderSpinnerControls(t),this.isEditing&&this.isFocused&&this.renderCursor(t,i),this.isFocused&&this.drawFocusIndicator(t),this.disabled&&(t.fillStyle="rgba(255, 255, 255, 0.6)",t.fillRect(0,0,this.width,this.height)),G.endMonitoring("NumberInput")}catch(e){this.errorHandler.handle(e,"render")}}drawFocusIndicator(t){t.strokeStyle=d.getColor("focus",this.theme),t.lineWidth=2,t.setLineDash([2,2]),t.strokeRect(n.FOCUS_INDICATOR_OFFSET,n.FOCUS_INDICATOR_OFFSET,this.width-n.FOCUS_INDICATOR_BORDER,this.height-n.FOCUS_INDICATOR_BORDER),t.setLineDash([])}renderSpinnerControls(t){const i=this.width-20;t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.beginPath(),t.moveTo(i,0),t.lineTo(i,this.height),t.stroke();const s=this.isMouseDownOnControl?d.getColor("primaryLight",this.theme):d.getColor("background",this.theme);t.fillStyle=s,t.fillRect(i+1,1,18,this.height-2),t.fillStyle=d.getColor("textSecondary",this.theme),t.font="10px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("▲",i+20/2,this.height/n.NUMBER_INPUT_QUARTER_HEIGHT),t.fillText("▼",i+20/2,this.height*n.NUMBER_INPUT_THREE_QUARTER_HEIGHT/n.NUMBER_INPUT_QUARTER_HEIGHT)}renderCursor(t,e){const i=t.measureText(e).width,s=n.NUMBER_INPUT_TEXT_MARGIN+i+n.NUMBER_INPUT_CURSOR_OFFSET;Math.floor(Date.now()/n.NUMBER_INPUT_BLINK_INTERVAL)%2===0&&(t.strokeStyle=d.getColor("text",this.theme),t.lineWidth=1,t.beginPath(),t.moveTo(s,n.NUMBER_INPUT_CURSOR_MARGIN),t.lineTo(s,this.height-n.NUMBER_INPUT_CURSOR_MARGIN),t.stroke())}clearRenderCache(){this.renderCache.clear()}throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}getValue(){return this.value}reset(){this.value=0,this.isEditing=!1,this.editingValue="",this.isFocused=!1,this.stopRepeating(),this.clearRenderCache(),this.emit("reset")}enable(){this.disabled=!1,this.setAttribute("tabindex","0"),this.clearRenderCache(),this.emit("enabled")}disable(){this.disabled=!0,this.setAttribute("tabindex","-1"),this.cancelEdit(),this.stopRepeating(),this.clearRenderCache(),this.emit("disabled")}destroy(){try{this.stopRepeating(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.clearRenderCache(),this.debounceTimer&&clearTimeout(this.debounceTimer),super.destroy?.(),this.emit("destroyed")}catch(t){x.error("Error during NumberInput cleanup:",t)}}}class Wt extends C{constructor(t={}){super({...t,width:t.width||n.ACCORDION_DEFAULT_WIDTH,height:t.height||n.ACCORDION_DEFAULT_HEIGHT,ariaRole:"dialog",ariaLabel:t.ariaLabel||"Drawer"}),this.validateOptions(t),this.isOpen=t.isOpen||!1,this.position=t.position||"left",this.modal=t.modal!==!1,this.persistent=t.persistent||!1,this.title=t.title||"",this.content=t.content||"",this.disabled=t.disabled||!1,this.theme=t.theme||d.getCurrentTheme(),this.animationDuration=t.animationDuration||n.DEFAULT_ANIMATION_DURATION,this.animationState={isAnimating:!1,progress:this.isOpen?1:0,type:null,startTime:0},this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),Y.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.trapFocus=t.trapFocus!==!1,this.restoreFocus=t.restoreFocus!==!1,this.previouslyFocusedElement=null,this.errorHandler=this.createErrorHandler(),this.performanceMonitor=G.createInstance("Drawer");try{this.setupEventHandlers(),this.setupAccessibility(),this.setupResizeObserver(),this.setupTouchSupport()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){const e=["left","right","top","bottom"];if(t.position&&!e.includes(t.position))throw new b(`Invalid position: ${t.position}. Must be one of: ${e.join(", ")}`,"Drawer");if(t.animationDuration&&(typeof t.animationDuration!="number"||t.animationDuration<0))throw new b("Animation duration must be a positive number","Drawer")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{Escape:()=>!this.persistent&&this.close(),Tab:t=>this.handleTabNavigation(t),Enter:()=>this.handleEnterKey(),Space:()=>this.handleSpaceKey()}}createErrorHandler(){return{handle:(t,e)=>{const i=new b(t.message||"Unknown error","Drawer",{context:e,originalError:t});x.error("Drawer Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"animation":this.animationState.isAnimating=!1,k.cancelAnimation(this);break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","dialog"),this.setAttribute("aria-modal",this.modal.toString()),this.setAttribute("aria-hidden",(!this.isOpen).toString()),this.title&&this.setAttribute("aria-labelledby",`drawer-title-${this.id}`),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupResizeObserver(){"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{this.clearRenderCache(),this.throttledRender()}),this.element&&this.resizeObserver.observe(this.element))}setupTouchSupport(){this.touchState={startX:0,startY:0,currentX:0,currentY:0,isDragging:!1},this.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.addEventListener("touchmove",this.handleTouchMove.bind(this)),this.addEventListener("touchend",this.handleTouchEnd.bind(this))}setupEventHandlers(){const t={click:this.handleClick.bind(this),keyDown:this.handleKeyDown.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async open(){try{if(this.isOpen||this.animationState.isAnimating||this.disabled)return;this.isOpen=!0,this.setAttribute("aria-hidden","false"),this.restoreFocus&&document.activeElement&&(this.previouslyFocusedElement=document.activeElement),this.prefersReducedMotion()?this.animationState.progress=1:await this.startAnimation("open"),this.manageFocus(),this.announceChange(`${this.title||"Drawer"} opened`),this.emit("drawerOpened",{position:this.position})}catch(t){this.errorHandler.handle(t,"open")}}async close(){try{if(!this.isOpen||this.animationState.isAnimating)return;this.isOpen=!1,this.setAttribute("aria-hidden","true"),this.prefersReducedMotion()?this.animationState.progress=0:await this.startAnimation("close"),this.restoreFocus&&this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),this.previouslyFocusedElement=null),this.announceChange(`${this.title||"Drawer"} closed`),this.emit("drawerClosed",{position:this.position})}catch(t){this.errorHandler.handle(t,"close")}}async toggle(){this.isOpen?await this.close():await this.open()}async startAnimation(t){return this.animationState.isAnimating=!0,this.animationState.type=t,this.animationState.startTime=performance.now(),new Promise(e=>{const i=()=>{const s=performance.now()-this.animationState.startTime,a=Math.min(s/this.animationDuration,1),h=this.easeOutCubic(a);t==="open"?this.animationState.progress=h:this.animationState.progress=1-h,this.clearRenderCache(),a>=1?(this.animationState.isAnimating=!1,this.animationState.progress=this.isOpen?1:0,e()):requestAnimationFrame(i)};i()})}manageFocus(){this.trapFocus&&this.isOpen&&this.focus()}prefersReducedMotion(){return window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}announceChange(t){this.announcer&&(this.announcer.textContent=t)}easeOutCubic(t){return 1-Math.pow(1-t,n.EASING_CUBIC_POWER)}getDrawerBounds(){const{progress:t}=this.animationState;switch(this.position){case"left":return{x:-this.width+this.width*t,y:0,width:this.width,height:this.height};case"right":return{x:this.width-this.width*t,y:0,width:this.width,height:this.height};case"top":return{x:0,y:-this.height+this.height*t,width:this.width,height:this.height};case"bottom":return{x:0,y:this.height-this.height*t,width:this.width,height:this.height};default:return{x:0,y:0,width:this.width,height:this.height}}}handleClick(t){if(!this.disabled)try{const{localX:e,localY:i}=t,s=this.getDrawerBounds();if(this.title&&i>=s.y&&i<s.y+n.TOOLTIP_HEADER_HEIGHT&&e>=s.x+s.width-n.TOOLTIP_SHADOW_WIDTH&&e<s.x+s.width){this.close();return}this.modal&&!this.persistent&&(e>=s.x&&e<s.x+s.width&&i>=s.y&&i<s.y+s.height||this.close())}catch(e){this.errorHandler.handle(e,"click-handler")}}handleKeyDown(t){if(!this.disabled)try{const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),e(t))}catch(e){this.errorHandler.handle(e,"keyboard-handler")}}handleTabNavigation(t){if(!this.trapFocus||!this.isOpen)return;const e=this.getFocusableElements();if(e.length===0)return;const i=e[0],s=e[e.length-1];t.shiftKey?document.activeElement===i&&(t.preventDefault(),s.focus()):document.activeElement===s&&(t.preventDefault(),i.focus())}handleEnterKey(){this.emit("enterPressed")}handleSpaceKey(){this.emit("spacePressed")}handleFocusIn(){this.isFocused=!0,this.emit("focusIn")}handleFocusOut(){this.isFocused=!1,this.emit("focusOut")}handleTouchStart(t){if(this.disabled||!this.isOpen)return;const e=t.touches[0];this.touchState.startX=e.clientX,this.touchState.startY=e.clientY,this.touchState.currentX=e.clientX,this.touchState.currentY=e.clientY,this.touchState.isDragging=!1}handleTouchMove(t){if(this.disabled||!this.isOpen)return;const e=t.touches[0];this.touchState.currentX=e.clientX,this.touchState.currentY=e.clientY;const i=Math.abs(this.touchState.currentX-this.touchState.startX),s=Math.abs(this.touchState.currentY-this.touchState.startY);(i>10||s>10)&&(this.touchState.isDragging=!0)}handleTouchEnd(t){if(this.disabled||!this.isOpen||!this.touchState.isDragging)return;const e=this.touchState.currentX-this.touchState.startX,i=this.touchState.currentY-this.touchState.startY,s=50;let a=!1;switch(this.position){case"left":a=e<-s;break;case"right":a=e>s;break;case"top":a=i<-s;break;case"bottom":a=i>s;break}a&&!this.persistent&&this.close(),this.touchState.isDragging=!1}getFocusableElements(){const t=["button","[href]","input","select","textarea",'[tabindex]:not([tabindex="-1"])'];return Array.from(this.element?.querySelectorAll(t.join(","))||[]).filter(e=>!e.disabled&&e.offsetParent!==null)}renderSelf(t){if(t.type==="canvas"&&!(this.animationState.progress<=0))try{this.performanceMonitor.startMeasurement("render"),this.modal&&this.renderOverlay(t),this.renderDrawer(t),this.performanceMonitor.endMeasurement("render")}catch(e){this.errorHandler.handle(e,"render")}}renderOverlay(t){const e=this.animationState.progress*n.TOOLTIP_ANIMATION_ALPHA,i=d.getColor("overlay",this.theme);let s="rgba(0, 0, 0, 0.5)";if(i.startsWith("rgba")){const a=i.match(/rgba\(([^)]+)\)/);if(a){const h=a[1].split(",");h.length>=n.CONTENT_PARTS_RGB&&(s=`rgba(${h[0]}, ${h[1]}, ${h[2]}, ${e})`)}}else if(i.startsWith("rgb")){const a=i.match(/rgb\(([^)]+)\)/);a&&(s=`rgba(${a[1]}, ${e})`)}else s=`rgba(0, 0, 0, ${e})`;t.fillStyle=s,t.fillRect(0,0,this.width*2,this.height*2)}renderDrawer(t){const e=this.getDrawerBounds(),i=d.getColor("shadow",this.theme)||"rgba(0, 0, 0, 0.15)";t.shadowColor=i,t.shadowBlur=12,t.shadowOffsetX=this.position==="left"?n.TOOLTIP_OFFSET_DISTANCE:this.position==="right"?-3:0,t.shadowOffsetY=this.position==="top"?n.TOOLTIP_OFFSET_DISTANCE:this.position==="bottom"?-3:0,t.fillStyle=d.getColor("background",this.theme),t.fillRect(e.x,e.y,e.width,e.height),t.shadowColor="transparent",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(e.x,e.y,e.width,e.height),this.title&&this.renderHeader(t,e),this.renderContent(t,e),this.isFocused&&this.renderFocusIndicator(t,e)}renderHeader(t,e){t.fillStyle=d.getColor("backgroundSecondary",this.theme),t.fillRect(e.x,e.y,e.width,50),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.beginPath(),t.moveTo(e.x,e.y+50),t.lineTo(e.x+e.width,e.y+50),t.stroke(),t.fillStyle=d.getColor("text",this.theme),t.font="bold 16px Arial",t.textAlign="left",t.textBaseline="middle";const s=e.width-n.TOOLTIP_SHADOW_OFFSET,a=this.truncateText(t,this.title,s);t.fillText(a,e.x+n.TOOLTIP_PADDING,e.y+50/2);const h=e.x+e.width-n.CLOSE_BUTTON_SIZE,o=e.y+50/2;this.isCloseButtonHovered&&(t.fillStyle=d.getColor("dangerHover",this.theme),t.beginPath(),t.arc(h,o,n.CLOSE_BUTTON_RADIUS,0,Math.PI*2),t.fill()),t.fillStyle=d.getColor("textSecondary",this.theme),t.font="18px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("×",h,o)}renderContent(t,e){const i=e.y+(this.title?n.TOOLTIP_HEADER_HEIGHT:0),s=e.height-(this.title?n.TOOLTIP_HEADER_HEIGHT:0),a=n.TOOLTIP_PADDING;t.fillStyle=d.getColor("text",this.theme),t.font="14px Arial",t.textAlign="left",t.textBaseline="top";const h=this.content.split(`
`),o=e.width-a*2;let l=i+a;h.forEach(r=>{this.wrapText(t,r,o).forEach(g=>{l+n.TOOLTIP_CONTENT_LINE_HEIGHT<=i+s-a&&(t.fillText(g,e.x+a,l),l+=n.TOOLTIP_CONTENT_LINE_HEIGHT)})})}renderFocusIndicator(t,e){t.strokeStyle=d.getColor("focus",this.theme),t.lineWidth=2,t.setLineDash([n.TOOLTIP_BORDER_DASH,n.TOOLTIP_BORDER_DASH]),t.strokeRect(e.x+n.FOCUS_INDICATOR_OFFSET,e.y+n.FOCUS_INDICATOR_OFFSET,e.width-n.FOCUS_INDICATOR_BORDER,e.height-n.FOCUS_INDICATOR_BORDER),t.setLineDash([])}wrapText(t,e,i){const s=e.split(" "),a=[];let h="";for(const o of s){const l=h+(h?" ":"")+o;t.measureText(l).width>i&&h?(a.push(h),h=o):h=l}return h&&a.push(h),a.length?a:[""]}truncateText(t,e,i){if(t.measureText(e).width<=i)return e;const a="...";let h=e;for(;t.measureText(h+a).width>i&&h.length>0;)h=h.slice(0,-1);return h+a}clearRenderCache(){this.renderCache.clear()}throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}setTitle(t){this.title=t,this.title&&this.setAttribute("aria-labelledby",`drawer-title-${this.id}`),this.clearRenderCache(),this.emit("titleChanged",{title:t})}setContent(t){this.content=t,this.clearRenderCache(),this.emit("contentChanged",{content:t})}setPosition(t){if(!["left","right","top","bottom"].includes(t))throw new b(`Invalid position: ${t}`,"Drawer");this.position=t,this.clearRenderCache(),this.emit("positionChanged",{position:t})}enable(){this.disabled=!1,this.setAttribute("tabindex","0"),this.clearRenderCache(),this.emit("enabled")}disable(){this.disabled=!0,this.setAttribute("tabindex","-1"),this.close(),this.clearRenderCache(),this.emit("disabled")}reset(){this.isOpen=!1,this.animationState={isAnimating:!1,progress:0,type:null,startTime:0},this.setAttribute("aria-hidden","true"),this.clearRenderCache(),this.emit("reset")}destroy(){try{k.cancelAnimation(this),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.restoreFocus&&this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),this.previouslyFocusedElement=null),this.clearRenderCache(),this.debounceTimer&&clearTimeout(this.debounceTimer),super.destroy?.(),this.emit("destroyed")}catch(t){x.error("Error during Drawer cleanup:",t)}}}class Vt extends C{constructor(t={}){super({...t,width:t.width||n.SEARCHBOX_DEFAULT_WIDTH,height:t.height||n.SEARCHBOX_DEFAULT_HEIGHT,ariaRole:"searchbox",ariaLabel:t.ariaLabel||"Search"}),this.validateOptions(t),this.value=t.value||"",this.placeholder=t.placeholder||"Search...",this.disabled=t.disabled||!1,this.showClearButton=t.showClearButton!==!1,this.showSearchButton=t.showSearchButton!==!1,this.debounceDelay=t.debounceDelay||n.SEARCHBOX_DEBOUNCE_DELAY,this.searchOnType=t.searchOnType!==!1,this.minSearchLength=t.minSearchLength||1,this.suggestions=t.suggestions||[],this.showSuggestions=t.showSuggestions!==!1,this.maxSuggestions=t.maxSuggestions||n.SEARCHBOX_MAX_SUGGESTIONS,this.caseSensitive=t.caseSensitive||!1,this.highlightMatches=t.highlightMatches!==!1,this.theme=t.theme||d.getCurrentTheme(),this.isFocused=!1,this.showingSuggestions=!1,this.filteredSuggestions=[],this.selectedSuggestionIndex=-1,this.debounceTimer=null,this.searchHistory=[],this.maxHistoryLength=t.maxHistoryLength||10,this.animationState={suggestionProgress:0},this.renderCache=new Map,this.throttledRender=this.throttle(this.render.bind(this),Y.eventThrottle),this.announcer=this.createScreenReaderAnnouncer(),this.keyboardHandler=this.createKeyboardHandler(),this.errorHandler=this.createErrorHandler(),this.performanceMonitor=G.createInstance("SearchBox");try{this.setupEventHandlers(),this.setupAccessibility(),this.setupResizeObserver()}catch(e){this.errorHandler.handle(e,"constructor")}}validateOptions(t){if(t.debounceDelay&&(typeof t.debounceDelay!="number"||t.debounceDelay<0))throw new b("Debounce delay must be a positive number","SearchBox");if(t.minSearchLength&&(typeof t.minSearchLength!="number"||t.minSearchLength<0))throw new b("Minimum search length must be a positive number","SearchBox");if(t.maxSuggestions&&(typeof t.maxSuggestions!="number"||t.maxSuggestions<1))throw new b("Maximum suggestions must be a positive number","SearchBox")}createScreenReaderAnnouncer(){const t=document.createElement("div");return t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,document.body.appendChild(t),t}createKeyboardHandler(){return{Enter:()=>this.handleEnterKey(),Escape:()=>this.handleEscapeKey(),ArrowDown:()=>this.navigateSuggestions(1),ArrowUp:()=>this.navigateSuggestions(-1),Tab:t=>this.handleTabKey(t),Backspace:()=>this.handleBackspace(),Delete:()=>this.handleDelete()}}createErrorHandler(){return{handle:(t,e)=>{const i=new b(t.message||"Unknown error","SearchBox",{context:e,originalError:t});x.error("SearchBox Error:",i),this.emit("error",i),this.recoverFromError(e)}}}recoverFromError(t){switch(t){case"search":this.clearSuggestions();break;case"render":this.clearRenderCache();break;default:this.reset()}}setupAccessibility(){this.setAttribute("role","searchbox"),this.setAttribute("aria-autocomplete","list"),this.setAttribute("aria-expanded","false"),this.setAttribute("aria-haspopup","listbox"),this.setAttribute("tabindex",this.disabled?"-1":"0"),this.addEventListener("focusin",()=>this.handleFocusIn()),this.addEventListener("focusout",()=>this.handleFocusOut())}setupResizeObserver(){"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{this.clearRenderCache(),this.throttledRender()}),this.element&&this.resizeObserver.observe(this.element))}setupEventHandlers(){const t={click:this.handleClick.bind(this),keyDown:this.handleKeyDown.bind(this),keyUp:this.handleKeyUp.bind(this),focus:this.handleFocus.bind(this),blur:this.handleBlur.bind(this)};Object.entries(t).forEach(([e,i])=>{this.on(e,i)})}async setValue(t){try{const e=this.value;this.value=String(t||""),e!==this.value&&(this.clearRenderCache(),this.updateSuggestions(),this.emit("valueChanged",{value:this.value,oldValue:e}),this.searchOnType&&this.debouncedSearch())}catch(e){this.errorHandler.handle(e,"setValue")}}updateSuggestions(){try{if(!this.showSuggestions||this.value.length<this.minSearchLength){this.clearSuggestions();return}const t=this.caseSensitive?this.value:this.value.toLowerCase();if(this.filteredSuggestions=this.suggestions.filter(e=>(this.caseSensitive?e:e.toLowerCase()).includes(t)).slice(0,this.maxSuggestions),this.searchHistory.length>0&&t.length>0){const e=this.searchHistory.filter(i=>(this.caseSensitive?i:i.toLowerCase()).includes(t)&&!this.filteredSuggestions.includes(i)).slice(0,Math.max(0,this.maxSuggestions-this.filteredSuggestions.length));this.filteredSuggestions=[...this.filteredSuggestions,...e]}this.showingSuggestions=this.filteredSuggestions.length>0,this.selectedSuggestionIndex=-1,this.setAttribute("aria-expanded",this.showingSuggestions.toString()),this.showingSuggestions&&this.announceChange(`${this.filteredSuggestions.length} suggestions available`)}catch(t){this.errorHandler.handle(t,"updateSuggestions")}}clearSuggestions(){this.filteredSuggestions=[],this.showingSuggestions=!1,this.selectedSuggestionIndex=-1,this.setAttribute("aria-expanded","false")}debouncedSearch(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.performSearch()},this.debounceDelay)}async performSearch(){try{this.value.length>=this.minSearchLength&&(this.addToHistory(this.value),this.emit("search",{query:this.value,timestamp:new Date().toISOString()}))}catch(t){this.errorHandler.handle(t,"performSearch")}}addToHistory(t){!t||this.searchHistory.includes(t)||(this.searchHistory.unshift(t),this.searchHistory.length>this.maxHistoryLength&&(this.searchHistory=this.searchHistory.slice(0,this.maxHistoryLength)),this.emit("historyUpdated",{history:this.searchHistory}))}selectSuggestion(t){try{if(t>=0&&t<this.filteredSuggestions.length){const e=this.filteredSuggestions[t];this.setValue(e),this.clearSuggestions(),this.performSearch(),this.announceChange(`Selected: ${e}`),this.emit("suggestionSelected",{value:e,index:t})}}catch(e){this.errorHandler.handle(e,"selectSuggestion")}}navigateSuggestions(t){if(!this.showingSuggestions||this.filteredSuggestions.length===0)return;const e=this.filteredSuggestions.length-1;let i=this.selectedSuggestionIndex+t;if(i<-1?i=e:i>e&&(i=-1),this.selectedSuggestionIndex=i,i>=0){const s=this.filteredSuggestions[i];this.announceChange(`${i+1} of ${this.filteredSuggestions.length}: ${s}`)}else this.announceChange("Back to search input");this.clearRenderCache()}clear(){this.setValue(""),this.clearSuggestions(),this.emit("cleared")}announceChange(t){this.announcer&&(this.announcer.textContent=t)}handleClick(t){if(!this.disabled)try{const{localX:e,localY:i}=t;if(this.showClearButton&&this.value&&e>=this.width-n.SEARCHBOX_CLEAR_BUTTON_WIDTH&&e<this.width-n.SEARCHBOX_CLEAR_BUTTON_OFFSET){this.clear();return}if(this.showSearchButton&&e>=this.width-n.SEARCHBOX_SEARCH_BUTTON_WIDTH){this.performSearch();return}if(this.showingSuggestions&&i>this.height){const s=Math.floor((i-this.height)/n.SEARCHBOX_SUGGESTION_HEIGHT);s>=0&&s<this.filteredSuggestions.length&&this.selectSuggestion(s);return}this.focus()}catch(e){this.errorHandler.handle(e,"click-handler")}}handleKeyDown(t){if(!this.disabled)try{const e=this.keyboardHandler[t.key];e&&(t.preventDefault(),e(t))}catch(e){this.errorHandler.handle(e,"keyboard-handler")}}handleKeyUp(t){if(!this.disabled)try{t.key.length===1&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&this.setValue(this.value+t.key)}catch(e){this.errorHandler.handle(e,"keyup-handler")}}handleEnterKey(){this.selectedSuggestionIndex>=0?this.selectSuggestion(this.selectedSuggestionIndex):this.performSearch()}handleEscapeKey(){this.showingSuggestions?this.clearSuggestions():this.clear()}handleTabKey(t){this.showingSuggestions&&this.selectedSuggestionIndex>=0&&(t.preventDefault(),this.selectSuggestion(this.selectedSuggestionIndex))}handleBackspace(){this.value.length>0&&this.setValue(this.value.slice(0,-1))}handleDelete(){this.handleBackspace()}handleFocus(){this.isFocused=!0,this.updateSuggestions(),this.emit("focus")}handleBlur(){setTimeout(()=>{this.isFocused=!1,this.clearSuggestions(),this.emit("blur")},n.SEARCHBOX_SUGGESTION_ANIMATION_DELAY)}handleFocusIn(){this.isFocused=!0,this.clearRenderCache()}handleFocusOut(){this.isFocused=!1,this.clearRenderCache()}renderSelf(t){if(t.type==="canvas")try{this.performanceMonitor.startMeasurement("render"),this.renderInputField(t),this.showingSuggestions&&this.renderSuggestions(t),this.performanceMonitor.endMeasurement("render")}catch(e){this.errorHandler.handle(e,"render")}}renderInputField(t){const e=this.disabled?d.getColor("backgroundDisabled",this.theme):d.getColor("background",this.theme);t.fillStyle=e,t.fillRect(0,0,this.width,this.height);const i=this.isFocused?d.getColor("focus",this.theme):d.getColor("border",this.theme);t.strokeStyle=i,t.lineWidth=this.isFocused?2:1,t.strokeRect(0,0,this.width,this.height),this.renderSearchIcon(t),this.renderTextContent(t),this.showClearButton&&this.value&&this.renderClearButton(t),this.showSearchButton&&this.renderSearchButton(t),this.isFocused&&this.renderFocusIndicator(t),this.isFocused&&!this.showingSuggestions&&this.renderCursor(t)}renderSearchIcon(t){const i=this.height/2;t.fillStyle=d.getColor("textSecondary",this.theme),t.font="16px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("🔍",12,i)}renderTextContent(t){const e=this.value||this.placeholder,i=!this.value,s=this.disabled?d.getColor("disabled",this.theme):i?d.getColor("textSecondary",this.theme):d.getColor("text",this.theme);t.fillStyle=s,t.font=i?"italic 14px Arial":"14px Arial",t.textAlign="left",t.textBaseline="middle";const a=30,h=this.width-n.SEARCHBOX_BUTTON_SPACING,o=this.truncateText(t,e,h);t.fillText(o,a,this.height/2)}renderClearButton(t){const e=this.width-n.SEARCHBOX_BUTTON_POSITION,i=this.height/2,s=8;this.isClearButtonHovered&&(t.fillStyle=d.getColor("dangerHover",this.theme),t.beginPath(),t.arc(e,i,s,0,Math.PI*2),t.fill()),t.fillStyle=d.getColor("textSecondary",this.theme),t.font="14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("×",e,i)}renderSearchButton(t){const i=this.height-n.SEARCHBOX_BUTTON_HEIGHT_OFFSET,s=this.width-35-2,a=2;t.fillStyle=d.getColor("primary",this.theme),t.fillRect(s,a,35,i),t.fillStyle=d.getColor("primaryText",this.theme),t.font="12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("Go",s+35/2,a+i/2),t.strokeStyle=d.getColor("primaryBorder",this.theme),t.lineWidth=1,t.strokeRect(s,a,35,i)}renderFocusIndicator(t){t.strokeStyle=d.getColor("focus",this.theme),t.lineWidth=2,t.setLineDash([2,2]),t.strokeRect(n.FOCUS_INDICATOR_OFFSET,n.FOCUS_INDICATOR_OFFSET,this.width-n.FOCUS_INDICATOR_BORDER,this.height-n.FOCUS_INDICATOR_BORDER),t.setLineDash([])}renderCursor(t){const e=t.measureText(this.value).width,i=n.SEARCHBOX_SEARCH_ICON_OFFSET+e,s=Date.now(),a=Math.sin(s*n.SEARCHBOX_CURSOR_BLINK_FREQUENCY)*n.SEARCHBOX_CURSOR_OPACITY_FACTOR+n.SEARCHBOX_CURSOR_OPACITY_BASE;t.strokeStyle=`rgba(${this.theme==="dark"?"255,255,255":"0,0,0"}, ${a})`,t.lineWidth=1,t.beginPath(),t.moveTo(i,n.SEARCHBOX_CURSOR_MARGIN),t.lineTo(i,this.height-n.SEARCHBOX_CURSOR_MARGIN),t.stroke()}renderSuggestions(t){const e=this.height,i=30,s=this.filteredSuggestions.length*i;t.fillStyle=d.getColor("background",this.theme),t.fillRect(0,e,this.width,s),t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.strokeRect(0,e,this.width,s),this.filteredSuggestions.forEach((a,h)=>{this.renderSuggestion(t,a,h,e+h*i,i)})}renderSuggestion(t,e,i,s,a){const h=i===this.selectedSuggestionIndex;if(h&&(t.fillStyle=d.getColor("primaryHover",this.theme),t.fillRect(0,s,this.width,a)),this.highlightMatches&&this.value)this.renderHighlightedText(t,e,this.value,n.SEARCHBOX_SUGGESTION_ICON_OFFSET,s+a/2);else{t.fillStyle=d.getColor("text",this.theme),t.font="14px Arial",t.textAlign="left",t.textBaseline="middle";const o=this.width-n.ACCORDION_PADDING,l=this.truncateText(t,e,o);t.fillText(l,n.ACCORDION_ICON_MARGIN,s+a/2)}h&&(t.fillStyle=d.getColor("primary",this.theme),t.font="12px Arial",t.textAlign="right",t.textBaseline="middle",t.fillText("↩",this.width-n.SEARCHBOX_SUGGESTION_ICON_OFFSET,s+a/2)),i<this.filteredSuggestions.length-1&&(t.strokeStyle=d.getColor("border",this.theme),t.lineWidth=1,t.beginPath(),t.moveTo(0,s+a),t.lineTo(this.width,s+a),t.stroke())}renderHighlightedText(t,e,i,s,a){const h=this.caseSensitive?e:e.toLowerCase(),o=this.caseSensitive?i:i.toLowerCase(),l=h.indexOf(o);if(t.font="14px Arial",t.textAlign="left",t.textBaseline="middle",l===-1)t.fillStyle=d.getColor("text",this.theme),t.fillText(e,s,a);else{const r=e.slice(0,l),E=e.slice(l,l+i.length),g=e.slice(l+i.length);let _=s;if(r&&(t.fillStyle=d.getColor("text",this.theme),t.fillText(r,_,a),_+=t.measureText(r).width),E){t.fillStyle=d.getColor("primaryText",this.theme);const I=t.measureText(E).width;t.fillStyle=d.getColor("primary",this.theme),t.fillRect(_,a-n.SEARCHBOX_HIGHLIGHT_Y_OFFSET,I,n.SEARCHBOX_HIGHLIGHT_HEIGHT),t.fillStyle=d.getColor("primaryText",this.theme),t.fillText(E,_,a),_+=I}g&&(t.fillStyle=d.getColor("text",this.theme),t.fillText(g,_,a))}}truncateText(t,e,i){if(t.measureText(e).width<=i)return e;const a="...";let h=e;for(;t.measureText(h+a).width>i&&h.length>0;)h=h.slice(0,-1);return h+a}clearRenderCache(){this.renderCache.clear()}throttle(t,e){let i;return function(...s){i||(t.apply(this,s),i=!0,setTimeout(()=>i=!1,e))}}getSuggestions(){return[...this.suggestions]}setSuggestions(t){if(!Array.isArray(t))throw new b("Suggestions must be an array","SearchBox");this.suggestions=t.map(e=>String(e)),this.updateSuggestions(),this.emit("suggestionsChanged",{suggestions:this.suggestions})}addSuggestion(t){const e=String(t);this.suggestions.includes(e)||(this.suggestions.push(e),this.updateSuggestions(),this.emit("suggestionAdded",{suggestion:e}))}removeSuggestion(t){const e=this.suggestions.indexOf(t);e>=0&&(this.suggestions.splice(e,1),this.updateSuggestions(),this.emit("suggestionRemoved",{suggestion:t,index:e}))}getSearchHistory(){return[...this.searchHistory]}clearSearchHistory(){this.searchHistory=[],this.emit("historyCleared")}setPlaceholder(t){this.placeholder=String(t||""),this.clearRenderCache(),this.emit("placeholderChanged",{placeholder:this.placeholder})}enable(){this.disabled=!1,this.setAttribute("tabindex","0"),this.clearRenderCache(),this.emit("enabled")}disable(){this.disabled=!0,this.setAttribute("tabindex","-1"),this.clearSuggestions(),this.clearRenderCache(),this.emit("disabled")}reset(){this.value="",this.clearSuggestions(),this.clearSearchHistory(),this.selectedSuggestionIndex=-1,this.clearRenderCache(),this.emit("reset")}destroy(){try{this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.announcer&&this.announcer.parentNode&&this.announcer.parentNode.removeChild(this.announcer),this.clearRenderCache(),this.clearSuggestions(),this.clearSearchHistory(),super.destroy?.(),this.emit("destroyed")}catch(t){x.error("Error during SearchBox cleanup:",t)}}}const R={DEFAULT_MAX_FPS:60,DEFAULT_WIDTH:800,DEFAULT_HEIGHT:600,MIN_DEVICE_MEMORY:2,MIN_CORES:2,FPS_UPDATE_INTERVAL:1e3,DEBUG_PANEL_MIN_WIDTH:200,DEBUG_PANEL_POSITION:{TOP:10,RIGHT:10,PADDING:10,BORDER_RADIUS:4,Z_INDEX:1e3},MILLISECONDS_PER_SECOND:1e3,RGBA_ZERO_VALUES:{RED:0,GREEN:0,BLUE:0,ALPHA:.8},DEBUG_STYLES:{FONT_SIZE:12,ZERO_THRESHOLD:0,DECIMAL_PLACES:2},RESIZE_OBSERVER:{FIRST_ENTRY_INDEX:0}};class Qt{constructor(t,e={}){this.container=t,this.options={renderMode:e.renderMode||"auto",accessibility:e.accessibility!==!1,highPerformance:e.highPerformance||!1,maxFPS:e.maxFPS||R.DEFAULT_MAX_FPS,debug:e.debug||!1,width:e.width||R.DEFAULT_WIDTH,height:e.height||R.DEFAULT_HEIGHT,...e},this.renderer=null,this.scene=new nt,this.inputManager=null,this.accessibilityManager=null,this.animationManager=new ot(this),this.isRunning=!1,this.isPaused=!1,this.lastFrameTime=0,this.deltaTime=0,this.frameCount=0,this.fpsCounter=0,this.lastFPSUpdate=0,this.performanceStats={fps:0,frameTime:0,renderTime:0,updateTime:0},this.config=this.options,this.init()}init(){this.logInfo("Initializing..."),this.setupRenderer(),this.setupInputManager(),this.setupAccessibility(),this.setupEventListeners(),this.setupPerformanceMonitoring(),this.setupComponentRegistry(),this.logInfo(`Initialized with ${this.renderer.type} renderer`)}setupRenderer(){switch(this.determineOptimalRenderMode()){case"webgl":try{this.renderer=new rt(this.container,this.options)}catch(e){this.logWarning("WebGL renderer failed to initialize, falling back to Canvas",e),this.renderer=new q(this.container,this.options)}break;case"canvas":this.renderer=new q(this.container,this.options);break;case"svg":this.renderer=new lt(this.container,this.options);break;default:this.renderer=new q(this.container,this.options)}this.renderer.engine=this,this.logInfo(`Using ${this.renderer.type} renderer`)}setupInputManager(){this.inputManager=new ct(this)}setupAccessibility(){this.options.accessibility&&(this.accessibilityManager=new dt(this.container),this.accessibilityManager.engine=this)}setupEventListeners(){typeof ResizeObserver<"u"?new ResizeObserver(e=>{this.handleResize(e)}).observe(this.container):window.addEventListener("resize",()=>{this.handleResize()}),document.addEventListener("visibilitychange",()=>{document.hidden?this.pause():this.resume()})}setupPerformanceMonitoring(){this.options.debug&&this.createDebugPanel()}setupComponentRegistry(){this.componentRegistry=new Map,this.componentInstances=new Map,this.registerComponent("button",ut),this.registerComponent("slider",ft),this.registerComponent("meter",Tt),this.registerComponent("label",Et),this.registerComponent("interactive-button",pt),this.registerComponent("interactive-slider",Rt),this.registerComponent("ethics-meter",St),this.registerComponent("modal-dialog",bt),this.registerComponent("navigation-menu",Ot),this.registerComponent("chart",Ct),this.registerComponent("form-field",Dt),this.registerComponent("tooltip",Nt),this.registerComponent("data-table",yt),this.registerComponent("notification-toast",Lt),this.registerComponent("loading-spinner",Ht),this.registerComponent("tab-container",wt),this.registerComponent("progress-stepper",xt),this.registerComponent("split-pane",Mt),this.registerComponent("tree-view",Ft),this.registerComponent("file-upload",vt),this.registerComponent("color-picker",Ut),this.registerComponent("accordion",Bt),this.registerComponent("datetime-picker",kt),this.registerComponent("number-input",Gt),this.registerComponent("drawer",Wt),this.registerComponent("search-box",Vt),this.logInfo(`Component registry initialized with ${this.componentRegistry.size} component types`)}registerComponent(t,e){this.componentRegistry.set(t,e),this.componentInstances.set(t,new Set)}createComponent(t,e={}){const i=this.componentRegistry.get(t);if(!i)return this.logWarning(`Component type "${t}" not found in registry`),null;try{const s=new i(e);return this.componentInstances.get(t).add(s),this.addObject(s),s}catch(s){return this.logError(`Failed to create component of type "${t}"`,s),null}}destroyComponent(t){if(!t){this.logWarning("Attempted to destroy null/undefined component");return}for(const[,e]of this.componentInstances)if(e.has(t)){e.delete(t);break}this.removeObject(t)}getComponentsByType(t){return Array.from(this.componentInstances.get(t)||[])}getAllComponents(){const t=[];for(const e of this.componentInstances.values())t.push(...e);return t}determineOptimalRenderMode(){if(this.options.renderMode!=="auto")return this.options.renderMode;const t=this.detectWebGLSupport(),e=this.detectCanvasSupport(),i=this.options.highPerformance,s=/Mobi|Android/i.test(navigator.userAgent),a=this.detectLowEndDevice();return i&&t&&!s&&!a?"webgl":e&&!a?"canvas":"svg"}detectWebGLSupport(){try{const t=document.createElement("canvas");return!!(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch{return!1}}detectCanvasSupport(){try{return!!document.createElement("canvas").getContext("2d")}catch{return!1}}detectLowEndDevice(){try{const t=navigator.deviceMemory,e=navigator.hardwareConcurrency;return!!(t&&t<R.MIN_DEVICE_MEMORY||e&&e<R.MIN_CORES)}catch(t){return this.logWarning("Device detection failed",t),!1}}start(){this.isRunning||(this.isRunning=!0,this.isPaused=!1,this.lastFrameTime=performance.now(),this.lastFPSUpdate=this.lastFrameTime,this.logInfo("Starting animation loop"),this.animate())}stop(){this.isRunning=!1,this.isPaused=!1,this.logInfo("Stopped")}pause(){this.isPaused=!0,this.logInfo("Paused")}resume(){this.isRunning&&this.isPaused&&(this.isPaused=!1,this.lastFrameTime=performance.now(),this.logInfo("Resumed"))}animate(t=performance.now()){if(!this.isRunning)return;const e=performance.now();if(this.deltaTime=Math.min(t-this.lastFrameTime,R.MILLISECONDS_PER_SECOND/this.options.maxFPS),this.lastFrameTime=t,!this.isPaused){this.update(this.deltaTime);const i=performance.now();this.render(),this.performanceStats.renderTime=performance.now()-i,this.updatePerformanceStats(t,e)}requestAnimationFrame(i=>this.animate(i))}update(t){this.animationManager.update(t),this.scene.update(t),this.inputManager.update(t),this.accessibilityManager&&this.accessibilityManager.needsUpdate&&this.accessibilityManager.update()}render(){this.renderer&&this.renderer.render(this.scene)}updatePerformanceStats(t,e){this.frameCount++,this.performanceStats.updateTime=performance.now()-e,this.performanceStats.frameTime=performance.now()-t,t-this.lastFPSUpdate>=R.FPS_UPDATE_INTERVAL&&(this.performanceStats.fps=Math.round(this.frameCount*R.FPS_UPDATE_INTERVAL/(t-this.lastFPSUpdate)),this.frameCount=0,this.lastFPSUpdate=t,this.options.debug&&this.updateDebugPanel())}addObject(t){return t?(this.scene.add(t),this.accessibilityManager&&t.isInteractive&&t.accessibilityConfig&&this.accessibilityManager.registerComponent(t),t):(this.logWarning("Attempted to add null/undefined object to scene"),null)}removeObject(t){if(!t){this.logWarning("Attempted to remove null/undefined object from scene");return}this.scene.remove(t),this.accessibilityManager&&t.isInteractive&&this.accessibilityManager.unregisterComponent(t)}clearScene(){this.scene.clear(),this.accessibilityManager&&this.accessibilityManager.clearObjects()}addComponent(t){return this.addObject(t)}removeComponent(t){return this.removeObject(t)}screenToWorld(t,e){return this.renderer.screenToWorld?this.renderer.screenToWorld(t,e):{x:t,y:e}}worldToScreen(t,e){return this.renderer.worldToScreen?this.renderer.worldToScreen(t,e):{x:t,y:e}}handleResize(t=null){if(this.renderer&&this.renderer.resize){let e,i;t&&t[R.RESIZE_OBSERVER.FIRST_ENTRY_INDEX]?{width:e,height:i}=t[R.RESIZE_OBSERVER.FIRST_ENTRY_INDEX].contentRect:{width:e,height:i}=this.container.getBoundingClientRect(),e>R.DEBUG_STYLES.ZERO_THRESHOLD&&i>R.DEBUG_STYLES.ZERO_THRESHOLD&&this.renderer.resize(e,i)}this.scene.handleResize()}createDebugPanel(){this.debugPanel=document.createElement("div"),this.debugPanel.style.cssText=`
            position: absolute;
            top: ${R.DEBUG_PANEL_POSITION.TOP}px;
            right: ${R.DEBUG_PANEL_POSITION.RIGHT}px;
            background: rgba(${R.RGBA_ZERO_VALUES.RED}, ${R.RGBA_ZERO_VALUES.GREEN}, ${R.RGBA_ZERO_VALUES.BLUE}, ${R.RGBA_ZERO_VALUES.ALPHA});
            color: white;
            padding: ${R.DEBUG_PANEL_POSITION.PADDING}px;
            font-family: monospace;
            font-size: ${R.DEBUG_STYLES.FONT_SIZE}px;
            border-radius: ${R.DEBUG_PANEL_POSITION.BORDER_RADIUS}px;
            z-index: ${R.DEBUG_PANEL_POSITION.Z_INDEX};
            min-width: ${R.DEBUG_PANEL_MIN_WIDTH}px;
        `,this.container.style.position!=="absolute"&&this.container.style.position!=="relative"&&(this.container.style.position="relative"),this.container.appendChild(this.debugPanel)}updateDebugPanel(){if(this.debugPanel)try{const t=this.performanceStats,e=this.scene.objects?this.scene.objects.length:R.DEBUG_STYLES.ZERO_THRESHOLD,i=this.scene.interactiveObjects?this.scene.interactiveObjects.length:R.DEBUG_STYLES.ZERO_THRESHOLD;this.debugPanel.innerHTML=`
                <div><strong>Visual Engine Debug</strong></div>
                <div>FPS: ${t.fps}</div>
                <div>Frame Time: ${t.frameTime.toFixed(R.DEBUG_STYLES.DECIMAL_PLACES)}ms</div>
                <div>Update Time: ${t.updateTime.toFixed(R.DEBUG_STYLES.DECIMAL_PLACES)}ms</div>
                <div>Render Time: ${t.renderTime.toFixed(R.DEBUG_STYLES.DECIMAL_PLACES)}ms</div>
                <div>Objects: ${e}</div>
                <div>Interactive: ${i}</div>
                <div>Renderer: ${this.renderer?this.renderer.type:"None"}</div>
            `}catch(t){this.logError("Error updating debug panel",t)}}emit(t,e={}){if(typeof this.options.onEvent=="function"&&this.options.onEvent(t,e),typeof window<"u"&&window.dispatchEvent){const i=new CustomEvent(`visualengine:${t}`,{detail:e});window.dispatchEvent(i)}}logInfo(t,e=null){this.options.debug&&console.log(`VisualEngine: ${t}`,e||"")}logWarning(t,e=null){this.options.debug&&console.warn(`VisualEngine: ${t}`,e||"")}logError(t,e=null){this.options.debug&&console.error(`VisualEngine: ${t}`,e||""),this.emit("error",{message:t,error:e?.message||e,timestamp:Date.now()})}getStats(){return{...this.performanceStats,objects:this.scene.objects.length,interactiveObjects:this.scene.interactiveObjects.length,renderer:this.renderer?this.renderer.type:"None",isRunning:this.isRunning,isPaused:this.isPaused}}destroy(){try{this.stop(),this.inputManager&&typeof this.inputManager.destroy=="function"&&this.inputManager.destroy(),this.renderer&&typeof this.renderer.destroy=="function"&&this.renderer.destroy(),this.accessibilityManager&&typeof this.accessibilityManager.destroy=="function"&&this.accessibilityManager.destroy(),this.debugPanel&&this.debugPanel.parentNode&&this.debugPanel.parentNode.removeChild(this.debugPanel),this.scene&&typeof this.scene.clear=="function"&&this.scene.clear(),this.componentInstances&&this.componentInstances.clear(),this.logInfo("Destroyed")}catch(t){this.logError("Error during VisualEngine destruction",t)}}}export{Qt as VisualEngine,Qt as default};
//# sourceMappingURL=visual-engine-CPXCswte.js.map
