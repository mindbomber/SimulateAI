{"version":3,"file":"core-Bu-3NiyB.js","sources":["../../src/js/utils/logger.js","../../src/js/utils/simple-storage.js","../../src/js/utils/simple-analytics.js","../../src/js/utils/constants.js","../../src/js/core/simulation.js","../../src/js/core/animation-manager.js","../../src/js/core/scene.js","../../src/js/core/input-manager.js","../../src/js/renderers/canvas-renderer.js","../../src/js/renderers/svg-renderer.js","../../src/js/renderers/webgl-renderer.js"],"sourcesContent":["/**\n * Copyright 2025 Armando Sori\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Logger Utility\n * Provides structured logging with different levels and environments\n */\n/* eslint-disable no-console */\n\nclass Logger {\n  constructor() {\n    this.levels = {\n      ERROR: 0,\n      WARN: 1,\n      INFO: 2,\n      DEBUG: 3,\n      TRACE: 4,\n    };\n\n    // Set log level based on environment\n    this.currentLevel = this.detectEnvironment();\n    this.enabledTypes = new Set(['error', 'warn', 'info']);\n\n    // Production mode disables most logging\n    if (this.isProduction()) {\n      this.enabledTypes = new Set(['error']);\n    }\n  }\n\n  /**\n   * Detect current environment\n   */\n  detectEnvironment() {\n    // Check for common development indicators\n    if (typeof window !== 'undefined') {\n      const isDev =\n        window.location.hostname === 'localhost' ||\n        window.location.hostname === '127.0.0.1' ||\n        window.location.hostname.includes('dev') ||\n        window.location.search.includes('debug=true');\n      return isDev ? this.levels.DEBUG : this.levels.WARN;\n    }\n    return this.levels.WARN;\n  }\n\n  /**\n   * Check if running in production\n   */\n  isProduction() {\n    return (\n      typeof window !== 'undefined' &&\n      window.location.hostname !== 'localhost' &&\n      window.location.hostname !== '127.0.0.1' &&\n      !window.location.hostname.includes('dev')\n    );\n  }\n\n  /**\n   * Format log message with timestamp and context\n   */\n  formatMessage(level, context, message, data) {\n    const timestamp = new Date().toISOString();\n    const prefix = `[${timestamp}] [${level.toUpperCase()}]`;\n    const contextStr = context ? ` [${context}]` : '';\n\n    if (data !== undefined) {\n      return [prefix + contextStr, message, data];\n    }\n    return [prefix + contextStr, message];\n  }\n\n  /**\n   * Core logging method\n   */\n  log(level, context, message, data) {\n    if (!this.enabledTypes.has(level)) {\n      return;\n    }\n\n    const args = this.formatMessage(level, context, message, data);\n\n    try {\n      switch (level) {\n        case 'error':\n          console.error(...args);\n          break;\n        case 'warn':\n          console.warn(...args);\n          break;\n        case 'info':\n          console.info(...args);\n          break;\n        case 'debug':\n          console.log(...args);\n          break;\n        case 'trace':\n          console.trace(...args);\n          break;\n        default:\n          console.log(...args);\n      }\n    } catch (e) {\n      // Fallback for environments without console methods\n      try {\n        console.log(...args);\n      } catch (fallbackError) {\n        // Silent fail in restrictive environments\n      }\n    }\n  }\n\n  /**\n   * Error logging - always enabled\n   */\n  error(context, message, data) {\n    this.log('error', context, message, data);\n  }\n\n  /**\n   * Warning logging - enabled in dev and staging\n   */\n  warn(context, message, data) {\n    this.log('warn', context, message, data);\n  }\n\n  /**\n   * Info logging - enabled in development\n   */\n  info(context, message, data) {\n    this.log('info', context, message, data);\n  }\n\n  /**\n   * Debug logging - enabled in development with debug flag\n   */\n  debug(context, message, data) {\n    this.log('debug', context, message, data);\n  }\n\n  /**\n   * Trace logging - enabled in development with debug flag\n   */\n  trace(context, message, data) {\n    this.log('trace', context, message, data);\n  }\n\n  /**\n   * Performance timing\n   */\n  time(label) {\n    if (this.enabledTypes.has('debug')) {\n      console.time(label);\n    }\n  }\n\n  timeEnd(label) {\n    if (this.enabledTypes.has('debug')) {\n      console.timeEnd(label);\n    }\n  }\n\n  /**\n   * Enable/disable specific log types\n   */\n  enable(type) {\n    this.enabledTypes.add(type);\n  }\n\n  disable(type) {\n    this.enabledTypes.delete(type);\n  }\n\n  /**\n   * Enable debug mode\n   */\n  enableDebug() {\n    this.enabledTypes.add('debug');\n    this.enabledTypes.add('trace');\n  }\n\n  /**\n   * Disable all logging except errors\n   */\n  silent() {\n    this.enabledTypes.clear();\n    this.enabledTypes.add('error');\n  }\n}\n\n// Create singleton instance\nconst logger = new Logger();\n\n// ES6 module exports\nexport default logger;\nexport { logger };\n\n// Backward compatibility for older modules\nif (typeof window !== 'undefined') {\n  window.Logger = logger;\n}\n","/**\n * Copyright 2025 Armando Sori\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Simplified Storage Manager - Robust and Educational-Focused\n * Provides essential storage functionality with graceful degradation\n *\n * @version 1.0.0\n * @author SimulateAI Team\n * @license Apache-2.0\n */\n\nimport logger from './logger.js';\n\n/**\n * Simple, robust storage manager with fallbacks\n */\nclass SimpleStorageManager {\n  constructor() {\n    this.prefix = 'ai_ethics_';\n    this.isLocalStorageAvailable =\n      this.checkStorageAvailability('localStorage');\n    this.isSessionStorageAvailable =\n      this.checkStorageAvailability('sessionStorage');\n    this.memoryStorage = new Map(); // Fallback storage\n\n    // Initialize with a simple test\n    this.init();\n  }\n\n  /**\n   * Initialize storage and log status\n   */\n  init() {\n    logger.info('Storage', 'Storage Status');\n    logger.info('Storage', '- localStorage', \n      this.isLocalStorageAvailable ? '✅ Available' : '❌ Not available'\n    );\n    logger.info('Storage', '- sessionStorage',\n      this.isSessionStorageAvailable ? '✅ Available' : '❌ Not available'\n    );\n\n    if (!this.isLocalStorageAvailable && !this.isSessionStorageAvailable) {\n      logger.warn(\n        '⚠️  Browser storage not available. Using memory storage (data will not persist).'\n      );\n    }\n  }\n\n  /**\n   * Check if a storage type is available\n   */\n  checkStorageAvailability(storageType) {\n    try {\n      const storage = window[storageType];\n      if (!storage) return false;\n\n      const testKey = '__storage_test__';\n      storage.setItem(testKey, 'test');\n      storage.removeItem(testKey);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * Get a value from storage with fallback chain\n   */\n  get(key, defaultValue = null) {\n    const fullKey = this.prefix + key;\n\n    try {\n      // Try localStorage first\n      if (this.isLocalStorageAvailable) {\n        const value = localStorage.getItem(fullKey);\n        if (value !== null) {\n          return JSON.parse(value);\n        }\n      }\n\n      // Try sessionStorage\n      if (this.isSessionStorageAvailable) {\n        const value = sessionStorage.getItem(fullKey);\n        if (value !== null) {\n          return JSON.parse(value);\n        }\n      }\n\n      // Try memory storage\n      if (this.memoryStorage.has(fullKey)) {\n        return this.memoryStorage.get(fullKey);\n      }\n    } catch (e) {\n      logger.warn(`Error reading storage key \"${key}\":`, e);\n    }\n\n    return defaultValue;\n  }\n\n  /**\n   * Set a value in storage with fallback chain\n   */\n  set(key, value) {\n    const fullKey = this.prefix + key;\n    let success = false;\n\n    try {\n      // Try localStorage first\n      if (this.isLocalStorageAvailable) {\n        localStorage.setItem(fullKey, JSON.stringify(value));\n        success = true;\n      }\n      // Try sessionStorage as backup\n      else if (this.isSessionStorageAvailable) {\n        sessionStorage.setItem(fullKey, JSON.stringify(value));\n        success = true;\n      }\n\n      // Always store in memory as final fallback\n      this.memoryStorage.set(fullKey, value);\n    } catch (e) {\n      logger.warn(`Error saving storage key \"${key}\":`, e);\n      // Fallback to memory storage\n      this.memoryStorage.set(fullKey, value);\n    }\n\n    return success;\n  }\n\n  /**\n   * Remove a value from all storage types\n   */\n  remove(key) {\n    const fullKey = this.prefix + key;\n\n    try {\n      if (this.isLocalStorageAvailable) {\n        localStorage.removeItem(fullKey);\n      }\n      if (this.isSessionStorageAvailable) {\n        sessionStorage.removeItem(fullKey);\n      }\n      this.memoryStorage.delete(fullKey);\n    } catch (e) {\n      logger.warn(`Error removing storage key \"${key}\":`, e);\n    }\n  }\n\n  /**\n   * Clear all app data from storage\n   */\n  clear() {\n    try {\n      // Clear from localStorage\n      if (this.isLocalStorageAvailable) {\n        const keys = Object.keys(localStorage);\n        keys.forEach(key => {\n          if (key.startsWith(this.prefix)) {\n            localStorage.removeItem(key);\n          }\n        });\n      }\n\n      // Clear from sessionStorage\n      if (this.isSessionStorageAvailable) {\n        const keys = Object.keys(sessionStorage);\n        keys.forEach(key => {\n          if (key.startsWith(this.prefix)) {\n            sessionStorage.removeItem(key);\n          }\n        });\n      }\n\n      // Clear memory storage\n      this.memoryStorage.clear();\n    } catch (e) {\n      logger.warn('Error clearing storage:', e);\n    }\n  }\n\n  /**\n   * Get all keys for debugging\n   */\n  getAllKeys() {\n    const keys = new Set();\n\n    try {\n      // From localStorage\n      if (this.isLocalStorageAvailable) {\n        Object.keys(localStorage).forEach(key => {\n          if (key.startsWith(this.prefix)) {\n            keys.add(key.replace(this.prefix, ''));\n          }\n        });\n      }\n\n      // From sessionStorage\n      if (this.isSessionStorageAvailable) {\n        Object.keys(sessionStorage).forEach(key => {\n          if (key.startsWith(this.prefix)) {\n            keys.add(key.replace(this.prefix, ''));\n          }\n        });\n      }\n\n      // From memory storage\n      this.memoryStorage.forEach((value, key) => {\n        if (key.startsWith(this.prefix)) {\n          keys.add(key.replace(this.prefix, ''));\n        }\n      });\n    } catch (e) {\n      logger.warn('Error getting storage keys:', e);\n    }\n\n    return Array.from(keys);\n  }\n\n  /**\n   * Check storage usage (simplified)\n   */\n  getStorageInfo() {\n    return {\n      localStorageAvailable: this.isLocalStorageAvailable,\n      sessionStorageAvailable: this.isSessionStorageAvailable,\n      memoryStorageKeys: this.memoryStorage.size,\n      allKeys: this.getAllKeys(),\n    };\n  }\n}\n\n/**\n * Convenience methods for common storage operations\n */\nclass UserPreferences {\n  constructor(storage) {\n    this.storage = storage;\n  }\n\n  // User interface preferences\n  getTheme() {\n    return this.storage.get('theme', 'light');\n  }\n\n  setTheme(theme) {\n    this.storage.set('theme', theme);\n  }\n\n  getLanguage() {\n    return this.storage.get('language', 'en');\n  }\n\n  setLanguage(language) {\n    this.storage.set('language', language);\n  }\n\n  // Accessibility preferences\n  getAccessibilitySettings() {\n    return this.storage.get('accessibility', {\n      // Note: undefined values mean user hasn't set them explicitly\n      // Boolean values mean user has made an explicit choice\n    });\n  }\n\n  setAccessibilitySettings(settings) {\n    this.storage.set('accessibility', settings);\n  }\n\n  // Pre-launch modal preferences\n  getPreLaunchSettings() {\n    return this.storage.get('preLaunchSettings', {\n      skipPreLaunch: false,\n      skipPreLaunchFor: {},\n      alwaysShowEducatorResources: true,\n    });\n  }\n\n  setPreLaunchSettings(settings) {\n    this.storage.set('preLaunchSettings', settings);\n  }\n\n  // Convenience methods for pre-launch modal\n  shouldSkipPreLaunch(simulationId = null) {\n    const settings = this.getPreLaunchSettings();\n    if (simulationId) {\n      return settings.skipPreLaunch || settings.skipPreLaunchFor[simulationId];\n    }\n    return settings.skipPreLaunch;\n  }\n\n  setSkipPreLaunchFor(simulationId, skip = true) {\n    const settings = this.getPreLaunchSettings();\n    settings.skipPreLaunchFor[simulationId] = skip;\n    this.setPreLaunchSettings(settings);\n  }\n\n  setSkipPreLaunchGlobally(skip = true) {\n    const settings = this.getPreLaunchSettings();\n    settings.skipPreLaunch = skip;\n    this.setPreLaunchSettings(settings);\n  }\n\n  // All preferences as one object\n  getAllPreferences() {\n    return {\n      theme: this.getTheme(),\n      language: this.getLanguage(),\n      accessibility: this.getAccessibilitySettings(),\n      preLaunch: this.getPreLaunchSettings(),\n    };\n  }\n}\n\n/**\n * User progress tracking\n */\nclass UserProgress {\n  constructor(storage) {\n    this.storage = storage;\n  }\n\n  // Simulation progress\n  getSimulationProgress(simulationId) {\n    return this.storage.get(`progress_${simulationId}`, {\n      completed: false,\n      score: 0,\n      scenarios: [],\n      timeSpent: 0,\n      lastPlayed: null,\n    });\n  }\n\n  setSimulationProgress(simulationId, progress) {\n    this.storage.set(`progress_${simulationId}`, {\n      ...progress,\n      lastPlayed: new Date().toISOString(),\n    });\n  }\n\n  // Overall user stats\n  getOverallStats() {\n    return this.storage.get('overall_stats', {\n      totalSimulations: 0,\n      totalTimeSpent: 0,\n      averageScore: 0,\n      completedSimulations: [],\n      achievements: [],\n    });\n  }\n\n  setOverallStats(stats) {\n    this.storage.set('overall_stats', stats);\n  }\n\n  // Get all progress data\n  getAllProgress() {\n    const keys = this.storage.getAllKeys();\n    const progressKeys = keys.filter(key => key.startsWith('progress_'));\n    const progress = {};\n\n    progressKeys.forEach(key => {\n      const simulationId = key.replace('progress_', '');\n      progress[simulationId] = this.getSimulationProgress(simulationId);\n    });\n\n    return {\n      simulations: progress,\n      overall: this.getOverallStats(),\n    };\n  }\n}\n\n// Create singleton instances\nconst simpleStorage = new SimpleStorageManager();\nconst userPreferences = new UserPreferences(simpleStorage);\nconst userProgress = new UserProgress(simpleStorage);\n\n// Export for use in other modules\nexport { SimpleStorageManager, simpleStorage, userPreferences, userProgress };\n\n// Make available globally for debugging\nwindow.SimpleStorage = {\n  manager: simpleStorage,\n  preferences: userPreferences,\n  progress: userProgress,\n};\n\nlogger.info('Storage', '✅ Simple Storage Manager initialized');\n","/**\n * Copyright 2025 Armando Sori\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Simplified Analytics Manager - Educational Focus\n * Provides basic analytics without complex storage dependencies\n *\n * @version 1.0.0\n * @author SimulateAI Team\n * @license Apache-2.0\n */\n\nimport { simpleStorage, userPreferences } from './simple-storage.js';\nimport logger from './logger.js';\n\n// Constants to avoid magic numbers\nconst ANALYTICS_CONSTANTS = {\n  MAX_EVENTS: 100,\n  SESSION_ID_RADIX: 36,\n  SESSION_ID_SUFFIX_START: 2,\n  SESSION_ID_SUFFIX_LENGTH: 11,\n  AUTO_SAVE_INTERVAL: 30000, // 30 seconds\n};\n\n/**\n * Simple analytics manager for educational platforms\n */\nclass SimpleAnalyticsManager {\n  constructor() {\n    this.enabled = true;\n    this.events = [];\n    this.maxEvents = ANALYTICS_CONSTANTS.MAX_EVENTS;\n    this.sessionId = this.generateSessionId();\n    this.startTime = Date.now();\n\n    logger.info('Analytics', '📊 Simple Analytics Manager initialized');\n  }\n\n  /**\n   * Generate a simple session ID\n   */\n  generateSessionId() {\n    return `session_${Date.now()}_${Math.random().toString(ANALYTICS_CONSTANTS.SESSION_ID_RADIX).substring(ANALYTICS_CONSTANTS.SESSION_ID_SUFFIX_START, ANALYTICS_CONSTANTS.SESSION_ID_SUFFIX_LENGTH)}`;\n  }\n\n  /**\n   * Check if analytics is enabled\n   */\n  isEnabled() {\n    try {\n      const prefs = userPreferences.getAllPreferences();\n      return prefs.analytics !== false && this.enabled;\n    } catch (error) {\n      return this.enabled;\n    }\n  }\n\n  /**\n   * Track a simple event\n   */\n  trackEvent(eventName, data = {}) {\n    if (!this.isEnabled()) return;\n\n    try {\n      const event = {\n        name: eventName,\n        data,\n        timestamp: Date.now(),\n        sessionId: this.sessionId,\n        url: window.location.href,\n      };\n\n      this.events.push(event);\n\n      // Keep only recent events\n      if (this.events.length > this.maxEvents) {\n        this.events = this.events.slice(-this.maxEvents);\n      }\n\n      logger.info('📊 Event tracked:', eventName, data);\n    } catch (error) {\n      logger.warn('Error tracking event:', error);\n    }\n  }\n\n  /**\n   * Track page view\n   */\n  trackPageView(page = window.location.pathname) {\n    this.trackEvent('page_view', { page });\n  }\n\n  /**\n   * Track simulation start\n   */\n  trackSimulationStart(simulationId, metadata = {}) {\n    this.trackEvent('simulation_start', {\n      simulationId,\n      ...metadata,\n    });\n  }\n\n  /**\n   * Track simulation completion\n   */\n  trackSimulationComplete(simulationId, results = {}) {\n    this.trackEvent('simulation_complete', {\n      simulationId,\n      score: results.score || 0,\n      timeSpent: results.timeSpent || 0,\n      scenarios: results.scenarios || [],\n      ...results,\n    });\n  }\n\n  /**\n   * Track user interaction\n   */\n  trackInteraction(type, target, details = {}) {\n    this.trackEvent('user_interaction', {\n      type,\n      target,\n      ...details,\n    });\n  }\n\n  /**\n   * Track performance metrics\n   */\n  trackPerformance(metric, value, details = {}) {\n    this.trackEvent('performance', {\n      metric,\n      value,\n      ...details,\n    });\n  }\n\n  /**\n   * Track accessibility usage\n   */\n  trackAccessibility(feature, enabled, details = {}) {\n    this.trackEvent('accessibility', {\n      feature,\n      enabled,\n      ...details,\n    });\n  }\n\n  /**\n   * Track error\n   */\n  trackError(error, context = {}) {\n    this.trackEvent('error', {\n      message: error.message || String(error),\n      stack: error.stack || 'No stack trace',\n      ...context,\n    });\n  }\n\n  /**\n   * Get session summary\n   */\n  getSessionSummary() {\n    const sessionEvents = this.events.filter(\n      e => e.sessionId === this.sessionId\n    );\n    const duration = Date.now() - this.startTime;\n\n    return {\n      sessionId: this.sessionId,\n      duration,\n      eventCount: sessionEvents.length,\n      events: sessionEvents,\n      startTime: this.startTime,\n      endTime: Date.now(),\n    };\n  }\n\n  /**\n   * Get all events (for debugging)\n   */\n  getAllEvents() {\n    return [...this.events];\n  }\n\n  /**\n   * Clear all events\n   */\n  clearEvents() {\n    this.events = [];\n    logger.info('📊 Analytics events cleared');\n  }\n\n  /**\n   * Save events to storage (simple)\n   */\n  saveEvents() {\n    try {\n      const summary = this.getSessionSummary();\n      simpleStorage.set('analytics_session', summary);\n      simpleStorage.set('analytics_events', this.events);\n    } catch (error) {\n      logger.warn('Error saving analytics events:', error);\n    }\n  }\n\n  /**\n   * Load events from storage\n   */\n  loadEvents() {\n    try {\n      const savedEvents = simpleStorage.get('analytics_events', []);\n      const savedSession = simpleStorage.get('analytics_session', null);\n\n      if (savedEvents.length > 0) {\n        this.events = savedEvents;\n        logger.info('📊 Loaded', savedEvents.length, 'analytics events');\n      }\n\n      if (savedSession) {\n        logger.info('📊 Previous session:', savedSession);\n      }\n    } catch (error) {\n      logger.warn('Error loading analytics events:', error);\n    }\n  }\n\n  /**\n   * Initialize analytics system\n   */\n  async init() {\n    try {\n      this.loadEvents();\n      this.trackPageView();\n\n      // Auto-save events periodically\n      setInterval(() => {\n        this.saveEvents();\n      }, ANALYTICS_CONSTANTS.AUTO_SAVE_INTERVAL); // Every 30 seconds\n\n      // Save events when page unloads\n      window.addEventListener('beforeunload', () => {\n        this.saveEvents();\n      });\n\n      logger.info('Analytics', '📊 Simple Analytics Manager ready');\n    } catch (error) {\n      logger.warn('Error initializing analytics:', error);\n    }\n  }\n\n  /**\n   * Enable/disable analytics\n   */\n  setEnabled(enabled) {\n    this.enabled = enabled;\n    logger.info('📊 Analytics', enabled ? 'enabled' : 'disabled');\n\n    // Save preference\n    try {\n      const prefs = userPreferences.getAllPreferences();\n      prefs.analytics = enabled;\n      // Note: We're not saving this back as it would require updating the preference structure\n    } catch (error) {\n      logger.warn('Error saving analytics preference:', error);\n    }\n  }\n}\n\n// Create singleton instance\nconst simpleAnalytics = new SimpleAnalyticsManager();\n\n// Export for use in other modules\nexport { SimpleAnalyticsManager, simpleAnalytics };\n\n// Make available globally for compatibility and debugging\nwindow.AnalyticsManager = simpleAnalytics;\nwindow.SimpleAnalytics = simpleAnalytics;\n\n// Auto-initialize\nsimpleAnalytics.init();\n\nlogger.info('Analytics', '✅ Simple Analytics Manager loaded');\n","/**\n * Shared Constants for SimulateAI Platform\n *\n * This file contains commonly used constants across the application\n * to eliminate magic numbers and improve maintainability.\n *\n * @author SimulateAI Development Team\n * @version 1.0.0\n */\n\n// Timing Constants (in milliseconds)\nexport const TIMING = {\n  // Animation durations\n  QUICK: 150,\n  FAST: 300,\n  NORMAL: 500,\n  SLOW: 1000,\n  VERY_SLOW: 2000,\n\n  // Delays and intervals\n  DEBOUNCE_DELAY: 300,\n  THROTTLE_DELAY: 100,\n  POLLING_INTERVAL: 5000,\n  SESSION_TIMEOUT: 30000,\n\n  // Notification durations\n  NOTIFICATION_SHORT: 3000,\n  NOTIFICATION_NORMAL: 5000,\n  NOTIFICATION_LONG: 8000,\n\n  // Time conversions\n  SECONDS_PER_MINUTE: 60,\n  MINUTES_PER_HOUR: 60,\n  HOURS_PER_DAY: 24,\n  DAYS_PER_WEEK: 7,\n  DAYS_PER_MONTH: 30,\n  DAYS_PER_YEAR: 365,\n\n  // DOM manipulation delays\n  DOM_READY_DELAY: 50,\n  POST_APPEND_DELAY: 100,\n  INITIALIZATION_DELAY: 300,\n  TRANSITION_DELAY: 150,\n\n  // Animation durations\n  FADE_DURATION: 200,\n  SLIDE_DURATION: 300,\n  SPIN_DURATION: 1000,\n\n  // Timeouts\n  NETWORK_TIMEOUT: 5000,\n  LONG_TASK_TIMEOUT: 30000,\n  USER_SESSION_TIMEOUT: 1800000, // 30 minutes\n\n  // Intervals\n  AUTOSAVE_INTERVAL: 60000, // 1 minute\n  HEALTH_CHECK_INTERVAL: 300000, // 5 minutes\n  PERFORMANCE_SAMPLE_INTERVAL: 10000, // 10 seconds\n};\n\n// Responsive Breakpoints (in pixels)\nexport const BREAKPOINTS = {\n  MOBILE_SMALL: 576,\n  MOBILE: 768,\n  TABLET: 992,\n  DESKTOP: 1200,\n  DESKTOP_LARGE: 1400,\n};\n\n// Canvas and Rendering Constants\nexport const CANVAS = {\n  // Default dimensions\n  DEFAULT_WIDTH: 800,\n  DEFAULT_HEIGHT: 600,\n\n  // Canvas limits\n  MAX_WIDTH: 4096,\n  MAX_HEIGHT: 4096,\n\n  // Rendering settings\n  DPI_SCALE: 2,\n  DEFAULT_FRAMERATE: 60,\n  TARGET_FRAMERATE: 16.67, // 1000/60\n\n  // WebGL constants\n  WEBGL_MAX_TEXTURES: 16,\n  BUFFER_SIZE: 1024,\n};\n\n// UI Component Constants\nexport const UI = {\n  // Z-index layers\n  Z_INDEX: {\n    BASE: 1,\n    DROPDOWN: 10,\n    MODAL_BACKDROP: 100,\n    MODAL: 1000,\n    TOOLTIP: 2000,\n    NOTIFICATION: 3000,\n  },\n\n  // Common sizes\n  BUTTON_HEIGHT: 40,\n  INPUT_HEIGHT: 40,\n  HEADER_HEIGHT: 60,\n  SIDEBAR_WIDTH: 250,\n  SCROLLBAR_WIDTH: 16,\n\n  // Spacing scale\n  SPACING: {\n    XS: 4,\n    SM: 8,\n    MD: 16,\n    LG: 24,\n    XL: 32,\n    XXL: 48,\n  },\n\n  // Border radius\n  BORDER_RADIUS: {\n    SMALL: 4,\n    MEDIUM: 8,\n    LARGE: 12,\n    PILL: 999,\n  },\n};\n\n// Performance Thresholds\nexport const PERFORMANCE = {\n  // Ethical scoring\n  ETHICAL_EXCELLENT: 0.9,\n  ETHICAL_GOOD: 0.7,\n  ETHICAL_AVERAGE: 0.5,\n  ETHICAL_NEEDS_IMPROVEMENT: 0.3,\n\n  // General scoring\n  SCORE_EXCELLENT: 0.8,\n  SCORE_GOOD: 0.6,\n  SCORE_AVERAGE: 0.4,\n  SCORE_POOR: 0.2,\n\n  // Progress indicators\n  PROGRESS_COMPLETE: 1.0,\n  PROGRESS_MOSTLY_COMPLETE: 0.8,\n  PROGRESS_HALFWAY: 0.5,\n  PROGRESS_STARTED: 0.1,\n};\n\n// Analytics and Tracking\nexport const ANALYTICS = {\n  // Session limits\n  MAX_SESSION_LENGTH: 3600000, // 1 hour in ms\n  BATCH_SIZE: 50,\n  FLUSH_INTERVAL: 10000,\n\n  // Performance monitoring\n  SLOW_OPERATION_THRESHOLD: 1000,\n  MEMORY_WARNING_THRESHOLD: 100000000, // 100MB\n\n  // Sampling rates\n  ERROR_SAMPLE_RATE: 1.0,\n  PERFORMANCE_SAMPLE_RATE: 0.1,\n  USER_INTERACTION_SAMPLE_RATE: 0.8,\n};\n\n// Color System (using standard web color values)\nexport const COLORS = {\n  // RGB color components\n  RGB_MAX: 255,\n  RGB_MIN: 0,\n\n  // Alpha transparency\n  TRANSPARENT: 0,\n  SEMI_TRANSPARENT: 0.5,\n  MOSTLY_OPAQUE: 0.8,\n  OPAQUE: 1.0,\n\n  // Common transparency levels\n  OVERLAY_ALPHA: 0.3,\n  DISABLED_ALPHA: 0.6,\n  HOVER_ALPHA: 0.9,\n};\n\n// Animation Easing Values\nexport const EASING = {\n  // Standard easing\n  LINEAR: 0,\n  EASE_IN: 0.42,\n  EASE_OUT: 0.58,\n  EASE_IN_OUT: 0.5,\n\n  // Bounce easing coefficients\n  BOUNCE_C1: 1.70158,\n  BOUNCE_C2: 2.5949095, // c1 * 1.525\n  BOUNCE_C3: 2.70158, // c1 + 1\n  BOUNCE_C4: 2.75,\n  BOUNCE_C5: 7.5625,\n\n  // Elastic constants\n  ELASTIC_C4: 2.0943951023931953, // (2 * Math.PI) / 3\n  ELASTIC_C5: 1.3962634015954636, // (2 * Math.PI) / 4.5\n};\n\n// Common Magic Numbers - Most Frequently Used\nexport const COMMON = {\n  // Fractions and percentages\n  HALF: 0.5,\n  QUARTER: 0.25,\n  THREE_QUARTERS: 0.75,\n  ONE_TENTH: 0.1,\n  ONE_FIFTH: 0.2,\n  ONE_THIRD: 0.33,\n  TWO_THIRDS: 0.67,\n\n  // Precise fractional values for animations\n  ONE_AND_HALF: 1.5,\n  TWO_AND_HALF: 2.5,\n  TWO_AND_QUARTER: 2.25,\n  TWO_AND_FIVE_EIGHTHS: 2.625,\n  FIFTEEN_SIXTEENTHS: 0.9375,\n  SIXTYTHREE_SIXTYFOURTHS: 0.984375,\n\n  // Small integers (very common)\n  TWO: 2,\n  THREE: 3,\n  FOUR: 4,\n  FIVE: 5,\n  SIX: 6,\n  SEVEN: 7,\n  EIGHT: 8,\n  NINE: 9,\n  TEN: 10,\n  TWELVE: 12,\n  FIFTEEN: 15,\n  SIXTEEN: 16,\n  TWENTY: 20,\n  TWENTY_FOUR: 24,\n  TWENTY_FIVE: 25,\n  THIRTY: 30,\n  THIRTY_SIX: 36,\n  FORTY: 40,\n  FIFTY: 50,\n  SIXTY: 60,\n  SEVENTY: 70,\n  EIGHTY: 80,\n  NINETY: 90,\n\n  // Power of 2 values\n  SIXTY_FOUR: 64,\n  ONE_TWENTY_EIGHT: 128,\n  TWO_FIFTY_SIX: 256,\n  FIVE_TWELVE: 512,\n  ONE_K: 1024,\n  TWO_K: 2048,\n  FOUR_K: 4096,\n\n  // Geometric constants\n  CIRCLE_DEGREES: 360,\n  HALF_CIRCLE_DEGREES: 180,\n  QUARTER_CIRCLE_DEGREES: 90,\n  PI_DEGREES: 180,\n  TWO_PI_DEGREES: 360,\n\n  // Distance and positioning\n  MARGIN_SMALL: 5,\n  MARGIN_MEDIUM: 10,\n  MARGIN_LARGE: 15,\n  PADDING_SMALL: 5,\n  PADDING_MEDIUM: 10,\n  PADDING_LARGE: 20,\n\n  // Negative values (commonly used)\n  NEGATIVE_TWO: -2,\n  NEGATIVE_FIVE: -5,\n  NEGATIVE_TEN: -10,\n  NEGATIVE_FIFTY: -50,\n\n  // Timing values (milliseconds)\n  MILLISECONDS_100: 100,\n  MILLISECONDS_150: 150,\n  MILLISECONDS_200: 200,\n  MILLISECONDS_300: 300,\n  MILLISECONDS_500: 500,\n  MILLISECONDS_1000: 1000,\n  MILLISECONDS_1500: 1500,\n  MILLISECONDS_2000: 2000,\n  MILLISECONDS_3000: 3000,\n  MILLISECONDS_5000: 5000,\n  MILLISECONDS_8000: 8000,\n  MILLISECONDS_10000: 10000,\n  MILLISECONDS_30000: 30000,\n  MILLISECONDS_60000: 60000,\n\n  // Standard sizes\n  SMALL_SIZE: 25,\n  MEDIUM_SIZE: 50,\n  LARGE_SIZE: 100,\n  XLARGE_SIZE: 150,\n  XXLARGE_SIZE: 200,\n\n  // Grid and layout\n  GRID_COLS_7: 7, // Days of week\n  GRID_COLS_12: 12, // Months\n  GRID_ROWS_6: 6, // Calendar rows\n\n  // Color values\n  COLOR_255: 255, // RGB max\n  COLOR_0: 0, // RGB min\n  HEX_FF: 0xff,\n  HEX_00FF: 0x00ff,\n  HEX_0000FF: 0x0000ff,\n\n  // Opacity levels\n  OPACITY_10: 0.1,\n  OPACITY_20: 0.2,\n  OPACITY_30: 0.3,\n  OPACITY_40: 0.4,\n  OPACITY_50: 0.5,\n  OPACITY_60: 0.6,\n  OPACITY_70: 0.7,\n  OPACITY_80: 0.8,\n  OPACITY_90: 0.9,\n\n  // Conversion factors\n  HOURS_24: 24,\n  MINUTES_60: 60,\n  SECONDS_60: 60,\n  DAYS_7: 7,\n  DAYS_30: 30,\n  DAYS_365: 365,\n\n  // Math constants\n  MATH_E: 2.718281828,\n  MATH_PI: Math.PI,\n  MATH_2PI: Math.PI * 2,\n  MATH_PI_2: Math.PI / 2,\n  MATH_SQRT_2: Math.SQRT2,\n\n  // Percentage values\n  PERCENT_5: 5,\n  PERCENT_10: 10,\n  PERCENT_20: 20,\n  PERCENT_25: 25,\n  PERCENT_50: 50,\n  PERCENT_75: 75,\n  PERCENT_100: 100,\n};\n\n// File and Data Limits\nexport const LIMITS = {\n  // File sizes (in bytes)\n  MAX_FILE_SIZE: 10485760, // 10MB\n  MAX_IMAGE_SIZE: 5242880, // 5MB\n  MAX_TEXT_SIZE: 1048576, // 1MB\n\n  // String lengths\n  MAX_USERNAME_LENGTH: 50,\n  MAX_EMAIL_LENGTH: 254,\n  MAX_PASSWORD_LENGTH: 128,\n  MIN_PASSWORD_LENGTH: 8,\n\n  // Array limits\n  MAX_ARRAY_LENGTH: 10000,\n  MAX_OBJECT_DEPTH: 10,\n\n  // Simulation limits\n  MAX_SIMULATION_TIME: 7200000, // 2 hours\n  MAX_DECISIONS_PER_SESSION: 100,\n  MAX_CONCURRENT_SIMULATIONS: 5,\n};\n\n// Validation Patterns and Constants\nexport const VALIDATION = {\n  // Common numeric ranges\n  PERCENTAGE_MIN: 0,\n  PERCENTAGE_MAX: 100,\n  PROBABILITY_MIN: 0.0,\n  PROBABILITY_MAX: 1.0,\n\n  // Age ranges for educational content\n  MIN_AGE: 13,\n  MAX_AGE: 120,\n\n  // Rating scales\n  RATING_MIN: 1,\n  RATING_MAX: 5,\n  SCALE_MIN: 0,\n  SCALE_MAX: 10,\n};\n\n// Educational Content Constants\nexport const EDUCATION = {\n  // Difficulty levels\n  DIFFICULTY: {\n    BEGINNER: 1,\n    INTERMEDIATE: 2,\n    ADVANCED: 3,\n    EXPERT: 4,\n  },\n\n  // Duration ranges (in minutes)\n  DURATION: {\n    QUICK: 5,\n    SHORT: 15,\n    MEDIUM: 30,\n    LONG: 60,\n    EXTENDED: 120,\n  },\n\n  // Age groups\n  AGE_GROUPS: {\n    MIDDLE_SCHOOL: 13,\n    HIGH_SCHOOL: 16,\n    COLLEGE: 18,\n    ADULT: 25,\n  },\n};\n\n// Default export containing all constants\nexport default {\n  TIMING,\n  BREAKPOINTS,\n  CANVAS,\n  UI,\n  PERFORMANCE,\n  ANALYTICS,\n  COLORS,\n  EASING,\n  LIMITS,\n  VALIDATION,\n  EDUCATION,\n  COMMON,\n};\n","/**\n * Copyright 2025 Armando Sori\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * EthicsSimulation - Base class for all ethics simulations\n * Provides common functionality for ethics tracking, UI management, and educational features\n */\n\nimport { simpleStorage } from '../utils/simple-storage.js';\nimport { simpleAnalytics } from '../utils/simple-analytics.js';\nimport { UIPanel, EthicsDisplay, FeedbackSystem } from './ui.js';\n\n// Constants to avoid magic numbers\nconst SIMULATION_CONSTANTS = {\n  DEFAULT_DURATION: 300, // 5 minutes in seconds\n  DEFAULT_METRIC_VALUE: 50,\n  FEEDBACK_PANEL_WIDTH: 220,\n  FEEDBACK_PANEL_MARGIN: 10,\n  ETHICS_PANEL_WIDTH: 250,\n  ETHICS_PANEL_HEIGHT: 150,\n  ETHICS_PANEL_Y_OFFSET: 420,\n  ETHICS_PANEL_WIDTH_OFFSET: 240,\n  // UI positioning and sizing constants\n  UI_POSITIONS: {\n    CONTROL_PANEL: { x: 10, y: 10 },\n    INFO_PANEL: { x: 10, y: 170 },\n  },\n  UI_SIZES: {\n    CONTROL_PANEL: { width: 200, height: 150 },\n    INFO_PANEL: { width: 200, height: 300 },\n  },\n  // Default values for initialization\n  INITIAL_VALUES: {\n    SCENARIO_INDEX: 0,\n    SCORE: 0,\n    TIME_ELAPSED: 0,\n    METRIC_MIN: 0,\n    METRIC_MAX: 100,\n    DEFAULT_WEIGHT: 1,\n  },\n};\n\nclass EthicsSimulation {\n  constructor(id, config = {}) {\n    this.id = id;\n    this.title = config.title || 'Untitled Simulation';\n    this.description = config.description || '';\n    this.difficulty = config.difficulty || 'beginner'; // beginner, intermediate, advanced\n    this.duration = config.duration || SIMULATION_CONSTANTS.DEFAULT_DURATION;\n    this.tags = config.tags || [];\n\n    // Ethics tracking\n    this.ethicsMetrics = new Map();\n    this.ethicsHistory = [];\n    this.currentScenario = SIMULATION_CONSTANTS.INITIAL_VALUES.SCENARIO_INDEX;\n    this.scenarios = config.scenarios || [];\n\n    // Simulation state\n    this.state = {\n      started: false,\n      completed: false,\n      paused: false,\n      score: SIMULATION_CONSTANTS.INITIAL_VALUES.SCORE,\n      decisions: [],\n      timeElapsed: SIMULATION_CONSTANTS.INITIAL_VALUES.TIME_ELAPSED,\n    };\n\n    // Engine reference\n    this.engine = null;\n    this.components = [];\n\n    // Event system\n    this.events = new Map();\n\n    this.initializeEthicsMetrics(config.ethicsMetrics || []);\n  }\n\n  initializeEthicsMetrics(metrics) {\n    const defaultMetrics = [\n      {\n        name: 'fairness',\n        label: 'Fairness',\n        value: SIMULATION_CONSTANTS.DEFAULT_METRIC_VALUE,\n        weight: SIMULATION_CONSTANTS.INITIAL_VALUES.DEFAULT_WEIGHT,\n      },\n      {\n        name: 'transparency',\n        label: 'Transparency',\n        value: SIMULATION_CONSTANTS.DEFAULT_METRIC_VALUE,\n        weight: SIMULATION_CONSTANTS.INITIAL_VALUES.DEFAULT_WEIGHT,\n      },\n      {\n        name: 'privacy',\n        label: 'Privacy',\n        value: SIMULATION_CONSTANTS.DEFAULT_METRIC_VALUE,\n        weight: SIMULATION_CONSTANTS.INITIAL_VALUES.DEFAULT_WEIGHT,\n      },\n      {\n        name: 'accountability',\n        label: 'Accountability',\n        value: SIMULATION_CONSTANTS.DEFAULT_METRIC_VALUE,\n        weight: SIMULATION_CONSTANTS.INITIAL_VALUES.DEFAULT_WEIGHT,\n      },\n    ];\n\n    const allMetrics = [...defaultMetrics, ...metrics];\n\n    allMetrics.forEach(metric => {\n      this.ethicsMetrics.set(metric.name, {\n        label: metric.label,\n        value: metric.value || SIMULATION_CONSTANTS.DEFAULT_METRIC_VALUE,\n        min: metric.min || SIMULATION_CONSTANTS.INITIAL_VALUES.METRIC_MIN,\n        max: metric.max || SIMULATION_CONSTANTS.INITIAL_VALUES.METRIC_MAX,\n        weight:\n          metric.weight || SIMULATION_CONSTANTS.INITIAL_VALUES.DEFAULT_WEIGHT,\n        description: metric.description || '',\n      });\n    });\n  }\n\n  // Engine integration\n  init(engineInstance) {\n    this.engine = engineInstance;\n    this.setupUI();\n    this.setupEthicsDisplay();\n    this.loadScenario(SIMULATION_CONSTANTS.INITIAL_VALUES.SCENARIO_INDEX);\n\n    // Start tracking time\n    this.startTime = Date.now();\n\n    this.emit('simulation:initialized');\n  }\n\n  setupUI() {\n    // Create base UI components\n    this.createControlPanel();\n    this.createInformationPanel();\n    this.createFeedbackSystem();\n  }\n\n  createControlPanel() {\n    const panel = new UIPanel({\n      id: 'control-panel',\n      position: SIMULATION_CONSTANTS.UI_POSITIONS.CONTROL_PANEL,\n      size: SIMULATION_CONSTANTS.UI_SIZES.CONTROL_PANEL,\n      title: 'Controls',\n    });\n\n    // Add common controls\n    panel.addButton('Reset', () => this.reset());\n    panel.addButton('Pause', () => this.togglePause());\n    panel.addButton('Help', () => this.showHelp());\n\n    this.controlPanel = panel;\n    this.engine.addComponent(panel);\n  }\n\n  createInformationPanel() {\n    const panel = new UIPanel({\n      id: 'info-panel',\n      position: SIMULATION_CONSTANTS.UI_POSITIONS.INFO_PANEL,\n      size: SIMULATION_CONSTANTS.UI_SIZES.INFO_PANEL,\n      title: 'Information',\n    });\n\n    this.informationPanel = panel;\n    this.engine.addComponent(panel);\n  }\n  createFeedbackSystem() {\n    if (!this.engine || !this.engine.config) {\n      this.handleError('Engine not properly initialized for feedback system');\n      return;\n    }\n\n    this.feedbackSystem = new FeedbackSystem({\n      position: {\n        x: this.engine.config.width - SIMULATION_CONSTANTS.FEEDBACK_PANEL_WIDTH,\n        y: SIMULATION_CONSTANTS.FEEDBACK_PANEL_MARGIN,\n      },\n      size: { width: 200, height: 400 },\n    });\n\n    this.engine.addComponent(this.feedbackSystem);\n  }\n\n  setupEthicsDisplay() {\n    if (!this.engine || !this.engine.config) {\n      this.handleError('Engine not properly initialized for ethics display');\n      return;\n    }\n\n    // Create ethics meters display\n    this.ethicsDisplay = new EthicsDisplay({\n      metrics: this.ethicsMetrics,\n      position: {\n        x: this.engine.config.width - SIMULATION_CONSTANTS.ETHICS_PANEL_WIDTH,\n        y: SIMULATION_CONSTANTS.ETHICS_PANEL_Y_OFFSET,\n      },\n      size: {\n        width: SIMULATION_CONSTANTS.ETHICS_PANEL_WIDTH_OFFSET,\n        height: SIMULATION_CONSTANTS.ETHICS_PANEL_HEIGHT,\n      },\n    });\n\n    this.engine.addComponent(this.ethicsDisplay);\n  } // Scenario management\n  loadScenario(index) {\n    if (!this.scenarios || !Array.isArray(this.scenarios)) {\n      this.handleError('Scenarios not properly initialized');\n      return;\n    }\n\n    if (index >= this.scenarios.length) {\n      this.completeSimulation();\n      return;\n    }\n\n    if (index < 0) {\n      this.handleError(`Invalid scenario index: ${index}`);\n      return;\n    }\n\n    this.currentScenario = index;\n    const scenario = this.scenarios[index];\n\n    if (!scenario) {\n      this.handleError(`Scenario not found at index: ${index}`);\n      return;\n    }\n\n    this.clearScenarioComponents();\n    this.setupScenarioComponents(scenario);\n    this.updateInformationPanel(scenario);\n\n    this.emit('scenario:loaded', { scenario, index });\n  }\n\n  clearScenarioComponents() {\n    // Remove scenario-specific components\n    this.components.forEach(component => {\n      if (component.isScenarioComponent) {\n        this.engine.removeComponent(component);\n      }\n    });\n\n    this.components = this.components.filter(c => !c.isScenarioComponent);\n  }\n\n  setupScenarioComponents(scenario) {\n    // Override in specific simulations\n    // Log scenario setup in development only\n    if (\n      typeof process !== 'undefined' &&\n      process.env?.NODE_ENV === 'development'\n    ) {\n      // eslint-disable-next-line no-console\n      console.log('Setting up scenario:', scenario.title);\n    }\n  }\n\n  updateInformationPanel(scenario) {\n    if (!this.informationPanel) {\n      this.handleError('Information panel not initialized');\n      return;\n    }\n\n    if (!scenario) {\n      this.handleError(\n        'Cannot update information panel: scenario is null/undefined'\n      );\n      return;\n    }\n\n    const title = scenario.title || 'Unknown Scenario';\n    const description = scenario.description || 'No description available';\n    const objective = scenario.objective || 'No objective specified';\n\n    this.informationPanel.setContent(`\n            <h3>${title}</h3>\n            <p>${description}</p>\n            <div class=\"scenario-info\">\n                <p><strong>Objective:</strong> ${objective}</p>\n                <p><strong>Scenario ${this.currentScenario + 1}</strong> of ${this.scenarios.length}</p>\n            </div>\n        `);\n  }\n\n  // Ethics tracking methods\n  updateEthicsMetric(metricName, change, reasoning = '') {\n    const metric = this.ethicsMetrics.get(metricName);\n    if (!metric) {\n      this.handleError(`Ethics metric '${metricName}' not found`);\n      return;\n    }\n\n    const oldValue = metric.value;\n    metric.value = Math.max(\n      metric.min,\n      Math.min(metric.max, metric.value + change)\n    );\n\n    // Record the change\n    const record = {\n      timestamp: Date.now(),\n      metric: metricName,\n      oldValue,\n      newValue: metric.value,\n      change,\n      reasoning,\n      scenario: this.currentScenario,\n    };\n\n    this.ethicsHistory.push(record);\n    this.logEthicalDecision(metricName, change, reasoning);\n\n    // Update display\n    if (this.ethicsDisplay) {\n      this.ethicsDisplay.updateMetric(metricName, metric.value);\n    }\n\n    // Provide feedback\n    this.provideFeedback(metricName, change, reasoning);\n\n    this.emit('ethics:updated', record);\n  }\n  logEthicalDecision(category, change, reasoning) {\n    const decision = {\n      timestamp: Date.now(),\n      simulationId: this.id,\n      scenario: this.currentScenario,\n      category,\n      change,\n      reasoning,\n      state: { ...this.state },\n      allMetrics: Object.fromEntries(this.ethicsMetrics),\n    };\n\n    // Store in local storage and analytics with error handling\n    try {\n      simpleStorage.set(`decision_${this.id}_${Date.now()}`, decision);\n    } catch (error) {\n      this.handleError('Failed to log decision to storage', error);\n    }\n\n    try {\n      simpleAnalytics.trackEvent('ethics_decision', decision);\n    } catch (error) {\n      this.handleError('Failed to track decision in analytics', error);\n    }\n  }\n\n  provideFeedback(metricName, change, reasoning) {\n    if (!this.feedbackSystem) return;\n\n    const metric = this.ethicsMetrics.get(metricName);\n    const isPositive = change > 0;\n\n    let feedbackText = '';\n    let feedbackType = isPositive ? 'positive' : 'negative';\n\n    if (Math.abs(change) > 10) {\n      feedbackType = isPositive ? 'excellent' : 'concerning';\n    }\n\n    feedbackText = `${metric.label} ${isPositive ? 'improved' : 'decreased'} by ${Math.abs(change)} points.`;\n\n    if (reasoning) {\n      feedbackText += ` ${reasoning}`;\n    }\n\n    this.feedbackSystem.addFeedback(feedbackText, feedbackType);\n  }\n\n  // Decision making framework\n  makeDecision(decisionId, choice, impact = {}) {\n    const decision = {\n      id: decisionId,\n      choice,\n      timestamp: Date.now(),\n      scenario: this.currentScenario,\n      impact,\n    };\n\n    this.state.decisions.push(decision);\n\n    // Apply ethics impacts\n    Object.entries(impact).forEach(([metric, change]) => {\n      if (typeof change === 'object') {\n        this.updateEthicsMetric(metric, change.value, change.reasoning);\n      } else {\n        this.updateEthicsMetric(metric, change);\n      }\n    });\n\n    this.emit('decision:made', decision);\n\n    return decision;\n  }\n\n  // Simulation control\n  start() {\n    if (this.state.started) return;\n\n    this.state.started = true;\n    this.state.paused = false;\n    this.startTime = Date.now();\n\n    this.emit('simulation:started');\n  }\n\n  pause() {\n    this.state.paused = true;\n    this.emit('simulation:paused');\n  }\n\n  resume() {\n    this.state.paused = false;\n    this.emit('simulation:resumed');\n  }\n\n  togglePause() {\n    if (this.state.paused) {\n      this.resume();\n    } else {\n      this.pause();\n    }\n  }\n\n  reset() {\n    this.state = {\n      started: false,\n      completed: false,\n      paused: false,\n      score: 0,\n      decisions: [],\n      timeElapsed: 0,\n    };\n\n    // Reset ethics metrics to initial values\n    this.ethicsMetrics.forEach(metric => {\n      metric.value = 50; // Reset to neutral\n    });\n\n    this.ethicsHistory = [];\n    this.currentScenario = 0;\n\n    this.loadScenario(0);\n    this.emit('simulation:reset');\n  }\n\n  nextScenario() {\n    if (this.currentScenario < this.scenarios.length - 1) {\n      this.loadScenario(this.currentScenario + 1);\n    } else {\n      this.completeSimulation();\n    }\n  }\n\n  completeSimulation() {\n    this.state.completed = true;\n    this.state.timeElapsed = Date.now() - this.startTime;\n\n    // Calculate final score\n    this.calculateFinalScore();\n\n    // Generate completion report\n    const report = this.generateCompletionReport();\n\n    this.emit('simulation:completed', { score: this.state.score, report });\n  }\n  calculateFinalScore() {\n    if (!this.ethicsMetrics || this.ethicsMetrics.size === 0) {\n      this.handleError('No ethics metrics available for score calculation');\n      this.state.score = 0;\n      return;\n    }\n\n    let totalScore = 0;\n    let totalWeight = 0;\n\n    this.ethicsMetrics.forEach(metric => {\n      if (\n        typeof metric.value === 'number' &&\n        typeof metric.weight === 'number'\n      ) {\n        totalScore += metric.value * metric.weight;\n        totalWeight += metric.weight;\n      }\n    });\n\n    if (totalWeight === 0) {\n      this.handleError('Total weight is zero, cannot calculate score');\n      this.state.score = 0;\n      return;\n    }\n\n    this.state.score = Math.round(totalScore / totalWeight);\n  }\n\n  generateCompletionReport() {\n    return {\n      simulationId: this.id,\n      title: this.title,\n      duration: this.state.timeElapsed,\n      score: this.state.score,\n      decisions: this.state.decisions.length,\n      ethicsMetrics: Object.fromEntries(this.ethicsMetrics),\n      ethicsHistory: this.ethicsHistory,\n      scenarios: this.scenarios.length,\n      completedAt: new Date().toISOString(),\n    };\n  }\n\n  // Event system\n  on(event, callback) {\n    if (!this.events.has(event)) {\n      this.events.set(event, []);\n    }\n    this.events.get(event).push(callback);\n  }\n\n  emit(event, data = {}) {\n    if (this.events.has(event)) {\n      this.events.get(event).forEach(callback => {\n        try {\n          callback(data);\n        } catch (error) {\n          this.handleError(`Error in event handler for ${event}`, error);\n        }\n      });\n    }\n  }\n\n  // Accessibility\n  getAccessibilityDescription() {\n    return `${this.title}: ${this.description}. Current ethics scores: ${Array.from(\n      this.ethicsMetrics.entries()\n    )\n      .map(([_name, metric]) => `${metric.label}: ${metric.value}`)\n      .join(', ')}`;\n  }\n\n  // Update method called by engine\n  update(deltaTime) {\n    if (!this.state.started || this.state.paused || this.state.completed)\n      return;\n\n    this.state.timeElapsed += deltaTime;\n\n    // Override in specific simulations for custom update logic\n    this.updateSimulation(deltaTime);\n  }\n\n  updateSimulation(_deltaTime) {\n    // Override in specific simulations\n  }\n\n  // Helper methods\n  showHelp() {\n    // Display help information\n    this.emit('help:requested');\n  }\n  getProgress() {\n    const totalScenarios = this.scenarios ? this.scenarios.length : 0;\n    const currentScenario = Math.max(0, this.currentScenario);\n\n    if (totalScenarios === 0) {\n      return {\n        scenario: 0,\n        totalScenarios: 0,\n        percentage: 0,\n      };\n    }\n\n    return {\n      scenario: currentScenario + 1,\n      totalScenarios,\n      percentage: ((currentScenario + 1) / totalScenarios) * 100,\n    };\n  }\n\n  // Error handling\n  handleError(message, error = null) {\n    const errorData = {\n      simulationId: this.id,\n      message,\n      error: error?.message || 'Unknown error',\n      timestamp: Date.now(),\n      scenario: this.currentScenario,\n    };\n\n    // Track error in analytics\n    try {\n      simpleAnalytics.trackEvent('simulation_error', errorData);\n    } catch (analyticsError) {\n      // Silent fail for analytics\n    }\n\n    // Emit error event for UI handling\n    this.emit('error', errorData);\n\n    // Store error for debugging in development\n    if (\n      typeof process !== 'undefined' &&\n      process.env?.NODE_ENV === 'development'\n    ) {\n      // eslint-disable-next-line no-console\n      console.error(`Simulation Error [${this.id}]:`, message, error);\n    }\n  }\n\n  // Cleanup and resource management\n  destroy() {\n    try {\n      // Clear all components\n      this.clearScenarioComponents();\n\n      // Remove UI components\n      if (this.engine) {\n        if (this.controlPanel) {\n          this.engine.removeComponent(this.controlPanel);\n        }\n        if (this.informationPanel) {\n          this.engine.removeComponent(this.informationPanel);\n        }\n        if (this.feedbackSystem) {\n          this.engine.removeComponent(this.feedbackSystem);\n        }\n        if (this.ethicsDisplay) {\n          this.engine.removeComponent(this.ethicsDisplay);\n        }\n      }\n\n      // Clear event listeners\n      this.events.clear();\n\n      // Reset state\n      this.state = null;\n      this.ethicsMetrics.clear();\n      this.ethicsHistory = [];\n      this.components = [];\n\n      // Log destruction in development only\n      if (\n        typeof process !== 'undefined' &&\n        process.env?.NODE_ENV === 'development'\n      ) {\n        // eslint-disable-next-line no-console\n        console.log(`EthicsSimulation ${this.id}: Destroyed`);\n      }\n    } catch (error) {\n      this.handleError('Error during simulation cleanup', error);\n    }\n  }\n}\n\n// Export for ES6 modules\nexport default EthicsSimulation;\n","/**\n * Copyright 2025 Armando Sori\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * AnimationManager - Enhanced animation system for simulations\n * Modern implementation with accessibility, theme integration, and performance optimization\n *\n * Features:\n * - WCAG 2.1 AA compliance with reduced motion support\n * - Dark mode and theme integration\n * - Performance monitoring and optimization\n * - Advanced error handling and recovery\n * - Touch/gesture animation support\n * - Memory management and cleanup\n * - Accessibility announcements\n *\n * @version 2.0.0\n * @author SimulateAI Team\n */\n\nimport logger from '../utils/logger.js';\nimport { COMMON, EASING } from '../utils/constants.js';\n\n// Enhanced constants and configuration\nconst ANIMATION_CONSTANTS = {\n  DEFAULT_DURATION: 300,\n  REDUCED_MOTION_DURATION: 50,\n  MAX_ANIMATIONS_PER_FRAME: 50,\n  FRAME_TIME_LIMIT: 16, // ~60 FPS\n  PERFORMANCE_WARNING_THRESHOLD: 32, // 2x frame time\n  MEMORY_CLEANUP_INTERVAL: 30000, // 30 seconds\n  THROTTLE_DELAY: 16,\n  TOUCH_GESTURE_THRESHOLD: 50,\n  PERFORMANCE_WARNING_LIMIT: 5, // Maximum performance warnings before throttling\n  PERFORMANCE_RESET_DELAY: 5000, // 5 seconds delay for performance reset\n  CLEANUP_DELAY: 1500, // 1.5 seconds delay for cleanup operations\n  PROPERTY_SIZE_MULTIPLIER: 128, // Multiplier for calculating property memory size\n  HISTORY_CUTOFF_TIME: 60000, // 1 minute in milliseconds for history cleanup\n  HEX_SHORT_LENGTH: 3, // Length of short hex color codes\n  HEX_LONG_LENGTH: 6, // Length of long hex color codes\n  HEX_SLICE_END_SHORT: 4, // End index for hex color slicing\n  TRANSITION_MIDPOINT: 0.5, // Midpoint for transitions and easings\n  SCALE_DURATION_MULTIPLIER: 0.8, // Multiplier for scale animation duration\n  REDUCED_SHAKE_COUNT: 3, // Number of shakes for reduced motion\n  NORMAL_SHAKE_COUNT: 10, // Number of shakes for normal motion\n  FADE_DURATION_MULTIPLIER: 0.5, // Multiplier for fade animation duration\n  SWIPE_DISTANCE: 50, // Distance for swipe animations\n  PINCH_IN_SCALE: 0.8, // Scale factor for pinch in gesture\n  PINCH_OUT_SCALE: 1.2, // Scale factor for pinch out gesture\n};\n\nconst EASING_PRESETS = {\n  accessibility: 'easeInOut',\n  reduced: 'linear',\n  smooth: 'easeOutCubic',\n  bounce: 'bounce',\n  elastic: 'elastic',\n};\n\n/**\n * Animation theme integration for accessibility and visual consistency\n */\nclass AnimationTheme {\n  static getCurrentTheme() {\n    const prefersReducedMotion = window.matchMedia?.(\n      '(prefers-reduced-motion: reduce)'\n    ).matches;\n    const prefersHighContrast = window.matchMedia?.(\n      '(prefers-contrast: high)'\n    ).matches;\n\n    return {\n      reducedMotion: prefersReducedMotion,\n      highContrast: prefersHighContrast,\n      theme: prefersHighContrast ? 'highContrast' : 'light',\n    };\n  }\n\n  static getAnimationConfig(theme = null) {\n    const currentTheme = theme || this.getCurrentTheme();\n\n    return {\n      duration: currentTheme.reducedMotion\n        ? ANIMATION_CONSTANTS.REDUCED_MOTION_DURATION\n        : ANIMATION_CONSTANTS.DEFAULT_DURATION,\n      easing: currentTheme.reducedMotion\n        ? EASING_PRESETS.reduced\n        : EASING_PRESETS.accessibility,\n      enabled: !currentTheme.reducedMotion,\n      respectSystemPreferences: true,\n    };\n  }\n}\n\n/**\n * Performance monitoring for animation operations\n */\nclass AnimationPerformanceMonitor {\n  static metrics = new Map();\n  static memoryTracker = new Map();\n\n  static startOperation(operationName) {\n    const startTime = performance.now();\n    this.metrics.set(operationName, {\n      startTime,\n      operations: (this.metrics.get(operationName)?.operations || 0) + 1,\n    });\n    return startTime;\n  }\n\n  static endOperation(operationName, startTime = null) {\n    const endTime = performance.now();\n    const metric = this.metrics.get(operationName);\n\n    if (metric) {\n      const duration = endTime - (startTime || metric.startTime);\n      metric.lastDuration = duration;\n      metric.averageDuration =\n        ((metric.averageDuration || 0) * (metric.operations - 1) + duration) /\n        metric.operations;\n\n      // Performance warning for slow animations\n      if (duration > ANIMATION_CONSTANTS.PERFORMANCE_WARNING_THRESHOLD) {\n        logger.warn(\n          `Slow animation operation: ${operationName} took ${duration.toFixed(2)}ms`\n        );\n      }\n    }\n  }\n\n  static trackMemory(animationId, size) {\n    this.memoryTracker.set(animationId, {\n      size,\n      timestamp: Date.now(),\n    });\n  }\n\n  static releaseMemory(animationId) {\n    this.memoryTracker.delete(animationId);\n  }\n\n  static getMetrics() {\n    return {\n      operations: Object.fromEntries(this.metrics),\n      memory: {\n        trackedAnimations: this.memoryTracker.size,\n        totalMemoryEstimate: Array.from(this.memoryTracker.values()).reduce(\n          (total, item) => total + item.size,\n          0\n        ),\n      },\n    };\n  }\n}\n\n/**\n * Enhanced error handling for animation operations\n */\nclass AnimationError extends Error {\n  constructor(message, context = {}, originalError = null) {\n    super(message);\n    this.name = 'AnimationError';\n    this.context = context;\n    this.originalError = originalError;\n    this.timestamp = new Date().toISOString();\n    this.animationId = context.animationId;\n    this.theme = AnimationTheme.getCurrentTheme();\n  }\n}\n\nexport class AnimationManager {\n  constructor(engine) {\n    this.engine = engine;\n    this.animations = new Map();\n    this.timelines = new Map();\n    this.activeAnimations = new Set();\n    this.animationId = 0;\n\n    // Enhanced state management\n    this.theme = AnimationTheme.getCurrentTheme();\n    this.performanceMonitor = AnimationPerformanceMonitor;\n    this.renderCache = new Map();\n\n    // Performance settings with theme awareness\n    this.maxAnimationsPerFrame = ANIMATION_CONSTANTS.MAX_ANIMATIONS_PER_FRAME;\n    this.frameTimeLimit = ANIMATION_CONSTANTS.FRAME_TIME_LIMIT;\n\n    // Accessibility features\n    this.accessibilityEnabled = true;\n    this.reducedMotionMode = this.theme.reducedMotion;\n    this.announcements = [];\n\n    // Error handling\n    this.errorCount = 0;\n    this.lastError = null;\n\n    // Memory management\n    this.memoryCleanupInterval = null;\n\n    // Touch/gesture support\n    this.gestureAnimations = new Map();\n\n    // Settings persistence\n    this.settings = this.loadSettings();\n\n    this.init();\n  }\n\n  init() {\n    const startTime = this.performanceMonitor.startOperation(\n      'animation-manager-init'\n    );\n\n    try {\n      this.setupThemeIntegration();\n      this.setupAccessibilityFeatures();\n      this.setupPerformanceMonitoring();\n      this.setupMemoryManagement();\n      this.setupEventListeners();\n\n      logger.info(\n        'Animation',\n        'Enhanced AnimationManager initialized with accessibility and performance features'\n      );\n    } catch (error) {\n      this.handleError(\n        new AnimationError(\n          'Failed to initialize AnimationManager',\n          { engine: this.engine },\n          error\n        )\n      );\n    } finally {\n      this.performanceMonitor.endOperation('animation-manager-init', startTime);\n    }\n  }\n\n  setupThemeIntegration() {\n    // Watch for theme changes\n    const reducedMotionQuery = window.matchMedia(\n      '(prefers-reduced-motion: reduce)'\n    );\n    const contrastQuery = window.matchMedia('(prefers-contrast: high)');\n\n    const updateTheme = () => {\n      this.theme = AnimationTheme.getCurrentTheme();\n      this.reducedMotionMode = this.theme.reducedMotion;\n      this.updateAnimationDefaults();\n      this.announceThemeChange();\n    };\n\n    if (reducedMotionQuery.addEventListener) {\n      reducedMotionQuery.addEventListener('change', updateTheme);\n      contrastQuery.addEventListener('change', updateTheme);\n    }\n\n    // Store listeners for cleanup\n    this.themeListeners = { reducedMotionQuery, contrastQuery, updateTheme };\n  }\n\n  setupAccessibilityFeatures() {\n    // Create announcement region for animation states\n    this.createAccessibilityRegion();\n\n    // Setup accessibility announcements\n    this.accessibilityConfig = {\n      announceAnimations: this.settings.announceAnimations !== false,\n      respectReducedMotion: this.settings.respectReducedMotion !== false,\n      enableKeyboardControls: this.settings.enableKeyboardControls !== false,\n    };\n  }\n\n  createAccessibilityRegion() {\n    if (typeof document === 'undefined') return;\n\n    let region = document.getElementById('animation-announcements');\n    if (!region) {\n      region = document.createElement('div');\n      region.id = 'animation-announcements';\n      region.setAttribute('aria-live', 'polite');\n      region.setAttribute('aria-atomic', 'true');\n      region.className = 'sr-only';\n      region.style.cssText = `\n                position: absolute !important;\n                left: -10000px !important;\n                width: 1px !important;\n                height: 1px !important;\n                overflow: hidden !important;\n            `;\n      document.body.appendChild(region);\n    }\n    this.accessibilityRegion = region;\n  }\n\n  setupPerformanceMonitoring() {\n    // Monitor animation performance\n    this.performanceConfig = {\n      trackRenderTime: true,\n      trackMemoryUsage: true,\n      enableWarnings: true,\n      maxAnimationDuration: this.reducedMotionMode\n        ? COMMON.MILLISECONDS_100\n        : COMMON.MILLISECONDS_2000,\n    };\n  }\n\n  setupMemoryManagement() {\n    // Periodic cleanup\n    this.memoryCleanupInterval = setInterval(() => {\n      this.performMemoryCleanup();\n    }, ANIMATION_CONSTANTS.MEMORY_CLEANUP_INTERVAL);\n  }\n\n  setupEventListeners() {\n    // Listen for visibility changes to pause animations when tab is not active\n    if (typeof document !== 'undefined') {\n      document.addEventListener('visibilitychange', () => {\n        if (document.hidden) {\n          this.pauseAllAnimations();\n        } else {\n          this.resumeAllAnimations();\n        }\n      });\n    }\n  }\n\n  updateAnimationDefaults() {\n    const config = AnimationTheme.getAnimationConfig(this.theme);\n    this.defaultDuration = config.duration;\n    this.defaultEasing = config.easing;\n    this.animationsEnabled = config.enabled || this.settings.forceAnimations;\n  }\n\n  announceThemeChange() {\n    if (this.accessibilityConfig.announceAnimations) {\n      this.announce(\n        `Animation theme updated: ${this.theme.theme} mode, reduced motion: ${this.reducedMotionMode ? 'on' : 'off'}`\n      );\n    }\n  } // Enhanced animation methods with accessibility and performance\n  animate(target, properties, duration = null, options = {}) {\n    const startTime =\n      this.performanceMonitor.startOperation('create-animation');\n\n    try {\n      if (!target || !properties) {\n        throw new AnimationError('Invalid animation parameters', {\n          target,\n          properties,\n        });\n      }\n\n      // Apply theme-aware defaults\n      const actualDuration =\n        duration ||\n        this.defaultDuration ||\n        ANIMATION_CONSTANTS.DEFAULT_DURATION;\n      const themeDuration = this.reducedMotionMode\n        ? Math.min(actualDuration, ANIMATION_CONSTANTS.REDUCED_MOTION_DURATION)\n        : actualDuration;\n\n      if (!this.animationsEnabled && !options.force) {\n        // Skip animation but call completion callback\n        if (options.onComplete) {\n          setTimeout(() => options.onComplete(target), 0);\n        }\n        return null;\n      }\n\n      const animation = {\n        id: ++this.animationId,\n        target,\n        properties: this.processProperties(target, properties),\n        duration: Math.max(themeDuration, 1), // Minimum 1ms\n        startTime: performance.now(),\n        elapsed: 0,\n        progress: 0,\n\n        // Enhanced options with accessibility\n        easing: options.easing || this.defaultEasing || 'easeInOut',\n        delay: options.delay || 0,\n        repeat: options.repeat || 0,\n        yoyo: options.yoyo || false,\n        onStart: options.onStart || null,\n        onUpdate: options.onUpdate || null,\n        onComplete: options.onComplete || null,\n        onRepeat: options.onRepeat || null,\n        onError: options.onError || null,\n\n        // Accessibility options\n        announceStart: options.announceStart || false,\n        announceComplete: options.announceComplete || false,\n        description: options.description || '',\n\n        // State\n        started: false,\n        completed: false,\n        paused: false,\n        repeatCount: 0,\n        direction: 1,\n\n        // Performance tracking\n        createdAt: Date.now(),\n        performanceWarnings: 0,\n      };\n\n      this.animations.set(animation.id, animation);\n      this.activeAnimations.add(animation.id);\n\n      // Track memory usage\n      this.performanceMonitor.trackMemory(\n        animation.id,\n        this.estimateAnimationMemory(animation)\n      );\n\n      // Accessibility announcement\n      if (animation.announceStart && animation.description) {\n        this.announce(`Starting animation: ${animation.description}`);\n      }\n\n      return animation.id;\n    } catch (error) {\n      this.handleError(\n        new AnimationError(\n          'Failed to create animation',\n          { target, properties, duration, options },\n          error\n        )\n      );\n      return null;\n    } finally {\n      this.performanceMonitor.endOperation('create-animation', startTime);\n    }\n  }\n\n  // Tween to specific values\n  to(target, properties, duration, options = {}) {\n    return this.animate(target, properties, duration, options);\n  }\n\n  // Tween from specific values\n  from(target, properties, duration, options = {}) {\n    // Set the starting values, then animate to current values\n    const endValues = {};\n    Object.keys(properties).forEach(key => {\n      endValues[key] = target[key] || 0;\n      target[key] = properties[key];\n    });\n\n    return this.animate(target, endValues, duration, options);\n  }\n\n  // Timeline management\n  createTimeline(options = {}) {\n    const timeline = {\n      id: ++this.animationId,\n      animations: [],\n      duration: 0,\n      startTime: 0,\n      elapsed: 0,\n      progress: 0,\n\n      // Options\n      repeat: options.repeat || 0,\n      yoyo: options.yoyo || false,\n      onStart: options.onStart || null,\n      onUpdate: options.onUpdate || null,\n      onComplete: options.onComplete || null,\n\n      // State\n      started: false,\n      completed: false,\n      paused: false,\n    };\n\n    this.timelines.set(timeline.id, timeline);\n    return timeline.id;\n  }\n\n  // Add animation to timeline\n  addToTimeline(\n    timelineId,\n    target,\n    properties,\n    duration,\n    delay = 0,\n    options = {}\n  ) {\n    const timeline = this.timelines.get(timelineId);\n    if (!timeline) return null;\n\n    const animation = {\n      target,\n      properties: this.processProperties(target, properties),\n      duration,\n      delay,\n      easing: options.easing || 'easeInOut',\n      onStart: options.onStart || null,\n      onUpdate: options.onUpdate || null,\n      onComplete: options.onComplete || null,\n      started: false,\n      completed: false,\n    };\n\n    timeline.animations.push(animation);\n    timeline.duration = Math.max(timeline.duration, delay + duration);\n\n    return animation;\n  }\n\n  // Play timeline\n  playTimeline(timelineId) {\n    const timeline = this.timelines.get(timelineId);\n    if (!timeline) return;\n\n    timeline.startTime = performance.now();\n    timeline.started = true;\n    timeline.completed = false;\n\n    if (timeline.onStart) {\n      timeline.onStart(timeline);\n    }\n  }\n\n  // Control methods\n  pause(animationId) {\n    const animation = this.animations.get(animationId);\n    if (animation) {\n      animation.paused = true;\n    }\n  }\n\n  resume(animationId) {\n    const animation = this.animations.get(animationId);\n    if (animation && animation.paused) {\n      animation.paused = false;\n      // Adjust start time to account for pause duration\n      const now = performance.now();\n      animation.startTime = now - animation.elapsed;\n    }\n  }\n\n  stop(animationId) {\n    const animation = this.animations.get(animationId);\n    if (animation) {\n      animation.completed = true;\n      this.activeAnimations.delete(animationId);\n    }\n  }\n\n  stopAll() {\n    this.activeAnimations.forEach(id => this.stop(id));\n  } // Enhanced update method with performance monitoring and error handling\n  update(deltaTime) {\n    const frameStart =\n      this.performanceMonitor.startOperation('animation-update');\n    let processedCount = 0;\n    let errorCount = 0;\n\n    try {\n      // Update active animations with performance monitoring\n      for (const animationId of this.activeAnimations) {\n        if (\n          processedCount >= this.maxAnimationsPerFrame ||\n          performance.now() - frameStart.startTime > this.frameTimeLimit\n        ) {\n          break;\n        }\n\n        const animation = this.animations.get(animationId);\n        if (animation && !animation.paused) {\n          try {\n            this.updateAnimation(animation, deltaTime);\n            processedCount++;\n          } catch (error) {\n            errorCount++;\n            this.handleAnimationError(animation, error);\n          }\n        }\n      }\n\n      // Update timelines with error handling\n      this.timelines.forEach(timeline => {\n        if (timeline.started && !timeline.completed && !timeline.paused) {\n          try {\n            this.updateTimeline(timeline, deltaTime);\n          } catch (error) {\n            errorCount++;\n            this.handleTimelineError(timeline, error);\n          }\n        }\n      });\n\n      // Clean up completed animations\n      this.cleanupCompleted();\n\n      // Performance warnings\n      const frameTime = performance.now() - frameStart.startTime;\n      if (frameTime > this.frameTimeLimit * 2) {\n        logger.warn(\n          `Animation frame took ${frameTime.toFixed(2)}ms (processed ${processedCount} animations)`\n        );\n      }\n    } catch (error) {\n      this.handleError(\n        new AnimationError(\n          'Animation update failed',\n          { processedCount, errorCount },\n          error\n        )\n      );\n    } finally {\n      this.performanceMonitor.endOperation('animation-update', frameStart);\n    }\n  }\n\n  updateAnimation(animation, _deltaTime) {\n    const now = performance.now();\n\n    try {\n      // Handle delay\n      if (!animation.started) {\n        if (now - animation.startTime >= animation.delay) {\n          animation.started = true;\n          animation.startTime = now;\n\n          if (animation.onStart) {\n            animation.onStart(animation.target, animation);\n          }\n\n          // Accessibility announcement\n          if (animation.announceStart && animation.description) {\n            this.announce(`Animation started: ${animation.description}`);\n          }\n        } else {\n          return;\n        }\n      }\n\n      // Calculate progress with bounds checking\n      animation.elapsed = now - animation.startTime;\n      animation.progress = Math.min(\n        Math.max(animation.elapsed / animation.duration, 0),\n        1\n      );\n\n      // Apply easing with error handling\n      const easedProgress = this.applyEasing(\n        animation.progress,\n        animation.easing\n      );\n\n      // Update properties with validation\n      this.updateProperties(animation, easedProgress);\n\n      // Call update callback with error handling\n      if (animation.onUpdate) {\n        try {\n          animation.onUpdate(animation.target, animation.progress, animation);\n        } catch (error) {\n          animation.performanceWarnings++;\n          if (animation.onError) {\n            animation.onError(error, animation);\n          }\n        }\n      }\n\n      // Handle completion\n      if (animation.progress >= 1) {\n        this.handleAnimationComplete(animation);\n      }\n    } catch (error) {\n      animation.performanceWarnings++;\n      throw new AnimationError(\n        'Animation update failed',\n        { animationId: animation.id },\n        error\n      );\n    }\n  }\n\n  updateTimeline(timeline, _deltaTime) {\n    const now = performance.now();\n    timeline.elapsed = now - timeline.startTime;\n    timeline.progress = Math.min(timeline.elapsed / timeline.duration, 1);\n\n    // Update timeline animations\n    timeline.animations.forEach(animation => {\n      const animationStart = timeline.startTime + animation.delay;\n      const animationEnd = animationStart + animation.duration;\n\n      if (\n        now >= animationStart &&\n        now <= animationEnd &&\n        !animation.completed\n      ) {\n        if (!animation.started) {\n          animation.started = true;\n          if (animation.onStart) {\n            animation.onStart(animation.target, animation);\n          }\n        }\n\n        const animationProgress = Math.min(\n          (now - animationStart) / animation.duration,\n          1\n        );\n        const easedProgress = this.applyEasing(\n          animationProgress,\n          animation.easing\n        );\n\n        this.updateProperties(animation, easedProgress);\n\n        if (animation.onUpdate) {\n          animation.onUpdate(animation.target, animationProgress, animation);\n        }\n\n        if (animationProgress >= 1 && !animation.completed) {\n          animation.completed = true;\n          if (animation.onComplete) {\n            animation.onComplete(animation.target, animation);\n          }\n        }\n      }\n    });\n\n    // Handle timeline completion\n    if (timeline.progress >= 1) {\n      timeline.completed = true;\n      if (timeline.onComplete) {\n        timeline.onComplete(timeline);\n      }\n    }\n  }\n  handleAnimationComplete(animation) {\n    try {\n      if (animation.repeat > 0 || animation.repeat === -1) {\n        // Handle repeat\n        animation.repeatCount++;\n\n        if (\n          animation.repeat === -1 ||\n          animation.repeatCount < animation.repeat\n        ) {\n          if (animation.yoyo) {\n            animation.direction *= -1;\n            // Swap start and end values for yoyo effect\n            Object.keys(animation.properties).forEach(key => {\n              const prop = animation.properties[key];\n              [prop.start, prop.end] = [prop.end, prop.start];\n            });\n          }\n\n          animation.startTime = performance.now();\n          animation.elapsed = 0;\n          animation.progress = 0;\n\n          if (animation.onRepeat) {\n            animation.onRepeat(\n              animation.target,\n              animation.repeatCount,\n              animation\n            );\n          }\n\n          return;\n        }\n      }\n\n      // Animation fully completed\n      animation.completed = true;\n      this.activeAnimations.delete(animation.id);\n\n      // Release memory tracking\n      this.performanceMonitor.releaseMemory(animation.id);\n\n      // Accessibility announcement\n      if (animation.announceComplete && animation.description) {\n        this.announce(`Animation completed: ${animation.description}`);\n      }\n\n      if (animation.onComplete) {\n        animation.onComplete(animation.target, animation);\n      }\n    } catch (error) {\n      this.handleAnimationError(animation, error);\n    }\n  }\n\n  // Enhanced error handling methods\n  handleError(error) {\n    this.errorCount++;\n    this.lastError = error;\n\n    logger.error('AnimationManager Error:', error);\n\n    // Emit error event for application-level handling\n    if (this.engine && this.engine.emit) {\n      this.engine.emit('animation:error', error);\n    }\n\n    // Attempt graceful recovery\n    this.attemptErrorRecovery(error);\n  }\n\n  handleAnimationError(animation, error) {\n    animation.performanceWarnings++;\n\n    if (animation.onError) {\n      animation.onError(error, animation);\n    } else {\n      this.handleError(\n        new AnimationError(\n          'Animation execution error',\n          { animationId: animation.id },\n          error\n        )\n      );\n    }\n\n    // Stop problematic animation if too many errors\n    if (\n      animation.performanceWarnings >\n      ANIMATION_CONSTANTS.PERFORMANCE_WARNING_LIMIT\n    ) {\n      this.stop(animation.id);\n      this.announce(\n        `Animation stopped due to errors: ${animation.description || 'Unknown animation'}`\n      );\n    }\n  }\n\n  handleTimelineError(timeline, error) {\n    logger.warn('Timeline error:', error);\n    timeline.completed = true;\n  }\n\n  attemptErrorRecovery(error) {\n    switch (error.context?.operation) {\n      case 'create-animation':\n        // Clear any partial animation state\n        if (error.context?.animationId) {\n          this.stop(error.context.animationId);\n        }\n        break;\n      case 'animation-update':\n        // Reduce animation complexity temporarily\n        this.maxAnimationsPerFrame = Math.max(\n          10,\n          this.maxAnimationsPerFrame - 10\n        );\n        setTimeout(() => {\n          this.maxAnimationsPerFrame =\n            ANIMATION_CONSTANTS.MAX_ANIMATIONS_PER_FRAME;\n        }, ANIMATION_CONSTANTS.PERFORMANCE_RESET_DELAY);\n        break;\n    }\n  }\n\n  // Enhanced accessibility methods\n  announce(message, urgent = false) {\n    if (!this.accessibilityConfig.announceAnimations || !message) return;\n\n    this.announcements.push({\n      message: String(message).trim(),\n      urgent,\n      timestamp: Date.now(),\n    });\n\n    // Process announcement\n    setTimeout(() => this.processAnnouncements(), 100);\n  }\n\n  processAnnouncements() {\n    if (this.announcements.length === 0 || !this.accessibilityRegion) return;\n\n    const announcement = this.announcements.shift();\n    this.accessibilityRegion.textContent = announcement.message;\n\n    // Clear after announcement\n    setTimeout(() => {\n      if (\n        this.accessibilityRegion &&\n        this.accessibilityRegion.textContent === announcement.message\n      ) {\n        this.accessibilityRegion.textContent = '';\n      }\n    }, ANIMATION_CONSTANTS.CLEANUP_DELAY);\n  }\n\n  // Memory management methods\n  estimateAnimationMemory(animation) {\n    // Rough estimate of animation memory usage\n    const baseSize = 1024; // Base animation object\n    const propertySize =\n      Object.keys(animation.properties).length *\n      ANIMATION_CONSTANTS.PROPERTY_SIZE_MULTIPLIER;\n    return baseSize + propertySize;\n  }\n\n  performMemoryCleanup() {\n    // Remove old completed animations from memory\n    const cutoffTime = Date.now() - ANIMATION_CONSTANTS.HISTORY_CUTOFF_TIME; // 1 minute ago\n\n    this.animations.forEach((animation, id) => {\n      if (animation.completed && animation.createdAt < cutoffTime) {\n        this.animations.delete(id);\n        this.performanceMonitor.releaseMemory(id);\n      }\n    });\n\n    // Clean old timelines\n    this.timelines.forEach((timeline, id) => {\n      if (timeline.completed && timeline.createdAt < cutoffTime) {\n        this.timelines.delete(id);\n      }\n    });\n\n    // Clear render cache\n    if (this.renderCache.size > 100) {\n      this.renderCache.clear();\n    }\n  }\n\n  // Enhanced control methods\n  pauseAllAnimations() {\n    this.activeAnimations.forEach(id => {\n      const animation = this.animations.get(id);\n      if (animation) {\n        animation.paused = true;\n      }\n    });\n\n    if (this.accessibilityConfig.announceAnimations) {\n      this.announce('All animations paused');\n    }\n  }\n\n  resumeAllAnimations() {\n    const now = performance.now();\n    this.activeAnimations.forEach(id => {\n      const animation = this.animations.get(id);\n      if (animation && animation.paused) {\n        animation.paused = false;\n        animation.startTime = now - animation.elapsed;\n      }\n    });\n\n    if (this.accessibilityConfig.announceAnimations) {\n      this.announce('All animations resumed');\n    }\n  }\n\n  // Settings management\n  loadSettings() {\n    try {\n      if (typeof localStorage !== 'undefined') {\n        const settings = JSON.parse(\n          localStorage.getItem('animationSettings') || '{}'\n        );\n        return {\n          announceAnimations: settings.announceAnimations !== false,\n          respectReducedMotion: settings.respectReducedMotion !== false,\n          enableKeyboardControls: settings.enableKeyboardControls !== false,\n          forceAnimations: settings.forceAnimations || false,\n          maxAnimationsPerFrame:\n            settings.maxAnimationsPerFrame ||\n            ANIMATION_CONSTANTS.MAX_ANIMATIONS_PER_FRAME,\n        };\n      }\n    } catch (error) {\n      logger.warn('Failed to load animation settings:', error);\n    }\n\n    return {\n      announceAnimations: true,\n      respectReducedMotion: true,\n      enableKeyboardControls: true,\n      forceAnimations: false,\n      maxAnimationsPerFrame: ANIMATION_CONSTANTS.MAX_ANIMATIONS_PER_FRAME,\n    };\n  }\n\n  saveSettings(settings) {\n    try {\n      if (typeof localStorage !== 'undefined') {\n        const currentSettings = this.loadSettings();\n        const newSettings = { ...currentSettings, ...settings };\n        localStorage.setItem('animationSettings', JSON.stringify(newSettings));\n        this.settings = newSettings;\n      }\n    } catch (error) {\n      logger.warn('Failed to save animation settings:', error);\n    }\n  }\n\n  // Enhanced configuration methods\n  setReducedMotionMode(enabled) {\n    this.reducedMotionMode = enabled;\n    this.settings.respectReducedMotion = enabled;\n    this.updateAnimationDefaults();\n    this.saveSettings({ respectReducedMotion: enabled });\n\n    if (enabled) {\n      // Convert existing animations to reduced motion\n      this.activeAnimations.forEach(id => {\n        const animation = this.animations.get(id);\n        if (animation && !animation.completed) {\n          animation.duration = Math.min(\n            animation.duration,\n            ANIMATION_CONSTANTS.REDUCED_MOTION_DURATION\n          );\n          animation.easing = 'linear';\n        }\n      });\n    }\n\n    this.announce(`Reduced motion mode ${enabled ? 'enabled' : 'disabled'}`);\n  }\n\n  setAccessibilityAnnouncements(enabled) {\n    this.accessibilityConfig.announceAnimations = enabled;\n    this.saveSettings({ announceAnimations: enabled });\n    this.announce(\n      `Animation announcements ${enabled ? 'enabled' : 'disabled'}`\n    );\n  }\n\n  updateProperties(animation, progress) {\n    Object.keys(animation.properties).forEach(key => {\n      const prop = animation.properties[key];\n\n      if (prop.type === 'number') {\n        animation.target[key] = prop.start + (prop.end - prop.start) * progress;\n      } else if (prop.type === 'color') {\n        animation.target[key] = this.interpolateColor(\n          prop.start,\n          prop.end,\n          progress\n        );\n      } else if (prop.type === 'transform') {\n        animation.target[key] = this.interpolateTransform(\n          prop.start,\n          prop.end,\n          progress\n        );\n      }\n    });\n  }\n\n  processProperties(target, properties) {\n    const processed = {};\n\n    Object.keys(properties).forEach(key => {\n      const endValue = properties[key];\n      const startValue = target[key] || 0;\n\n      if (typeof endValue === 'number') {\n        processed[key] = {\n          type: 'number',\n          start: startValue,\n          end: endValue,\n        };\n      } else if (this.isColor(endValue)) {\n        processed[key] = {\n          type: 'color',\n          start: this.parseColor(startValue),\n          end: this.parseColor(endValue),\n        };\n      } else if (\n        typeof endValue === 'string' &&\n        endValue.includes('transform')\n      ) {\n        processed[key] = {\n          type: 'transform',\n          start: startValue,\n          end: endValue,\n        };\n      } else {\n        // Fallback to number\n        processed[key] = {\n          type: 'number',\n          start: parseFloat(startValue) || 0,\n          end: parseFloat(endValue) || 0,\n        };\n      }\n    });\n\n    return processed;\n  }\n\n  // Easing functions\n  applyEasing(progress, easingName) {\n    const easings = {\n      linear: t => t,\n      easeIn: t => t * t,\n      easeOut: t => t * (2 - t),\n      easeInOut: t =>\n        t < COMMON.HALF\n          ? COMMON.TWO * t * t\n          : -1 + (COMMON.FOUR - COMMON.TWO * t) * t,\n      easeInCubic: t => t * t * t,\n      easeOutCubic: t => --t * t * t + 1,\n      easeInOutCubic: t =>\n        t < COMMON.HALF\n          ? COMMON.FOUR * t * t * t\n          : (t - 1) *\n              (COMMON.TWO * t - COMMON.TWO) *\n              (COMMON.TWO * t - COMMON.TWO) +\n            1,\n      easeInQuart: t => t * t * t * t,\n      easeOutQuart: t => 1 - --t * t * t * t,\n      easeInOutQuart: t =>\n        t < COMMON.HALF\n          ? COMMON.EIGHT * t * t * t * t\n          : 1 - COMMON.EIGHT * --t * t * t * t,\n      easeInSine: t => 1 - Math.cos((t * Math.PI) / 2),\n      easeOutSine: t => Math.sin((t * Math.PI) / 2),\n      easeInOutSine: t => -(Math.cos(Math.PI * t) - 1) / 2,\n      bounce: t => {\n        if (t < 1 / EASING.BOUNCE_C4) return EASING.BOUNCE_C5 * t * t;\n        if (t < COMMON.TWO / EASING.BOUNCE_C4)\n          return (\n            EASING.BOUNCE_C5 *\n              (t -= COMMON.ONE_AND_HALF / EASING.BOUNCE_C4) *\n              t +\n            COMMON.THREE_QUARTERS\n          );\n        if (t < COMMON.TWO_AND_HALF / EASING.BOUNCE_C4)\n          return (\n            EASING.BOUNCE_C5 *\n              (t -= COMMON.TWO_AND_QUARTER / EASING.BOUNCE_C4) *\n              t +\n            COMMON.FIFTEEN_SIXTEENTHS\n          );\n        return (\n          EASING.BOUNCE_C5 *\n            (t -= COMMON.TWO_AND_FIVE_EIGHTHS / EASING.BOUNCE_C4) *\n            t +\n          COMMON.SIXTYTHREE_SIXTYFOURTHS\n        );\n      },\n      elastic: t => {\n        if (t === 0) return 0;\n        if (t === 1) return 1;\n        return (\n          Math.pow(COMMON.TWO, -COMMON.TEN * t) *\n            Math.sin(\n              ((t - COMMON.ONE_TENTH) * (COMMON.TWO * Math.PI)) /\n                COMMON.OPACITY_40\n            ) +\n          1\n        );\n      },\n    };\n\n    const easingFunc = easings[easingName] || easings.linear;\n    return easingFunc(progress);\n  }\n\n  // Color interpolation\n  isColor(value) {\n    return (\n      typeof value === 'string' &&\n      (value.startsWith('#') ||\n        value.startsWith('rgb') ||\n        value.startsWith('hsl'))\n    );\n  }\n\n  parseColor(color) {\n    if (typeof color !== 'string') return { r: 0, g: 0, b: 0, a: 1 };\n\n    // Simple hex color parsing\n    if (color.startsWith('#')) {\n      const hex = color.slice(1);\n      if (hex.length === ANIMATION_CONSTANTS.HEX_SHORT_LENGTH) {\n        return {\n          r: parseInt(hex[0] + hex[0], 16),\n          g: parseInt(hex[1] + hex[1], 16),\n          b: parseInt(hex[2] + hex[2], 16),\n          a: 1,\n        };\n      } else if (hex.length === ANIMATION_CONSTANTS.HEX_LONG_LENGTH) {\n        return {\n          r: parseInt(hex.slice(0, 2), 16),\n          g: parseInt(\n            hex.slice(2, ANIMATION_CONSTANTS.HEX_SLICE_END_SHORT),\n            16\n          ),\n          b: parseInt(\n            hex.slice(\n              ANIMATION_CONSTANTS.HEX_SLICE_END_SHORT,\n              ANIMATION_CONSTANTS.HEX_LONG_LENGTH\n            ),\n            16\n          ),\n          a: 1,\n        };\n      }\n    }\n\n    // RGB parsing would go here\n    return { r: 0, g: 0, b: 0, a: 1 };\n  }\n\n  interpolateColor(start, end, progress) {\n    const r = Math.round(start.r + (end.r - start.r) * progress);\n    const g = Math.round(start.g + (end.g - start.g) * progress);\n    const b = Math.round(start.b + (end.b - start.b) * progress);\n    const a = start.a + (end.a - start.a) * progress;\n\n    return `rgba(${r}, ${g}, ${b}, ${a})`;\n  }\n\n  interpolateTransform(start, end, progress) {\n    // Basic transform interpolation\n    // In a real implementation, this would parse and interpolate transform strings\n    return progress < ANIMATION_CONSTANTS.TRANSITION_MIDPOINT ? start : end;\n  }\n\n  // Utility methods\n  cleanupCompleted() {\n    const toDelete = [];\n\n    this.animations.forEach((animation, id) => {\n      if (animation.completed) {\n        toDelete.push(id);\n      }\n    });\n\n    toDelete.forEach(id => {\n      this.animations.delete(id);\n      this.activeAnimations.delete(id);\n    });\n\n    // Clean up completed timelines\n    const timelinesToDelete = [];\n    this.timelines.forEach((timeline, id) => {\n      if (timeline.completed) {\n        timelinesToDelete.push(id);\n      }\n    });\n\n    timelinesToDelete.forEach(id => {\n      this.timelines.delete(id);\n    });\n  }\n\n  getActiveAnimationCount() {\n    return this.activeAnimations.size;\n  }\n\n  getActiveTimelineCount() {\n    return Array.from(this.timelines.values()).filter(\n      t => t.started && !t.completed\n    ).length;\n  } // Enhanced preset animations with accessibility\n  fadeIn(target, duration = null, options = {}) {\n    const actualDuration = duration || this.defaultDuration;\n    target.opacity = target.opacity || 0;\n\n    return this.to(target, { opacity: 1 }, actualDuration, {\n      ...options,\n      description: options.description || 'Fade in animation',\n      announceComplete: options.announceComplete || false,\n    });\n  }\n\n  fadeOut(target, duration = null, options = {}) {\n    const actualDuration = duration || this.defaultDuration;\n\n    return this.to(target, { opacity: 0 }, actualDuration, {\n      ...options,\n      description: options.description || 'Fade out animation',\n      announceComplete: options.announceComplete || false,\n    });\n  }\n\n  slideIn(\n    target,\n    direction = 'left',\n    distance = 100,\n    duration = null,\n    options = {}\n  ) {\n    const actualDuration = duration || this.defaultDuration;\n    const startPos =\n      direction === 'left'\n        ? -distance\n        : direction === 'right'\n          ? distance\n          : direction === 'up'\n            ? -distance\n            : distance;\n\n    const property = direction === 'left' || direction === 'right' ? 'x' : 'y';\n    const endPos = target[property] || 0;\n\n    target[property] = startPos;\n\n    return this.to(target, { [property]: endPos }, actualDuration, {\n      ...options,\n      description: options.description || `Slide in from ${direction}`,\n      easing: options.easing || 'easeOutCubic',\n    });\n  }\n\n  scale(target, scale = 1.2, duration = null, options = {}) {\n    const actualDuration =\n      duration ||\n      this.defaultDuration * ANIMATION_CONSTANTS.SCALE_DURATION_MULTIPLIER; // Slightly faster for scale\n    const originalScale = target.scale || 1;\n\n    return this.to(target, { scale }, actualDuration, {\n      ...options,\n      yoyo: true,\n      description: options.description || 'Scale animation',\n      onComplete: () => {\n        target.scale = originalScale;\n        if (options.onComplete) options.onComplete();\n      },\n    });\n  }\n\n  shake(target, intensity = 5, duration = null, options = {}) {\n    const actualDuration = duration || this.defaultDuration;\n    const originalX = target.x || 0;\n    const shakeCount = this.reducedMotionMode\n      ? ANIMATION_CONSTANTS.REDUCED_SHAKE_COUNT\n      : ANIMATION_CONSTANTS.NORMAL_SHAKE_COUNT; // Fewer shakes for reduced motion\n    const shakeDistance = this.reducedMotionMode\n      ? Math.min(intensity, 2)\n      : intensity;\n\n    const timeline = this.createTimeline({\n      ...options,\n      description: options.description || 'Shake animation',\n    });\n\n    for (let i = 0; i < shakeCount; i++) {\n      const direction = i % 2 === 0 ? 1 : -1;\n      const x = originalX + direction * shakeDistance;\n\n      this.addToTimeline(\n        timeline,\n        target,\n        { x },\n        actualDuration / shakeCount,\n        i * (actualDuration / shakeCount)\n      );\n    }\n\n    // Return to original position\n    this.addToTimeline(\n      timeline,\n      target,\n      { x: originalX },\n      actualDuration / shakeCount,\n      actualDuration - actualDuration / shakeCount\n    );\n\n    this.playTimeline(timeline);\n    return timeline;\n  }\n\n  // New accessibility-focused animations\n  focusHighlight(target, duration = null, options = {}) {\n    const actualDuration =\n      duration ||\n      this.defaultDuration * ANIMATION_CONSTANTS.FADE_DURATION_MULTIPLIER;\n\n    if (this.theme.highContrast) {\n      // High contrast focus animation\n      return this.to(\n        target,\n        {\n          borderWidth: 3,\n          borderColor: '#ffff00',\n        },\n        actualDuration,\n        {\n          ...options,\n          description: 'Focus highlight animation',\n          yoyo: true,\n        }\n      );\n    } else {\n      // Standard focus animation\n      return this.to(\n        target,\n        {\n          scale: 1.05,\n          boxShadow: '0 0 10px rgba(0, 123, 255, 0.5)',\n        },\n        actualDuration,\n        {\n          ...options,\n          description: 'Focus highlight animation',\n          yoyo: true,\n          easing: 'easeInOut',\n        }\n      );\n    }\n  }\n\n  slideReveal(target, direction = 'down', duration = null, options = {}) {\n    const actualDuration = duration || this.defaultDuration;\n    const property =\n      direction === 'down' || direction === 'up' ? 'height' : 'width';\n    const from = 0;\n    const to =\n      target[\n        `original${property.charAt(0).toUpperCase() + property.slice(1)}`\n      ] ||\n      target[property] ||\n      100;\n\n    target[property] = from;\n    target.overflow = 'hidden';\n\n    return this.to(target, { [property]: to }, actualDuration, {\n      ...options,\n      description: options.description || `Slide reveal ${direction}`,\n      easing: 'easeOutCubic',\n      onComplete: () => {\n        target.overflow = 'visible';\n        if (options.onComplete) options.onComplete();\n      },\n    });\n  }\n\n  // Touch/gesture animation support\n  createGestureAnimation(target, gestureType, options = {}) {\n    const gestureAnimations = {\n      swipeLeft: () =>\n        this.slideIn(\n          target,\n          'left',\n          ANIMATION_CONSTANTS.SWIPE_DISTANCE,\n          null,\n          options\n        ),\n      swipeRight: () =>\n        this.slideIn(\n          target,\n          'right',\n          ANIMATION_CONSTANTS.SWIPE_DISTANCE,\n          null,\n          options\n        ),\n      swipeUp: () =>\n        this.slideIn(\n          target,\n          'up',\n          ANIMATION_CONSTANTS.SWIPE_DISTANCE,\n          null,\n          options\n        ),\n      swipeDown: () =>\n        this.slideIn(\n          target,\n          'down',\n          ANIMATION_CONSTANTS.SWIPE_DISTANCE,\n          null,\n          options\n        ),\n      pinchIn: () =>\n        this.scale(target, ANIMATION_CONSTANTS.PINCH_IN_SCALE, null, options),\n      pinchOut: () =>\n        this.scale(target, ANIMATION_CONSTANTS.PINCH_OUT_SCALE, null, options),\n      tap: () => this.focusHighlight(target, null, options),\n    };\n\n    const animationFunc = gestureAnimations[gestureType];\n    if (animationFunc) {\n      const animationId = animationFunc();\n      this.gestureAnimations.set(target, animationId);\n      return animationId;\n    }\n\n    return null;\n  }\n\n  // Enhanced accessibility reporting\n  getAccessibilityReport() {\n    return {\n      isEnabled: this.accessibilityEnabled,\n      reducedMotionMode: this.reducedMotionMode,\n      theme: this.theme,\n      activeAnimations: this.activeAnimations.size,\n      announcements: this.accessibilityConfig.announceAnimations,\n      settings: this.settings,\n      performance: this.performanceMonitor.getMetrics(),\n      errors: this.errorCount,\n      lastError: this.lastError,\n    };\n  }\n\n  // Performance and diagnostic methods\n  getPerformanceReport() {\n    const metrics = this.performanceMonitor.getMetrics();\n    const activeCount = this.activeAnimations.size;\n    const timelineCount = this.getActiveTimelineCount();\n\n    return {\n      activeAnimations: activeCount,\n      activeTimelines: timelineCount,\n      framePerformance: {\n        averageFrameTime:\n          metrics.operations['animation-update']?.averageDuration || 0,\n        lastFrameTime:\n          metrics.operations['animation-update']?.lastDuration || 0,\n        frameTimeLimit: this.frameTimeLimit,\n        maxAnimationsPerFrame: this.maxAnimationsPerFrame,\n      },\n      memory: metrics.memory,\n      errors: this.errorCount,\n      reducedMotionMode: this.reducedMotionMode,\n      theme: this.theme.theme,\n    };\n  } // Enhanced cleanup with comprehensive resource management\n  destroy() {\n    const startTime =\n      this.performanceMonitor.startOperation('animation-cleanup');\n\n    try {\n      // Stop all animations gracefully\n      this.stopAll();\n\n      // Clean up event listeners\n      this.removeEventListeners();\n\n      // Clean up accessibility resources\n      this.cleanupAccessibilityFeatures();\n\n      // Clear memory tracking\n      this.performanceMonitor.memoryTracker.clear();\n\n      // Clear intervals\n      if (this.memoryCleanupInterval) {\n        clearInterval(this.memoryCleanupInterval);\n        this.memoryCleanupInterval = null;\n      }\n\n      // Clear data structures\n      this.animations.clear();\n      this.timelines.clear();\n      this.activeAnimations.clear();\n      this.gestureAnimations.clear();\n      this.renderCache.clear();\n      this.announcements = [];\n\n      // Save final settings\n      this.saveSettings(this.settings);\n\n      logger.info('Enhanced AnimationManager destroyed successfully');\n    } catch (error) {\n      logger.error('Error during AnimationManager cleanup:', error);\n    } finally {\n      this.performanceMonitor.endOperation('animation-cleanup', startTime);\n    }\n  }\n\n  removeEventListeners() {\n    try {\n      if (this.themeListeners) {\n        const { reducedMotionQuery, contrastQuery, updateTheme } =\n          this.themeListeners;\n\n        if (reducedMotionQuery.removeEventListener) {\n          reducedMotionQuery.removeEventListener('change', updateTheme);\n          contrastQuery.removeEventListener('change', updateTheme);\n        }\n      }\n\n      // Remove document event listeners\n      if (typeof document !== 'undefined') {\n        document.removeEventListener(\n          'visibilitychange',\n          this.handleVisibilityChange\n        );\n      }\n    } catch (error) {\n      logger.warn('Event listener cleanup failed:', error);\n    }\n  }\n\n  cleanupAccessibilityFeatures() {\n    try {\n      // Remove accessibility region\n      if (this.accessibilityRegion && this.accessibilityRegion.parentNode) {\n        this.accessibilityRegion.parentNode.removeChild(\n          this.accessibilityRegion\n        );\n      }\n    } catch (error) {\n      logger.warn('Accessibility cleanup failed:', error);\n    }\n  }\n}\n\n// Static utility methods for global animation operations\nAnimationManager.createGlobalStyles = function () {\n  if (\n    typeof document === 'undefined' ||\n    document.getElementById('animation-manager-styles')\n  )\n    return;\n\n  const styleSheet = document.createElement('style');\n  styleSheet.id = 'animation-manager-styles';\n  styleSheet.textContent = `\n        /* Global animation styles with accessibility support */\n        @media (prefers-reduced-motion: reduce) {\n            *,\n            *::before,\n            *::after {\n                animation-duration: 0.01ms !important;\n                animation-iteration-count: 1 !important;\n                transition-duration: 0.01ms !important;\n            }\n            \n            .animation-enabled {\n                animation: none !important;\n                transition: none !important;\n            }\n        }\n        \n        .sr-only {\n            position: absolute !important;\n            width: 1px !important;\n            height: 1px !important;\n            padding: 0 !important;\n            margin: -1px !important;\n            overflow: hidden !important;\n            clip: rect(0, 0, 0, 0) !important;\n            white-space: nowrap !important;\n            border: 0 !important;\n        }\n        \n        .animation-focus-highlight {\n            outline: 2px solid #007bff !important;\n            outline-offset: 2px !important;\n        }\n        \n        @media (prefers-contrast: high) {\n            .animation-focus-highlight {\n                outline: 3px solid #ffff00 !important;\n                outline-offset: 2px !important;\n            }\n        }\n        \n        .animation-container {\n            contain: layout style;\n        }\n        \n        .animation-target {\n            will-change: auto;\n        }\n        \n        .animation-target.animating {\n            will-change: transform, opacity, background-color;\n        }\n    `;\n\n  document.head.appendChild(styleSheet);\n};\n\nAnimationManager.detectAnimationSupport = function () {\n  if (typeof window === 'undefined') return false;\n\n  const testElement = document.createElement('div');\n  const animationProps = [\n    'animation',\n    'webkitAnimation',\n    'mozAnimation',\n    'oAnimation',\n    'msAnimation',\n  ];\n\n  return animationProps.some(prop => prop in testElement.style);\n};\n\nAnimationManager.getSystemAnimationPreferences = function () {\n  if (typeof window === 'undefined') return {};\n\n  return {\n    reducedMotion:\n      window.matchMedia?.('(prefers-reduced-motion: reduce)').matches || false,\n    highContrast:\n      window.matchMedia?.('(prefers-contrast: high)').matches || false,\n    animationSupport: this.detectAnimationSupport(),\n  };\n};\n\n// Initialize global styles when module loads\nif (typeof document !== 'undefined') {\n  if (document.readyState === 'loading') {\n    document.addEventListener(\n      'DOMContentLoaded',\n      AnimationManager.createGlobalStyles\n    );\n  } else {\n    AnimationManager.createGlobalStyles();\n  }\n}\n\nexport default AnimationManager;\n","/**\n * Scene - Container and manager for all visual objects in the simulation\n * Handles object hierarchy, updates, and spatial queries\n */\n\n// Animation easing constants\nconst EASING_CONSTANTS = {\n  // General easing constants\n  HALF: 0.5,\n  TWO: 2,\n\n  // Bounce easing constants\n  BOUNCE_DIVISOR: 2.75,\n  BOUNCE_MULTIPLIER: 7.5625,\n  BOUNCE_THRESHOLD_1: 1,\n  BOUNCE_THRESHOLD_2: 2,\n  BOUNCE_THRESHOLD_3: 2.5,\n  BOUNCE_OFFSET_1: 1.5,\n  BOUNCE_OFFSET_2: 2.25,\n  BOUNCE_OFFSET_3: 2.625,\n  BOUNCE_VALUE_1: 0.75,\n  BOUNCE_VALUE_2: 0.9375,\n  BOUNCE_VALUE_3: 0.984375,\n};\n\nexport class Scene {\n  constructor() {\n    this.objects = [];\n    this.interactiveObjects = [];\n    this.layers = new Map(); // For z-index management\n    this.background = null;\n    this.camera = null;\n\n    // Spatial optimization (for future implementation)\n    this.spatialGrid = null;\n    this.needsSpatialUpdate = false;\n\n    // Object pools for performance\n    this.objectPools = new Map();\n  }\n\n  add(object) {\n    if (!object) return;\n\n    // Set scene reference\n    object.scene = this;\n\n    // Add to main objects array\n    this.objects.push(object);\n\n    // Add to interactive objects if applicable\n    if (object.isInteractive) {\n      this.interactiveObjects.push(object);\n    }\n\n    // Handle layering\n    if (object.layer !== undefined) {\n      this.addToLayer(object, object.layer);\n    }\n\n    // Mark for spatial update\n    this.needsSpatialUpdate = true;\n\n    // Call object's onAdded callback if it exists\n    if (object.onAdded) {\n      object.onAdded(this);\n    }\n  }\n\n  remove(object) {\n    if (!object) return;\n\n    // Remove from main objects array\n    const index = this.objects.indexOf(object);\n    if (index > -1) {\n      this.objects.splice(index, 1);\n    }\n\n    // Remove from interactive objects\n    const interactiveIndex = this.interactiveObjects.indexOf(object);\n    if (interactiveIndex > -1) {\n      this.interactiveObjects.splice(interactiveIndex, 1);\n    }\n\n    // Remove from layers\n    if (object.layer !== undefined) {\n      this.removeFromLayer(object, object.layer);\n    }\n\n    // Clear scene reference\n    object.scene = null;\n\n    // Mark for spatial update\n    this.needsSpatialUpdate = true;\n\n    // Call object's onRemoved callback if it exists\n    if (object.onRemoved) {\n      object.onRemoved();\n    }\n  }\n\n  addToLayer(object, layerIndex) {\n    if (!this.layers.has(layerIndex)) {\n      this.layers.set(layerIndex, []);\n    }\n\n    const layer = this.layers.get(layerIndex);\n    if (!layer.includes(object)) {\n      layer.push(object);\n\n      // Sort layer by z-index if objects have it\n      layer.sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n    }\n  }\n\n  removeFromLayer(object, layerIndex) {\n    if (this.layers.has(layerIndex)) {\n      const layer = this.layers.get(layerIndex);\n      const index = layer.indexOf(object);\n      if (index > -1) {\n        layer.splice(index, 1);\n      }\n    }\n  }\n\n  clear() {\n    // Call onRemoved for all objects\n    this.objects.forEach(object => {\n      if (object.onRemoved) {\n        object.onRemoved();\n      }\n      object.scene = null;\n    });\n\n    this.objects = [];\n    this.interactiveObjects = [];\n    this.layers.clear();\n    this.background = null;\n    this.needsSpatialUpdate = true;\n  }\n\n  update(deltaTime) {\n    // Update all objects\n    for (let i = this.objects.length - 1; i >= 0; i--) {\n      const object = this.objects[i];\n\n      if (object.update) {\n        object.update(deltaTime);\n      }\n\n      // Remove objects marked for deletion\n      if (object.markedForDeletion) {\n        this.remove(object);\n      }\n    }\n\n    // Update spatial grid if needed\n    if (this.needsSpatialUpdate && this.spatialGrid) {\n      this.updateSpatialGrid();\n      this.needsSpatialUpdate = false;\n    }\n  }\n\n  render(renderer) {\n    // Render background first\n    if (this.background) {\n      renderer.renderObject(this.background);\n    }\n\n    // Render objects by layers (if using layers) or by z-index\n    if (this.layers.size > 0) {\n      this.renderByLayers(renderer);\n    } else {\n      this.renderByZIndex(renderer);\n    }\n  }\n\n  renderByLayers(renderer) {\n    // Get sorted layer indices\n    const layerIndices = Array.from(this.layers.keys()).sort((a, b) => a - b);\n\n    layerIndices.forEach(layerIndex => {\n      const layer = this.layers.get(layerIndex);\n      layer.forEach(object => {\n        if (object.visible !== false) {\n          renderer.renderObject(object);\n        }\n      });\n    });\n\n    // Render objects not in any layer\n    this.objects.forEach(object => {\n      if (object.layer === undefined && object.visible !== false) {\n        renderer.renderObject(object);\n      }\n    });\n  }\n\n  renderByZIndex(renderer) {\n    // Create sorted copy of objects by z-index\n    const sortedObjects = [...this.objects].sort(\n      (a, b) => (a.zIndex || 0) - (b.zIndex || 0)\n    );\n\n    sortedObjects.forEach(object => {\n      if (object.visible !== false) {\n        renderer.renderObject(object);\n      }\n    });\n  }\n\n  // Spatial queries\n  getObjectsAt(x, y) {\n    const results = [];\n\n    // Check interactive objects first (reverse order for top-to-bottom hit testing)\n    for (let i = this.interactiveObjects.length - 1; i >= 0; i--) {\n      const object = this.interactiveObjects[i];\n\n      if (\n        object.visible !== false &&\n        object.containsPoint &&\n        object.containsPoint(x, y)\n      ) {\n        results.push(object);\n      }\n    }\n\n    return results;\n  }\n\n  getObjectsInArea(x, y, width, height) {\n    const results = [];\n    const area = { x, y, width, height };\n\n    this.objects.forEach(object => {\n      if (object.visible !== false && object.getBounds) {\n        const bounds = object.getBounds();\n        if (this.rectanglesIntersect(area, bounds)) {\n          results.push(object);\n        }\n      }\n    });\n\n    return results;\n  }\n\n  getObjectsByType(type) {\n    return this.objects.filter(object => object.type === type);\n  }\n\n  getObjectsByTag(tag) {\n    return this.objects.filter(\n      object => object.tags && object.tags.includes(tag)\n    );\n  }\n\n  findObject(predicate) {\n    return this.objects.find(predicate);\n  }\n\n  findObjects(predicate) {\n    return this.objects.filter(predicate);\n  }\n\n  // Hit testing with detailed information\n  hitTest(x, y, options = {}) {\n    const {\n      includeNonInteractive = false,\n      layer = null,\n      type = null,\n    } = options;\n\n    let objectsToTest = includeNonInteractive\n      ? this.objects\n      : this.interactiveObjects;\n\n    // Filter by layer if specified\n    if (layer !== null) {\n      objectsToTest = objectsToTest.filter(obj => obj.layer === layer);\n    }\n\n    // Filter by type if specified\n    if (type !== null) {\n      objectsToTest = objectsToTest.filter(obj => obj.type === type);\n    }\n\n    // Test objects in reverse order (top to bottom)\n    for (let i = objectsToTest.length - 1; i >= 0; i--) {\n      const object = objectsToTest[i];\n\n      if (object.visible !== false && object.containsPoint) {\n        const localPoint = this.worldToLocal(object, x, y);\n        if (object.containsPoint(localPoint.x, localPoint.y)) {\n          return {\n            object,\n            worldPoint: { x, y },\n            localPoint,\n            distance: this.getDistance(x, y, object.x || 0, object.y || 0),\n          };\n        }\n      }\n    }\n\n    return null;\n  }\n\n  // Coordinate transformations\n  worldToLocal(object, worldX, worldY) {\n    // Basic transformation - can be extended for complex transforms\n    return {\n      x: worldX - (object.x || 0),\n      y: worldY - (object.y || 0),\n    };\n  }\n\n  localToWorld(object, localX, localY) {\n    return {\n      x: localX + (object.x || 0),\n      y: localY + (object.y || 0),\n    };\n  }\n\n  // Utility methods\n  rectanglesIntersect(rect1, rect2) {\n    return !(\n      rect2.x > rect1.x + rect1.width ||\n      rect2.x + rect2.width < rect1.x ||\n      rect2.y > rect1.y + rect1.height ||\n      rect2.y + rect2.height < rect1.y\n    );\n  }\n\n  getDistance(x1, y1, x2, y2) {\n    const dx = x2 - x1;\n    const dy = y2 - y1;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  // Event handling\n  handleInput(eventType, eventData) {\n    // Handle input events in reverse order (top-to-bottom hit testing)\n    const objects = [...this.interactiveObjects].reverse();\n\n    for (const object of objects) {\n      if (object.visible === false) continue;\n\n      // Check if object can handle this input type\n      if (object.handleInput && object.handleInput(eventType, eventData)) {\n        // Input was consumed, stop propagation\n        return true;\n      }\n\n      // For mouse/touch events, check if point is within object bounds\n      if (\n        (eventType.includes('mouse') || eventType.includes('touch')) &&\n        eventData.x !== undefined &&\n        eventData.y !== undefined\n      ) {\n        if (\n          object.containsPoint &&\n          object.containsPoint(eventData.x, eventData.y)\n        ) {\n          // Trigger object-specific events\n          if (eventType === 'mousedown' && object.onMouseDown) {\n            object.onMouseDown(eventData);\n            return true;\n          } else if (eventType === 'mouseup' && object.onClick) {\n            object.onClick(eventData);\n            return true;\n          } else if (eventType === 'mousemove' && object.onMouseMove) {\n            object.onMouseMove(eventData);\n            return true;\n          }\n        }\n      }\n    }\n\n    return false; // Input not consumed\n  }\n\n  handleResize() {\n    // Notify all objects of resize\n    this.objects.forEach(object => {\n      if (object.onResize) {\n        object.onResize();\n      }\n    });\n  }\n\n  // Animation and tweening support\n  animateObject(object, properties, duration, options = {}) {\n    if (!object || !properties || duration <= 0) return;\n\n    const {\n      easing = 'easeInOut',\n      onComplete = null,\n      onUpdate = null,\n    } = options;\n\n    const startTime = performance.now();\n    const startValues = {};\n\n    // Store initial values\n    Object.keys(properties).forEach(key => {\n      startValues[key] = object[key] || 0;\n    });\n\n    const animate = currentTime => {\n      const elapsed = currentTime - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n\n      // Apply easing\n      const easedProgress = this.applyEasing(progress, easing);\n\n      // Update object properties\n      Object.keys(properties).forEach(key => {\n        const startValue = startValues[key];\n        const endValue = properties[key];\n        object[key] = startValue + (endValue - startValue) * easedProgress;\n      });\n\n      if (onUpdate) {\n        onUpdate(object, easedProgress);\n      }\n\n      if (progress < 1) {\n        requestAnimationFrame(animate);\n      } else if (onComplete) {\n        onComplete(object);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }\n\n  applyEasing(t, type) {\n    switch (type) {\n      case 'linear':\n        return t;\n      case 'easeIn':\n        return t * t;\n      case 'easeOut':\n        return 1 - (1 - t) * (1 - t);\n      case 'easeInOut':\n        return t < EASING_CONSTANTS.HALF\n          ? EASING_CONSTANTS.TWO * t * t\n          : 1 -\n              Math.pow(\n                -EASING_CONSTANTS.TWO * t + EASING_CONSTANTS.TWO,\n                EASING_CONSTANTS.TWO\n              ) /\n                EASING_CONSTANTS.TWO;\n      case 'bounce':\n        if (\n          t <\n          EASING_CONSTANTS.BOUNCE_THRESHOLD_1 / EASING_CONSTANTS.BOUNCE_DIVISOR\n        ) {\n          return EASING_CONSTANTS.BOUNCE_MULTIPLIER * t * t;\n        } else if (\n          t <\n          EASING_CONSTANTS.BOUNCE_THRESHOLD_2 / EASING_CONSTANTS.BOUNCE_DIVISOR\n        ) {\n          return (\n            EASING_CONSTANTS.BOUNCE_MULTIPLIER *\n              (t -=\n                EASING_CONSTANTS.BOUNCE_OFFSET_1 /\n                EASING_CONSTANTS.BOUNCE_DIVISOR) *\n              t +\n            EASING_CONSTANTS.BOUNCE_VALUE_1\n          );\n        } else if (\n          t <\n          EASING_CONSTANTS.BOUNCE_THRESHOLD_3 / EASING_CONSTANTS.BOUNCE_DIVISOR\n        ) {\n          return (\n            EASING_CONSTANTS.BOUNCE_MULTIPLIER *\n              (t -=\n                EASING_CONSTANTS.BOUNCE_OFFSET_2 /\n                EASING_CONSTANTS.BOUNCE_DIVISOR) *\n              t +\n            EASING_CONSTANTS.BOUNCE_VALUE_2\n          );\n        } else {\n          return (\n            EASING_CONSTANTS.BOUNCE_MULTIPLIER *\n              (t -=\n                EASING_CONSTANTS.BOUNCE_OFFSET_3 /\n                EASING_CONSTANTS.BOUNCE_DIVISOR) *\n              t +\n            EASING_CONSTANTS.BOUNCE_VALUE_3\n          );\n        }\n      default:\n        return t;\n    }\n  }\n\n  // Performance and debugging\n  getStats() {\n    return {\n      totalObjects: this.objects.length,\n      interactiveObjects: this.interactiveObjects.length,\n      layers: this.layers.size,\n      needsSpatialUpdate: this.needsSpatialUpdate,\n    };\n  }\n\n  // Future: Spatial grid implementation for optimization\n  updateSpatialGrid() {\n    // TODO: Implement spatial partitioning for large numbers of objects\n    // This would significantly improve performance for collision detection\n    // and spatial queries in complex simulations\n  }\n}\n\nexport default Scene;\n","/**\n * @fileoverview Advanced Input Manager for SimulateAI Platform\n * Provides comprehensive input handling with accessibility, theme support, and performance monitoring\n * @version 2.0.0\n * @author SimulateAI Development Team\n * @since 2025\n */\n\nimport logger from '../utils/logger.js';\n\n// Configuration Constants\nconst INPUT_CONFIG = {\n  // Performance settings\n  PERFORMANCE_MONITOR_INTERVAL: 1000,\n  MAX_EVENT_HISTORY: 100,\n  THROTTLE_INTERVAL: 16, // ~60fps\n  MAX_LOG_ENTRIES: 50,\n\n  // Gesture thresholds\n  GESTURE_THRESHOLDS: {\n    TAP_TIMEOUT: 300,\n    TAP_MAX_DISTANCE: 10,\n    PAN_MIN_DISTANCE: 10,\n    PINCH_MIN_DISTANCE: 20,\n    LONG_PRESS_DURATION: 500,\n    DOUBLE_TAP_INTERVAL: 300,\n  },\n\n  // Touch settings\n  TOUCH_SETTINGS: {\n    DEFAULT_RADIUS: 20,\n    DEFAULT_FORCE: 1,\n    MAX_TOUCHES: 10,\n    PASSIVE_EVENTS: false,\n  },\n\n  // Keyboard settings\n  KEYBOARD_SETTINGS: {\n    REPEAT_DELAY: 500,\n    REPEAT_RATE: 50,\n    GLOBAL_SHORTCUTS: ['F1', 'F11', 'F12', 'Tab', 'Escape'],\n    ACCESSIBILITY_KEYS: [\n      'Tab',\n      'Enter',\n      'Space',\n      'ArrowUp',\n      'ArrowDown',\n      'ArrowLeft',\n      'ArrowRight',\n    ],\n  },\n\n  // Gamepad settings\n  GAMEPAD_SETTINGS: {\n    POLL_INTERVAL: 16,\n    DEADZONE: 0.1,\n    BUTTON_THRESHOLD: 0.5,\n    VIBRATION_ENABLED: true,\n  },\n\n  // Accessibility settings\n  ACCESSIBILITY: {\n    FOCUS_VISIBLE_OUTLINE: '2px solid #0078d4',\n    HIGH_CONTRAST_SUPPORT: true,\n    REDUCED_MOTION_SUPPORT: true,\n    SCREEN_READER_SUPPORT: true,\n  },\n\n  // Privacy settings\n  PRIVACY: {\n    ANONYMOUS_TRACKING: true,\n    RESPECT_DNT: true,\n    MINIMAL_DATA_COLLECTION: true,\n  },\n};\n\n// Theme Constants\nconst INPUT_THEMES = {\n  light: {\n    focusColor: '#0078d4',\n    hoverColor: '#106ebe',\n    disabledColor: '#8a8886',\n    backgroundColor: '#ffffff',\n    textColor: '#323130',\n  },\n  dark: {\n    focusColor: '#4cc2ff',\n    hoverColor: '#0078d4',\n    disabledColor: '#605e5c',\n    backgroundColor: '#1f1f1f',\n    textColor: '#ffffff',\n  },\n  highContrast: {\n    focusColor: '#ffff00',\n    hoverColor: '#ffffff',\n    disabledColor: '#808080',\n    backgroundColor: '#000000',\n    textColor: '#ffffff',\n  },\n};\n\n// Error Types\nconst INPUT_ERRORS = {\n  INVALID_EVENT: 'INVALID_EVENT',\n  HANDLER_ERROR: 'HANDLER_ERROR',\n  GESTURE_ERROR: 'GESTURE_ERROR',\n  GAMEPAD_ERROR: 'GAMEPAD_ERROR',\n  ACCESSIBILITY_ERROR: 'ACCESSIBILITY_ERROR',\n};\n\n/**\n * Advanced Input Manager with comprehensive event handling, accessibility, and performance monitoring\n * @class InputManager\n */\nexport class InputManager {\n  /**\n   * Creates a new InputManager instance\n   * @param {Object} engine - The engine instance\n   * @param {Object} options - Configuration options\n   */\n  constructor(engine, options = {}) {\n    // Validate required parameters\n    if (!engine) {\n      throw new Error('Engine instance is required for InputManager');\n    }\n\n    this.engine = engine;\n    this.container = engine.container;\n    this.renderer = engine.renderer;\n\n    // Configuration\n    this.config = {\n      ...INPUT_CONFIG,\n      ...options,\n    };\n\n    // Theme management\n    this.currentTheme = options.theme || 'light';\n    this.themeColors = INPUT_THEMES[this.currentTheme];\n\n    // Initialize helper classes\n    this.performanceMonitor = new InputPerformanceMonitor();\n    this.accessibilityManager = new InputAccessibilityManager(this);\n    this.errorHandler = new InputErrorHandler();\n    this.privacyManager = new InputPrivacyManager(this.config.PRIVACY);\n    this.inputValidator = new InputValidator();\n\n    // Event throttling\n    this.throttleTimers = new Map();\n    this.eventHistory = [];\n\n    // Enhanced input state tracking\n    this.mouse = {\n      x: 0,\n      y: 0,\n      down: false,\n      button: -1,\n      wheel: 0,\n      velocity: { x: 0, y: 0 },\n      lastUpdate: performance.now(),\n      buttons: new Set(),\n      hoveredElements: new Set(),\n    };\n\n    this.keyboard = {\n      keys: new Set(),\n      modifiers: {\n        shift: false,\n        ctrl: false,\n        alt: false,\n        meta: false,\n      },\n      composition: false,\n      lastKeyTime: 0,\n      repeatKeys: new Map(),\n    };\n\n    this.touch = {\n      touches: new Map(),\n      maxTouches: 0,\n      gestures: {\n        pinch: {\n          active: false,\n          scale: 1,\n          startDistance: 0,\n          center: { x: 0, y: 0 },\n        },\n        pan: { active: false, deltaX: 0, deltaY: 0, velocity: { x: 0, y: 0 } },\n        tap: { active: false, startTime: 0, count: 0, lastTapTime: 0 },\n        longPress: { active: false, startTime: 0, triggered: false },\n        rotate: { active: false, angle: 0, startAngle: 0 },\n      },\n      history: [],\n    };\n\n    // Gamepad support\n    this.gamepad = {\n      controllers: new Map(),\n      pollInterval: null,\n      deadzone: this.config.GAMEPAD_SETTINGS.DEADZONE,\n      buttonStates: new Map(),\n      axisStates: new Map(),\n    };\n\n    // Event callbacks with priority system\n    this.eventHandlers = new Map();\n    this.eventPriorities = new Map();\n\n    // Enhanced gesture settings\n    this.gestureThreshold = {\n      ...this.config.GESTURE_THRESHOLDS,\n    };\n\n    // Initialize subsystems\n    this.init();\n  }\n\n  /**\n   * Initialize the input manager and all subsystems\n   */\n  init() {\n    try {\n      this.setupMouseEvents();\n      this.setupKeyboardEvents();\n      this.setupTouchEvents();\n      this.setupWheelEvents();\n      this.setupGamepadEvents();\n      this.setupAccessibilityFeatures();\n      this.startPerformanceMonitoring();\n\n      // Apply theme\n      this.applyTheme(this.currentTheme);\n\n      // Set up privacy compliance\n      this.privacyManager.initialize();\n\n      this.log('InputManager initialized successfully', 'info');\n    } catch (error) {\n      this.errorHandler.handleError(error, 'INITIALIZATION_ERROR');\n      throw error;\n    }\n  }\n\n  /**\n   * Apply theme to input elements\n   * @param {string} themeName - Theme name (light, dark, highContrast)\n   */\n  applyTheme(themeName) {\n    if (!INPUT_THEMES[themeName]) {\n      this.log(`Unknown theme: ${themeName}`, 'warn');\n      return;\n    }\n\n    this.currentTheme = themeName;\n    this.themeColors = INPUT_THEMES[themeName];\n\n    // Apply theme-specific styles\n    const element = this.renderer.getElement();\n    if (element) {\n      element.style.setProperty(\n        '--input-focus-color',\n        this.themeColors.focusColor\n      );\n      element.style.setProperty(\n        '--input-hover-color',\n        this.themeColors.hoverColor\n      );\n    }\n\n    this.emit('themeChanged', { theme: themeName, colors: this.themeColors });\n  }\n\n  /**\n   * Enhanced logging with context and performance\n   * @param {string} message - Log message\n   * @param {string} level - Log level\n   * @param {Object} context - Additional context\n   */\n  log(message, level = 'info', context = {}) {\n    if (!this.privacyManager.shouldLog()) return;\n\n    const timestamp = new Date().toISOString();\n    const logEntry = {\n      timestamp,\n      level,\n      message,\n      context,\n      component: 'InputManager',\n    };\n\n    switch (level) {\n      case 'error':\n        logger.error(`[InputManager Error] ${message}`, context);\n        break;\n      case 'warn':\n        logger.warn(`[InputManager Warning] ${message}`, context);\n        break;\n      case 'debug':\n        logger.debug(`[InputManager Debug] ${message}`, context);\n        break;\n      default:\n        logger.info(`[InputManager] ${message}`, context);\n    }\n\n    this.performanceMonitor.logEvent(logEntry);\n  }\n\n  /**\n   * Throttle function for performance optimization\n   * @param {Function} func - Function to throttle\n   * @param {number} delay - Throttle delay in ms\n   * @returns {Function} Throttled function\n   */\n  throttle(func, delay) {\n    let timeoutId;\n    let lastExecTime = 0;\n\n    return (...args) => {\n      const currentTime = performance.now();\n\n      if (currentTime - lastExecTime > delay) {\n        func.apply(this, args);\n        lastExecTime = currentTime;\n      } else {\n        clearTimeout(timeoutId);\n        timeoutId = setTimeout(\n          () => {\n            func.apply(this, args);\n            lastExecTime = performance.now();\n          },\n          delay - (currentTime - lastExecTime)\n        );\n      }\n    };\n  }\n\n  /**\n   * Setup enhanced mouse events\n   */\n  setupMouseEvents() {\n    const element = this.renderer.getElement();\n    const options = { passive: false, capture: false };\n\n    // Bind methods to preserve context\n    this.boundMouseHandlers = {\n      mousedown: this.handleMouseDown.bind(this),\n      mousemove: this.throttle(\n        this.handleMouseMove.bind(this),\n        this.config.THROTTLE_INTERVAL\n      ),\n      mouseup: this.handleMouseUp.bind(this),\n      mouseenter: this.handleMouseEnter.bind(this),\n      mouseleave: this.handleMouseLeave.bind(this),\n      contextmenu: this.handleContextMenu.bind(this),\n    };\n\n    // Add event listeners\n    Object.entries(this.boundMouseHandlers).forEach(([event, handler]) => {\n      element.addEventListener(event, handler, options);\n    });\n  }\n\n  /**\n   * Setup enhanced keyboard events\n   */\n  setupKeyboardEvents() {\n    const options = { passive: false, capture: true };\n\n    // Bind handlers\n    this.boundKeyboardHandlers = {\n      keydown: this.handleKeyDown.bind(this),\n      keyup: this.handleKeyUp.bind(this),\n    };\n\n    // Use document for keyboard events to capture global shortcuts\n    Object.entries(this.boundKeyboardHandlers).forEach(([event, handler]) => {\n      document.addEventListener(event, handler, options);\n    });\n  }\n\n  /**\n   * Setup enhanced touch events\n   */\n  setupTouchEvents() {\n    const element = this.renderer.getElement();\n    const options = {\n      passive: this.config.TOUCH_SETTINGS.PASSIVE_EVENTS,\n      capture: false,\n    };\n\n    // Bind handlers\n    this.boundTouchHandlers = {\n      touchstart: this.handleTouchStart.bind(this),\n      touchmove: this.throttle(\n        this.handleTouchMove.bind(this),\n        this.config.THROTTLE_INTERVAL\n      ),\n      touchend: this.handleTouchEnd.bind(this),\n      touchcancel: this.handleTouchCancel.bind(this),\n    };\n\n    Object.entries(this.boundTouchHandlers).forEach(([event, handler]) => {\n      element.addEventListener(event, handler, options);\n    });\n  }\n\n  /**\n   * Setup enhanced wheel events\n   */\n  setupWheelEvents() {\n    const element = this.renderer.getElement();\n    const options = { passive: false, capture: false };\n\n    this.boundWheelHandler = this.throttle(\n      this.handleWheel.bind(this),\n      this.config.THROTTLE_INTERVAL\n    );\n    element.addEventListener('wheel', this.boundWheelHandler, options);\n  }\n\n  /**\n   * Setup gamepad events\n   */\n  setupGamepadEvents() {\n    window.addEventListener(\n      'gamepadconnected',\n      this.handleGamepadConnected.bind(this)\n    );\n    window.addEventListener(\n      'gamepaddisconnected',\n      this.handleGamepadDisconnected.bind(this)\n    );\n\n    // Start gamepad polling\n    this.startGamepadPolling();\n  }\n\n  /**\n   * Setup accessibility features\n   */\n  setupAccessibilityFeatures() {\n    this.accessibilityManager.initialize();\n    this.setupFocusManagement();\n    this.setupAriaSupport();\n  }\n\n  /**\n   * Start performance monitoring\n   */\n  startPerformanceMonitoring() {\n    this.performanceMonitor.start(this.config.PERFORMANCE_MONITOR_INTERVAL);\n  }\n\n  /**\n   * Setup focus management for accessibility\n   */\n  setupFocusManagement() {\n    const element = this.renderer.getElement();\n\n    // Make element focusable\n    if (!element.hasAttribute('tabindex')) {\n      element.setAttribute('tabindex', '0');\n    }\n\n    // Add focus/blur handlers\n    element.addEventListener('focus', this.handleFocus.bind(this));\n    element.addEventListener('blur', this.handleBlur.bind(this));\n  }\n\n  /**\n   * Setup ARIA support for screen readers\n   */\n  setupAriaSupport() {\n    const element = this.renderer.getElement();\n\n    element.setAttribute('role', 'application');\n    element.setAttribute('aria-label', 'Interactive simulation canvas');\n  }\n\n  /**\n   * Start gamepad polling\n   */\n  startGamepadPolling() {\n    if (this.gamepad.pollInterval) return;\n\n    this.gamepad.pollInterval = setInterval(() => {\n      this.pollGamepads();\n    }, this.config.GAMEPAD_SETTINGS.POLL_INTERVAL);\n  }\n\n  /**\n   * Poll connected gamepads for state changes\n   */\n  pollGamepads() {\n    const gamepads = navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      const gamepad = gamepads[i];\n      if (!gamepad) continue;\n\n      this.processGamepadState(gamepad);\n    }\n  }\n\n  /**\n   * Process gamepad state and emit events\n   * @param {Gamepad} gamepad - Gamepad object\n   */\n  processGamepadState(gamepad) {\n    const { id } = gamepad;\n    const prevState = this.gamepad.controllers.get(id) || {};\n\n    // Process buttons\n    gamepad.buttons.forEach((button, index) => {\n      const wasPressed = prevState.buttons?.[index]?.pressed || false;\n      const isPressed =\n        button.pressed ||\n        button.value > this.config.GAMEPAD_SETTINGS.BUTTON_THRESHOLD;\n\n      if (isPressed !== wasPressed) {\n        this.emit(isPressed ? 'gamepadbuttondown' : 'gamepadbuttonup', {\n          gamepadId: id,\n          button: index,\n          value: button.value,\n        });\n      }\n    });\n\n    // Store current state\n    this.gamepad.controllers.set(id, {\n      buttons: gamepad.buttons.map(b => ({\n        pressed: b.pressed,\n        value: b.value,\n      })),\n      axes: [...gamepad.axes],\n    });\n  }\n\n  // ==================== EVENT HANDLERS ====================\n\n  /**\n   * Enhanced mouse down handler with validation and accessibility\n   * @param {MouseEvent} event - Mouse event\n   */\n  handleMouseDown(event) {\n    try {\n      const coords = this.getEventCoordinates(event);\n      const now = performance.now();\n\n      // Update mouse state\n      this.mouse.x = coords.x;\n      this.mouse.y = coords.y;\n      this.mouse.down = true;\n      this.mouse.button = event.button;\n      this.mouse.buttons.add(event.button);\n      this.mouse.lastUpdate = now;\n\n      this.updateKeyboardModifiers(event);\n\n      const inputEvent = {\n        type: 'mousedown',\n        x: coords.x,\n        y: coords.y,\n        button: event.button,\n        buttons: Array.from(this.mouse.buttons),\n        timestamp: now,\n        originalEvent: event,\n        ...this.keyboard.modifiers,\n      };\n\n      this.performanceMonitor.recordEvent('mousedown', now);\n      this.emit('mousedown', inputEvent);\n      this.notifyScene('mousedown', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced mouse move handler\n   * @param {MouseEvent} event - Mouse event\n   */\n  handleMouseMove(event) {\n    try {\n      const coords = this.getEventCoordinates(event);\n      const now = performance.now();\n\n      // Calculate velocity\n      const deltaTime = now - this.mouse.lastUpdate;\n      const deltaX = coords.x - this.mouse.x;\n      const deltaY = coords.y - this.mouse.y;\n\n      this.mouse.velocity.x = deltaTime > 0 ? deltaX / deltaTime : 0;\n      this.mouse.velocity.y = deltaTime > 0 ? deltaY / deltaTime : 0;\n\n      // Update mouse state\n      this.mouse.x = coords.x;\n      this.mouse.y = coords.y;\n      this.mouse.lastUpdate = now;\n\n      this.updateKeyboardModifiers(event);\n\n      const inputEvent = {\n        type: 'mousemove',\n        x: coords.x,\n        y: coords.y,\n        deltaX,\n        deltaY,\n        velocity: { ...this.mouse.velocity },\n        button: this.mouse.button,\n        down: this.mouse.down,\n        timestamp: now,\n        originalEvent: event,\n        ...this.keyboard.modifiers,\n      };\n\n      this.performanceMonitor.recordEvent('mousemove', now);\n      this.emit('mousemove', inputEvent);\n      this.notifyScene('mousemove', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced mouse up handler\n   * @param {MouseEvent} event - Mouse event\n   */\n  handleMouseUp(event) {\n    try {\n      const coords = this.getEventCoordinates(event);\n      const now = performance.now();\n\n      // Update mouse state\n      this.mouse.x = coords.x;\n      this.mouse.y = coords.y;\n      this.mouse.down = false;\n      this.mouse.buttons.delete(event.button);\n      this.mouse.lastUpdate = now;\n\n      this.updateKeyboardModifiers(event);\n\n      const inputEvent = {\n        type: 'mouseup',\n        x: coords.x,\n        y: coords.y,\n        button: event.button,\n        buttons: Array.from(this.mouse.buttons),\n        timestamp: now,\n        originalEvent: event,\n        ...this.keyboard.modifiers,\n      };\n\n      this.performanceMonitor.recordEvent('mouseup', now);\n      this.emit('mouseup', inputEvent);\n      this.notifyScene('mouseup', inputEvent);\n\n      // Reset button if no buttons are pressed\n      if (this.mouse.buttons.size === 0) {\n        this.mouse.button = -1;\n      }\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced mouse enter handler\n   * @param {MouseEvent} event - Mouse event\n   */\n  handleMouseEnter(event) {\n    try {\n      const inputEvent = {\n        type: 'mouseenter',\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('mouseenter', inputEvent);\n      this.performanceMonitor.recordEvent('mouseenter');\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced mouse leave handler with state cleanup\n   * @param {MouseEvent} event - Mouse event\n   */\n  handleMouseLeave(event) {\n    try {\n      // Clean up mouse state\n      this.mouse.down = false;\n      this.mouse.buttons.clear();\n      this.mouse.button = -1;\n\n      const inputEvent = {\n        type: 'mouseleave',\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('mouseleave', inputEvent);\n      this.performanceMonitor.recordEvent('mouseleave');\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced context menu handler\n   * @param {MouseEvent} event - Mouse event\n   */\n  handleContextMenu(event) {\n    try {\n      // Prevent default context menu\n      event.preventDefault();\n\n      const coords = this.getEventCoordinates(event);\n      const inputEvent = {\n        type: 'contextmenu',\n        x: coords.x,\n        y: coords.y,\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('contextmenu', inputEvent);\n      this.performanceMonitor.recordEvent('contextmenu');\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced keyboard down handler\n   * @param {KeyboardEvent} event - Keyboard event\n   */\n  handleKeyDown(event) {\n    try {\n      // Only handle if container has focus or event is global\n      if (\n        !this.container.contains(document.activeElement) &&\n        !this.isGlobalShortcut(event)\n      ) {\n        return;\n      }\n\n      const now = performance.now();\n\n      // Add to pressed keys\n      this.keyboard.keys.add(event.code);\n      this.updateKeyboardModifiers(event);\n\n      const inputEvent = {\n        type: 'keydown',\n        key: event.key,\n        code: event.code,\n        repeat: event.repeat,\n        timestamp: now,\n        originalEvent: event,\n        ...this.keyboard.modifiers,\n      };\n\n      this.performanceMonitor.recordEvent('keydown', now);\n      this.emit('keydown', inputEvent);\n      this.notifyScene('keydown', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced keyboard up handler\n   * @param {KeyboardEvent} event - Keyboard event\n   */\n  handleKeyUp(event) {\n    try {\n      const now = performance.now();\n\n      // Remove from pressed keys\n      this.keyboard.keys.delete(event.code);\n      this.updateKeyboardModifiers(event);\n\n      const inputEvent = {\n        type: 'keyup',\n        key: event.key,\n        code: event.code,\n        timestamp: now,\n        originalEvent: event,\n        ...this.keyboard.modifiers,\n      };\n\n      this.performanceMonitor.recordEvent('keyup', now);\n      this.emit('keyup', inputEvent);\n      this.notifyScene('keyup', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced touch start handler\n   * @param {TouchEvent} event - Touch event\n   */\n  handleTouchStart(event) {\n    try {\n      event.preventDefault();\n\n      const touches = this.processTouches(event.touches);\n      const now = performance.now();\n\n      // Update touch state\n      touches.forEach(touch => {\n        this.touch.touches.set(touch.identifier, {\n          ...touch,\n          startTime: now,\n          startX: touch.x,\n          startY: touch.y,\n        });\n      });\n\n      // Detect gestures\n      this.detectGestures(touches);\n\n      const inputEvent = {\n        type: 'touchstart',\n        touches,\n        touchCount: this.touch.touches.size,\n        timestamp: now,\n        originalEvent: event,\n      };\n\n      this.performanceMonitor.recordEvent('touchstart', now);\n      this.emit('touchstart', inputEvent);\n      this.notifyScene('touchstart', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced touch move handler\n   * @param {TouchEvent} event - Touch event\n   */\n  handleTouchMove(event) {\n    try {\n      event.preventDefault();\n\n      const touches = this.processTouches(event.touches);\n      const now = performance.now();\n\n      // Update touch state\n      touches.forEach(touch => {\n        const existingTouch = this.touch.touches.get(touch.identifier);\n        if (existingTouch) {\n          this.touch.touches.set(touch.identifier, {\n            ...touch,\n            startTime: existingTouch.startTime,\n            startX: existingTouch.startX,\n            startY: existingTouch.startY,\n          });\n        }\n      });\n\n      // Update gestures\n      this.updateGestures(touches);\n\n      const inputEvent = {\n        type: 'touchmove',\n        touches,\n        gestures: { ...this.touch.gestures },\n        touchCount: this.touch.touches.size,\n        timestamp: now,\n        originalEvent: event,\n      };\n\n      this.performanceMonitor.recordEvent('touchmove', now);\n      this.emit('touchmove', inputEvent);\n      this.notifyScene('touchmove', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced touch end handler\n   * @param {TouchEvent} event - Touch event\n   */\n  handleTouchEnd(event) {\n    try {\n      event.preventDefault();\n\n      const touches = this.processTouches(event.changedTouches);\n      const now = performance.now();\n\n      // Remove ended touches\n      touches.forEach(touch => {\n        this.touch.touches.delete(touch.identifier);\n      });\n\n      // Finalize gestures\n      this.finalizeGestures(touches);\n\n      const inputEvent = {\n        type: 'touchend',\n        touches,\n        gestures: { ...this.touch.gestures },\n        touchCount: this.touch.touches.size,\n        timestamp: now,\n        originalEvent: event,\n      };\n\n      this.performanceMonitor.recordEvent('touchend', now);\n      this.emit('touchend', inputEvent);\n      this.notifyScene('touchend', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced touch cancel handler\n   * @param {TouchEvent} event - Touch event\n   */\n  handleTouchCancel(event) {\n    try {\n      // Clear all touches and gestures\n      this.touch.touches.clear();\n      this.resetGestures();\n\n      const inputEvent = {\n        type: 'touchcancel',\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('touchcancel', inputEvent);\n      this.performanceMonitor.recordEvent('touchcancel');\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Enhanced wheel handler\n   * @param {WheelEvent} event - Wheel event\n   */\n  handleWheel(event) {\n    try {\n      event.preventDefault();\n\n      const coords = this.getEventCoordinates(event);\n      const now = performance.now();\n\n      this.mouse.wheel = event.deltaY;\n\n      const inputEvent = {\n        type: 'wheel',\n        x: coords.x,\n        y: coords.y,\n        deltaX: event.deltaX,\n        deltaY: event.deltaY,\n        deltaZ: event.deltaZ,\n        timestamp: now,\n        originalEvent: event,\n      };\n\n      this.performanceMonitor.recordEvent('wheel', now);\n      this.emit('wheel', inputEvent);\n      this.notifyScene('wheel', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR);\n    }\n  }\n\n  /**\n   * Focus handler for accessibility\n   * @param {FocusEvent} event - Focus event\n   */\n  handleFocus(event) {\n    try {\n      this.accessibilityManager.onFocus(event);\n\n      const inputEvent = {\n        type: 'focus',\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('focus', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.ACCESSIBILITY_ERROR);\n    }\n  }\n\n  /**\n   * Blur handler for accessibility\n   * @param {FocusEvent} event - Blur event\n   */\n  handleBlur(event) {\n    try {\n      this.accessibilityManager.onBlur(event);\n\n      const inputEvent = {\n        type: 'blur',\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('blur', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.ACCESSIBILITY_ERROR);\n    }\n  }\n\n  /**\n   * Gamepad connected handler\n   * @param {GamepadEvent} event - Gamepad event\n   */\n  handleGamepadConnected(event) {\n    try {\n      const { gamepad } = event;\n      this.gamepad.controllers.set(gamepad.id, {\n        buttons: gamepad.buttons.map(b => ({\n          pressed: b.pressed,\n          value: b.value,\n        })),\n        axes: [...gamepad.axes],\n      });\n\n      this.log(`Gamepad connected: ${gamepad.id}`, 'info');\n\n      const inputEvent = {\n        type: 'gamepadconnected',\n        gamepadId: gamepad.id,\n        gamepad,\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('gamepadconnected', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.GAMEPAD_ERROR);\n    }\n  }\n\n  /**\n   * Gamepad disconnected handler\n   * @param {GamepadEvent} event - Gamepad event\n   */\n  handleGamepadDisconnected(event) {\n    try {\n      const { gamepad } = event;\n      this.gamepad.controllers.delete(gamepad.id);\n\n      this.log(`Gamepad disconnected: ${gamepad.id}`, 'info');\n\n      const inputEvent = {\n        type: 'gamepaddisconnected',\n        gamepadId: gamepad.id,\n        timestamp: performance.now(),\n        originalEvent: event,\n      };\n\n      this.emit('gamepaddisconnected', inputEvent);\n    } catch (error) {\n      this.errorHandler.handleError(error, INPUT_ERRORS.GAMEPAD_ERROR);\n    }\n  }\n\n  // ==================== UTILITY METHODS ====================\n\n  /**\n   * Get event coordinates relative to the canvas\n   * @param {Event} event - Event object\n   * @returns {Object} Coordinates {x, y}\n   */\n  getEventCoordinates(event) {\n    const rect = this.renderer.getElement().getBoundingClientRect();\n    return {\n      x: event.clientX - rect.left,\n      y: event.clientY - rect.top,\n    };\n  }\n\n  /**\n   * Process touch list into normalized touch objects\n   * @param {TouchList} touchList - Touch list\n   * @returns {Array} Normalized touch objects\n   */\n  processTouches(touchList) {\n    const rect = this.renderer.getElement().getBoundingClientRect();\n    const touches = [];\n\n    for (let i = 0; i < touchList.length; i++) {\n      const touch = touchList[i];\n      touches.push({\n        identifier: touch.identifier,\n        x: touch.clientX - rect.left,\n        y: touch.clientY - rect.top,\n        radiusX: touch.radiusX || this.config.TOUCH_SETTINGS.DEFAULT_RADIUS,\n        radiusY: touch.radiusY || this.config.TOUCH_SETTINGS.DEFAULT_RADIUS,\n        force: touch.force || this.config.TOUCH_SETTINGS.DEFAULT_FORCE,\n      });\n    }\n\n    return touches;\n  }\n\n  /**\n   * Update keyboard modifier state\n   * @param {Event} event - Event object\n   */\n  updateKeyboardModifiers(event) {\n    this.keyboard.modifiers.shift = event.shiftKey;\n    this.keyboard.modifiers.ctrl = event.ctrlKey;\n    this.keyboard.modifiers.alt = event.altKey;\n    this.keyboard.modifiers.meta = event.metaKey;\n  }\n\n  /**\n   * Check if event is a global shortcut\n   * @param {KeyboardEvent} event - Keyboard event\n   * @returns {boolean} Whether it's a global shortcut\n   */\n  isGlobalShortcut(event) {\n    const globalShortcuts = this.config.KEYBOARD_SETTINGS.GLOBAL_SHORTCUTS;\n\n    return (\n      globalShortcuts.includes(event.key) ||\n      (event.ctrlKey && ['?', 'h', 'H'].includes(event.key))\n    );\n  }\n\n  // ==================== GESTURE DETECTION ====================\n\n  /**\n   * Detect gestures from touch input\n   * @param {Array} touches - Touch objects\n   */\n  detectGestures(touches) {\n    if (touches.length === 1) {\n      // Single touch - potential tap\n      this.touch.gestures.tap = {\n        active: true,\n        startTime: performance.now(),\n        startX: touches[0].x,\n        startY: touches[0].y,\n      };\n    } else if (touches.length === 2) {\n      // Two touches - potential pinch\n      const distance = this.getTouchDistance(touches[0], touches[1]);\n      this.touch.gestures.pinch = {\n        active: true,\n        scale: 1,\n        startDistance: distance,\n        centerX: (touches[0].x + touches[1].x) / 2,\n        centerY: (touches[0].y + touches[1].y) / 2,\n      };\n    }\n  }\n\n  /**\n   * Update ongoing gestures\n   * @param {Array} touches - Touch objects\n   */\n  updateGestures(touches) {\n    // Update pinch gesture\n    if (this.touch.gestures.pinch.active && touches.length === 2) {\n      const distance = this.getTouchDistance(touches[0], touches[1]);\n      const scale = distance / this.touch.gestures.pinch.startDistance;\n\n      this.touch.gestures.pinch.scale = scale;\n      this.touch.gestures.pinch.centerX = (touches[0].x + touches[1].x) / 2;\n      this.touch.gestures.pinch.centerY = (touches[0].y + touches[1].y) / 2;\n\n      // Emit pinch event\n      this.emit('pinch', {\n        scale,\n        centerX: this.touch.gestures.pinch.centerX,\n        centerY: this.touch.gestures.pinch.centerY,\n      });\n    }\n\n    // Update pan gesture\n    if (touches.length === 1 && this.touch.gestures.tap.active) {\n      const deltaX = touches[0].x - this.touch.gestures.tap.startX;\n      const deltaY = touches[0].y - this.touch.gestures.tap.startY;\n      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n\n      if (distance > this.gestureThreshold.PAN_MIN_DISTANCE) {\n        this.touch.gestures.tap.active = false;\n        this.touch.gestures.pan = {\n          active: true,\n          deltaX,\n          deltaY,\n        };\n\n        this.emit('panstart', {\n          x: touches[0].x,\n          y: touches[0].y,\n          deltaX,\n          deltaY,\n        });\n      }\n    }\n  }\n\n  /**\n   * Finalize gestures when touch ends\n   * @param {Array} _touches - Touch objects (unused)\n   */\n  finalizeGestures(_touches) {\n    // Check for tap completion\n    if (this.touch.gestures.tap.active) {\n      const elapsed = performance.now() - this.touch.gestures.tap.startTime;\n      if (elapsed < this.gestureThreshold.TAP_TIMEOUT) {\n        this.emit('tap', {\n          x: this.touch.gestures.tap.startX,\n          y: this.touch.gestures.tap.startY,\n        });\n      }\n    }\n\n    // Finalize pan gesture\n    if (this.touch.gestures.pan.active) {\n      this.emit('panend', {\n        deltaX: this.touch.gestures.pan.deltaX,\n        deltaY: this.touch.gestures.pan.deltaY,\n      });\n    }\n\n    this.resetGestures();\n  }\n\n  /**\n   * Reset all gesture states\n   */\n  resetGestures() {\n    this.touch.gestures = {\n      pinch: { active: false, scale: 1, startDistance: 0 },\n      pan: { active: false, deltaX: 0, deltaY: 0 },\n      tap: { active: false, startTime: 0 },\n    };\n  }\n\n  /**\n   * Calculate distance between two touches\n   * @param {Object} touch1 - First touch\n   * @param {Object} touch2 - Second touch\n   * @returns {number} Distance\n   */\n  getTouchDistance(touch1, touch2) {\n    const dx = touch1.x - touch2.x;\n    const dy = touch1.y - touch2.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  // ==================== EVENT SYSTEM ====================\n\n  /**\n   * Register event handler\n   * @param {string} eventType - Event type\n   * @param {Function} callback - Callback function\n   */\n  on(eventType, callback) {\n    if (!this.eventHandlers.has(eventType)) {\n      this.eventHandlers.set(eventType, new Set());\n    }\n    this.eventHandlers.get(eventType).add(callback);\n  }\n\n  /**\n   * Unregister event handler\n   * @param {string} eventType - Event type\n   * @param {Function} callback - Callback function\n   */\n  off(eventType, callback) {\n    if (this.eventHandlers.has(eventType)) {\n      this.eventHandlers.get(eventType).delete(callback);\n    }\n  }\n\n  /**\n   * Emit event to registered handlers\n   * @param {string} eventType - Event type\n   * @param {Object} eventData - Event data\n   */\n  emit(eventType, eventData) {\n    if (this.eventHandlers.has(eventType)) {\n      this.eventHandlers.get(eventType).forEach(callback => {\n        try {\n          callback(eventData);\n        } catch (error) {\n          this.errorHandler.handleError(error, INPUT_ERRORS.HANDLER_ERROR, {\n            eventType,\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Notify scene of input event\n   * @param {string} eventType - Event type\n   * @param {Object} eventData - Event data\n   */\n  notifyScene(eventType, eventData) {\n    if (this.engine.scene && this.engine.scene.handleInput) {\n      this.engine.scene.handleInput(eventType, eventData);\n    }\n  }\n\n  // ==================== QUERY METHODS ====================\n\n  /**\n   * Check if key is currently pressed\n   * @param {string} keyCode - Key code\n   * @returns {boolean} Whether key is pressed\n   */\n  isKeyPressed(keyCode) {\n    return this.keyboard.keys.has(keyCode);\n  }\n\n  /**\n   * Check if mouse is down\n   * @returns {boolean} Whether mouse is down\n   */\n  isMouseDown() {\n    return this.mouse.down;\n  }\n\n  /**\n   * Get current mouse position\n   * @returns {Object} Mouse position {x, y}\n   */\n  getMousePosition() {\n    return { x: this.mouse.x, y: this.mouse.y };\n  }\n\n  /**\n   * Get current touch count\n   * @returns {number} Number of active touches\n   */\n  getTouchCount() {\n    return this.touch.touches.size;\n  }\n\n  /**\n   * Get performance metrics\n   * @returns {Object} Performance metrics\n   */\n  getPerformanceMetrics() {\n    return this.performanceMonitor.getMetrics();\n  }\n\n  // ==================== LIFECYCLE METHODS ====================\n\n  /**\n   * Update method (called by engine)\n   * @param {number} _deltaTime - Time since last update (unused)\n   */\n  update(_deltaTime) {\n    // Update any time-based input processing\n    // Currently used for gesture timeouts and key repeat handling\n\n    // Update performance monitoring\n    this.performanceMonitor.update();\n\n    // Update accessibility features\n    this.accessibilityManager.update();\n  }\n\n  /**\n   * Cleanup all event listeners and state\n   */\n  destroy() {\n    try {\n      const element = this.renderer.getElement();\n\n      // Remove mouse event listeners\n      if (this.boundMouseHandlers) {\n        Object.entries(this.boundMouseHandlers).forEach(([event, handler]) => {\n          element.removeEventListener(event, handler);\n        });\n      }\n\n      // Remove keyboard event listeners\n      if (this.boundKeyboardHandlers) {\n        Object.entries(this.boundKeyboardHandlers).forEach(\n          ([event, handler]) => {\n            document.removeEventListener(event, handler);\n          }\n        );\n      }\n\n      // Remove touch event listeners\n      if (this.boundTouchHandlers) {\n        Object.entries(this.boundTouchHandlers).forEach(([event, handler]) => {\n          element.removeEventListener(event, handler);\n        });\n      }\n\n      // Remove wheel event listener\n      if (this.boundWheelHandler) {\n        element.removeEventListener('wheel', this.boundWheelHandler);\n      }\n\n      // Remove gamepad event listeners\n      window.removeEventListener(\n        'gamepadconnected',\n        this.handleGamepadConnected\n      );\n      window.removeEventListener(\n        'gamepaddisconnected',\n        this.handleGamepadDisconnected\n      );\n\n      // Stop gamepad polling\n      if (this.gamepad.pollInterval) {\n        clearInterval(this.gamepad.pollInterval);\n      }\n\n      // Stop performance monitoring\n      this.performanceMonitor.stop();\n\n      // Clear state\n      this.eventHandlers.clear();\n      this.keyboard.keys.clear();\n      this.keyboard.repeatKeys.clear();\n      this.touch.touches.clear();\n      this.gamepad.controllers.clear();\n      this.eventHistory = [];\n\n      this.log('InputManager destroyed', 'info');\n    } catch (error) {\n      this.errorHandler.handleError(error, 'DESTRUCTION_ERROR');\n    }\n  }\n}\n\n// ==================== HELPER CLASSES ====================\n\n/**\n * Performance monitoring for input events\n */\nclass InputPerformanceMonitor {\n  constructor() {\n    this.events = new Map();\n    this.metrics = {\n      totalEvents: 0,\n      averageResponseTime: 0,\n      peakResponseTime: 0,\n      eventCounts: new Map(),\n    };\n    this.isRunning = false;\n    this.logEntries = [];\n  }\n\n  start(interval = 1000) {\n    if (this.isRunning) return;\n\n    this.isRunning = true;\n    this.startTime = performance.now();\n\n    this.monitorInterval = setInterval(() => {\n      this.updateMetrics();\n    }, interval);\n  }\n\n  stop() {\n    if (!this.isRunning) return;\n\n    this.isRunning = false;\n    clearInterval(this.monitorInterval);\n  }\n\n  recordEvent(eventType, timestamp = performance.now()) {\n    if (!this.events.has(eventType)) {\n      this.events.set(eventType, []);\n    }\n\n    this.events.get(eventType).push(timestamp);\n    this.metrics.totalEvents++;\n\n    const count = this.metrics.eventCounts.get(eventType) || 0;\n    this.metrics.eventCounts.set(eventType, count + 1);\n  }\n\n  updateMetrics() {\n    const now = performance.now();\n    const recentEvents = [];\n\n    for (const [, timestamps] of this.events) {\n      const recent = timestamps.filter(t => now - t < 1000);\n      recentEvents.push(...recent);\n    }\n\n    if (recentEvents.length > 0) {\n      const responseTime =\n        recentEvents.reduce((sum, t) => sum + (now - t), 0) /\n        recentEvents.length;\n      this.metrics.averageResponseTime = responseTime;\n      this.metrics.peakResponseTime = Math.max(\n        this.metrics.peakResponseTime,\n        responseTime\n      );\n    }\n  }\n\n  getMetrics() {\n    return { ...this.metrics };\n  }\n\n  logEvent(logEntry) {\n    this.logEntries.push(logEntry);\n\n    if (this.logEntries.length > INPUT_CONFIG.MAX_EVENT_HISTORY) {\n      this.logEntries = this.logEntries.slice(-INPUT_CONFIG.MAX_LOG_ENTRIES);\n    }\n  }\n\n  update() {\n    // Update performance metrics if needed\n  }\n}\n\n/**\n * Accessibility manager for input events\n */\nclass InputAccessibilityManager {\n  constructor(inputManager) {\n    this.inputManager = inputManager;\n    this.focusVisible = false;\n    this.reducedMotion = false;\n    this.highContrast = false;\n    this.screenReader = false;\n  }\n\n  initialize() {\n    this.detectAccessibilityPreferences();\n    this.setupAccessibilityFeatures();\n  }\n\n  detectAccessibilityPreferences() {\n    if (window.matchMedia) {\n      const reducedMotionQuery = window.matchMedia(\n        '(prefers-reduced-motion: reduce)'\n      );\n      this.reducedMotion = reducedMotionQuery.matches;\n\n      const updateReducedMotion = e => {\n        this.reducedMotion = e.matches;\n        this.inputManager.emit('accessibilityChanged', {\n          reducedMotion: this.reducedMotion,\n        });\n      };\n\n      reducedMotionQuery.addListener(updateReducedMotion);\n\n      const highContrastQuery = window.matchMedia('(prefers-contrast: high)');\n      this.highContrast = highContrastQuery.matches;\n\n      const updateHighContrast = e => {\n        this.highContrast = e.matches;\n        this.inputManager.emit('accessibilityChanged', {\n          highContrast: this.highContrast,\n        });\n      };\n\n      highContrastQuery.addListener(updateHighContrast);\n    }\n\n    this.screenReader = this.detectScreenReader();\n  }\n\n  detectScreenReader() {\n    return (\n      window.navigator.userAgent.includes('NVDA') ||\n      window.navigator.userAgent.includes('JAWS') ||\n      window.speechSynthesis ||\n      window.navigator.userAgent.includes('VoiceOver')\n    );\n  }\n\n  setupAccessibilityFeatures() {\n    document.addEventListener('keydown', () => {\n      this.focusVisible = true;\n    });\n\n    document.addEventListener('mousedown', () => {\n      this.focusVisible = false;\n    });\n  }\n\n  getEventAccessibilityData(_event) {\n    return {\n      focusVisible: this.focusVisible,\n      reducedMotion: this.reducedMotion,\n      highContrast: this.highContrast,\n      screenReader: this.screenReader,\n      keyboardNavigation: this.focusVisible,\n    };\n  }\n\n  onFocus(event) {\n    this.focusVisible = true;\n    if (event.target) {\n      event.target.setAttribute('data-focus-visible', 'true');\n    }\n  }\n\n  onBlur(event) {\n    if (event.target) {\n      event.target.removeAttribute('data-focus-visible');\n    }\n  }\n\n  update() {\n    // Update accessibility features if needed\n  }\n}\n\n/**\n * Error handler for input events\n */\nclass InputErrorHandler {\n  constructor() {\n    this.errors = [];\n    this.maxErrors = 50;\n  }\n\n  handleError(error, type, context = {}) {\n    const errorEntry = {\n      timestamp: new Date().toISOString(),\n      type,\n      message: error.message,\n      stack: error.stack,\n      context,\n    };\n\n    this.errors.push(errorEntry);\n\n    if (this.errors.length > this.maxErrors) {\n      this.errors = this.errors.slice(-this.maxErrors / 2);\n    }\n\n    if (type === INPUT_ERRORS.INVALID_EVENT) {\n      logger.warn('[InputManager] Invalid event:', errorEntry);\n    } else {\n      logger.error('[InputManager] Error:', errorEntry);\n    }\n  }\n\n  getErrors() {\n    return [...this.errors];\n  }\n\n  clearErrors() {\n    this.errors = [];\n  }\n}\n\n/**\n * Privacy manager for input handling\n */\nclass InputPrivacyManager {\n  constructor(config) {\n    this.config = config;\n    this.respectDNT = config.RESPECT_DNT;\n    this.anonymousTracking = config.ANONYMOUS_TRACKING;\n    this.minimalDataCollection = config.MINIMAL_DATA_COLLECTION;\n  }\n\n  initialize() {\n    if (this.respectDNT && navigator.doNotTrack === '1') {\n      this.anonymousTracking = false;\n    }\n  }\n\n  shouldLog() {\n    return !navigator.doNotTrack || !this.respectDNT;\n  }\n\n  sanitizeEventData(eventData) {\n    if (!this.minimalDataCollection) return eventData;\n\n    const sanitized = { ...eventData };\n    delete sanitized.originalEvent;\n    delete sanitized.element;\n\n    return sanitized;\n  }\n}\n\n/**\n * Input validator for event validation\n */\nclass InputValidator {\n  validate(event, eventType) {\n    if (!event) {\n      throw new Error('Event is null or undefined');\n    }\n\n    if (!eventType) {\n      throw new Error('Event type is required');\n    }\n\n    if (typeof event !== 'object') {\n      throw new Error('Event must be an object');\n    }\n\n    switch (eventType) {\n      case 'mousedown':\n      case 'mouseup':\n      case 'mousemove':\n        return this.validateMouseEvent(event);\n      case 'keydown':\n      case 'keyup':\n        return this.validateKeyboardEvent(event);\n      case 'touchstart':\n      case 'touchmove':\n      case 'touchend':\n        return this.validateTouchEvent(event);\n      default:\n        return true;\n    }\n  }\n\n  validateMouseEvent(event) {\n    return (\n      typeof event.clientX === 'number' && typeof event.clientY === 'number'\n    );\n  }\n\n  validateKeyboardEvent(event) {\n    return typeof event.key === 'string' || typeof event.code === 'string';\n  }\n\n  validateTouchEvent(event) {\n    return event.touches && typeof event.touches.length === 'number';\n  }\n}\n\nexport default InputManager;\n","/**\n * Enhanced Canvas Renderer for SimulateAI Platform\n * High-performance, accessible, and modern canvas-based graphics rendering\n *\n * Features:\n * - High-DPI and responsive canvas support\n * - Accessibility integration with ARIA and screen reader support\n * - Theme-aware rendering with dark mode support\n * - Performance monitoring and optimization\n * - Advanced animation system with motion sensitivity\n * - Memory management and cleanup\n * - Security-conscious rendering\n * - Comprehensive error handling\n *\n * @version 2.0.0\n * @author SimulateAI Team\n */\n\nimport logger from '../utils/logger.js';\n\n// Enhanced constants and configuration\nconst CANVAS_CONSTANTS = {\n  VERSION: '2.0.0',\n  DEFAULT_WIDTH: 800,\n  DEFAULT_HEIGHT: 600,\n  MAX_CANVAS_SIZE: 32767, // Browser limitation\n  ANIMATION_FPS: 60,\n  PERFORMANCE_SAMPLE_RATE: 0.1,\n\n  // Performance constants\n  FRAME_TIME_THRESHOLD: 16.67, // 60fps threshold in milliseconds\n  MAX_DRAW_CALLS: 10000,\n\n  // Font and text constants\n  DEFAULT_FONT_SIZE: 14,\n  LABEL_FONT_SIZE: 12,\n\n  // Drawing constants\n  DEFAULT_BORDER_RADIUS: 4,\n  FOCUSED_BORDER_WIDTH: 3,\n  DEFAULT_STROKE_WIDTH: 1,\n  CHART_TITLE_Y_OFFSET: 20,\n  CHART_AREA_RATIO: 0.8,\n  CHART_BAR_PADDING_RATIO: 0.1,\n  CHART_BAR_PADDING_MIN: 2,\n  CHART_BAR_BOTTOM_MARGIN: 20,\n  CHART_LABEL_Y_OFFSET: 5,\n  CHART_POINT_RADIUS: 4,\n  CHART_POINT_LABEL_Y_OFFSET: 15,\n  CHART_GRID_LINES: 5,\n  CHART_PIE_RADIUS_RATIO: 0.8,\n  CHART_PIE_LABEL_RADIUS_RATIO: 0.7,\n  CHART_PIE_MIN_SLICE_ANGLE: 0.2,\n  CHART_LEGEND_OFFSET: 20,\n\n  // Color constants\n  COLOR_HUE_FULL_CIRCLE: 360,\n  COLOR_SATURATION: 70,\n  COLOR_LIGHTNESS: 50,\n\n  // Animation constants\n  REDUCED_MOTION_DURATION_FACTOR: 0.2,\n  REDUCED_MOTION_MAX_DURATION: 300,\n  ANIMATION_ID_BASE: 36,\n  ANIMATION_ID_LENGTH: 9,\n\n  // Easing constants\n  EASING_HALF_POINT: 0.5,\n  EASING_QUADRATIC_FACTOR: 2,\n  EASING_CUBIC_FACTOR: 4,\n  EASING_BOUNCE_DIVISOR: 2.75,\n  EASING_BOUNCE_MULTIPLIER: 7.5625,\n  EASING_BOUNCE_THRESHOLD_1: 1.5,\n  EASING_BOUNCE_THRESHOLD_2: 2.5,\n  EASING_BOUNCE_THRESHOLD_3: 2.25,\n  EASING_BOUNCE_THRESHOLD_4: 2.625,\n  EASING_BOUNCE_OFFSET_1: 0.75,\n  EASING_BOUNCE_OFFSET_2: 0.9375,\n  EASING_BOUNCE_OFFSET_3: 0.984375,\n\n  // Default object sizes\n  DEFAULT_OBJECT_WIDTH: 50,\n  DEFAULT_OBJECT_HEIGHT: 50,\n  DEFAULT_CIRCLE_RADIUS: 25,\n  DEFAULT_LINE_LENGTH: 50,\n\n  // Placeholder constants\n  PLACEHOLDER_OFFSET: -5,\n  PLACEHOLDER_SIZE: 10,\n\n  ACCESSIBILITY: {\n    MIN_CONTRAST_RATIO: 4.5,\n    MIN_FONT_SIZE: 12,\n    MIN_TOUCH_TARGET: 44,\n  },\n  THEMES: {\n    LIGHT: {\n      background: '#ffffff',\n      foreground: '#333333',\n      primary: '#007acc',\n      secondary: '#28a745',\n      accent: '#6c757d',\n    },\n    DARK: {\n      background: '#1a1a1a',\n      foreground: '#e0e0e0',\n      primary: '#4da6ff',\n      secondary: '#66bb6a',\n      accent: '#9e9e9e',\n    },\n    HIGH_CONTRAST: {\n      background: '#000000',\n      foreground: '#ffffff',\n      primary: '#ffff00',\n      secondary: '#00ffff',\n      accent: '#ff00ff',\n    },\n  },\n};\n\n/**\n * Performance monitoring for canvas operations\n */\nclass CanvasPerformanceMonitor {\n  constructor() {\n    this.metrics = {\n      drawCalls: 0,\n      renderTime: 0,\n      frameCount: 0,\n      averageFrameTime: 0,\n      droppedFrames: 0,\n      lastFrameTime: 0,\n    };\n    this.enabled = CANVAS_CONSTANTS.PERFORMANCE_SAMPLE_RATE > Math.random();\n  }\n\n  startFrame() {\n    if (!this.enabled) return;\n    this.frameStartTime = performance.now();\n  }\n\n  endFrame() {\n    if (!this.enabled) return;\n\n    const frameTime = performance.now() - this.frameStartTime;\n    this.metrics.frameCount++;\n    this.metrics.renderTime += frameTime;\n    this.metrics.averageFrameTime =\n      this.metrics.renderTime / this.metrics.frameCount;\n\n    if (frameTime > CANVAS_CONSTANTS.FRAME_TIME_THRESHOLD) {\n      // > 60fps threshold\n      this.metrics.droppedFrames++;\n    }\n\n    this.metrics.lastFrameTime = frameTime;\n  }\n\n  recordDrawCall() {\n    if (!this.enabled) return;\n    this.metrics.drawCalls++;\n  }\n\n  getMetrics() {\n    return { ...this.metrics };\n  }\n\n  reset() {\n    Object.keys(this.metrics).forEach(key => {\n      this.metrics[key] = 0;\n    });\n  }\n}\n\n/**\n * Canvas accessibility manager\n */\nclass CanvasAccessibilityManager {\n  constructor(canvas, renderer) {\n    this.canvas = canvas;\n    this.renderer = renderer;\n    this.description = '';\n    this.elements = new Map();\n    this.focusedElement = null;\n    this.setupAccessibility();\n  }\n\n  setupAccessibility() {\n    // Set up canvas accessibility attributes\n    this.canvas.setAttribute('role', 'img');\n    this.canvas.setAttribute('tabindex', '0');\n    this.updateDescription('Interactive simulation canvas');\n\n    // Add keyboard navigation\n    this.canvas.addEventListener('keydown', this.handleKeydown.bind(this));\n    this.canvas.addEventListener('focus', this.handleFocus.bind(this));\n    this.canvas.addEventListener('blur', this.handleBlur.bind(this));\n  }\n\n  updateDescription(description) {\n    this.description = description;\n    this.canvas.setAttribute('aria-label', description);\n  }\n\n  addElement(id, element) {\n    this.elements.set(id, {\n      ...element,\n      id,\n      focusable: element.focusable !== false,\n    });\n    this.updateDescription();\n  }\n\n  removeElement(id) {\n    this.elements.delete(id);\n    if (this.focusedElement === id) {\n      this.focusedElement = null;\n    }\n    this.updateDescription();\n  }\n\n  handleKeydown(event) {\n    const focusableElements = Array.from(this.elements.values()).filter(\n      el => el.focusable\n    );\n\n    if (focusableElements.length === 0) return;\n\n    let currentIndex = focusableElements.findIndex(\n      el => el.id === this.focusedElement\n    );\n\n    switch (event.key) {\n      case 'Tab':\n        event.preventDefault();\n        if (event.shiftKey) {\n          currentIndex =\n            currentIndex <= 0 ? focusableElements.length - 1 : currentIndex - 1;\n        } else {\n          currentIndex =\n            currentIndex >= focusableElements.length - 1 ? 0 : currentIndex + 1;\n        }\n        this.focusElement(focusableElements[currentIndex].id);\n        break;\n\n      case 'Enter':\n      case ' ':\n        if (this.focusedElement) {\n          const element = this.elements.get(this.focusedElement);\n          if (element && element.onClick) {\n            event.preventDefault();\n            element.onClick();\n          }\n        }\n        break;\n    }\n  }\n\n  focusElement(id) {\n    this.focusedElement = id;\n    const element = this.elements.get(id);\n    if (element) {\n      this.announceElement(element);\n      this.renderer.requestRender();\n    }\n  }\n\n  announceElement(element) {\n    const announcement =\n      element.ariaLabel || element.label || `${element.type} element`;\n    this.announceToScreenReader(announcement);\n  }\n\n  announceToScreenReader(message) {\n    const announcer = document.createElement('div');\n    announcer.setAttribute('aria-live', 'polite');\n    announcer.setAttribute('aria-atomic', 'true');\n    announcer.style.position = 'absolute';\n    announcer.style.left = '-10000px';\n    announcer.style.width = '1px';\n    announcer.style.height = '1px';\n    announcer.style.overflow = 'hidden';\n\n    document.body.appendChild(announcer);\n    announcer.textContent = message;\n\n    setTimeout(() => {\n      document.body.removeChild(announcer);\n    }, 1000);\n  }\n\n  handleFocus() {\n    this.canvas.style.outline = '2px solid #007acc';\n  }\n\n  handleBlur() {\n    this.canvas.style.outline = 'none';\n    this.focusedElement = null;\n  }\n\n  getElementAt(x, y) {\n    for (const [id, element] of this.elements.entries()) {\n      if (this.isPointInElement(x, y, element)) {\n        return id;\n      }\n    }\n    return null;\n  }\n\n  isPointInElement(x, y, element) {\n    const { x: ex, y: ey, width, height } = element;\n    return x >= ex && x <= ex + width && y >= ey && y <= ey + height;\n  }\n}\n\n/**\n * Enhanced Canvas Renderer with modern features\n */\n\nclass CanvasRenderer {\n  /**\n   * Create an enhanced canvas renderer\n   * @param {HTMLElement} container - Container element\n   * @param {Object} options - Renderer options\n   */\n  constructor(container, options = {}) {\n    this.container = container;\n    this.options = {\n      width: options.width || CANVAS_CONSTANTS.DEFAULT_WIDTH,\n      height: options.height || CANVAS_CONSTANTS.DEFAULT_HEIGHT,\n      pixelRatio: options.pixelRatio || window.devicePixelRatio || 1,\n      alpha: options.alpha !== false,\n      antialias: options.antialias !== false,\n      theme: options.theme || 'light',\n      enableAccessibility: options.enableAccessibility !== false,\n      enablePerformanceMonitoring:\n        options.enablePerformanceMonitoring !== false,\n      respectReducedMotion: options.respectReducedMotion !== false,\n      maxDrawCalls: options.maxDrawCalls || CANVAS_CONSTANTS.MAX_DRAW_CALLS,\n      ...options,\n    };\n\n    // Core canvas properties\n    this.canvas = null;\n    this.ctx = null;\n    this.layers = new Map();\n    this.animations = new Set();\n    this.isRendering = false;\n    this.renderRequested = false;\n\n    // Enhanced features\n    this.performanceMonitor = new CanvasPerformanceMonitor();\n    this.accessibilityManager = null;\n\n    // Safely handle theme selection with proper type checking\n    const themeKey = (\n      typeof this.options.theme === 'string' ? this.options.theme : 'light'\n    ).toUpperCase();\n    this.currentTheme =\n      CANVAS_CONSTANTS.THEMES[themeKey] || CANVAS_CONSTANTS.THEMES.LIGHT;\n\n    this.imageCache = new Map();\n    this.drawCallCount = 0;\n\n    // Responsive handling\n    this.resizeObserver = null;\n    this.boundHandleResize = this.handleResize.bind(this);\n\n    // Animation frame handling\n    this.animationFrameId = null;\n    this.lastFrameTime = 0;\n\n    // Error handling\n    this.errorHandler =\n      options.errorHandler || this.defaultErrorHandler.bind(this);\n\n    // Initialize\n    try {\n      this.initialize();\n    } catch (error) {\n      this.errorHandler('Initialization failed', error);\n    }\n  }\n\n  /**\n   * Initialize the canvas renderer with enhanced features\n   */\n  initialize() {\n    this.validateContainer();\n    this.createCanvas();\n    this.setupContext();\n    this.setupAccessibility();\n    this.setupResponsiveHandling();\n    this.setupThemeMonitoring();\n    this.applyInitialStyles();\n  }\n\n  /**\n   * Validate container element\n   */\n  validateContainer() {\n    if (!this.container || !this.container.nodeType) {\n      throw new Error('Invalid container element provided');\n    }\n  }\n\n  /**\n   * Create and configure canvas element\n   */\n  createCanvas() {\n    this.canvas = document.createElement('canvas');\n\n    // Validate canvas size limits\n    const maxWidth = Math.min(\n      this.options.width,\n      CANVAS_CONSTANTS.MAX_CANVAS_SIZE\n    );\n    const maxHeight = Math.min(\n      this.options.height,\n      CANVAS_CONSTANTS.MAX_CANVAS_SIZE\n    );\n\n    // Set canvas styling\n    this.canvas.style.width = '100%';\n    this.canvas.style.height = '100%';\n    this.canvas.style.display = 'block';\n    this.canvas.style.touchAction = 'none'; // Prevent default touch behaviors\n\n    // Set canvas size with device pixel ratio\n    this.canvas.width = maxWidth * this.options.pixelRatio;\n    this.canvas.height = maxHeight * this.options.pixelRatio;\n\n    // Add security attributes\n    this.canvas.setAttribute('data-renderer', 'canvas');\n    this.canvas.setAttribute('data-version', CANVAS_CONSTANTS.VERSION);\n\n    this.container.appendChild(this.canvas);\n  }\n\n  /**\n   * Setup canvas context with enhanced options\n   */\n  setupContext() {\n    const contextOptions = {\n      alpha: this.options.alpha,\n      antialias: this.options.antialias,\n      colorSpace: 'srgb',\n      desynchronized: false,\n      willReadFrequently: false,\n    };\n\n    this.ctx = this.canvas.getContext('2d', contextOptions);\n\n    if (!this.ctx) {\n      throw new Error('Failed to get 2D canvas context');\n    }\n\n    // Scale context for high-DPI displays\n    this.ctx.scale(this.options.pixelRatio, this.options.pixelRatio);\n\n    // Set default styles with theme awareness\n    this.applyDefaultStyles();\n  }\n\n  /**\n   * Apply default canvas styles\n   */\n  applyDefaultStyles() {\n    this.ctx.font =\n      '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, system-ui, sans-serif';\n    this.ctx.textBaseline = 'middle';\n    this.ctx.lineCap = 'round';\n    this.ctx.lineJoin = 'round';\n    this.ctx.imageSmoothingEnabled = this.options.antialias;\n    this.ctx.imageSmoothingQuality = 'high';\n  }\n\n  /**\n   * Setup accessibility features\n   */\n  setupAccessibility() {\n    if (this.options.enableAccessibility) {\n      this.accessibilityManager = new CanvasAccessibilityManager(\n        this.canvas,\n        this\n      );\n    }\n  }\n\n  /**\n   * Setup responsive canvas handling\n   */\n  setupResponsiveHandling() {\n    if (window.ResizeObserver) {\n      this.resizeObserver = new ResizeObserver(this.boundHandleResize);\n      this.resizeObserver.observe(this.container);\n    } else {\n      window.addEventListener('resize', this.boundHandleResize);\n    }\n  }\n\n  /**\n   * Setup theme change monitoring\n   */\n  setupThemeMonitoring() {\n    if (window.matchMedia) {\n      const contrastQuery = window.matchMedia('(prefers-contrast: high)');\n\n      const updateTheme = () => {\n        let newTheme = 'light';\n        if (contrastQuery.matches) {\n          newTheme = 'high_contrast';\n        }\n        this.setTheme(newTheme);\n      };\n\n      contrastQuery.addEventListener('change', updateTheme);\n\n      // Initial theme detection\n      updateTheme();\n    }\n  }\n\n  /**\n   * Apply initial canvas styles\n   */\n  applyInitialStyles() {\n    this.clear();\n    this.ctx.fillStyle = this.currentTheme.background;\n    this.ctx.fillRect(0, 0, this.options.width, this.options.height);\n  }\n\n  /**\n   * Handle container resize\n   */\n  handleResize(entries) {\n    let width, height;\n\n    if (entries && entries[0]) {\n      ({ width, height } = entries[0].contentRect);\n    } else {\n      // Fallback for non-ResizeObserver browsers\n      ({ width, height } = this.container.getBoundingClientRect());\n    }\n\n    // Validate dimensions before resizing\n    if (width > 0 && height > 0) {\n      this.resize(width, height);\n    }\n    // Skip resize silently if dimensions are invalid (container might be hidden)\n  }\n\n  /**\n   * Set theme with automatic style updates\n   * @param {string} themeName - Theme name ('light', 'dark', 'high_contrast')\n   */\n  setTheme(themeName) {\n    // Safely handle theme name with proper type checking\n    const themeKey = (\n      typeof themeName === 'string' ? themeName : 'light'\n    ).toUpperCase();\n    const theme = CANVAS_CONSTANTS.THEMES[themeKey];\n    if (theme && theme !== this.currentTheme) {\n      this.currentTheme = theme;\n      this.options.theme = themeName;\n      this.applyInitialStyles();\n      this.requestRender();\n    }\n  }\n\n  /**\n   * Request render frame with performance monitoring\n   */\n  requestRender() {\n    if (this.renderRequested) return;\n\n    this.renderRequested = true;\n    this.animationFrameId = requestAnimationFrame(timestamp => {\n      this.performanceMonitor.startFrame();\n      this.renderRequested = false;\n      this.lastFrameTime = timestamp;\n      this.performanceMonitor.endFrame();\n    });\n  }\n\n  /**\n   * Default error handler\n   */\n  defaultErrorHandler(message, error) {\n    logger.error(`CanvasRenderer Error: ${message}`, error);\n\n    if (this.options.enableAccessibility && this.accessibilityManager) {\n      this.accessibilityManager.announceToScreenReader(\n        `Rendering error: ${message}`\n      );\n    }\n  }\n  // Enhanced drawing methods with accessibility and theme support\n  /**\n   * Clear canvas area with theme-aware background\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Width to clear\n   * @param {number} height - Height to clear\n   */\n  clear(\n    x = 0,\n    y = 0,\n    width = this.options.width,\n    height = this.options.height\n  ) {\n    this.ctx.clearRect(x, y, width, height);\n\n    // Apply theme background if clearing full canvas\n    if (\n      x === 0 &&\n      y === 0 &&\n      width === this.options.width &&\n      height === this.options.height\n    ) {\n      this.ctx.fillStyle = this.currentTheme.background;\n      this.ctx.fillRect(x, y, width, height);\n    }\n\n    this.performanceMonitor.recordDrawCall();\n  }\n\n  /**\n   * Draw rectangle with enhanced options and accessibility\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Rectangle width\n   * @param {number} height - Rectangle height\n   * @param {Object} options - Drawing options\n   */\n  drawRect(x, y, width, height, options = {}) {\n    if (this.drawCallCount >= this.options.maxDrawCalls) {\n      this.errorHandler(\n        'Maximum draw calls exceeded',\n        new Error('Performance limit')\n      );\n      return;\n    }\n\n    this.ctx.save();\n\n    try {\n      // Apply theme-aware defaults\n      const fill =\n        options.fill || (options.primary ? this.currentTheme.primary : null);\n      const stroke =\n        options.stroke ||\n        (options.border ? this.currentTheme.foreground : null);\n\n      // Accessibility: Ensure minimum size for interactive elements\n      if (\n        options.interactive &&\n        (width < CANVAS_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET ||\n          height < CANVAS_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET)\n      ) {\n        logger.warn('Interactive element below minimum touch target size');\n      }\n\n      if (fill) {\n        this.ctx.fillStyle = fill;\n        if (options.borderRadius) {\n          this.drawRoundedRect(x, y, width, height, options.borderRadius);\n          this.ctx.fill();\n        } else {\n          this.ctx.fillRect(x, y, width, height);\n        }\n      }\n\n      if (stroke) {\n        this.ctx.strokeStyle = stroke;\n        this.ctx.lineWidth = options.strokeWidth || 1;\n        if (options.borderRadius) {\n          this.drawRoundedRect(x, y, width, height, options.borderRadius);\n          this.ctx.stroke();\n        } else {\n          this.ctx.strokeRect(x, y, width, height);\n        }\n      }\n\n      // Register with accessibility manager\n      if (options.interactive && this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `rect_${Date.now()}`,\n          {\n            type: 'rectangle',\n            x,\n            y,\n            width,\n            height,\n            label: options.label,\n            ariaLabel: options.ariaLabel,\n            onClick: options.onClick,\n            focusable: options.focusable,\n          }\n        );\n      }\n    } catch (error) {\n      this.errorHandler('Failed to draw rectangle', error);\n    } finally {\n      this.ctx.restore();\n      this.performanceMonitor.recordDrawCall();\n      this.drawCallCount++;\n    }\n  }\n\n  /**\n   * Draw rounded rectangle path\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Rectangle width\n   * @param {number} height - Rectangle height\n   * @param {number|Object} radius - Border radius (number or {tl, tr, br, bl})\n   */\n  drawRoundedRect(x, y, width, height, radius) {\n    if (typeof radius === 'number') {\n      radius = { tl: radius, tr: radius, br: radius, bl: radius };\n    }\n\n    this.ctx.beginPath();\n    this.ctx.moveTo(x + radius.tl, y);\n    this.ctx.lineTo(x + width - radius.tr, y);\n    this.ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\n    this.ctx.lineTo(x + width, y + height - radius.br);\n    this.ctx.quadraticCurveTo(\n      x + width,\n      y + height,\n      x + width - radius.br,\n      y + height\n    );\n    this.ctx.lineTo(x + radius.bl, y + height);\n    this.ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\n    this.ctx.lineTo(x, y + radius.tl);\n    this.ctx.quadraticCurveTo(x, y, x + radius.tl, y);\n    this.ctx.closePath();\n  }\n\n  /**\n   * Draw circle with enhanced accessibility features\n   * @param {number} x - Center X coordinate\n   * @param {number} y - Center Y coordinate\n   * @param {number} radius - Circle radius\n   * @param {Object} options - Drawing options\n   */\n  drawCircle(x, y, radius, options = {}) {\n    if (this.drawCallCount >= this.options.maxDrawCalls) return;\n\n    this.ctx.save();\n\n    try {\n      // Apply theme-aware defaults\n      const fill =\n        options.fill || (options.primary ? this.currentTheme.primary : null);\n      const stroke =\n        options.stroke ||\n        (options.border ? this.currentTheme.foreground : null);\n\n      this.ctx.beginPath();\n      this.ctx.arc(x, y, radius, 0, 2 * Math.PI);\n\n      if (fill) {\n        this.ctx.fillStyle = fill;\n        this.ctx.fill();\n      }\n\n      if (stroke) {\n        this.ctx.strokeStyle = stroke;\n        this.ctx.lineWidth = options.strokeWidth || 1;\n        this.ctx.stroke();\n      }\n\n      // Register with accessibility manager\n      if (options.interactive && this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `circle_${Date.now()}`,\n          {\n            type: 'circle',\n            x: x - radius,\n            y: y - radius,\n            width: radius * 2,\n            height: radius * 2,\n            label: options.label,\n            ariaLabel: options.ariaLabel,\n            onClick: options.onClick,\n          }\n        );\n      }\n    } catch (error) {\n      this.errorHandler('Failed to draw circle', error);\n    } finally {\n      this.ctx.restore();\n      this.performanceMonitor.recordDrawCall();\n      this.drawCallCount++;\n    }\n  }\n\n  /**\n   * Draw line with enhanced styling options\n   * @param {number} x1 - Start X coordinate\n   * @param {number} y1 - Start Y coordinate\n   * @param {number} x2 - End X coordinate\n   * @param {number} y2 - End Y coordinate\n   * @param {Object} options - Drawing options\n   */\n  drawLine(x1, y1, x2, y2, options = {}) {\n    if (this.drawCallCount >= this.options.maxDrawCalls) return;\n\n    this.ctx.save();\n\n    try {\n      this.ctx.beginPath();\n      this.ctx.moveTo(x1, y1);\n      this.ctx.lineTo(x2, y2);\n\n      this.ctx.strokeStyle = options.stroke || this.currentTheme.foreground;\n      this.ctx.lineWidth = options.strokeWidth || 1;\n\n      if (options.lineCap) {\n        this.ctx.lineCap = options.lineCap;\n      }\n\n      if (options.dashPattern) {\n        this.ctx.setLineDash(options.dashPattern);\n      }\n\n      this.ctx.stroke();\n    } catch (error) {\n      this.errorHandler('Failed to draw line', error);\n    } finally {\n      this.ctx.restore();\n      this.performanceMonitor.recordDrawCall();\n      this.drawCallCount++;\n    }\n  }\n\n  /**\n   * Draw path with multiple points\n   * @param {Array} points - Array of {x, y} points\n   * @param {Object} options - Drawing options\n   */\n  drawPath(points, options = {}) {\n    if (!Array.isArray(points) || points.length < 2) return;\n    if (this.drawCallCount >= this.options.maxDrawCalls) return;\n\n    this.ctx.save();\n\n    try {\n      this.ctx.beginPath();\n      this.ctx.moveTo(points[0].x, points[0].y);\n\n      for (let i = 1; i < points.length; i++) {\n        if (options.smooth && i > 0 && i < points.length - 1) {\n          // Smooth curves using quadratic curves\n          const cp = points[i];\n          const next = points[i + 1];\n          this.ctx.quadraticCurveTo(\n            cp.x,\n            cp.y,\n            (cp.x + next.x) / 2,\n            (cp.y + next.y) / 2\n          );\n        } else {\n          this.ctx.lineTo(points[i].x, points[i].y);\n        }\n      }\n\n      if (options.closePath) {\n        this.ctx.closePath();\n      }\n\n      if (options.fill) {\n        this.ctx.fillStyle = options.fill;\n        this.ctx.fill();\n      }\n\n      if (options.stroke) {\n        this.ctx.strokeStyle = options.stroke;\n        this.ctx.lineWidth = options.strokeWidth || 1;\n        this.ctx.stroke();\n      }\n    } catch (error) {\n      this.errorHandler('Failed to draw path', error);\n    } finally {\n      this.ctx.restore();\n      this.performanceMonitor.recordDrawCall();\n      this.drawCallCount++;\n    }\n  }\n\n  /**\n   * Draw text with enhanced accessibility and typography\n   * @param {string} text - Text to draw\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {Object} options - Text options\n   */\n  drawText(text, x, y, options = {}) {\n    if (\n      typeof text !== 'string' ||\n      this.drawCallCount >= this.options.maxDrawCalls\n    )\n      return;\n\n    this.ctx.save();\n\n    try {\n      // Accessibility: Ensure minimum font size\n      const fontSize = Math.max(\n        options.fontSize || CANVAS_CONSTANTS.DEFAULT_FONT_SIZE,\n        CANVAS_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE\n      );\n\n      // Apply theme-aware defaults\n      const fill =\n        options.fill || options.color || this.currentTheme.foreground;\n\n      // Set font properties with accessibility considerations\n      const fontWeight = options.fontWeight || 'normal';\n      const fontFamily =\n        options.fontFamily ||\n        '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, system-ui, sans-serif';\n\n      this.ctx.font = `${fontWeight} ${fontSize}px ${fontFamily}`;\n      this.ctx.textAlign = options.textAlign || 'left';\n      this.ctx.textBaseline = options.textBaseline || 'middle';\n\n      // Text shadow for better readability if specified\n      if (options.shadow) {\n        this.ctx.shadowColor = options.shadow.color || 'rgba(0,0,0,0.5)';\n        this.ctx.shadowBlur = options.shadow.blur || 2;\n        this.ctx.shadowOffsetX = options.shadow.offsetX || 1;\n        this.ctx.shadowOffsetY = options.shadow.offsetY || 1;\n      }\n\n      if (fill) {\n        this.ctx.fillStyle = fill;\n        this.ctx.fillText(text, x, y);\n      }\n\n      if (options.stroke) {\n        this.ctx.strokeStyle = options.stroke;\n        this.ctx.lineWidth = options.strokeWidth || 1;\n        this.ctx.strokeText(text, x, y);\n      }\n\n      // Register with accessibility manager for screen readers\n      if (options.accessible && this.accessibilityManager) {\n        const metrics = this.ctx.measureText(text);\n        this.accessibilityManager.addElement(\n          options.id || `text_${Date.now()}`,\n          {\n            type: 'text',\n            x,\n            y: y - fontSize / 2,\n            width: metrics.width,\n            height: fontSize,\n            text,\n            label: options.label || text,\n            ariaLabel: options.ariaLabel || text,\n          }\n        );\n      }\n    } catch (error) {\n      this.errorHandler('Failed to draw text', error);\n    } finally {\n      this.ctx.restore();\n      this.performanceMonitor.recordDrawCall();\n      this.drawCallCount++;\n    }\n  }\n  // Advanced drawing methods with enhanced accessibility and theme support\n\n  /**\n   * Draw accessible button with proper focus handling\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Button width\n   * @param {number} height - Button height\n   * @param {string} text - Button text\n   * @param {Object} options - Button styling and interaction options\n   */\n  drawButton(x, y, width, height, text, options = {}) {\n    if (this.drawCallCount >= this.options.maxDrawCalls) return;\n\n    try {\n      // Ensure minimum touch target size for accessibility\n      const adjustedWidth = Math.max(\n        width,\n        CANVAS_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET\n      );\n      const adjustedHeight = Math.max(\n        height,\n        CANVAS_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET\n      );\n\n      // Theme-aware colors\n      const backgroundColor =\n        options.backgroundColor ||\n        (options.variant === 'secondary'\n          ? this.currentTheme.secondary\n          : this.currentTheme.primary);\n      const borderColor = options.borderColor || this.currentTheme.foreground;\n      const textColor = options.textColor || '#ffffff';\n\n      // Draw button background with focus indicator\n      const isFocused =\n        this.accessibilityManager?.focusedElement === options.id;\n      this.drawRect(x, y, adjustedWidth, adjustedHeight, {\n        fill: backgroundColor,\n        stroke: isFocused ? this.currentTheme.accent : borderColor,\n        strokeWidth: isFocused\n          ? CANVAS_CONSTANTS.FOCUSED_BORDER_WIDTH\n          : CANVAS_CONSTANTS.DEFAULT_STROKE_WIDTH,\n        borderRadius:\n          options.borderRadius || CANVAS_CONSTANTS.DEFAULT_BORDER_RADIUS,\n        interactive: true,\n        id: options.id,\n        label: options.label || text,\n        ariaLabel: options.ariaLabel || text,\n        onClick: options.onClick,\n        focusable: true,\n      });\n\n      // Draw button text with proper contrast\n      this.drawText(text, x + adjustedWidth / 2, y + adjustedHeight / 2, {\n        fill: textColor,\n        fontSize: Math.max(\n          options.fontSize || CANVAS_CONSTANTS.DEFAULT_FONT_SIZE,\n          CANVAS_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE\n        ),\n        fontWeight: options.fontWeight || '500',\n        textAlign: 'center',\n        textBaseline: 'middle',\n        accessible: true,\n        id: `${options.id}_text`,\n        ariaLabel: `Button: ${text}`,\n      });\n    } catch (error) {\n      this.errorHandler('Failed to draw button', error);\n    }\n  }\n  /**\n   * Draw accessible chart with proper labeling and keyboard navigation\n   * @param {Array} data - Chart data\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Chart width\n   * @param {number} height - Chart height\n   * @param {Object} options - Chart options\n   */\n  drawChart(data, x, y, width, height, options = {}) {\n    if (!Array.isArray(data) || data.length === 0) {\n      this.errorHandler(\n        'Invalid chart data provided',\n        new Error('Data must be non-empty array')\n      );\n      return;\n    }\n\n    const chartType = options.type || 'bar';\n\n    this.ctx.save();\n\n    try {\n      // Draw chart background with theme awareness\n      if (options.backgroundColor !== false) {\n        this.drawRect(x, y, width, height, {\n          fill: options.backgroundColor || this.currentTheme.background,\n        });\n      }\n\n      // Draw chart border\n      if (options.border !== false) {\n        this.drawRect(x, y, width, height, {\n          stroke: options.borderColor || this.currentTheme.foreground,\n          strokeWidth: 1,\n        });\n      }\n\n      // Add chart title if provided\n      if (options.title) {\n        this.drawText(\n          options.title,\n          x + width / 2,\n          y - CANVAS_CONSTANTS.CHART_TITLE_Y_OFFSET,\n          {\n            fill: this.currentTheme.foreground,\n            fontSize: 16,\n            fontWeight: 'bold',\n            textAlign: 'center',\n            accessible: true,\n            ariaLabel: `Chart title: ${options.title}`,\n          }\n        );\n      }\n\n      // Render chart based on type\n      switch (chartType) {\n        case 'bar':\n          this.drawBarChart(data, x, y, width, height, options);\n          break;\n        case 'line':\n          this.drawLineChart(data, x, y, width, height, options);\n          break;\n        case 'pie':\n          this.drawPieChart(data, x, y, Math.min(width, height), options);\n          break;\n        default:\n          throw new Error(`Unsupported chart type: ${chartType}`);\n      }\n\n      // Register chart with accessibility manager\n      if (this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `chart_${Date.now()}`,\n          {\n            type: 'chart',\n            x,\n            y,\n            width,\n            height,\n            chartType,\n            data,\n            label: options.label || `${chartType} chart`,\n            ariaLabel:\n              options.ariaLabel ||\n              this.generateChartDescription(data, chartType),\n          }\n        );\n      }\n    } catch (error) {\n      this.errorHandler('Failed to draw chart', error);\n    } finally {\n      this.ctx.restore();\n    }\n  }\n\n  /**\n   * Generate accessible description for chart data\n   * @param {Array} data - Chart data\n   * @param {string} chartType - Type of chart\n   * @returns {string} Accessible description\n   */\n  generateChartDescription(data, chartType) {\n    const total = data.reduce((sum, item) => sum + (item.value || 0), 0);\n    const itemCount = data.length;\n    const maxValue = Math.max(...data.map(d => d.value || 0));\n    const minValue = Math.min(...data.map(d => d.value || 0));\n\n    return (\n      `${chartType} chart with ${itemCount} data points. ` +\n      `Values range from ${minValue} to ${maxValue}. Total: ${total}`\n    );\n  }\n  /**\n   * Draw accessible bar chart with enhanced features\n   * @param {Array} data - Chart data\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Chart width\n   * @param {number} height - Chart height\n   * @param {Object} options - Chart options\n   */\n  drawBarChart(data, x, y, width, height, options = {}) {\n    if (!data.length) return;\n\n    try {\n      const maxValue = Math.max(...data.map(d => d.value || 0));\n      if (maxValue === 0) return;\n\n      const barWidth = width / data.length;\n      const padding = Math.max(\n        barWidth * CANVAS_CONSTANTS.CHART_BAR_PADDING_RATIO,\n        CANVAS_CONSTANTS.CHART_BAR_PADDING_MIN\n      );\n      const chartArea = height * CANVAS_CONSTANTS.CHART_AREA_RATIO;\n\n      data.forEach((item, index) => {\n        const barHeight = (item.value / maxValue) * chartArea;\n        const barX = x + index * barWidth + padding;\n        const barY =\n          y + height - barHeight - CANVAS_CONSTANTS.CHART_BAR_BOTTOM_MARGIN;\n        const actualBarWidth = barWidth - padding * 2;\n\n        // Use theme-aware colors with contrast checking\n        const barColor =\n          item.color || options.barColor || this.currentTheme.primary;\n\n        this.drawRect(barX, barY, actualBarWidth, barHeight, {\n          fill: barColor,\n          interactive: options.interactive,\n          id: `bar_${index}`,\n          label: `${item.label || `Item ${index + 1}`}: ${item.value}`,\n          ariaLabel: `Bar ${index + 1} of ${data.length}: ${item.label || 'Unnamed'} with value ${item.value}`,\n          onClick: () => options.onBarClick?.(item, index),\n        });\n\n        // Draw value label on top of bar\n        if (options.showValues !== false) {\n          this.drawText(\n            item.value.toString(),\n            barX + actualBarWidth / 2,\n            barY - 10,\n            {\n              fill: this.currentTheme.foreground,\n              fontSize: Math.max(\n                10,\n                CANVAS_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE\n              ),\n              textAlign: 'center',\n              textBaseline: 'bottom',\n            }\n          );\n        }\n\n        // Draw category label\n        if (item.label) {\n          this.drawText(\n            item.label,\n            barX + actualBarWidth / 2,\n            y + height - CANVAS_CONSTANTS.CHART_LABEL_Y_OFFSET,\n            {\n              fill: this.currentTheme.foreground,\n              fontSize: Math.max(\n                CANVAS_CONSTANTS.LABEL_FONT_SIZE,\n                CANVAS_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE\n              ),\n              textAlign: 'center',\n              textBaseline: 'bottom',\n            }\n          );\n        }\n      });\n    } catch (error) {\n      this.errorHandler('Failed to draw bar chart', error);\n    }\n  }\n  /**\n   * Draw accessible line chart with enhanced features\n   * @param {Array} data - Chart data\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Chart width\n   * @param {number} height - Chart height\n   * @param {Object} options - Chart options\n   */\n  drawLineChart(data, x, y, width, height, options = {}) {\n    if (data.length < 2) {\n      this.errorHandler(\n        'Line chart requires at least 2 data points',\n        new Error('Insufficient data')\n      );\n      return;\n    }\n\n    try {\n      const values = data.map(d => d.value || 0);\n      const maxValue = Math.max(...values);\n      const minValue = Math.min(...values);\n      const range = maxValue - minValue || 1; // Avoid division by zero\n\n      const chartArea = height * CANVAS_CONSTANTS.CHART_AREA_RATIO;\n      const points = data.map((item, index) => ({\n        x: x + (index / (data.length - 1)) * width,\n        y:\n          y +\n          chartArea -\n          ((item.value - minValue) / range) * chartArea +\n          CANVAS_CONSTANTS.CHART_BAR_BOTTOM_MARGIN,\n        value: item.value,\n        label: item.label,\n      }));\n\n      // Draw grid lines for better readability\n      if (options.showGrid !== false) {\n        this.drawGrid(\n          x,\n          y + CANVAS_CONSTANTS.CHART_BAR_BOTTOM_MARGIN,\n          width,\n          chartArea,\n          options\n        );\n      }\n\n      // Draw line with theme-aware styling\n      this.drawPath(points, {\n        stroke: options.lineColor || this.currentTheme.primary,\n        strokeWidth: options.lineWidth || 2,\n        smooth: options.smooth !== false,\n      });\n\n      // Draw data points with accessibility features\n      points.forEach((point, index) => {\n        this.drawCircle(\n          point.x,\n          point.y,\n          options.pointRadius || CANVAS_CONSTANTS.CHART_POINT_RADIUS,\n          {\n            fill: options.pointColor || this.currentTheme.primary,\n            stroke: this.currentTheme.background,\n            strokeWidth: 2,\n            interactive: options.interactive,\n            id: `point_${index}`,\n            label: `${point.label || `Point ${index + 1}`}: ${point.value}`,\n            ariaLabel: `Data point ${index + 1} of ${points.length}: ${point.label || 'Unnamed'} with value ${point.value}`,\n            onClick: () => options.onPointClick?.(data[index], index),\n          }\n        );\n\n        // Show value labels if requested\n        if (options.showValues) {\n          this.drawText(\n            point.value.toString(),\n            point.x,\n            point.y - CANVAS_CONSTANTS.CHART_POINT_LABEL_Y_OFFSET,\n            {\n              fill: this.currentTheme.foreground,\n              fontSize: 10,\n              textAlign: 'center',\n              textBaseline: 'bottom',\n            }\n          );\n        }\n      });\n    } catch (error) {\n      this.errorHandler('Failed to draw line chart', error);\n    }\n  }\n\n  /**\n   * Draw grid lines for charts\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Grid width\n   * @param {number} height - Grid height\n   * @param {Object} options - Grid options\n   */\n  drawGrid(x, y, width, height, options = {}) {\n    const gridColor = options.gridColor || `${this.currentTheme.accent}40`; // Semi-transparent\n    const gridLines = options.gridLines || CANVAS_CONSTANTS.CHART_GRID_LINES;\n\n    this.ctx.save();\n    this.ctx.strokeStyle = gridColor;\n    this.ctx.lineWidth = 0.5;\n    this.ctx.setLineDash([2, 2]);\n\n    // Horizontal grid lines\n    for (let i = 0; i <= gridLines; i++) {\n      const lineY = y + (i / gridLines) * height;\n      this.ctx.beginPath();\n      this.ctx.moveTo(x, lineY);\n      this.ctx.lineTo(x + width, lineY);\n      this.ctx.stroke();\n    }\n\n    // Vertical grid lines\n    for (let i = 0; i <= gridLines; i++) {\n      const lineX = x + (i / gridLines) * width;\n      this.ctx.beginPath();\n      this.ctx.moveTo(lineX, y);\n      this.ctx.lineTo(lineX, y + height);\n      this.ctx.stroke();\n    }\n\n    this.ctx.restore();\n  }\n  /**\n   * Draw accessible pie chart with enhanced features\n   * @param {Array} data - Chart data\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} size - Chart size\n   * @param {Object} options - Chart options\n   */\n  drawPieChart(data, x, y, size, options = {}) {\n    if (!data.length) return;\n\n    try {\n      const centerX = x + size / 2;\n      const centerY = y + size / 2;\n      const radius = (size / 2) * CANVAS_CONSTANTS.CHART_PIE_RADIUS_RATIO;\n\n      const total = data.reduce((sum, item) => sum + (item.value || 0), 0);\n      if (total === 0) return;\n\n      let currentAngle = -Math.PI / 2; // Start at top\n\n      data.forEach((item, index) => {\n        const sliceAngle = (item.value / total) * 2 * Math.PI;\n        const endAngle = currentAngle + sliceAngle;\n\n        // Calculate slice center for label positioning\n        const labelAngle = currentAngle + sliceAngle / 2;\n        const labelRadius =\n          radius * CANVAS_CONSTANTS.CHART_PIE_LABEL_RADIUS_RATIO;\n        const labelX = centerX + Math.cos(labelAngle) * labelRadius;\n        const labelY = centerY + Math.sin(labelAngle) * labelRadius;\n\n        this.ctx.save();\n\n        // Draw slice\n        this.ctx.beginPath();\n        this.ctx.moveTo(centerX, centerY);\n        this.ctx.arc(centerX, centerY, radius, currentAngle, endAngle);\n        this.ctx.closePath();\n\n        const sliceColor =\n          item.color || this.generateSliceColor(index, data.length);\n        this.ctx.fillStyle = sliceColor;\n        this.ctx.fill();\n\n        // Draw border\n        this.ctx.strokeStyle =\n          options.borderColor || this.currentTheme.background;\n        this.ctx.lineWidth = 2;\n        this.ctx.stroke();\n\n        this.ctx.restore();\n\n        // Register slice with accessibility manager\n        if (this.accessibilityManager) {\n          const percentage = ((item.value / total) * 100).toFixed(1);\n          this.accessibilityManager.addElement(`slice_${index}`, {\n            type: 'pie-slice',\n            x: centerX - radius,\n            y: centerY - radius,\n            width: radius * 2,\n            height: radius * 2,\n            label: `${item.label || `Slice ${index + 1}`}: ${percentage}%`,\n            ariaLabel: `Pie slice ${index + 1} of ${data.length}: ${item.label || 'Unnamed'} representing ${percentage}% with value ${item.value}`,\n            interactive: options.interactive,\n            onClick: () => options.onSliceClick?.(item, index),\n          });\n        }\n\n        // Draw label if there's enough space\n        if (\n          sliceAngle > CANVAS_CONSTANTS.CHART_PIE_MIN_SLICE_ANGLE &&\n          options.showLabels !== false\n        ) {\n          const percentage = ((item.value / total) * 100).toFixed(1);\n          const labelText = options.showPercentages\n            ? `${percentage}%`\n            : item.label;\n\n          if (labelText) {\n            this.drawText(labelText, labelX, labelY, {\n              fill: this.currentTheme.background,\n              fontSize: Math.max(\n                10,\n                CANVAS_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE\n              ),\n              textAlign: 'center',\n              textBaseline: 'middle',\n              fontWeight: 'bold',\n            });\n          }\n        }\n\n        currentAngle = endAngle;\n      });\n\n      // Draw legend if requested\n      if (options.showLegend !== false) {\n        this.drawPieChartLegend(\n          data,\n          x + size + CANVAS_CONSTANTS.CHART_LEGEND_OFFSET,\n          y,\n          options\n        );\n      }\n    } catch (error) {\n      this.errorHandler('Failed to draw pie chart', error);\n    }\n  }\n\n  /**\n   * Generate color for pie chart slice\n   * @param {number} index - Slice index\n   * @param {number} total - Total number of slices\n   * @returns {string} Color value\n   */\n  generateSliceColor(index, total) {\n    const hue = (index / total) * CANVAS_CONSTANTS.COLOR_HUE_FULL_CIRCLE;\n    const saturation = CANVAS_CONSTANTS.COLOR_SATURATION;\n    const lightness = CANVAS_CONSTANTS.COLOR_LIGHTNESS;\n    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;\n  }\n\n  /**\n   * Draw legend for pie chart\n   * @param {Array} data - Chart data\n   * @param {number} x - Legend X coordinate\n   * @param {number} y - Legend Y coordinate\n   * @param {Object} options - Legend options\n   */\n  drawPieChartLegend(data, x, y, _options = {}) {\n    const itemHeight = 25;\n    const colorBoxSize = 15;\n\n    data.forEach((item, index) => {\n      const itemY = y + index * itemHeight;\n      const color = item.color || this.generateSliceColor(index, data.length);\n\n      // Draw color box\n      this.drawRect(x, itemY, colorBoxSize, colorBoxSize, {\n        fill: color,\n        stroke: this.currentTheme.foreground,\n        strokeWidth: 1,\n      });\n\n      // Draw label\n      this.drawText(\n        item.label || `Item ${index + 1}`,\n        x + colorBoxSize + 10,\n        itemY + colorBoxSize / 2,\n        {\n          fill: this.currentTheme.foreground,\n          fontSize: 12,\n          textBaseline: 'middle',\n        }\n      );\n    });\n  }\n  // Enhanced animation methods with motion sensitivity and performance optimization\n\n  /**\n   * Create accessible animation with motion sensitivity support\n   * @param {Function} callback - Animation callback function\n   * @param {number} duration - Animation duration in milliseconds\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID for control\n   */\n  animate(callback, duration = 1000, options = {}) {\n    // Respect user's motion preferences\n    if (\n      this.options.respectReducedMotion &&\n      window.matchMedia &&\n      window.matchMedia('(prefers-reduced-motion: reduce)').matches\n    ) {\n      // Skip animation for motion-sensitive users\n      if (options.skipOnReducedMotion !== false) {\n        callback(1); // Complete immediately\n        return null;\n      }\n\n      // Reduce animation duration for motion-sensitive users\n      duration = Math.min(\n        duration * CANVAS_CONSTANTS.REDUCED_MOTION_DURATION_FACTOR,\n        CANVAS_CONSTANTS.REDUCED_MOTION_MAX_DURATION\n      );\n    }\n\n    const animation = {\n      callback,\n      duration,\n      startTime: performance.now(),\n      id: Math.random()\n        .toString(CANVAS_CONSTANTS.ANIMATION_ID_BASE)\n        .substr(2, CANVAS_CONSTANTS.ANIMATION_ID_LENGTH),\n      easing: options.easing || 'easeInOut',\n      onComplete: options.onComplete,\n      onProgress: options.onProgress,\n      paused: false,\n      cancelled: false,\n    };\n\n    this.animations.add(animation);\n    this.runAnimation(animation);\n\n    return animation.id;\n  }\n\n  /**\n   * Run animation with performance monitoring\n   * @param {Object} animation - Animation object\n   */\n  runAnimation(animation) {\n    const animate = currentTime => {\n      if (animation.cancelled) {\n        this.animations.delete(animation);\n        return;\n      }\n\n      if (animation.paused) {\n        requestAnimationFrame(animate);\n        return;\n      }\n\n      const elapsed = currentTime - animation.startTime;\n      let progress = Math.min(elapsed / animation.duration, 1);\n\n      // Apply easing function\n      progress = this.applyEasing(progress, animation.easing);\n\n      try {\n        animation.callback(progress);\n\n        if (animation.onProgress) {\n          animation.onProgress(progress);\n        }\n\n        if (progress < 1) {\n          requestAnimationFrame(animate);\n        } else {\n          this.animations.delete(animation);\n          if (animation.onComplete) {\n            animation.onComplete();\n          }\n        }\n      } catch (error) {\n        this.errorHandler('Animation callback failed', error);\n        this.animations.delete(animation);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }\n\n  /**\n   * Apply easing function to animation progress\n   * @param {number} t - Progress value (0-1)\n   * @param {string} easing - Easing function name\n   * @returns {number} Eased progress value\n   */\n  applyEasing(t, easing) {\n    switch (easing) {\n      case 'linear':\n        return t;\n      case 'easeIn':\n        return t * t;\n      case 'easeOut':\n        return t * (2 - t);\n      case 'easeInOut':\n        return t < CANVAS_CONSTANTS.EASING_HALF_POINT\n          ? CANVAS_CONSTANTS.EASING_QUADRATIC_FACTOR * t * t\n          : -1 +\n              (CANVAS_CONSTANTS.EASING_CUBIC_FACTOR -\n                CANVAS_CONSTANTS.EASING_QUADRATIC_FACTOR * t) *\n                t;\n      case 'easeInCubic':\n        return t * t * t;\n      case 'easeOutCubic':\n        return --t * t * t + 1;\n      case 'easeInOutCubic':\n        return t < CANVAS_CONSTANTS.EASING_HALF_POINT\n          ? CANVAS_CONSTANTS.EASING_CUBIC_FACTOR * t * t * t\n          : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n      case 'bounce':\n        if (t < 1 / CANVAS_CONSTANTS.EASING_BOUNCE_DIVISOR) {\n          return CANVAS_CONSTANTS.EASING_BOUNCE_MULTIPLIER * t * t;\n        } else if (\n          t <\n          CANVAS_CONSTANTS.EASING_QUADRATIC_FACTOR /\n            CANVAS_CONSTANTS.EASING_BOUNCE_DIVISOR\n        ) {\n          return (\n            CANVAS_CONSTANTS.EASING_BOUNCE_MULTIPLIER *\n              (t -=\n                CANVAS_CONSTANTS.EASING_BOUNCE_THRESHOLD_1 /\n                CANVAS_CONSTANTS.EASING_BOUNCE_DIVISOR) *\n              t +\n            CANVAS_CONSTANTS.EASING_BOUNCE_OFFSET_1\n          );\n        } else if (\n          t <\n          CANVAS_CONSTANTS.EASING_BOUNCE_THRESHOLD_2 /\n            CANVAS_CONSTANTS.EASING_BOUNCE_DIVISOR\n        ) {\n          return (\n            CANVAS_CONSTANTS.EASING_BOUNCE_MULTIPLIER *\n              (t -=\n                CANVAS_CONSTANTS.EASING_BOUNCE_THRESHOLD_3 /\n                CANVAS_CONSTANTS.EASING_BOUNCE_DIVISOR) *\n              t +\n            CANVAS_CONSTANTS.EASING_BOUNCE_OFFSET_2\n          );\n        } else {\n          return (\n            CANVAS_CONSTANTS.EASING_BOUNCE_MULTIPLIER *\n              (t -=\n                CANVAS_CONSTANTS.EASING_BOUNCE_THRESHOLD_4 /\n                CANVAS_CONSTANTS.EASING_BOUNCE_DIVISOR) *\n              t +\n            CANVAS_CONSTANTS.EASING_BOUNCE_OFFSET_3\n          );\n        }\n      default:\n        return t;\n    }\n  }\n\n  /**\n   * Pause animation by ID\n   * @param {string} animationId - Animation ID to pause\n   */\n  pauseAnimation(animationId) {\n    for (const animation of this.animations) {\n      if (animation.id === animationId) {\n        animation.paused = true;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Resume animation by ID\n   * @param {string} animationId - Animation ID to resume\n   */\n  resumeAnimation(animationId) {\n    for (const animation of this.animations) {\n      if (animation.id === animationId) {\n        animation.paused = false;\n        // Adjust start time to account for pause duration\n        animation.startTime =\n          performance.now() - (animation.duration * animation.progress || 0);\n        break;\n      }\n    }\n  }\n\n  /**\n   * Stop animation by ID\n   * @param {string} animationId - Animation ID to stop\n   */\n  stopAnimation(animationId) {\n    for (const animation of this.animations) {\n      if (animation.id === animationId) {\n        animation.cancelled = true;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Stop all animations\n   */\n  stopAllAnimations() {\n    for (const animation of this.animations) {\n      animation.cancelled = true;\n    }\n    this.animations.clear();\n  }\n\n  /**\n   * Create fade animation\n   * @param {Object} target - Target object with alpha property\n   * @param {number} targetAlpha - Target alpha value\n   * @param {number} duration - Animation duration\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID\n   */\n  fadeAnimation(target, targetAlpha, duration = 500, options = {}) {\n    const startAlpha = target.alpha || 0;\n    const deltaAlpha = targetAlpha - startAlpha;\n\n    return this.animate(\n      progress => {\n        target.alpha = startAlpha + deltaAlpha * progress;\n        this.requestRender();\n      },\n      duration,\n      options\n    );\n  }\n\n  /**\n   * Create slide animation\n   * @param {Object} target - Target object with x/y properties\n   * @param {number} targetX - Target X position\n   * @param {number} targetY - Target Y position\n   * @param {number} duration - Animation duration\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID\n   */\n  slideAnimation(target, targetX, targetY, duration = 500, options = {}) {\n    const startX = target.x || 0;\n    const startY = target.y || 0;\n    const deltaX = targetX - startX;\n    const deltaY = targetY - startY;\n\n    return this.animate(\n      progress => {\n        target.x = startX + deltaX * progress;\n        target.y = startY + deltaY * progress;\n        this.requestRender();\n      },\n      duration,\n      options\n    );\n  }\n\n  /**\n   * Create scale animation\n   * @param {Object} target - Target object with scale property\n   * @param {number} targetScale - Target scale value\n   * @param {number} duration - Animation duration\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID\n   */\n  scaleAnimation(target, targetScale, duration = 500, options = {}) {\n    const startScale = target.scale || 1;\n    const deltaScale = targetScale - startScale;\n\n    return this.animate(\n      progress => {\n        target.scale = startScale + deltaScale * progress;\n        this.requestRender();\n      },\n      duration,\n      options\n    );\n  }\n  // Enhanced rendering and integration methods\n\n  /**\n   * Get renderer type for Visual Engine integration\n   * @returns {string} Renderer type\n   */\n  get type() {\n    return 'canvas';\n  }\n\n  /**\n   * Get canvas element for external integration\n   * @returns {HTMLCanvasElement} Canvas element\n   */\n  getElement() {\n    return this.canvas;\n  }\n\n  /**\n   * Render complete scene with performance monitoring\n   * @param {Object} scene - Scene object to render\n   */\n  render(scene) {\n    if (!scene) return;\n\n    this.performanceMonitor.startFrame();\n    this.drawCallCount = 0;\n\n    try {\n      this.clear();\n\n      if (scene.backgroundColor) {\n        this.ctx.fillStyle = scene.backgroundColor;\n        this.ctx.fillRect(0, 0, this.options.width, this.options.height);\n      }\n\n      if (scene.render && typeof scene.render === 'function') {\n        scene.render(this);\n      } else if (scene.objects && Array.isArray(scene.objects)) {\n        scene.objects.forEach(obj => this.renderObject(obj));\n      }\n\n      // Announce scene changes to screen readers\n      if (this.accessibilityManager && scene.description) {\n        this.accessibilityManager.updateDescription(scene.description);\n      }\n    } catch (error) {\n      this.errorHandler('Failed to render scene', error);\n    } finally {\n      this.performanceMonitor.endFrame();\n    }\n  }\n\n  /**\n   * Render individual object with transformations and accessibility\n   * @param {Object} object - Object to render\n   */\n  renderObject(object) {\n    if (!object || object.visible === false) return;\n\n    this.ctx.save();\n\n    try {\n      // Apply transformations\n      if (object.x || object.y) {\n        this.ctx.translate(object.x || 0, object.y || 0);\n      }\n\n      if (object.rotation) {\n        this.ctx.rotate(object.rotation);\n      }\n\n      if (object.scale && object.scale !== 1) {\n        const scaleX =\n          typeof object.scale === 'object' ? object.scale.x : object.scale;\n        const scaleY =\n          typeof object.scale === 'object' ? object.scale.y : object.scale;\n        this.ctx.scale(scaleX, scaleY);\n      }\n\n      if (object.alpha !== undefined) {\n        this.ctx.globalAlpha = Math.max(0, Math.min(1, object.alpha));\n      }\n\n      // Apply blend mode if specified\n      if (object.blendMode) {\n        this.ctx.globalCompositeOperation = object.blendMode;\n      }\n\n      // Render based on object type or custom render method\n      if (object.render && typeof object.render === 'function') {\n        object.render(this);\n      } else if (object.type) {\n        this.renderByType(object);\n      }\n    } catch (error) {\n      this.errorHandler(\n        `Failed to render object: ${object.type || 'unknown'}`,\n        error\n      );\n    } finally {\n      this.ctx.restore();\n    }\n  }\n\n  /**\n   * Render object by type with enhanced features\n   * @param {Object} object - Object to render\n   */\n  renderByType(object) {\n    const commonOptions = {\n      fill: object.fill || object.color,\n      stroke: object.stroke || object.borderColor,\n      strokeWidth: object.strokeWidth || object.borderWidth,\n      interactive: object.interactive,\n      id: object.id,\n      label: object.label,\n      ariaLabel: object.ariaLabel,\n      onClick: object.onClick,\n    };\n\n    switch (object.type) {\n      case 'rect':\n      case 'rectangle':\n        this.drawRect(\n          0,\n          0,\n          object.width || CANVAS_CONSTANTS.DEFAULT_OBJECT_WIDTH,\n          object.height || CANVAS_CONSTANTS.DEFAULT_OBJECT_HEIGHT,\n          {\n            ...commonOptions,\n            borderRadius: object.borderRadius,\n          }\n        );\n        break;\n\n      case 'circle':\n        this.drawCircle(\n          0,\n          0,\n          object.radius || CANVAS_CONSTANTS.DEFAULT_CIRCLE_RADIUS,\n          commonOptions\n        );\n        break;\n\n      case 'text':\n        this.drawText(object.text || '', 0, 0, {\n          fill: commonOptions.fill,\n          fontSize: object.fontSize,\n          fontFamily: object.fontFamily,\n          fontWeight: object.fontWeight,\n          textAlign: object.textAlign || object.align,\n          textBaseline: object.textBaseline || object.baseline,\n          accessible: object.accessible,\n          id: commonOptions.id,\n          label: commonOptions.label,\n          ariaLabel: commonOptions.ariaLabel,\n        });\n        break;\n\n      case 'line':\n        this.drawLine(\n          object.x1 || 0,\n          object.y1 || 0,\n          object.x2 || CANVAS_CONSTANTS.DEFAULT_LINE_LENGTH,\n          object.y2 || CANVAS_CONSTANTS.DEFAULT_LINE_LENGTH,\n          {\n            stroke: commonOptions.stroke,\n            strokeWidth: commonOptions.strokeWidth,\n            lineCap: object.lineCap,\n            dashPattern: object.dashPattern,\n          }\n        );\n        break;\n\n      case 'path':\n        if (object.points && Array.isArray(object.points)) {\n          this.drawPath(object.points, {\n            ...commonOptions,\n            closePath: object.closePath,\n            smooth: object.smooth,\n          });\n        }\n        break;\n\n      case 'image':\n        if (object.src || object.image) {\n          this.drawImage(object.src || object.image, 0, 0, {\n            width: object.width,\n            height: object.height,\n            ...commonOptions,\n          });\n        }\n        break;\n\n      default:\n        // Draw a placeholder for unknown types\n        this.drawRect(\n          CANVAS_CONSTANTS.PLACEHOLDER_OFFSET,\n          CANVAS_CONSTANTS.PLACEHOLDER_OFFSET,\n          CANVAS_CONSTANTS.PLACEHOLDER_SIZE,\n          CANVAS_CONSTANTS.PLACEHOLDER_SIZE,\n          {\n            fill: '#ff6b6b',\n            stroke: '#e55555',\n            strokeWidth: 1,\n          }\n        );\n        logger.warn(`Unknown object type: ${object.type}`);\n    }\n  }\n  // Advanced utility and image methods\n\n  /**\n   * Draw image with caching and error handling\n   * @param {string|HTMLImageElement} source - Image source or element\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {Object} options - Drawing options\n   */\n  drawImage(source, x, y, options = {}) {\n    if (this.drawCallCount >= this.options.maxDrawCalls) return;\n\n    const drawImageElement = img => {\n      try {\n        const width = options.width || img.naturalWidth || img.width;\n        const height = options.height || img.naturalHeight || img.height;\n\n        // Apply any filters or effects\n        if (options.filter) {\n          this.ctx.filter = options.filter;\n        }\n\n        if (options.opacity !== undefined) {\n          const oldAlpha = this.ctx.globalAlpha;\n          this.ctx.globalAlpha = options.opacity;\n          this.ctx.drawImage(img, x, y, width, height);\n          this.ctx.globalAlpha = oldAlpha;\n        } else {\n          this.ctx.drawImage(img, x, y, width, height);\n        }\n\n        // Reset filter\n        if (options.filter) {\n          this.ctx.filter = 'none';\n        }\n\n        // Register with accessibility manager\n        if (options.accessible && this.accessibilityManager) {\n          this.accessibilityManager.addElement(\n            options.id || `image_${Date.now()}`,\n            {\n              type: 'image',\n              x,\n              y,\n              width,\n              height,\n              label: options.label || options.alt || 'Image',\n              ariaLabel:\n                options.ariaLabel || options.alt || 'Interactive image',\n            }\n          );\n        }\n\n        this.performanceMonitor.recordDrawCall();\n        this.drawCallCount++;\n      } catch (error) {\n        this.errorHandler('Failed to draw image', error);\n      }\n    };\n\n    if (typeof source === 'string') {\n      // Check cache first\n      if (this.imageCache.has(source)) {\n        const cachedImg = this.imageCache.get(source);\n        if (cachedImg.complete) {\n          drawImageElement(cachedImg);\n        } else {\n          cachedImg.addEventListener('load', () => drawImageElement(cachedImg));\n        }\n        return;\n      }\n\n      // Load and cache new image\n      const img = new Image();\n      this.imageCache.set(source, img);\n\n      img.onload = () => drawImageElement(img);\n      img.onerror = () => {\n        this.errorHandler(\n          'Failed to load image',\n          new Error(`Image not found: ${source}`)\n        );\n        this.imageCache.delete(source);\n      };\n\n      // Set CORS if needed\n      if (options.crossOrigin) {\n        img.crossOrigin = options.crossOrigin;\n      }\n\n      img.src = source;\n    } else if (source instanceof HTMLImageElement) {\n      drawImageElement(source);\n    } else {\n      this.errorHandler(\n        'Invalid image source',\n        new Error('Source must be string URL or HTMLImageElement')\n      );\n    }\n  }\n\n  /**\n   * Create gradient with theme awareness\n   * @param {string} type - Gradient type ('linear' or 'radial')\n   * @param {Array} colorStops - Array of color stops\n   * @param {Object} coordinates - Gradient coordinates\n   * @returns {CanvasGradient} Gradient object\n   */\n  createGradient(type, colorStops, coordinates) {\n    let gradient;\n\n    try {\n      if (type === 'linear') {\n        const { x0 = 0, y0 = 0, x1 = 0, y1 = 100 } = coordinates;\n        gradient = this.ctx.createLinearGradient(x0, y0, x1, y1);\n      } else if (type === 'radial') {\n        const {\n          x0 = 0,\n          y0 = 0,\n          r0 = 0,\n          x1 = 0,\n          y1 = 0,\n          r1 = 100,\n        } = coordinates;\n        gradient = this.ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);\n      } else {\n        throw new Error(`Unsupported gradient type: ${type}`);\n      }\n\n      colorStops.forEach(stop => {\n        const offset = typeof stop === 'object' ? stop.offset : stop[0];\n        const color = typeof stop === 'object' ? stop.color : stop[1];\n        gradient.addColorStop(offset, color);\n      });\n\n      return gradient;\n    } catch (error) {\n      this.errorHandler('Failed to create gradient', error);\n      return this.currentTheme.primary;\n    }\n  }\n\n  /**\n   * Resize canvas with proper scaling and cleanup\n   * @param {number} width - New width\n   * @param {number} height - New height\n   */\n  resize(width, height) {\n    if (!width || !height || width <= 0 || height <= 0) {\n      this.errorHandler(\n        'Invalid resize dimensions',\n        new Error('Width and height must be positive')\n      );\n      return;\n    }\n\n    try {\n      // Validate against browser limits\n      const maxWidth = Math.min(width, CANVAS_CONSTANTS.MAX_CANVAS_SIZE);\n      const maxHeight = Math.min(height, CANVAS_CONSTANTS.MAX_CANVAS_SIZE);\n\n      this.options.width = maxWidth;\n      this.options.height = maxHeight;\n\n      // Resize canvas\n      this.canvas.width = maxWidth * this.options.pixelRatio;\n      this.canvas.height = maxHeight * this.options.pixelRatio;\n\n      // Reapply scaling and default styles\n      this.ctx.scale(this.options.pixelRatio, this.options.pixelRatio);\n      this.applyDefaultStyles();\n\n      // Trigger resize event for listeners\n      this.canvas.dispatchEvent(\n        new CustomEvent('canvasResize', {\n          detail: { width: maxWidth, height: maxHeight },\n        })\n      );\n\n      // Clear performance metrics on resize\n      this.performanceMonitor.reset();\n      this.drawCallCount = 0;\n    } catch (error) {\n      this.errorHandler('Failed to resize canvas', error);\n    }\n  }\n\n  /**\n   * Get image data with error handling\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Width\n   * @param {number} height - Height\n   * @returns {ImageData|null} Image data or null on error\n   */\n  getImageData(\n    x = 0,\n    y = 0,\n    width = this.options.width,\n    height = this.options.height\n  ) {\n    try {\n      return this.ctx.getImageData(x, y, width, height);\n    } catch (error) {\n      this.errorHandler('Failed to get image data', error);\n      return null;\n    }\n  }\n\n  /**\n   * Put image data with error handling\n   * @param {ImageData} imageData - Image data to put\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   */\n  putImageData(imageData, x = 0, y = 0) {\n    if (!imageData) {\n      this.errorHandler(\n        'Invalid image data',\n        new Error('ImageData is required')\n      );\n      return;\n    }\n\n    try {\n      this.ctx.putImageData(imageData, x, y);\n      this.performanceMonitor.recordDrawCall();\n      this.drawCallCount++;\n    } catch (error) {\n      this.errorHandler('Failed to put image data', error);\n    }\n  }\n\n  /**\n   * Convert canvas to data URL with error handling\n   * @param {string} type - Image type\n   * @param {number} quality - Image quality\n   * @returns {string|null} Data URL or null on error\n   */\n  toDataURL(type = 'image/png', quality = 0.92) {\n    try {\n      return this.canvas.toDataURL(type, quality);\n    } catch (error) {\n      this.errorHandler('Failed to export canvas', error);\n      return null;\n    }\n  }\n\n  /**\n   * Convert canvas to blob with error handling\n   * @param {Function} callback - Callback function\n   * @param {string} type - Image type\n   * @param {number} quality - Image quality\n   */\n  toBlob(callback, type = 'image/png', quality = 0.92) {\n    try {\n      this.canvas.toBlob(callback, type, quality);\n    } catch (error) {\n      this.errorHandler('Failed to create blob', error);\n      callback(null);\n    }\n  }\n\n  /**\n   * Get performance metrics\n   * @returns {Object} Performance metrics\n   */\n  getPerformanceMetrics() {\n    return {\n      ...this.performanceMonitor.getMetrics(),\n      drawCallCount: this.drawCallCount,\n      activeAnimations: this.animations.size,\n      cacheSize: this.imageCache.size,\n      canvasSize: {\n        width: this.options.width,\n        height: this.options.height,\n        pixelRatio: this.options.pixelRatio,\n      },\n    };\n  }\n\n  /**\n   * Clear image cache\n   */\n  clearImageCache() {\n    this.imageCache.clear();\n  }\n\n  /**\n   * Clean up resources and event listeners\n   */\n  destroy() {\n    try {\n      // Stop all animations\n      this.stopAllAnimations();\n\n      // Clear caches\n      this.clearImageCache();\n\n      // Remove event listeners\n      if (this.resizeObserver) {\n        this.resizeObserver.disconnect();\n      } else {\n        window.removeEventListener('resize', this.boundHandleResize);\n      }\n\n      // Cancel any pending animation frames\n      if (this.animationFrameId) {\n        cancelAnimationFrame(this.animationFrameId);\n      }\n\n      // Remove accessibility manager\n      if (this.accessibilityManager) {\n        this.accessibilityManager = null;\n      }\n\n      // Remove canvas from DOM\n      if (this.canvas && this.canvas.parentNode) {\n        this.canvas.parentNode.removeChild(this.canvas);\n      }\n\n      // Clear references\n      this.canvas = null;\n      this.ctx = null;\n      this.container = null;\n      this.layers.clear();\n\n      // Dispatch cleanup event\n      document.dispatchEvent(\n        new CustomEvent('canvasRendererDestroyed', {\n          detail: { rendererId: this.id },\n        })\n      );\n    } catch (error) {\n      this.errorHandler('Error during cleanup', error);\n    }\n  }\n}\n\n// Export for use in other modules\nif (typeof window !== 'undefined') {\n  window.CanvasRenderer = CanvasRenderer;\n}\n\nexport default CanvasRenderer;\n","/**\n * Enhanced SVG Renderer for SimulateAI Platform\n * High-performance, accessible, and modern SVG-based graphics rendering\n *\n * Features:\n * - Vector-based scalable graphics with responsive design\n * - Accessibility integration with ARIA and screen reader support\n * - Theme-aware rendering with dark mode support\n * - Performance monitoring and optimization\n * - Advanced animation system with motion sensitivity\n * - Memory management and cleanup\n * - Security-conscious rendering\n * - Comprehensive error handling\n * - SVG-specific optimizations and capabilities\n *\n * @version 2.0.0\n * @author SimulateAI Team\n * @license Apache-2.0\n */\n\nimport logger from '../utils/logger.js';\n\n// Enhanced constants and configuration\nconst SVG_CONSTANTS = {\n  VERSION: '2.0.0',\n  DEFAULT_WIDTH: 800,\n  DEFAULT_HEIGHT: 600,\n  SVG_NAMESPACE: 'http://www.w3.org/2000/svg',\n  XLINK_NAMESPACE: 'http://www.w3.org/1999/xlink',\n  ANIMATION_FPS: 60,\n  PERFORMANCE_SAMPLE_RATE: 0.1,\n  MAX_ELEMENTS: 10000,\n\n  // Performance monitoring constants\n  PERFORMANCE: {\n    TARGET_FRAME_TIME: 16.67, // 60fps threshold\n    ANIMATION_DURATION_MULTIPLIER: 0.2,\n    MAX_ANIMATION_DURATION: 300,\n  },\n\n  // UI and styling constants\n  UI: {\n    DEFAULT_FONT_SIZE: 14,\n    DEFAULT_PADDING: 4,\n    DEFAULT_BORDER_RADIUS: 4,\n    DEFAULT_SHADOW_OPACITY: 0.5,\n    TITLE_OFFSET: -10,\n    DEFAULT_OBJECT_SIZE: 50,\n    DEFAULT_RADIUS: 25,\n  },\n\n  // ID generation constants\n  ID_GENERATION: {\n    RADIX: 36,\n    SUBSTRING_LENGTH: 9,\n    SUBSTRING_START: 2,\n  },\n\n  // Math and conversion constants\n  MATH: {\n    DEGREES_PER_PI: 180,\n    HALF: 0.5,\n    EASING_THRESHOLD_1: 0.5,\n    EASING_MULTIPLIER: 4,\n    BOUNCE_DIVISOR: 2.75,\n    BOUNCE_COEFFICIENT: 7.5625,\n    BOUNCE_OFFSET_1: 1.5,\n    BOUNCE_OFFSET_2: 2.25,\n    BOUNCE_OFFSET_3: 2.625,\n    BOUNCE_THRESHOLD_1: 0.75,\n    BOUNCE_THRESHOLD_2: 0.9375,\n    BOUNCE_THRESHOLD_3: 0.984375,\n    BOUNCE_MIDPOINT: 2.5,\n    ELASTIC_DIVISOR: 3,\n    ELASTIC_POWER: -10,\n    ELASTIC_OFFSET: 0.75,\n    ELASTIC_MULTIPLIER: 10,\n    PATTERN_SIZE: 5,\n    PATTERN_DOT_RADIUS: 1,\n    PLACEHOLDER_OFFSET: -5,\n    PLACEHOLDER_SIZE: 10,\n  },\n\n  ACCESSIBILITY: {\n    MIN_CONTRAST_RATIO: 4.5,\n    MIN_FONT_SIZE: 12,\n    MIN_TOUCH_TARGET: 44,\n    MIN_STROKE_WIDTH: 1,\n  },\n  THEMES: {\n    LIGHT: {\n      background: '#ffffff',\n      foreground: '#333333',\n      primary: '#007acc',\n      secondary: '#28a745',\n      accent: '#6c757d',\n      border: '#e0e0e0',\n    },\n    DARK: {\n      background: '#1a1a1a',\n      foreground: '#e0e0e0',\n      primary: '#4da6ff',\n      secondary: '#66bb6a',\n      accent: '#9e9e9e',\n      border: '#404040',\n    },\n    HIGH_CONTRAST: {\n      background: '#000000',\n      foreground: '#ffffff',\n      primary: '#ffff00',\n      secondary: '#00ffff',\n      accent: '#ff00ff',\n      border: '#ffffff',\n    },\n  },\n};\n\n/**\n * Performance monitoring for SVG operations\n */\nclass SVGPerformanceMonitor {\n  constructor() {\n    this.metrics = {\n      elementCount: 0,\n      animationCount: 0,\n      renderTime: 0,\n      frameCount: 0,\n      averageFrameTime: 0,\n      droppedFrames: 0,\n      lastFrameTime: 0,\n      domOperations: 0,\n    };\n    this.enabled = SVG_CONSTANTS.PERFORMANCE_SAMPLE_RATE > Math.random();\n  }\n\n  startFrame() {\n    if (!this.enabled) return;\n    this.frameStartTime = performance.now();\n  }\n\n  endFrame() {\n    if (!this.enabled) return;\n\n    const frameTime = performance.now() - this.frameStartTime;\n    this.metrics.frameCount++;\n    this.metrics.renderTime += frameTime;\n    this.metrics.averageFrameTime =\n      this.metrics.renderTime / this.metrics.frameCount;\n\n    if (frameTime > SVG_CONSTANTS.PERFORMANCE.TARGET_FRAME_TIME) {\n      // > 60fps threshold\n      this.metrics.droppedFrames++;\n    }\n\n    this.metrics.lastFrameTime = frameTime;\n  }\n\n  recordDOMOperation() {\n    if (!this.enabled) return;\n    this.metrics.domOperations++;\n  }\n\n  recordElement() {\n    if (!this.enabled) return;\n    this.metrics.elementCount++;\n  }\n\n  getMetrics() {\n    return { ...this.metrics };\n  }\n\n  reset() {\n    Object.keys(this.metrics).forEach(key => {\n      this.metrics[key] = 0;\n    });\n  }\n}\n\n/**\n * SVG accessibility manager with enhanced screen reader support\n */\nclass SVGAccessibilityManager {\n  constructor(svg, renderer) {\n    this.svg = svg;\n    this.renderer = renderer;\n    this.description = '';\n    this.elements = new Map();\n    this.focusedElement = null;\n    this.tabIndex = 0;\n    this.setupAccessibility();\n  }\n\n  setupAccessibility() {\n    // Set up SVG accessibility attributes\n    this.svg.setAttribute('role', 'img');\n    this.svg.setAttribute('tabindex', '0');\n    this.svg.setAttribute('focusable', 'true');\n    this.updateDescription('Interactive simulation SVG graphics');\n\n    // Add keyboard navigation\n    this.svg.addEventListener('keydown', this.handleKeydown.bind(this));\n    this.svg.addEventListener('focus', this.handleFocus.bind(this));\n    this.svg.addEventListener('blur', this.handleBlur.bind(this));\n    this.svg.addEventListener('click', this.handleClick.bind(this));\n  }\n\n  updateDescription(description) {\n    this.description = description;\n    this.svg.setAttribute('aria-label', description);\n\n    // Update or create title element\n    let title = this.svg.querySelector('title');\n    if (!title) {\n      title = document.createElementNS(SVG_CONSTANTS.SVG_NAMESPACE, 'title');\n      this.svg.insertBefore(title, this.svg.firstChild);\n    }\n    title.textContent = description;\n  }\n\n  addElement(id, element) {\n    const elementData = {\n      ...element,\n      id,\n      tabIndex: this.tabIndex++,\n      focusable: element.focusable !== false,\n    };\n\n    this.elements.set(id, elementData);\n\n    // Add accessibility attributes to SVG element\n    if (element.svgElement) {\n      this.enhanceElementAccessibility(element.svgElement, elementData);\n    }\n\n    this.updateDescription();\n  }\n\n  enhanceElementAccessibility(svgElement, elementData) {\n    if (elementData.focusable) {\n      svgElement.setAttribute('tabindex', elementData.tabIndex);\n      svgElement.setAttribute('focusable', 'true');\n    }\n\n    if (elementData.ariaLabel) {\n      svgElement.setAttribute('aria-label', elementData.ariaLabel);\n    }\n\n    if (elementData.role) {\n      svgElement.setAttribute('role', elementData.role);\n    }\n\n    // Add title element for screen readers\n    if (elementData.label || elementData.ariaLabel) {\n      const title = document.createElementNS(\n        SVG_CONSTANTS.SVG_NAMESPACE,\n        'title'\n      );\n      title.textContent = elementData.label || elementData.ariaLabel;\n      svgElement.insertBefore(title, svgElement.firstChild);\n    }\n\n    // Add description if provided\n    if (elementData.description) {\n      const desc = document.createElementNS(\n        SVG_CONSTANTS.SVG_NAMESPACE,\n        'desc'\n      );\n      desc.textContent = elementData.description;\n      svgElement.appendChild(desc);\n    }\n  }\n\n  removeElement(id) {\n    this.elements.delete(id);\n    if (this.focusedElement === id) {\n      this.focusedElement = null;\n    }\n    this.updateDescription();\n  }\n\n  handleKeydown(event) {\n    const focusableElements = Array.from(this.elements.values())\n      .filter(el => el.focusable)\n      .sort((a, b) => a.tabIndex - b.tabIndex);\n\n    if (focusableElements.length === 0) return;\n\n    let currentIndex = focusableElements.findIndex(\n      el => el.id === this.focusedElement\n    );\n\n    switch (event.key) {\n      case 'Tab':\n        event.preventDefault();\n        if (event.shiftKey) {\n          currentIndex =\n            currentIndex <= 0 ? focusableElements.length - 1 : currentIndex - 1;\n        } else {\n          currentIndex =\n            currentIndex >= focusableElements.length - 1 ? 0 : currentIndex + 1;\n        }\n        this.focusElement(focusableElements[currentIndex].id);\n        break;\n\n      case 'Enter':\n      case ' ':\n        if (this.focusedElement) {\n          const element = this.elements.get(this.focusedElement);\n          if (element && element.onClick) {\n            event.preventDefault();\n            element.onClick();\n          }\n        }\n        break;\n\n      case 'Escape':\n        if (this.focusedElement) {\n          this.focusedElement = null;\n          this.svg.focus();\n          this.renderer.requestRender();\n        }\n        break;\n    }\n  }\n\n  handleClick(event) {\n    // Find clicked element\n    const { target } = event;\n    const elementId = this.findElementIdByTarget(target);\n\n    if (elementId) {\n      this.focusElement(elementId);\n      const element = this.elements.get(elementId);\n      if (element && element.onClick) {\n        element.onClick(event);\n      }\n    }\n  }\n\n  findElementIdByTarget(target) {\n    for (const [id, element] of this.elements.entries()) {\n      if (\n        element.svgElement === target ||\n        element.svgElement?.contains(target)\n      ) {\n        return id;\n      }\n    }\n    return null;\n  }\n\n  focusElement(id) {\n    this.focusedElement = id;\n    const element = this.elements.get(id);\n    if (element) {\n      this.announceElement(element);\n      this.highlightFocusedElement(element);\n      this.renderer.requestRender();\n    }\n  }\n\n  highlightFocusedElement(element) {\n    // Remove previous focus indicators\n    this.svg.querySelectorAll('.focus-indicator').forEach(el => el.remove());\n\n    if (element.svgElement) {\n      // Create focus indicator\n      const bbox = element.svgElement.getBBox();\n      const indicator = document.createElementNS(\n        SVG_CONSTANTS.SVG_NAMESPACE,\n        'rect'\n      );\n      indicator.setAttribute('class', 'focus-indicator');\n      indicator.setAttribute('x', bbox.x - 2);\n      indicator.setAttribute('y', bbox.y - 2);\n      indicator.setAttribute(\n        'width',\n        bbox.width + SVG_CONSTANTS.UI.DEFAULT_PADDING\n      );\n      indicator.setAttribute(\n        'height',\n        bbox.height + SVG_CONSTANTS.UI.DEFAULT_PADDING\n      );\n      indicator.setAttribute('fill', 'none');\n      indicator.setAttribute('stroke', '#007acc');\n      indicator.setAttribute('stroke-width', '2');\n      indicator.setAttribute('stroke-dasharray', '4,2');\n      indicator.setAttribute('pointer-events', 'none');\n\n      // Insert after the focused element\n      element.svgElement.parentNode.insertBefore(\n        indicator,\n        element.svgElement.nextSibling\n      );\n    }\n  }\n\n  announceElement(element) {\n    const announcement =\n      element.ariaLabel || element.label || `${element.type} element`;\n    this.announceToScreenReader(announcement);\n  }\n\n  announceToScreenReader(message) {\n    const announcer = document.createElement('div');\n    announcer.setAttribute('aria-live', 'polite');\n    announcer.setAttribute('aria-atomic', 'true');\n    announcer.style.position = 'absolute';\n    announcer.style.left = '-10000px';\n    announcer.style.width = '1px';\n    announcer.style.height = '1px';\n    announcer.style.overflow = 'hidden';\n\n    document.body.appendChild(announcer);\n    announcer.textContent = message;\n\n    setTimeout(() => {\n      document.body.removeChild(announcer);\n    }, 1000);\n  }\n\n  handleFocus() {\n    this.svg.style.outline = '2px solid #007acc';\n  }\n\n  handleBlur() {\n    this.svg.style.outline = 'none';\n    this.focusedElement = null;\n    this.svg.querySelectorAll('.focus-indicator').forEach(el => el.remove());\n  }\n\n  generateOverallDescription() {\n    const elementTypes = new Map();\n    for (const element of this.elements.values()) {\n      const count = elementTypes.get(element.type) || 0;\n      elementTypes.set(element.type, count + 1);\n    }\n\n    const descriptions = Array.from(elementTypes.entries())\n      .map(([type, count]) => `${count} ${type}${count > 1 ? 's' : ''}`)\n      .join(', ');\n\n    return `SVG contains ${descriptions}`;\n  }\n}\n\n/**\n * Enhanced SVG Renderer with modern features\n */\n\nclass SVGRenderer {\n  /**\n   * Create an enhanced SVG renderer\n   * @param {HTMLElement} container - Container element\n   * @param {Object} options - Renderer options\n   */\n  constructor(container, options = {}) {\n    this.container = container;\n    this.options = {\n      width: options.width || SVG_CONSTANTS.DEFAULT_WIDTH,\n      height: options.height || SVG_CONSTANTS.DEFAULT_HEIGHT,\n      preserveAspectRatio: options.preserveAspectRatio || 'xMidYMid meet',\n      theme: options.theme || 'light',\n      enableAccessibility: options.enableAccessibility !== false,\n      enablePerformanceMonitoring:\n        options.enablePerformanceMonitoring !== false,\n      respectReducedMotion: options.respectReducedMotion !== false,\n      maxElements: options.maxElements || SVG_CONSTANTS.MAX_ELEMENTS,\n      ...options,\n    };\n\n    // Core SVG properties\n    this.svg = null;\n    this.defs = null;\n    this.mainGroup = null;\n    this.layers = new Map();\n    this.animations = new Set();\n    this.elementCount = 0;\n    this.renderRequested = false;\n\n    // Enhanced features\n    this.performanceMonitor = new SVGPerformanceMonitor();\n    this.accessibilityManager = null;\n    this.currentTheme =\n      SVG_CONSTANTS.THEMES[this.options.theme.toUpperCase()] ||\n      SVG_CONSTANTS.THEMES.LIGHT;\n    this.gradientCache = new Map();\n    this.patternCache = new Map();\n\n    // Responsive handling\n    this.resizeObserver = null;\n    this.boundHandleResize = this.handleResize.bind(this);\n\n    // Animation frame handling\n    this.animationFrameId = null;\n    this.lastFrameTime = 0;\n\n    // Error handling\n    this.errorHandler =\n      options.errorHandler || this.defaultErrorHandler.bind(this);\n\n    // Initialize\n    try {\n      this.initialize();\n    } catch (error) {\n      this.errorHandler('Initialization failed', error);\n    }\n  }\n\n  /**\n   * Initialize the SVG renderer with enhanced features\n   */\n  initialize() {\n    this.validateContainer();\n    this.createSVG();\n    this.setupStructure();\n    this.setupAccessibility();\n    this.setupResponsiveHandling();\n    this.setupThemeMonitoring();\n    this.addDefaultStyles();\n  }\n\n  /**\n   * Validate container element\n   */\n  validateContainer() {\n    if (!this.container || !this.container.nodeType) {\n      throw new Error('Invalid container element provided');\n    }\n  }\n\n  /**\n   * Create and configure SVG element\n   */\n  createSVG() {\n    this.svg = this.createSVGElement('svg', {\n      width: '100%',\n      height: '100%',\n      viewBox: `0 0 ${this.options.width} ${this.options.height}`,\n      preserveAspectRatio: this.options.preserveAspectRatio,\n      role: 'img',\n      'aria-label': 'Interactive simulation graphics',\n      class: 'svg-renderer',\n      'data-theme': this.options.theme,\n      'data-version': SVG_CONSTANTS.VERSION,\n    });\n\n    this.container.appendChild(this.svg);\n  }\n\n  /**\n   * Setup SVG structure with defs and main group\n   */\n  setupStructure() {\n    // Create defs for reusable elements\n    this.defs = this.createSVGElement('defs');\n    this.svg.appendChild(this.defs);\n\n    // Create main group for all content\n    this.mainGroup = this.createSVGElement('g', {\n      class: 'main-group',\n    });\n    this.svg.appendChild(this.mainGroup);\n  }\n\n  /**\n   * Setup accessibility features\n   */\n  setupAccessibility() {\n    if (this.options.enableAccessibility) {\n      this.accessibilityManager = new SVGAccessibilityManager(this.svg, this);\n    }\n  }\n\n  /**\n   * Setup responsive SVG handling\n   */\n  setupResponsiveHandling() {\n    if (window.ResizeObserver) {\n      this.resizeObserver = new ResizeObserver(this.boundHandleResize);\n      this.resizeObserver.observe(this.container);\n    } else {\n      window.addEventListener('resize', this.boundHandleResize);\n    }\n  }\n\n  /**\n   * Setup theme change monitoring\n   */\n  setupThemeMonitoring() {\n    if (window.matchMedia) {\n      const contrastQuery = window.matchMedia('(prefers-contrast: high)');\n\n      const updateTheme = () => {\n        let newTheme = 'light';\n        if (contrastQuery.matches) {\n          newTheme = 'high_contrast';\n        }\n        this.setTheme(newTheme);\n      };\n\n      contrastQuery.addEventListener('change', updateTheme);\n\n      // Initial theme detection\n      updateTheme();\n    }\n  }\n\n  /**\n   * Handle container resize\n   */\n  handleResize(entries) {\n    if (entries && entries[0]) {\n      const { width, height } = entries[0].contentRect;\n      this.resize(width, height);\n    } else {\n      // Fallback for non-ResizeObserver browsers\n      const rect = this.container.getBoundingClientRect();\n      this.resize(rect.width, rect.height);\n    }\n  }\n\n  /**\n   * Set theme with automatic style updates\n   * @param {string} themeName - Theme name ('light', 'dark', 'high_contrast')\n   */\n  setTheme(themeName) {\n    const theme = SVG_CONSTANTS.THEMES[themeName.toUpperCase()];\n    if (theme && theme !== this.currentTheme) {\n      this.currentTheme = theme;\n      this.options.theme = themeName;\n      this.svg.setAttribute('data-theme', themeName);\n      this.updateThemeStyles();\n      this.requestRender();\n    }\n  }\n\n  /**\n   * Update theme-specific styles\n   */\n  updateThemeStyles() {\n    // Update existing theme-dependent elements\n    this.svg.querySelectorAll('[data-theme-color]').forEach(element => {\n      const colorType = element.getAttribute('data-theme-color');\n      const colorValue = this.currentTheme[colorType];\n      if (colorValue) {\n        const attribute =\n          element.getAttribute('data-theme-attribute') || 'fill';\n        element.setAttribute(attribute, colorValue);\n      }\n    });\n  }\n\n  /**\n   * Request render frame with performance monitoring\n   */\n  requestRender() {\n    if (this.renderRequested) return;\n\n    this.renderRequested = true;\n    this.animationFrameId = requestAnimationFrame(timestamp => {\n      this.performanceMonitor.startFrame();\n      this.renderRequested = false;\n      this.lastFrameTime = timestamp;\n      this.performanceMonitor.endFrame();\n    });\n  }\n\n  /**\n   * Default error handler\n   */\n  defaultErrorHandler(message, error) {\n    logger.error(`SVGRenderer Error: ${message}`, error);\n\n    if (this.options.enableAccessibility && this.accessibilityManager) {\n      this.accessibilityManager.announceToScreenReader(\n        `Rendering error: ${message}`\n      );\n    }\n  }\n  // Enhanced SVG element creation and styling methods\n\n  /**\n   * Create SVG element with enhanced error handling and accessibility\n   * @param {string} tagName - SVG element tag name\n   * @param {Object} attributes - Element attributes\n   * @returns {SVGElement} Created SVG element\n   */\n  createSVGElement(tagName, attributes = {}) {\n    try {\n      const element = document.createElementNS(\n        SVG_CONSTANTS.SVG_NAMESPACE,\n        tagName\n      );\n\n      Object.entries(attributes).forEach(([key, value]) => {\n        if (value !== null && value !== undefined) {\n          element.setAttribute(key, value);\n        }\n      });\n\n      this.performanceMonitor.recordDOMOperation();\n      return element;\n    } catch (error) {\n      this.errorHandler(`Failed to create SVG element: ${tagName}`, error);\n      return null;\n    }\n  }\n\n  /**\n   * Add comprehensive default styles with theme support\n   */\n  addDefaultStyles() {\n    const style = this.createSVGElement('style');\n    if (!style) return;\n\n    style.textContent = `\n      .svg-renderer {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, system-ui, sans-serif;\n        overflow: hidden;\n      }\n      \n      .svg-renderer[data-theme=\"light\"] {\n        background: ${this.currentTheme.background};\n        color: ${this.currentTheme.foreground};\n      }\n      \n      .svg-renderer[data-theme=\"high_contrast\"] {\n        background: ${SVG_CONSTANTS.THEMES.HIGH_CONTRAST.background};\n        color: ${SVG_CONSTANTS.THEMES.HIGH_CONTRAST.foreground};\n      }\n      \n      .clickable {\n        cursor: pointer;\n        transition: opacity 0.2s ease;\n      }\n      \n      .clickable:hover:not([aria-disabled=\"true\"]) {\n        opacity: 0.8;\n      }\n      \n      .clickable:focus {\n        outline: 2px solid #007acc;\n        outline-offset: 2px;\n      }\n      \n      .animated {\n        transition: all 0.3s ease;\n      }\n      \n      @media (prefers-reduced-motion: reduce) {\n        .animated {\n          transition: none;\n        }\n      }\n      \n      .text-element {\n        user-select: none;\n        pointer-events: none;\n        font-size: ${Math.max(SVG_CONSTANTS.UI.DEFAULT_FONT_SIZE, SVG_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE)}px;\n      }\n      \n      .interactive {\n        pointer-events: all;\n      }\n      \n      .accessible-element {\n        outline: none;\n      }\n      \n      .accessible-element:focus {\n        outline: 2px solid #007acc;\n        outline-offset: 1px;\n      }\n      \n      .focus-indicator {\n        animation: focus-pulse 2s infinite;\n      }\n      \n      @keyframes focus-pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n      \n      .screen-reader-only {\n        position: absolute;\n        width: 1px;\n        height: 1px;\n        padding: 0;\n        margin: -1px;\n        overflow: hidden;\n        clip: rect(0, 0, 0, 0);\n        white-space: nowrap;\n        border: 0;\n      }\n    `;\n\n    this.defs.appendChild(style);\n  }\n\n  /**\n   * Create layer with enhanced features\n   * @param {string} name - Layer name\n   * @param {number} zIndex - Layer z-index\n   * @param {Object} options - Layer options\n   * @returns {SVGElement} Created layer element\n   */\n  createLayer(name, zIndex = 0, options = {}) {\n    const layer = this.createSVGElement('g', {\n      class: `layer layer-${name} ${options.className || ''}`,\n      'data-layer': name,\n      'data-z-index': zIndex,\n      transform: options.transform || '',\n      opacity: options.opacity || 1,\n    });\n\n    if (!layer) return null;\n\n    // Insert layer in correct z-order\n    const existingLayers = Array.from(this.mainGroup.children)\n      .filter(child => child.hasAttribute('data-layer'))\n      .sort((a, b) => {\n        const aZ = parseInt(a.getAttribute('data-z-index') || '0');\n        const bZ = parseInt(b.getAttribute('data-z-index') || '0');\n        return aZ - bZ;\n      });\n\n    let insertBefore = null;\n    for (const existingLayer of existingLayers) {\n      const existingZ = parseInt(\n        existingLayer.getAttribute('data-z-index') || '0'\n      );\n      if (existingZ > zIndex) {\n        insertBefore = existingLayer;\n        break;\n      }\n    }\n\n    if (insertBefore) {\n      this.mainGroup.insertBefore(layer, insertBefore);\n    } else {\n      this.mainGroup.appendChild(layer);\n    }\n\n    this.layers.set(name, layer);\n    this.performanceMonitor.recordElement();\n\n    return layer;\n  }\n\n  /**\n   * Get layer by name or create if it doesn't exist\n   * @param {string} name - Layer name\n   * @returns {SVGElement} Layer element\n   */\n  getLayer(name) {\n    return this.layers.get(name) || this.createLayer(name);\n  }\n  // Enhanced shape creation methods with accessibility and theme support\n\n  /**\n   * Create accessible rectangle with theme awareness\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Rectangle width\n   * @param {number} height - Rectangle height\n   * @param {Object} options - Drawing options\n   * @returns {SVGElement} Rectangle element\n   */\n  createRect(x, y, width, height, options = {}) {\n    if (this.elementCount >= this.options.maxElements) {\n      this.errorHandler(\n        'Maximum element count exceeded',\n        new Error('Performance limit')\n      );\n      return null;\n    }\n\n    try {\n      // Apply theme-aware defaults\n      const fill =\n        options.fill ||\n        (options.primary ? this.currentTheme.primary : 'transparent');\n      const stroke =\n        options.stroke || (options.border ? this.currentTheme.border : 'none');\n\n      // Accessibility: Ensure minimum size for interactive elements\n      if (\n        options.interactive &&\n        (width < SVG_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET ||\n          height < SVG_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET)\n      ) {\n        logger.warn('Interactive element below minimum touch target size');\n      }\n\n      const rect = this.createSVGElement('rect', {\n        x,\n        y,\n        width,\n        height,\n        fill,\n        stroke,\n        'stroke-width':\n          options.strokeWidth ||\n          (stroke !== 'none'\n            ? SVG_CONSTANTS.ACCESSIBILITY.MIN_STROKE_WIDTH\n            : 0),\n        rx: options.borderRadius || 0,\n        ry: options.borderRadius || 0,\n        class: `rect-element ${options.className || ''} ${options.interactive ? 'interactive clickable accessible-element' : ''}`,\n        'data-theme-color': options.themeColor,\n        'data-theme-attribute': options.themeAttribute || 'fill',\n        ...options.attributes,\n      });\n\n      if (!rect) return null;\n\n      // Register with accessibility manager\n      if (options.interactive && this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `rect_${this.elementCount}`,\n          {\n            type: 'rectangle',\n            svgElement: rect,\n            x,\n            y,\n            width,\n            height,\n            label: options.label,\n            ariaLabel: options.ariaLabel,\n            description: options.description,\n            onClick: options.onClick,\n            focusable: options.focusable !== false,\n            role: options.role || 'button',\n          }\n        );\n      }\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return rect;\n    } catch (error) {\n      this.errorHandler('Failed to create rectangle', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create accessible circle with theme awareness\n   * @param {number} cx - Center X coordinate\n   * @param {number} cy - Center Y coordinate\n   * @param {number} radius - Circle radius\n   * @param {Object} options - Drawing options\n   * @returns {SVGElement} Circle element\n   */\n  createCircle(cx, cy, radius, options = {}) {\n    if (this.elementCount >= this.options.maxElements) {\n      this.errorHandler(\n        'Maximum element count exceeded',\n        new Error('Performance limit')\n      );\n      return null;\n    }\n\n    try {\n      // Apply theme-aware defaults\n      const fill =\n        options.fill ||\n        (options.primary ? this.currentTheme.primary : 'transparent');\n      const stroke =\n        options.stroke || (options.border ? this.currentTheme.border : 'none');\n\n      // Accessibility: Ensure minimum size for interactive elements\n      const diameter = radius * 2;\n      if (\n        options.interactive &&\n        diameter < SVG_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET\n      ) {\n        logger.warn('Interactive circle below minimum touch target size');\n      }\n\n      const circle = this.createSVGElement('circle', {\n        cx,\n        cy,\n        r: radius,\n        fill,\n        stroke,\n        'stroke-width':\n          options.strokeWidth ||\n          (stroke !== 'none'\n            ? SVG_CONSTANTS.ACCESSIBILITY.MIN_STROKE_WIDTH\n            : 0),\n        class: `circle-element ${options.className || ''} ${options.interactive ? 'interactive clickable accessible-element' : ''}`,\n        'data-theme-color': options.themeColor,\n        'data-theme-attribute': options.themeAttribute || 'fill',\n        ...options.attributes,\n      });\n\n      if (!circle) return null;\n\n      // Register with accessibility manager\n      if (options.interactive && this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `circle_${this.elementCount}`,\n          {\n            type: 'circle',\n            svgElement: circle,\n            x: cx - radius,\n            y: cy - radius,\n            width: diameter,\n            height: diameter,\n            label: options.label,\n            ariaLabel: options.ariaLabel,\n            description: options.description,\n            onClick: options.onClick,\n            focusable: options.focusable !== false,\n            role: options.role || 'button',\n          }\n        );\n      }\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return circle;\n    } catch (error) {\n      this.errorHandler('Failed to create circle', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create accessible line with enhanced styling\n   * @param {number} x1 - Start X coordinate\n   * @param {number} y1 - Start Y coordinate\n   * @param {number} x2 - End X coordinate\n   * @param {number} y2 - End Y coordinate\n   * @param {Object} options - Drawing options\n   * @returns {SVGElement} Line element\n   */\n  createLine(x1, y1, x2, y2, options = {}) {\n    if (this.elementCount >= this.options.maxElements) {\n      this.errorHandler(\n        'Maximum element count exceeded',\n        new Error('Performance limit')\n      );\n      return null;\n    }\n\n    try {\n      const stroke = options.stroke || this.currentTheme.foreground;\n\n      const line = this.createSVGElement('line', {\n        x1,\n        y1,\n        x2,\n        y2,\n        stroke,\n        'stroke-width': Math.max(\n          options.strokeWidth || 1,\n          SVG_CONSTANTS.ACCESSIBILITY.MIN_STROKE_WIDTH\n        ),\n        'stroke-linecap': options.linecap || 'round',\n        'stroke-linejoin': options.linejoin || 'round',\n        'stroke-dasharray': options.dashArray,\n        'stroke-dashoffset': options.dashOffset,\n        class: `line-element ${options.className || ''}`,\n        'data-theme-color': options.themeColor,\n        'data-theme-attribute': 'stroke',\n        ...options.attributes,\n      });\n\n      if (!line) return null;\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return line;\n    } catch (error) {\n      this.errorHandler('Failed to create line', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create accessible path with enhanced features\n   * @param {string} pathData - SVG path data\n   * @param {Object} options - Drawing options\n   * @returns {SVGElement} Path element\n   */\n  createPath(pathData, options = {}) {\n    if (this.elementCount >= this.options.maxElements) {\n      this.errorHandler(\n        'Maximum element count exceeded',\n        new Error('Performance limit')\n      );\n      return null;\n    }\n\n    try {\n      const fill = options.fill || 'none';\n      const stroke = options.stroke || this.currentTheme.foreground;\n\n      const path = this.createSVGElement('path', {\n        d: pathData,\n        fill,\n        stroke,\n        'stroke-width':\n          options.strokeWidth ||\n          (stroke !== 'none'\n            ? SVG_CONSTANTS.ACCESSIBILITY.MIN_STROKE_WIDTH\n            : 0),\n        'stroke-linecap': options.linecap || 'round',\n        'stroke-linejoin': options.linejoin || 'round',\n        'stroke-dasharray': options.dashArray,\n        'stroke-dashoffset': options.dashOffset,\n        'fill-rule': options.fillRule || 'evenodd',\n        class: `path-element ${options.className || ''} ${options.interactive ? 'interactive clickable accessible-element' : ''}`,\n        'data-theme-color': options.themeColor,\n        'data-theme-attribute': options.themeAttribute || 'stroke',\n        ...options.attributes,\n      });\n\n      if (!path) return null;\n\n      // Register with accessibility manager if interactive\n      if (options.interactive && this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `path_${this.elementCount}`,\n          {\n            type: 'path',\n            svgElement: path,\n            label: options.label,\n            ariaLabel: options.ariaLabel,\n            description: options.description,\n            onClick: options.onClick,\n            focusable: options.focusable !== false,\n            role: options.role || 'button',\n          }\n        );\n      }\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return path;\n    } catch (error) {\n      this.errorHandler('Failed to create path', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create accessible text with enhanced typography\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {string} text - Text content\n   * @param {Object} options - Text options\n   * @returns {SVGElement} Text element\n   */\n  createText(x, y, text, options = {}) {\n    if (this.elementCount >= this.options.maxElements) {\n      this.errorHandler(\n        'Maximum element count exceeded',\n        new Error('Performance limit')\n      );\n      return null;\n    }\n\n    try {\n      // Accessibility: Ensure minimum font size\n      const fontSize = Math.max(\n        parseFloat(options.fontSize) || SVG_CONSTANTS.UI.DEFAULT_FONT_SIZE,\n        SVG_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE\n      );\n\n      const fill =\n        options.fill || options.color || this.currentTheme.foreground;\n\n      const textElement = this.createSVGElement('text', {\n        x,\n        y,\n        'text-anchor': options.textAnchor || 'start',\n        'dominant-baseline': options.dominantBaseline || 'middle',\n        'font-size': fontSize,\n        'font-family': options.fontFamily || 'inherit',\n        'font-weight': options.fontWeight || 'normal',\n        'font-style': options.fontStyle || 'normal',\n        'text-decoration': options.textDecoration,\n        fill,\n        stroke: options.stroke,\n        'stroke-width': options.strokeWidth || 0,\n        'letter-spacing': options.letterSpacing,\n        'word-spacing': options.wordSpacing,\n        class: `text-element ${options.className || ''} ${options.accessible ? 'accessible-element' : ''}`,\n        'data-theme-color': options.themeColor,\n        'data-theme-attribute': 'fill',\n        ...options.attributes,\n      });\n\n      if (!textElement) return null;\n\n      textElement.textContent = text;\n\n      // Add text shadow for better readability if specified\n      if (options.shadow) {\n        const filter = this.createTextShadowFilter(options.shadow);\n        if (filter) {\n          textElement.setAttribute('filter', `url(#${filter.id})`);\n        }\n      }\n\n      // Register with accessibility manager\n      if (options.accessible && this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `text_${this.elementCount}`,\n          {\n            type: 'text',\n            svgElement: textElement,\n            x,\n            y,\n            width: textElement.getBBox ? textElement.getBBox().width : 0,\n            height: fontSize,\n            text,\n            label: options.label || text,\n            ariaLabel: options.ariaLabel || text,\n            description: options.description,\n          }\n        );\n      }\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return textElement;\n    } catch (error) {\n      this.errorHandler('Failed to create text', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create group element with enhanced features\n   * @param {Object} options - Group options\n   * @returns {SVGElement} Group element\n   */\n  createGroup(options = {}) {\n    try {\n      const group = this.createSVGElement('g', {\n        class: `group-element ${options.className || ''}`,\n        transform: options.transform || '',\n        opacity: options.opacity || 1,\n        'data-group-id': options.id,\n        ...options.attributes,\n      });\n\n      if (!group) return null;\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return group;\n    } catch (error) {\n      this.errorHandler('Failed to create group', error);\n      return null;\n    }\n  }\n  // Advanced utility methods\n\n  /**\n   * Create text shadow filter for better readability\n   * @param {Object} shadow - Shadow configuration\n   * @returns {SVGElement} Filter element\n   */\n  createTextShadowFilter(shadow) {\n    try {\n      const filterId = `text-shadow-${Math.random().toString(SVG_CONSTANTS.ID_GENERATION.RADIX).substr(SVG_CONSTANTS.ID_GENERATION.SUBSTRING_START, SVG_CONSTANTS.ID_GENERATION.SUBSTRING_LENGTH)}`;\n      const filter = this.createSVGElement('filter', {\n        id: filterId,\n        x: '-50%',\n        y: '-50%',\n        width: '200%',\n        height: '200%',\n      });\n\n      const dropShadow = this.createSVGElement('feDropShadow', {\n        dx: shadow.offsetX || 1,\n        dy: shadow.offsetY || 1,\n        'std-deviation': shadow.blur || 1,\n        'flood-color': shadow.color || 'rgba(0,0,0,0.5)',\n        'flood-opacity':\n          shadow.opacity || SVG_CONSTANTS.UI.DEFAULT_SHADOW_OPACITY,\n      });\n\n      filter.appendChild(dropShadow);\n      this.defs.appendChild(filter);\n      return filter;\n    } catch (error) {\n      this.errorHandler('Failed to create text shadow filter', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create gradient with theme awareness\n   * @param {string} type - Gradient type ('linear' or 'radial')\n   * @param {Array} colorStops - Array of color stops\n   * @param {Object} coordinates - Gradient coordinates\n   * @param {string} id - Optional gradient ID\n   * @returns {SVGElement} Gradient element\n   */\n  createGradient(type, colorStops, coordinates, id) {\n    try {\n      const gradientId =\n        id ||\n        `gradient-${Math.random().toString(SVG_CONSTANTS.ID_GENERATION.RADIX).substr(SVG_CONSTANTS.ID_GENERATION.SUBSTRING_START, SVG_CONSTANTS.ID_GENERATION.SUBSTRING_LENGTH)}`;\n\n      // Check cache first\n      if (this.gradientCache.has(gradientId)) {\n        return this.gradientCache.get(gradientId);\n      }\n\n      let gradient;\n      if (type === 'linear') {\n        gradient = this.createSVGElement('linearGradient', {\n          id: gradientId,\n          x1: coordinates.x1 || '0%',\n          y1: coordinates.y1 || '0%',\n          x2: coordinates.x2 || '100%',\n          y2: coordinates.y2 || '0%',\n        });\n      } else if (type === 'radial') {\n        gradient = this.createSVGElement('radialGradient', {\n          id: gradientId,\n          cx: coordinates.cx || '50%',\n          cy: coordinates.cy || '50%',\n          r: coordinates.r || '50%',\n          fx: coordinates.fx || coordinates.cx || '50%',\n          fy: coordinates.fy || coordinates.cy || '50%',\n        });\n      } else {\n        throw new Error(`Unsupported gradient type: ${type}`);\n      }\n\n      if (!gradient) return null;\n\n      colorStops.forEach(stop => {\n        const offset = typeof stop === 'object' ? stop.offset : stop[0];\n        const color = typeof stop === 'object' ? stop.color : stop[1];\n        const opacity = typeof stop === 'object' ? stop.opacity : undefined;\n\n        const stopElement = this.createSVGElement('stop', {\n          offset: typeof offset === 'number' ? `${offset * 100}%` : offset,\n          'stop-color': color,\n          'stop-opacity': opacity,\n        });\n\n        gradient.appendChild(stopElement);\n      });\n\n      this.defs.appendChild(gradient);\n      this.gradientCache.set(gradientId, gradient);\n      return gradient;\n    } catch (error) {\n      this.errorHandler('Failed to create gradient', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create accessible button with enhanced features\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Button width\n   * @param {number} height - Button height\n   * @param {string} text - Button text\n   * @param {Function} onClick - Click handler\n   * @param {Object} options - Button options\n   * @returns {SVGElement} Button group element\n   */\n  createButton(x, y, width, height, text, onClick, options = {}) {\n    try {\n      // Ensure minimum touch target size\n      const adjustedWidth = Math.max(\n        width,\n        SVG_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET\n      );\n      const adjustedHeight = Math.max(\n        height,\n        SVG_CONSTANTS.ACCESSIBILITY.MIN_TOUCH_TARGET\n      );\n\n      const button = this.createGroup({\n        className: 'svg-button clickable interactive accessible-element',\n        transform: `translate(${x}, ${y})`,\n        id: options.id,\n      });\n\n      if (!button) return null;\n\n      // Create button background\n      const background = this.createRect(0, 0, adjustedWidth, adjustedHeight, {\n        fill: options.backgroundColor || this.currentTheme.primary,\n        stroke: options.borderColor || this.currentTheme.border,\n        strokeWidth: 1,\n        borderRadius:\n          options.borderRadius || SVG_CONSTANTS.UI.DEFAULT_BORDER_RADIUS,\n        themeColor: 'primary',\n        className: 'button-background',\n      });\n\n      // Create button text\n      const textElement = this.createText(\n        adjustedWidth / 2,\n        adjustedHeight / 2,\n        text,\n        {\n          textAnchor: 'middle',\n          dominantBaseline: 'middle',\n          fill: options.textColor || '#ffffff',\n          fontSize: Math.max(\n            options.fontSize || SVG_CONSTANTS.UI.DEFAULT_FONT_SIZE,\n            SVG_CONSTANTS.ACCESSIBILITY.MIN_FONT_SIZE\n          ),\n          fontWeight: options.fontWeight || '500',\n          className: 'button-text',\n          accessible: true,\n        }\n      );\n\n      if (background) button.appendChild(background);\n      if (textElement) button.appendChild(textElement);\n\n      // Add event handlers\n      if (onClick) {\n        button.addEventListener('click', onClick);\n        button.addEventListener('keydown', e => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            onClick(e);\n          }\n        });\n      }\n\n      // Set accessibility attributes\n      button.setAttribute('tabindex', '0');\n      button.setAttribute('role', 'button');\n      button.setAttribute('aria-label', options.ariaLabel || text);\n\n      if (options.disabled) {\n        button.setAttribute('aria-disabled', 'true');\n        button.style.opacity = '0.5';\n        button.style.cursor = 'not-allowed';\n      }\n\n      // Register with accessibility manager\n      if (this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `button_${this.elementCount}`,\n          {\n            type: 'button',\n            svgElement: button,\n            x,\n            y,\n            width: adjustedWidth,\n            height: adjustedHeight,\n            text,\n            label: options.label || text,\n            ariaLabel: options.ariaLabel || text,\n            description: options.description,\n            onClick,\n            focusable: !options.disabled,\n            role: 'button',\n          }\n        );\n      }\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return button;\n    } catch (error) {\n      this.errorHandler('Failed to create button', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create accessible chart container\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} width - Chart width\n   * @param {number} height - Chart height\n   * @param {Object} options - Chart options\n   * @returns {SVGElement} Chart group element\n   */\n  createChart(x, y, width, height, options = {}) {\n    try {\n      const chart = this.createGroup({\n        className: 'svg-chart accessible-element',\n        transform: `translate(${x}, ${y})`,\n        id: options.id,\n      });\n\n      if (!chart) return null;\n\n      // Create chart background\n      if (options.backgroundColor !== false) {\n        const background = this.createRect(0, 0, width, height, {\n          fill: options.backgroundColor || this.currentTheme.background,\n          stroke: options.borderColor || this.currentTheme.border,\n          strokeWidth: options.borderWidth || 1,\n          className: 'chart-background',\n        });\n\n        if (background) chart.appendChild(background);\n      }\n\n      // Add chart title if provided\n      if (options.title) {\n        const title = this.createText(\n          width / 2,\n          SVG_CONSTANTS.UI.TITLE_OFFSET,\n          options.title,\n          {\n            textAnchor: 'middle',\n            fill: this.currentTheme.foreground,\n            fontSize: 16,\n            fontWeight: 'bold',\n            className: 'chart-title',\n            accessible: true,\n          }\n        );\n\n        if (title) chart.appendChild(title);\n      }\n\n      // Register with accessibility manager\n      if (this.accessibilityManager) {\n        this.accessibilityManager.addElement(\n          options.id || `chart_${this.elementCount}`,\n          {\n            type: 'chart',\n            svgElement: chart,\n            x,\n            y,\n            width,\n            height,\n            label: options.label || options.title || 'Chart',\n            ariaLabel: options.ariaLabel || `${options.type || 'Data'} chart`,\n            description:\n              options.description || 'Interactive data visualization',\n          }\n        );\n      }\n\n      this.elementCount++;\n      this.performanceMonitor.recordElement();\n      return chart;\n    } catch (error) {\n      this.errorHandler('Failed to create chart', error);\n      return null;\n    }\n  }\n\n  /**\n   * Create pattern for fills and strokes\n   * @param {string} type - Pattern type ('dots', 'lines', 'grid', etc.)\n   * @param {Object} options - Pattern options\n   * @param {string} id - Optional pattern ID\n   * @returns {SVGElement} Pattern element\n   */\n  createPattern(type, options = {}, id) {\n    try {\n      const patternId =\n        id ||\n        `pattern-${type}-${Math.random().toString(SVG_CONSTANTS.ID_GENERATION.RADIX).substr(SVG_CONSTANTS.ID_GENERATION.SUBSTRING_START, SVG_CONSTANTS.ID_GENERATION.SUBSTRING_LENGTH)}`;\n\n      // Check cache first\n      if (this.patternCache.has(patternId)) {\n        return this.patternCache.get(patternId);\n      }\n\n      const pattern = this.createSVGElement('pattern', {\n        id: patternId,\n        patternUnits: 'userSpaceOnUse',\n        width: options.width || 10,\n        height: options.height || 10,\n      });\n\n      if (!pattern) return null;\n\n      const color = options.color || this.currentTheme.accent;\n      const strokeWidth = options.strokeWidth || 1;\n\n      switch (type) {\n        case 'dots': {\n          const dot = this.createCircle(\n            SVG_CONSTANTS.MATH.PATTERN_SIZE,\n            SVG_CONSTANTS.MATH.PATTERN_SIZE,\n            SVG_CONSTANTS.MATH.PATTERN_DOT_RADIUS,\n            {\n              fill: color,\n            }\n          );\n          if (dot) pattern.appendChild(dot);\n          break;\n        }\n\n        case 'lines': {\n          const line = this.createLine(0, 0, 0, 10, {\n            stroke: color,\n            strokeWidth,\n          });\n          if (line) pattern.appendChild(line);\n          break;\n        }\n\n        case 'grid': {\n          const vLine = this.createLine(0, 0, 0, 10, {\n            stroke: color,\n            strokeWidth,\n          });\n          const hLine = this.createLine(0, 0, 10, 0, {\n            stroke: color,\n            strokeWidth,\n          });\n          if (vLine) pattern.appendChild(vLine);\n          if (hLine) pattern.appendChild(hLine);\n          break;\n        }\n\n        case 'diagonal': {\n          const diagLine = this.createLine(0, 10, 10, 0, {\n            stroke: color,\n            strokeWidth,\n          });\n          if (diagLine) pattern.appendChild(diagLine);\n          break;\n        }\n\n        default:\n          logger.warn(`Unknown pattern type: ${type}`);\n      }\n\n      this.defs.appendChild(pattern);\n      this.patternCache.set(patternId, pattern);\n      return pattern;\n    } catch (error) {\n      this.errorHandler('Failed to create pattern', error);\n      return null;\n    }\n  }\n  // Enhanced animation system with motion sensitivity and performance optimization\n\n  /**\n   * Create accessible animation with motion sensitivity support\n   * @param {SVGElement} element - Element to animate\n   * @param {Object} properties - Properties to animate\n   * @param {number} duration - Animation duration in milliseconds\n   * @param {string} easing - Easing function name\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID for control\n   */\n  animate(element, properties, duration = 1000, easing = 'ease', options = {}) {\n    if (!element) {\n      this.errorHandler(\n        'Invalid element for animation',\n        new Error('Element is required')\n      );\n      return null;\n    }\n\n    // Respect user's motion preferences\n    if (\n      this.options.respectReducedMotion &&\n      window.matchMedia &&\n      window.matchMedia('(prefers-reduced-motion: reduce)').matches\n    ) {\n      // Skip animation for motion-sensitive users\n      if (options.skipOnReducedMotion !== false) {\n        this.applyFinalAnimationState(element, properties);\n        return null;\n      }\n\n      // Reduce animation duration for motion-sensitive users\n      duration = Math.min(\n        duration * SVG_CONSTANTS.PERFORMANCE.ANIMATION_DURATION_MULTIPLIER,\n        SVG_CONSTANTS.PERFORMANCE.MAX_ANIMATION_DURATION\n      );\n    }\n\n    const animation = {\n      element,\n      properties,\n      duration,\n      easing,\n      startTime: performance.now(),\n      startValues: {},\n      id: Math.random()\n        .toString(SVG_CONSTANTS.ID_GENERATION.RADIX)\n        .substr(\n          SVG_CONSTANTS.ID_GENERATION.SUBSTRING_START,\n          SVG_CONSTANTS.ID_GENERATION.SUBSTRING_LENGTH\n        ),\n      onComplete: options.onComplete,\n      onProgress: options.onProgress,\n      paused: false,\n      cancelled: false,\n    };\n\n    // Store starting values\n    Object.keys(properties).forEach(prop => {\n      try {\n        if (prop === 'transform') {\n          animation.startValues[prop] = element.getAttribute('transform') || '';\n        } else if (prop === 'opacity') {\n          animation.startValues[prop] =\n            parseFloat(element.getAttribute('opacity')) || 1;\n        } else {\n          animation.startValues[prop] =\n            parseFloat(element.getAttribute(prop)) || 0;\n        }\n      } catch (error) {\n        logger.warn(\n          `Failed to get starting value for property: ${prop}`,\n          error\n        );\n        animation.startValues[prop] = 0;\n      }\n    });\n\n    this.animations.add(animation);\n    this.runAnimation(animation);\n\n    return animation.id;\n  }\n\n  /**\n   * Apply final animation state immediately\n   * @param {SVGElement} element - Target element\n   * @param {Object} properties - Final properties\n   */\n  applyFinalAnimationState(element, properties) {\n    try {\n      Object.entries(properties).forEach(([prop, value]) => {\n        element.setAttribute(prop, value);\n      });\n    } catch (error) {\n      this.errorHandler('Failed to apply animation state', error);\n    }\n  }\n\n  /**\n   * Run animation with performance monitoring\n   * @param {Object} animation - Animation object\n   */\n  runAnimation(animation) {\n    const animate = currentTime => {\n      if (animation.cancelled) {\n        this.animations.delete(animation);\n        return;\n      }\n\n      if (animation.paused) {\n        requestAnimationFrame(animate);\n        return;\n      }\n\n      const elapsed = currentTime - animation.startTime;\n      let progress = Math.min(elapsed / animation.duration, 1);\n\n      // Apply easing function\n      progress = this.applyEasing(progress, animation.easing);\n\n      try {\n        // Update element properties\n        Object.entries(animation.properties).forEach(([prop, endValue]) => {\n          const startValue = animation.startValues[prop];\n\n          if (prop === 'transform') {\n            // Handle transform separately as it's not numeric\n            animation.element.setAttribute(prop, endValue);\n          } else {\n            const currentValue =\n              startValue + (endValue - startValue) * progress;\n            animation.element.setAttribute(prop, currentValue);\n          }\n        });\n\n        if (animation.onProgress) {\n          animation.onProgress(progress);\n        }\n\n        if (progress < 1) {\n          requestAnimationFrame(animate);\n        } else {\n          this.animations.delete(animation);\n          if (animation.onComplete) {\n            animation.onComplete();\n          }\n        }\n      } catch (error) {\n        this.errorHandler('Animation update failed', error);\n        this.animations.delete(animation);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }\n\n  /**\n   * Apply easing function to animation progress\n   * @param {number} t - Progress value (0-1)\n   * @param {string} easing - Easing function name\n   * @returns {number} Eased progress value\n   */\n  applyEasing(t, easing) {\n    switch (easing) {\n      case 'linear':\n        return t;\n      case 'ease-in':\n        return t * t;\n      case 'ease-out':\n        return t * (2 - t);\n      case 'ease-in-out':\n        return t < SVG_CONSTANTS.MATH.EASING_THRESHOLD_1\n          ? 2 * t * t\n          : -1 + (SVG_CONSTANTS.MATH.EASING_MULTIPLIER - 2 * t) * t;\n      case 'ease-in-cubic':\n        return t * t * t;\n      case 'ease-out-cubic':\n        return --t * t * t + 1;\n      case 'ease-in-out-cubic':\n        return t < SVG_CONSTANTS.MATH.EASING_THRESHOLD_1\n          ? SVG_CONSTANTS.MATH.EASING_MULTIPLIER * t * t * t\n          : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n      case 'bounce':\n        if (t < 1 / SVG_CONSTANTS.MATH.BOUNCE_DIVISOR) {\n          return SVG_CONSTANTS.MATH.BOUNCE_COEFFICIENT * t * t;\n        } else if (t < 2 / SVG_CONSTANTS.MATH.BOUNCE_DIVISOR) {\n          return (\n            SVG_CONSTANTS.MATH.BOUNCE_COEFFICIENT *\n              (t -=\n                SVG_CONSTANTS.MATH.BOUNCE_OFFSET_1 /\n                SVG_CONSTANTS.MATH.BOUNCE_DIVISOR) *\n              t +\n            SVG_CONSTANTS.MATH.BOUNCE_THRESHOLD_1\n          );\n        } else if (\n          t <\n          SVG_CONSTANTS.MATH.BOUNCE_MIDPOINT / SVG_CONSTANTS.MATH.BOUNCE_DIVISOR\n        ) {\n          return (\n            SVG_CONSTANTS.MATH.BOUNCE_COEFFICIENT *\n              (t -=\n                SVG_CONSTANTS.MATH.BOUNCE_OFFSET_2 /\n                SVG_CONSTANTS.MATH.BOUNCE_DIVISOR) *\n              t +\n            SVG_CONSTANTS.MATH.BOUNCE_THRESHOLD_2\n          );\n        } else {\n          return (\n            SVG_CONSTANTS.MATH.BOUNCE_COEFFICIENT *\n              (t -=\n                SVG_CONSTANTS.MATH.BOUNCE_OFFSET_3 /\n                SVG_CONSTANTS.MATH.BOUNCE_DIVISOR) *\n              t +\n            SVG_CONSTANTS.MATH.BOUNCE_THRESHOLD_3\n          );\n        }\n      case 'elastic': {\n        const c4 = (2 * Math.PI) / SVG_CONSTANTS.MATH.ELASTIC_DIVISOR;\n        return t === 0\n          ? 0\n          : t === 1\n            ? 1\n            : Math.pow(2, SVG_CONSTANTS.MATH.ELASTIC_POWER * t) *\n                Math.sin(\n                  (t * SVG_CONSTANTS.MATH.ELASTIC_MULTIPLIER -\n                    SVG_CONSTANTS.MATH.ELASTIC_OFFSET) *\n                    c4\n                ) +\n              1;\n      }\n      default:\n        return t;\n    }\n  }\n\n  /**\n   * Pause animation by ID\n   * @param {string} animationId - Animation ID to pause\n   */\n  pauseAnimation(animationId) {\n    for (const animation of this.animations) {\n      if (animation.id === animationId) {\n        animation.paused = true;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Resume animation by ID\n   * @param {string} animationId - Animation ID to resume\n   */\n  resumeAnimation(animationId) {\n    for (const animation of this.animations) {\n      if (animation.id === animationId) {\n        animation.paused = false;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Stop animation by ID\n   * @param {string} animationId - Animation ID to stop\n   */\n  stopAnimation(animationId) {\n    for (const animation of this.animations) {\n      if (animation.id === animationId) {\n        animation.cancelled = true;\n        break;\n      }\n    }\n  }\n\n  /**\n   * Stop all animations\n   */\n  stopAllAnimations() {\n    for (const animation of this.animations) {\n      animation.cancelled = true;\n    }\n    this.animations.clear();\n  }\n\n  /**\n   * Create fade animation using CSS or SMIL\n   * @param {SVGElement} element - Target element\n   * @param {number} targetOpacity - Target opacity value\n   * @param {number} duration - Animation duration\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID\n   */\n  fadeAnimation(element, targetOpacity, duration = 500, options = {}) {\n    return this.animate(\n      element,\n      { opacity: targetOpacity },\n      duration,\n      options.easing || 'ease-out',\n      options\n    );\n  }\n\n  /**\n   * Create slide animation\n   * @param {SVGElement} element - Target element\n   * @param {number} targetX - Target X position\n   * @param {number} targetY - Target Y position\n   * @param {number} duration - Animation duration\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID\n   */\n  slideAnimation(element, targetX, targetY, duration = 500, options = {}) {\n    const newTransform = `translate(${targetX}, ${targetY})`;\n\n    return this.animate(\n      element,\n      { transform: newTransform },\n      duration,\n      options.easing || 'ease-out',\n      options\n    );\n  }\n\n  /**\n   * Create scale animation\n   * @param {SVGElement} element - Target element\n   * @param {number} targetScale - Target scale value\n   * @param {number} duration - Animation duration\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID\n   */\n  scaleAnimation(element, targetScale, duration = 500, options = {}) {\n    const currentTransform = element.getAttribute('transform') || '';\n    const scaleTransform = `scale(${targetScale})`;\n\n    // Preserve existing transforms\n    let newTransform = scaleTransform;\n    if (currentTransform && !currentTransform.includes('scale')) {\n      newTransform = `${currentTransform} ${scaleTransform}`;\n    }\n\n    return this.animate(\n      element,\n      { transform: newTransform },\n      duration,\n      options.easing || 'ease-out',\n      options\n    );\n  }\n\n  /**\n   * Create rotation animation\n   * @param {SVGElement} element - Target element\n   * @param {number} targetRotation - Target rotation in degrees\n   * @param {number} duration - Animation duration\n   * @param {Object} options - Animation options\n   * @returns {string} Animation ID\n   */\n  rotateAnimation(element, targetRotation, duration = 500, options = {}) {\n    const currentTransform = element.getAttribute('transform') || '';\n    const rotateTransform = `rotate(${targetRotation})`;\n\n    // Preserve existing transforms\n    let newTransform = rotateTransform;\n    if (currentTransform && !currentTransform.includes('rotate')) {\n      newTransform = `${currentTransform} ${rotateTransform}`;\n    }\n\n    return this.animate(\n      element,\n      { transform: newTransform },\n      duration,\n      options.easing || 'ease-out',\n      options\n    );\n  }\n  // Enhanced rendering and integration methods\n\n  /**\n   * Get renderer type for Visual Engine integration\n   * @returns {string} Renderer type\n   */\n  get type() {\n    return 'svg';\n  }\n\n  /**\n   * Get SVG element for external integration\n   * @returns {SVGElement} SVG element\n   */\n  getElement() {\n    return this.svg;\n  }\n\n  /**\n   * Render complete scene with performance monitoring\n   * @param {Object} scene - Scene object to render\n   */\n  render(scene) {\n    if (!scene) return;\n\n    this.performanceMonitor.startFrame();\n\n    try {\n      this.clear();\n\n      if (scene.backgroundColor) {\n        const background = this.createRect(\n          0,\n          0,\n          this.options.width,\n          this.options.height,\n          {\n            fill: scene.backgroundColor,\n            className: 'scene-background',\n          }\n        );\n        if (background) this.mainGroup.appendChild(background);\n      }\n\n      if (scene.render && typeof scene.render === 'function') {\n        scene.render(this);\n      } else if (scene.objects && Array.isArray(scene.objects)) {\n        scene.objects.forEach(obj => this.renderObject(obj));\n      }\n\n      // Announce scene changes to screen readers\n      if (this.accessibilityManager && scene.description) {\n        this.accessibilityManager.updateDescription(scene.description);\n      }\n    } catch (error) {\n      this.errorHandler('Failed to render scene', error);\n    } finally {\n      this.performanceMonitor.endFrame();\n    }\n  }\n\n  /**\n   * Render individual object with transformations and accessibility\n   * @param {Object} object - Object to render\n   */\n  renderObject(object) {\n    if (!object || object.visible === false) return;\n\n    try {\n      // Create SVG group for this object\n      const group = this.createGroup({\n        className: 'scene-object',\n        id: object.id,\n      });\n\n      if (!group) return;\n\n      // Apply transformations\n      const transforms = [];\n\n      if (object.x || object.y) {\n        transforms.push(`translate(${object.x || 0}, ${object.y || 0})`);\n      }\n\n      if (object.rotation) {\n        const rotationDeg =\n          (object.rotation * SVG_CONSTANTS.MATH.DEGREES_PER_PI) / Math.PI;\n        transforms.push(`rotate(${rotationDeg})`);\n      }\n\n      if (object.scale && object.scale !== 1) {\n        const scaleX =\n          typeof object.scale === 'object' ? object.scale.x : object.scale;\n        const scaleY =\n          typeof object.scale === 'object' ? object.scale.y : object.scale;\n        transforms.push(`scale(${scaleX}, ${scaleY})`);\n      }\n\n      if (transforms.length > 0) {\n        group.setAttribute('transform', transforms.join(' '));\n      }\n\n      if (object.alpha !== undefined) {\n        group.setAttribute('opacity', Math.max(0, Math.min(1, object.alpha)));\n      }\n\n      // Apply blend mode if specified\n      if (object.blendMode) {\n        group.style.mixBlendMode = object.blendMode;\n      }\n\n      // Render based on object type or custom render method\n      let element;\n      if (object.render && typeof object.render === 'function') {\n        // Let object render itself\n        object.render(this, group);\n      } else if (object.type) {\n        element = this.renderByType(object);\n      }\n\n      if (element) {\n        group.appendChild(element);\n      }\n\n      this.mainGroup.appendChild(group);\n    } catch (error) {\n      this.errorHandler(\n        `Failed to render object: ${object.type || 'unknown'}`,\n        error\n      );\n    }\n  }\n\n  /**\n   * Render object by type with enhanced features\n   * @param {Object} object - Object to render\n   * @returns {SVGElement} Rendered element\n   */\n  renderByType(object) {\n    const commonOptions = {\n      fill: object.fill || object.color,\n      stroke: object.stroke || object.borderColor,\n      strokeWidth: object.strokeWidth || object.borderWidth,\n      className: object.className,\n      interactive: object.interactive,\n      id: object.id,\n      label: object.label,\n      ariaLabel: object.ariaLabel,\n      description: object.description,\n      onClick: object.onClick,\n      themeColor: object.themeColor,\n      themeAttribute: object.themeAttribute,\n    };\n\n    try {\n      switch (object.type) {\n        case 'rect':\n        case 'rectangle':\n          return this.createRect(\n            0,\n            0,\n            object.width || SVG_CONSTANTS.UI.DEFAULT_OBJECT_SIZE,\n            object.height || SVG_CONSTANTS.UI.DEFAULT_OBJECT_SIZE,\n            {\n              ...commonOptions,\n              borderRadius: object.borderRadius,\n            }\n          );\n\n        case 'circle':\n          return this.createCircle(\n            0,\n            0,\n            object.radius || SVG_CONSTANTS.UI.DEFAULT_RADIUS,\n            commonOptions\n          );\n\n        case 'ellipse':\n          return this.createSVGElement('ellipse', {\n            cx: 0,\n            cy: 0,\n            rx:\n              object.radiusX ||\n              object.radius ||\n              SVG_CONSTANTS.UI.DEFAULT_RADIUS,\n            ry:\n              object.radiusY ||\n              object.radius ||\n              SVG_CONSTANTS.UI.DEFAULT_RADIUS,\n            fill: commonOptions.fill || 'transparent',\n            stroke: commonOptions.stroke || 'none',\n            'stroke-width':\n              commonOptions.strokeWidth ||\n              SVG_CONSTANTS.ACCESSIBILITY.MIN_STROKE_WIDTH,\n            class: `ellipse-element ${commonOptions.className || ''}`,\n          });\n\n        case 'text':\n          return this.createText(0, 0, object.text || '', {\n            fill: commonOptions.fill,\n            fontSize: object.fontSize,\n            fontFamily: object.fontFamily,\n            fontWeight: object.fontWeight,\n            fontStyle: object.fontStyle,\n            textAnchor: object.textAnchor || object.align,\n            dominantBaseline: object.dominantBaseline || object.baseline,\n            accessible: object.accessible,\n            className: commonOptions.className,\n            id: commonOptions.id,\n            label: commonOptions.label,\n            ariaLabel: commonOptions.ariaLabel,\n            description: commonOptions.description,\n          });\n\n        case 'line':\n          return this.createLine(\n            object.x1 || 0,\n            object.y1 || 0,\n            object.x2 || SVG_CONSTANTS.UI.DEFAULT_OBJECT_SIZE,\n            object.y2 || SVG_CONSTANTS.UI.DEFAULT_OBJECT_SIZE,\n            {\n              stroke: commonOptions.stroke,\n              strokeWidth: commonOptions.strokeWidth,\n              linecap: object.linecap,\n              linejoin: object.linejoin,\n              dashArray: object.dashArray,\n              dashOffset: object.dashOffset,\n              className: commonOptions.className,\n            }\n          );\n\n        case 'path':\n          if (object.pathData || object.d) {\n            return this.createPath(object.pathData || object.d, {\n              ...commonOptions,\n              linecap: object.linecap,\n              linejoin: object.linejoin,\n              dashArray: object.dashArray,\n              fillRule: object.fillRule,\n            });\n          }\n          break;\n\n        case 'polygon':\n          if (object.points) {\n            const pointsString = Array.isArray(object.points)\n              ? object.points.map(p => `${p.x},${p.y}`).join(' ')\n              : object.points;\n\n            return this.createSVGElement('polygon', {\n              points: pointsString,\n              fill: commonOptions.fill || 'transparent',\n              stroke: commonOptions.stroke || 'none',\n              'stroke-width':\n                commonOptions.strokeWidth ||\n                SVG_CONSTANTS.ACCESSIBILITY.MIN_STROKE_WIDTH,\n              class: `polygon-element ${commonOptions.className || ''}`,\n            });\n          }\n          break;\n\n        case 'polyline':\n          if (object.points) {\n            const pointsString = Array.isArray(object.points)\n              ? object.points.map(p => `${p.x},${p.y}`).join(' ')\n              : object.points;\n\n            return this.createSVGElement('polyline', {\n              points: pointsString,\n              fill: 'none',\n              stroke: commonOptions.stroke || this.currentTheme.foreground,\n              'stroke-width':\n                commonOptions.strokeWidth ||\n                SVG_CONSTANTS.ACCESSIBILITY.MIN_STROKE_WIDTH,\n              class: `polyline-element ${commonOptions.className || ''}`,\n            });\n          }\n          break;\n\n        case 'image':\n          if (object.href || object.src) {\n            return this.createSVGElement('image', {\n              x: 0,\n              y: 0,\n              width: object.width || SVG_CONSTANTS.UI.DEFAULT_OBJECT_SIZE,\n              height: object.height || SVG_CONSTANTS.UI.DEFAULT_OBJECT_SIZE,\n              href: object.href || object.src,\n              preserveAspectRatio:\n                object.preserveAspectRatio || 'xMidYMid meet',\n              class: `image-element ${commonOptions.className || ''}`,\n            });\n          }\n          break;\n\n        default:\n          // Draw a placeholder for unknown types\n          logger.warn(`Unknown object type: ${object.type}`);\n          return this.createRect(\n            SVG_CONSTANTS.MATH.PLACEHOLDER_OFFSET,\n            SVG_CONSTANTS.MATH.PLACEHOLDER_OFFSET,\n            SVG_CONSTANTS.MATH.PLACEHOLDER_SIZE,\n            SVG_CONSTANTS.MATH.PLACEHOLDER_SIZE,\n            {\n              fill: '#ff6b6b',\n              stroke: '#e55555',\n              strokeWidth: 1,\n              className: 'unknown-object-placeholder',\n            }\n          );\n      }\n    } catch (error) {\n      this.errorHandler(`Failed to render object type: ${object.type}`, error);\n      return null;\n    }\n\n    return null;\n  }\n  // Enhanced utility and management methods\n\n  /**\n   * Resize SVG with proper scaling and cleanup\n   * @param {number} width - New width\n   * @param {number} height - New height\n   */\n  resize(width, height) {\n    if (!width || !height || width <= 0 || height <= 0) {\n      this.errorHandler(\n        'Invalid resize dimensions',\n        new Error('Width and height must be positive')\n      );\n      return;\n    }\n\n    try {\n      this.options.width = width;\n      this.options.height = height;\n\n      this.svg.setAttribute('viewBox', `0 0 ${width} ${height}`);\n\n      // Trigger resize event for listeners\n      this.svg.dispatchEvent(\n        new CustomEvent('svgResize', {\n          detail: { width, height },\n        })\n      );\n\n      // Clear performance metrics on resize\n      this.performanceMonitor.reset();\n      this.elementCount = 0;\n    } catch (error) {\n      this.errorHandler('Failed to resize SVG', error);\n    }\n  }\n\n  /**\n   * Add element to specific layer\n   * @param {string} layerName - Layer name\n   * @param {SVGElement} element - Element to add\n   * @returns {SVGElement} Added element\n   */\n  addToLayer(layerName, element) {\n    if (!element) {\n      this.errorHandler(\n        'Invalid element provided to layer',\n        new Error('Element is required')\n      );\n      return null;\n    }\n\n    try {\n      const layer = this.getLayer(layerName);\n      layer.appendChild(element);\n      return element;\n    } catch (error) {\n      this.errorHandler('Failed to add element to layer', error);\n      return null;\n    }\n  }\n\n  /**\n   * Clear SVG content with optional layer targeting\n   * @param {string} layerName - Optional layer name to clear\n   */\n  clear(layerName = null) {\n    try {\n      if (layerName) {\n        const layer = this.getLayer(layerName);\n        layer.innerHTML = '';\n      } else {\n        // Clear all content but preserve structure\n        this.mainGroup.innerHTML = '';\n        this.layers.clear();\n        this.elementCount = 0;\n\n        // Clear accessibility elements\n        if (this.accessibilityManager) {\n          this.accessibilityManager.elements.clear();\n        }\n      }\n\n      this.performanceMonitor.recordDOMOperation();\n    } catch (error) {\n      this.errorHandler('Failed to clear SVG content', error);\n    }\n  }\n\n  /**\n   * Set SVG viewBox for zooming and panning\n   * @param {number} x - ViewBox X\n   * @param {number} y - ViewBox Y\n   * @param {number} width - ViewBox width\n   * @param {number} height - ViewBox height\n   */\n  setViewBox(x, y, width, height) {\n    try {\n      this.svg.setAttribute('viewBox', `${x} ${y} ${width} ${height}`);\n    } catch (error) {\n      this.errorHandler('Failed to set viewBox', error);\n    }\n  }\n\n  /**\n   * Export SVG as string with optional optimization\n   * @param {Object} options - Export options\n   * @returns {string} SVG string\n   */\n  exportSVG(options = {}) {\n    try {\n      let svgString = new XMLSerializer().serializeToString(this.svg);\n\n      if (options.optimize) {\n        // Basic optimization: remove unnecessary whitespace and comments\n        svgString = svgString.replace(/>\\s+</g, '><');\n        svgString = svgString.replace(/<!--[\\s\\S]*?-->/g, '');\n      }\n\n      if (options.standalone) {\n        // Add XML declaration and DOCTYPE for standalone SVG\n        svgString = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n${svgString}`;\n      }\n\n      return svgString;\n    } catch (error) {\n      this.errorHandler('Failed to export SVG', error);\n      return '';\n    }\n  }\n\n  /**\n   * Convert SVG to data URL\n   * @param {Object} options - Export options\n   * @returns {string} Data URL\n   */\n  toDataURL(options = {}) {\n    try {\n      const svgString = this.exportSVG(options);\n      const base64 = btoa(unescape(encodeURIComponent(svgString)));\n      return `data:image/svg+xml;base64,${base64}`;\n    } catch (error) {\n      this.errorHandler('Failed to create data URL', error);\n      return '';\n    }\n  }\n\n  /**\n   * Get performance metrics\n   * @returns {Object} Performance metrics\n   */\n  getPerformanceMetrics() {\n    return {\n      ...this.performanceMonitor.getMetrics(),\n      elementCount: this.elementCount,\n      activeAnimations: this.animations.size,\n      gradientCacheSize: this.gradientCache.size,\n      patternCacheSize: this.patternCache.size,\n      layerCount: this.layers.size,\n      svgSize: {\n        width: this.options.width,\n        height: this.options.height,\n      },\n    };\n  }\n\n  /**\n   * Clear caches to free memory\n   */\n  clearCaches() {\n    try {\n      this.gradientCache.clear();\n      this.patternCache.clear();\n    } catch (error) {\n      this.errorHandler('Failed to clear caches', error);\n    }\n  }\n\n  /**\n   * Find element by ID within SVG\n   * @param {string} id - Element ID\n   * @returns {SVGElement|null} Found element\n   */\n  getElementById(id) {\n    try {\n      return this.svg.querySelector(`#${CSS.escape(id)}`);\n    } catch (error) {\n      this.errorHandler('Failed to find element by ID', error);\n      return null;\n    }\n  }\n\n  /**\n   * Find elements by class name within SVG\n   * @param {string} className - Class name\n   * @returns {NodeList} Found elements\n   */\n  getElementsByClassName(className) {\n    try {\n      return this.svg.querySelectorAll(`.${CSS.escape(className)}`);\n    } catch (error) {\n      this.errorHandler('Failed to find elements by class', error);\n      return [];\n    }\n  }\n\n  /**\n   * Get bounding box of element or entire SVG\n   * @param {SVGElement} element - Optional element (defaults to SVG)\n   * @returns {Object} Bounding box\n   */\n  getBoundingBox(element = null) {\n    try {\n      const target = element || this.svg;\n      if (target.getBBox) {\n        return target.getBBox();\n      } else if (target.getBoundingClientRect) {\n        return target.getBoundingClientRect();\n      }\n      return { x: 0, y: 0, width: 0, height: 0 };\n    } catch (error) {\n      this.errorHandler('Failed to get bounding box', error);\n      return { x: 0, y: 0, width: 0, height: 0 };\n    }\n  }\n\n  /**\n   * Clean up resources and event listeners\n   */\n  destroy() {\n    try {\n      // Stop all animations\n      this.stopAllAnimations();\n\n      // Clear caches\n      this.clearCaches();\n\n      // Remove event listeners\n      if (this.resizeObserver) {\n        this.resizeObserver.disconnect();\n      } else {\n        window.removeEventListener('resize', this.boundHandleResize);\n      }\n\n      // Cancel any pending animation frames\n      if (this.animationFrameId) {\n        cancelAnimationFrame(this.animationFrameId);\n      }\n\n      // Remove accessibility manager\n      if (this.accessibilityManager) {\n        this.accessibilityManager.elements.clear();\n        this.accessibilityManager = null;\n      }\n\n      // Remove SVG from DOM\n      if (this.svg && this.svg.parentNode) {\n        this.svg.parentNode.removeChild(this.svg);\n      }\n\n      // Clear references\n      this.svg = null;\n      this.defs = null;\n      this.mainGroup = null;\n      this.container = null;\n      this.layers.clear();\n\n      // Dispatch cleanup event\n      document.dispatchEvent(\n        new CustomEvent('svgRendererDestroyed', {\n          detail: { rendererId: this.id },\n        })\n      );\n    } catch (error) {\n      this.errorHandler('Error during cleanup', error);\n    }\n  }\n}\n\n// Export for use in other modules\nif (typeof window !== 'undefined') {\n  window.SVGRenderer = SVGRenderer;\n}\n\nexport default SVGRenderer;\n","/**\n * WebGL Renderer for the Visual Engine\n * Provides hardware-accelerated 2D graphics using WebGL\n */\n\nimport logger from '../utils/logger.js';\n\n// WebGL renderer constants\nconst WEBGL_CONSTANTS = {\n  // Default dimensions\n  DEFAULT_WIDTH: 800,\n  DEFAULT_HEIGHT: 600,\n\n  // Matrix dimensions\n  MATRIX_SIZE: 16,\n\n  // WebGL math constants\n  DEPTH_PROJECTION: -2,\n\n  // Geometry constants\n  VERTICES_PER_QUAD: 4,\n  TRIANGLE_VERTEX_COUNT: 3,\n  FLOATS_PER_VERTEX: 8, // x, y, u, v, r, g, b, a\n  BYTES_PER_FLOAT: 4,\n\n  // Default object dimensions\n  DEFAULT_OBJECT_SIZE: 50,\n\n  // Color parsing constants\n  HEX_SHORT_LENGTH: 3,\n  HEX_LONG_LENGTH: 6,\n  HEX_RADIX: 16,\n  COLOR_COMPONENT_MAX: 255,\n  HEX_SLICE_START: 2,\n  HEX_SLICE_MID: 4,\n  HEX_SLICE_END: 6,\n\n  // Default colors\n  DEFAULT_COLOR: [1, 1, 1], // White\n};\n\nexport class WebGLRenderer {\n  constructor(container, options = {}) {\n    this.container = container;\n    this.options = {\n      width: options.width || WEBGL_CONSTANTS.DEFAULT_WIDTH,\n      height: options.height || WEBGL_CONSTANTS.DEFAULT_HEIGHT,\n      pixelRatio: options.pixelRatio || window.devicePixelRatio || 1,\n      alpha: options.alpha !== false,\n      antialias: options.antialias !== false,\n      powerPreference: options.powerPreference || 'default',\n      ...options,\n    };\n\n    this.canvas = null;\n    this.gl = null;\n    this.programs = new Map();\n    this.buffers = new Map();\n    this.textures = new Map();\n    this.activeProgram = null;\n\n    // Transformation matrix\n    this.projectionMatrix = new Float32Array(WEBGL_CONSTANTS.MATRIX_SIZE);\n    this.modelMatrix = new Float32Array(WEBGL_CONSTANTS.MATRIX_SIZE);\n    this.viewMatrix = new Float32Array(WEBGL_CONSTANTS.MATRIX_SIZE);\n\n    // Object batching\n    this.batchBuffer = [];\n    this.maxBatchSize = 1000;\n\n    this.initialize();\n  }\n\n  initialize() {\n    try {\n      // Create canvas element\n      this.canvas = document.createElement('canvas');\n      this.canvas.style.width = '100%';\n      this.canvas.style.height = '100%';\n      this.canvas.style.display = 'block';\n\n      // Set canvas size with device pixel ratio\n      this.canvas.width = this.options.width * this.options.pixelRatio;\n      this.canvas.height = this.options.height * this.options.pixelRatio;\n\n      // Get WebGL context\n      this.gl =\n        this.canvas.getContext('webgl', {\n          alpha: this.options.alpha,\n          antialias: this.options.antialias,\n          powerPreference: this.options.powerPreference,\n        }) || this.canvas.getContext('experimental-webgl');\n\n      if (!this.gl) {\n        throw new Error('WebGL not supported');\n      }\n\n      // Setup WebGL state\n      this.setupWebGL();\n      this.createShaders();\n      this.createBuffers();\n      this.setupMatrices();\n\n      // Add accessibility attributes\n      this.canvas.setAttribute('role', 'img');\n      this.canvas.setAttribute('aria-label', 'WebGL simulation graphics');\n\n      // Append to container\n      this.container.appendChild(this.canvas);\n\n      logger.info('WebGLRenderer: Initialized successfully');\n    } catch (error) {\n      logger.error('WebGLRenderer: Failed to initialize:', error);\n      throw error;\n    }\n  }\n\n  setupWebGL() {\n    const { gl } = this;\n\n    // Set viewport\n    gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n\n    // Enable blending for transparency\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n    // Set clear color\n    gl.clearColor(0, 0, 0, 0);\n  }\n\n  createShaders() {\n    // Simple 2D vertex shader\n    const vertexShaderSource = `\n            attribute vec2 a_position;\n            attribute vec2 a_texCoord;\n            attribute vec4 a_color;\n            \n            uniform mat4 u_projection;\n            uniform mat4 u_model;\n            \n            varying vec2 v_texCoord;\n            varying vec4 v_color;\n            \n            void main() {\n                gl_Position = u_projection * u_model * vec4(a_position, 0.0, 1.0);\n                v_texCoord = a_texCoord;\n                v_color = a_color;\n            }\n        `;\n\n    // Simple fragment shader\n    const fragmentShaderSource = `\n            precision mediump float;\n            \n            varying vec2 v_texCoord;\n            varying vec4 v_color;\n            \n            uniform sampler2D u_texture;\n            uniform bool u_useTexture;\n            \n            void main() {\n                if (u_useTexture) {\n                    gl_FragColor = texture2D(u_texture, v_texCoord) * v_color;\n                } else {\n                    gl_FragColor = v_color;\n                }\n            }\n        `;\n\n    const program = this.createShaderProgram(\n      vertexShaderSource,\n      fragmentShaderSource\n    );\n    this.programs.set('basic', program);\n\n    // Get attribute and uniform locations\n    program.locations = {\n      attributes: {\n        position: this.gl.getAttribLocation(program, 'a_position'),\n        texCoord: this.gl.getAttribLocation(program, 'a_texCoord'),\n        color: this.gl.getAttribLocation(program, 'a_color'),\n      },\n      uniforms: {\n        projection: this.gl.getUniformLocation(program, 'u_projection'),\n        model: this.gl.getUniformLocation(program, 'u_model'),\n        texture: this.gl.getUniformLocation(program, 'u_texture'),\n        useTexture: this.gl.getUniformLocation(program, 'u_useTexture'),\n      },\n    };\n\n    this.useProgram('basic');\n  }\n\n  createShaderProgram(vertexSource, fragmentSource) {\n    const { gl } = this;\n\n    const vertexShader = this.createShader(gl.VERTEX_SHADER, vertexSource);\n    const fragmentShader = this.createShader(\n      gl.FRAGMENT_SHADER,\n      fragmentSource\n    );\n\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      const error = gl.getProgramInfoLog(program);\n      gl.deleteProgram(program);\n      throw new Error(`Failed to link shader program: ${error}`);\n    }\n\n    return program;\n  }\n\n  createShader(type, source) {\n    const { gl } = this;\n    const shader = gl.createShader(type);\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      const error = gl.getShaderInfoLog(shader);\n      gl.deleteShader(shader);\n      throw new Error(`Failed to compile shader: ${error}`);\n    }\n\n    return shader;\n  }\n\n  createBuffers() {\n    const { gl } = this;\n\n    // Create vertex buffer\n    this.buffers.set('vertex', gl.createBuffer());\n\n    // Create index buffer\n    this.buffers.set('index', gl.createBuffer());\n\n    // Create a buffer for batched rendering\n    this.buffers.set('batch', gl.createBuffer());\n  }\n\n  setupMatrices() {\n    // Setup orthographic projection matrix\n    this.setOrthographicProjection(\n      0,\n      this.options.width,\n      this.options.height,\n      0,\n      -1,\n      1\n    );\n\n    // Initialize model matrix as identity\n    this.setIdentityMatrix(this.modelMatrix);\n    this.setIdentityMatrix(this.viewMatrix);\n  }\n\n  setOrthographicProjection(left, right, bottom, top, near, far) {\n    const matrix = this.projectionMatrix;\n\n    matrix[0] = 2 / (right - left);\n    matrix[1] = 0;\n    matrix[2] = 0;\n    matrix[3] = 0;\n\n    matrix[4] = 0;\n    matrix[5] = 2 / (top - bottom);\n    matrix[6] = 0;\n    matrix[7] = 0;\n\n    matrix[8] = 0;\n    matrix[9] = 0;\n    matrix[10] = WEBGL_CONSTANTS.DEPTH_PROJECTION / (far - near);\n    matrix[11] = 0;\n\n    matrix[12] = -(right + left) / (right - left);\n    matrix[13] = -(top + bottom) / (top - bottom);\n    matrix[14] = -(far + near) / (far - near);\n    matrix[15] = 1;\n  }\n\n  setIdentityMatrix(matrix) {\n    matrix[0] = 1;\n    matrix[1] = 0;\n    matrix[2] = 0;\n    matrix[3] = 0;\n    matrix[4] = 0;\n    matrix[5] = 1;\n    matrix[6] = 0;\n    matrix[7] = 0;\n    matrix[8] = 0;\n    matrix[9] = 0;\n    matrix[10] = 1;\n    matrix[11] = 0;\n    matrix[12] = 0;\n    matrix[13] = 0;\n    matrix[14] = 0;\n    matrix[15] = 1;\n  }\n\n  useProgram(programName) {\n    const program = this.programs.get(programName);\n    if (program && program !== this.activeProgram) {\n      this.gl.useProgram(program);\n      this.activeProgram = program;\n\n      // Update matrices\n      this.gl.uniformMatrix4fv(\n        program.locations.uniforms.projection,\n        false,\n        this.projectionMatrix\n      );\n      this.gl.uniformMatrix4fv(\n        program.locations.uniforms.model,\n        false,\n        this.modelMatrix\n      );\n    }\n  }\n\n  // Required methods for Visual Engine integration\n  get type() {\n    return 'webgl';\n  }\n\n  getElement() {\n    return this.canvas;\n  }\n\n  clear() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n    this.batchBuffer = [];\n  }\n\n  render(scene) {\n    this.clear();\n    if (scene && scene.render) {\n      scene.render(this);\n    }\n    this.flushBatch();\n  }\n\n  renderObject(object) {\n    if (!object || object.visible === false) return;\n\n    // Add object to batch for efficient rendering\n    this.addToBatch(object);\n  }\n\n  addToBatch(object) {\n    // Simple batching - add object data to buffer\n    const batchItem = {\n      type: object.type || 'rect',\n      x: object.x || 0,\n      y: object.y || 0,\n      width: object.width || WEBGL_CONSTANTS.DEFAULT_OBJECT_SIZE,\n      height: object.height || WEBGL_CONSTANTS.DEFAULT_OBJECT_SIZE,\n      color: this.parseColor(object.fill || '#ffffff'),\n      alpha: object.alpha !== undefined ? object.alpha : 1,\n      rotation: object.rotation || 0,\n      scale: object.scale || 1,\n    };\n\n    this.batchBuffer.push(batchItem);\n\n    // Flush batch if it gets too large\n    if (this.batchBuffer.length >= this.maxBatchSize) {\n      this.flushBatch();\n    }\n  }\n\n  flushBatch() {\n    if (this.batchBuffer.length === 0) return;\n\n    const { gl } = this;\n    const { activeProgram: program } = this;\n\n    if (!program) return;\n\n    // Prepare vertex data for all batched objects\n    const vertices = [];\n    const indices = [];\n    let vertexIndex = 0;\n\n    this.batchBuffer.forEach((item, _i) => {\n      const { x, y, width, height, color, alpha } = item;\n\n      // Create quad vertices\n      const x1 = x;\n      const y1 = y;\n      const x2 = x + width;\n      const y2 = y + height;\n\n      // Vertex data: [x, y, u, v, r, g, b, a]\n      vertices.push(\n        x1,\n        y1,\n        0,\n        0,\n        color[0],\n        color[1],\n        color[2],\n        alpha,\n        x2,\n        y1,\n        1,\n        0,\n        color[0],\n        color[1],\n        color[2],\n        alpha,\n        x2,\n        y2,\n        1,\n        1,\n        color[0],\n        color[1],\n        color[2],\n        alpha,\n        x1,\n        y2,\n        0,\n        1,\n        color[0],\n        color[1],\n        color[2],\n        alpha\n      );\n\n      // Indices for two triangles\n      const baseIndex = vertexIndex;\n      indices.push(\n        baseIndex,\n        baseIndex + 1,\n        baseIndex + 2,\n        baseIndex,\n        baseIndex + 2,\n        baseIndex + WEBGL_CONSTANTS.TRIANGLE_VERTEX_COUNT\n      );\n\n      vertexIndex += WEBGL_CONSTANTS.VERTICES_PER_QUAD;\n    });\n\n    // Upload vertex data\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffers.get('batch'));\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.DYNAMIC_DRAW);\n\n    // Upload index data\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffers.get('index'));\n    gl.bufferData(\n      gl.ELEMENT_ARRAY_BUFFER,\n      new Uint16Array(indices),\n      gl.DYNAMIC_DRAW\n    );\n\n    // Setup vertex attributes\n    const stride =\n      WEBGL_CONSTANTS.FLOATS_PER_VERTEX * WEBGL_CONSTANTS.BYTES_PER_FLOAT; // 8 floats per vertex\n\n    gl.enableVertexAttribArray(program.locations.attributes.position);\n    gl.vertexAttribPointer(\n      program.locations.attributes.position,\n      2,\n      gl.FLOAT,\n      false,\n      stride,\n      0\n    );\n\n    gl.enableVertexAttribArray(program.locations.attributes.texCoord);\n    gl.vertexAttribPointer(\n      program.locations.attributes.texCoord,\n      2,\n      gl.FLOAT,\n      false,\n      stride,\n      WEBGL_CONSTANTS.HEX_SLICE_START * WEBGL_CONSTANTS.BYTES_PER_FLOAT\n    );\n\n    gl.enableVertexAttribArray(program.locations.attributes.color);\n    gl.vertexAttribPointer(\n      program.locations.attributes.color,\n      WEBGL_CONSTANTS.VERTICES_PER_QUAD,\n      gl.FLOAT,\n      false,\n      stride,\n      WEBGL_CONSTANTS.VERTICES_PER_QUAD * WEBGL_CONSTANTS.BYTES_PER_FLOAT\n    );\n\n    // Set uniforms\n    gl.uniform1i(program.locations.uniforms.useTexture, false);\n\n    // Draw\n    gl.drawElements(gl.TRIANGLES, indices.length, gl.UNSIGNED_SHORT, 0);\n\n    // Clear batch\n    this.batchBuffer = [];\n  }\n\n  parseColor(colorString) {\n    // Simple color parsing - just handle hex colors for now\n    if (typeof colorString === 'string' && colorString.startsWith('#')) {\n      const hex = colorString.slice(1);\n      if (hex.length === WEBGL_CONSTANTS.HEX_SHORT_LENGTH) {\n        return [\n          parseInt(hex[0] + hex[0], WEBGL_CONSTANTS.HEX_RADIX) /\n            WEBGL_CONSTANTS.COLOR_COMPONENT_MAX,\n          parseInt(hex[1] + hex[1], WEBGL_CONSTANTS.HEX_RADIX) /\n            WEBGL_CONSTANTS.COLOR_COMPONENT_MAX,\n          parseInt(hex[2] + hex[2], WEBGL_CONSTANTS.HEX_RADIX) /\n            WEBGL_CONSTANTS.COLOR_COMPONENT_MAX,\n        ];\n      } else if (hex.length === WEBGL_CONSTANTS.HEX_LONG_LENGTH) {\n        return [\n          parseInt(\n            hex.slice(0, WEBGL_CONSTANTS.HEX_SLICE_START),\n            WEBGL_CONSTANTS.HEX_RADIX\n          ) / WEBGL_CONSTANTS.COLOR_COMPONENT_MAX,\n          parseInt(\n            hex.slice(\n              WEBGL_CONSTANTS.HEX_SLICE_START,\n              WEBGL_CONSTANTS.HEX_SLICE_MID\n            ),\n            WEBGL_CONSTANTS.HEX_RADIX\n          ) / WEBGL_CONSTANTS.COLOR_COMPONENT_MAX,\n          parseInt(\n            hex.slice(\n              WEBGL_CONSTANTS.HEX_SLICE_MID,\n              WEBGL_CONSTANTS.HEX_SLICE_END\n            ),\n            WEBGL_CONSTANTS.HEX_RADIX\n          ) / WEBGL_CONSTANTS.COLOR_COMPONENT_MAX,\n        ];\n      }\n    }\n\n    // Default to white\n    return WEBGL_CONSTANTS.DEFAULT_COLOR;\n  }\n\n  renderByType(object) {\n    // For WebGL, we batch everything and render later\n    this.addToBatch(object);\n  }\n\n  resize() {\n    if (this.container && this.canvas) {\n      const rect = this.container.getBoundingClientRect();\n      this.options.width = rect.width;\n      this.options.height = rect.height;\n\n      this.canvas.width = this.options.width * this.options.pixelRatio;\n      this.canvas.height = this.options.height * this.options.pixelRatio;\n\n      this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n      this.setOrthographicProjection(\n        0,\n        this.options.width,\n        this.options.height,\n        0,\n        -1,\n        1\n      );\n\n      // Update projection matrix in shader\n      if (this.activeProgram) {\n        this.gl.uniformMatrix4fv(\n          this.activeProgram.locations.uniforms.projection,\n          false,\n          this.projectionMatrix\n        );\n      }\n    }\n  }\n\n  // Texture management\n  createTexture(image) {\n    const { gl } = this;\n    const texture = gl.createTexture();\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\n    // Set texture parameters\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n    return texture;\n  }\n\n  // Performance monitoring\n  getInfo() {\n    const { gl } = this;\n    return {\n      vendor: gl.getParameter(gl.VENDOR),\n      renderer: gl.getParameter(gl.RENDERER),\n      version: gl.getParameter(gl.VERSION),\n      shadingLanguageVersion: gl.getParameter(gl.SHADING_LANGUAGE_VERSION),\n      maxTextureSize: gl.getParameter(gl.MAX_TEXTURE_SIZE),\n      maxVertexAttribs: gl.getParameter(gl.MAX_VERTEX_ATTRIBS),\n      maxFragmentUniforms: gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS),\n    };\n  }\n\n  destroy() {\n    if (this.gl) {\n      // Clean up WebGL resources\n      this.programs.forEach(program => this.gl.deleteProgram(program));\n      this.buffers.forEach(buffer => this.gl.deleteBuffer(buffer));\n      this.textures.forEach(texture => this.gl.deleteTexture(texture));\n    }\n\n    if (this.canvas && this.canvas.parentNode) {\n      this.canvas.parentNode.removeChild(this.canvas);\n    }\n\n    logger.info('WebGLRenderer: Destroyed');\n  }\n}\n\nexport default WebGLRenderer;\n"],"names":["Logger","level","context","message","data","prefix","contextStr","args","label","type","logger","SimpleStorageManager","storageType","storage","testKey","key","defaultValue","fullKey","value","e","success","keys","UserPreferences","theme","language","settings","simulationId","skip","UserProgress","progress","stats","progressKeys","simpleStorage","userPreferences","userProgress","ANALYTICS_CONSTANTS","SimpleAnalyticsManager","eventName","event","error","page","metadata","results","target","details","metric","feature","enabled","sessionEvents","duration","summary","savedEvents","savedSession","prefs","simpleAnalytics","TIMING","BREAKPOINTS","PERFORMANCE","EASING","COMMON","SIMULATION_CONSTANTS","EthicsSimulation","id","config","metrics","engineInstance","panel","UIPanel","FeedbackSystem","EthicsDisplay","index","scenario","component","c","title","description","objective","metricName","change","reasoning","oldValue","record","category","decision","isPositive","feedbackText","feedbackType","decisionId","choice","impact","report","totalScore","totalWeight","callback","_name","deltaTime","_deltaTime","totalScenarios","currentScenario","errorData","ANIMATION_CONSTANTS","EASING_PRESETS","AnimationTheme","prefersReducedMotion","prefersHighContrast","currentTheme","AnimationPerformanceMonitor","operationName","startTime","endTime","animationId","size","total","item","__publicField","AnimationError","originalError","AnimationManager","engine","reducedMotionQuery","contrastQuery","updateTheme","region","properties","options","actualDuration","themeDuration","animation","endValues","timeline","timelineId","delay","now","frameStart","processedCount","errorCount","frameTime","easedProgress","animationStart","animationEnd","animationProgress","prop","urgent","announcement","cutoffTime","newSettings","processed","endValue","startValue","easingName","easings","t","color","hex","start","end","g","b","a","toDelete","timelinesToDelete","direction","distance","startPos","property","endPos","scale","originalScale","intensity","originalX","shakeCount","shakeDistance","i","x","from","to","gestureType","animationFunc","activeCount","timelineCount","styleSheet","testElement","EASING_CONSTANTS","Scene","object","interactiveIndex","layerIndex","layer","renderer","y","width","height","area","bounds","tag","predicate","includeNonInteractive","objectsToTest","obj","localPoint","worldX","worldY","localX","localY","rect1","rect2","x1","y1","x2","y2","dx","dy","eventType","eventData","objects","easing","onComplete","onUpdate","startValues","animate","currentTime","elapsed","INPUT_CONFIG","INPUT_THEMES","INPUT_ERRORS","InputManager","InputPerformanceMonitor","InputAccessibilityManager","InputErrorHandler","InputPrivacyManager","InputValidator","themeName","element","logEntry","func","timeoutId","lastExecTime","handler","gamepads","gamepad","prevState","button","wasPressed","isPressed","coords","inputEvent","deltaX","deltaY","touches","touch","existingTouch","rect","touchList","_touches","touch1","touch2","keyCode","interval","timestamp","count","recentEvents","timestamps","recent","responseTime","sum","inputManager","updateReducedMotion","highContrastQuery","updateHighContrast","_event","errorEntry","sanitized","CANVAS_CONSTANTS","CanvasPerformanceMonitor","CanvasAccessibilityManager","canvas","focusableElements","el","currentIndex","announcer","ex","ey","CanvasRenderer","container","themeKey","maxWidth","maxHeight","contextOptions","newTheme","entries","fill","stroke","radius","points","cp","next","text","fontSize","fontWeight","fontFamily","adjustedWidth","adjustedHeight","backgroundColor","borderColor","textColor","isFocused","chartType","itemCount","maxValue","d","minValue","barWidth","padding","chartArea","barHeight","barX","barY","actualBarWidth","barColor","values","range","point","gridColor","gridLines","lineY","lineX","centerX","centerY","currentAngle","sliceAngle","endAngle","labelAngle","labelRadius","labelX","labelY","sliceColor","percentage","labelText","hue","saturation","lightness","_options","itemY","targetAlpha","startAlpha","deltaAlpha","targetX","targetY","startX","startY","targetScale","startScale","deltaScale","scene","scaleX","scaleY","commonOptions","source","drawImageElement","img","oldAlpha","cachedImg","colorStops","coordinates","gradient","x0","y0","r0","r1","stop","offset","imageData","quality","SVG_CONSTANTS","SVGPerformanceMonitor","SVGAccessibilityManager","svg","elementData","svgElement","desc","elementId","bbox","indicator","elementTypes","SVGRenderer","colorType","colorValue","attribute","tagName","attributes","style","name","zIndex","existingLayers","child","aZ","bZ","insertBefore","existingLayer","cx","cy","diameter","circle","line","pathData","path","textElement","filter","group","shadow","filterId","dropShadow","gradientId","opacity","stopElement","onClick","background","chart","patternId","pattern","strokeWidth","dot","vLine","hLine","diagLine","currentValue","c4","targetOpacity","newTransform","currentTransform","scaleTransform","targetRotation","rotateTransform","transforms","rotationDeg","pointsString","p","layerName","svgString","className","WEBGL_CONSTANTS","WebGLRenderer","gl","program","vertexSource","fragmentSource","vertexShader","fragmentShader","shader","left","right","bottom","top","near","far","matrix","programName","batchItem","vertices","indices","vertexIndex","_i","alpha","baseIndex","stride","colorString","image","texture","buffer"],"mappings":"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"}