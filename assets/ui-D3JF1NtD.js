var D=Object.defineProperty;var $=(u,e,t)=>e in u?D(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var k=(u,e,t)=>$(u,typeof e!="symbol"?e+"":e,t);import{T as N,C as T,l as d}from"./core-Bu-3NiyB.js";const h={ANIMATION_DURATION:300,DEBOUNCE_DELAY:150,FOCUS_DELAY:16,FOCUS_TRANSITION_DELAY:100,TOUCH_TARGET_SIZE:44,FOCUS_RING_WIDTH:2,RIPPLE_DURATION:600,BREAKPOINTS:{mobile:768,tablet:1024,desktop:1200},FRAME_TIME_LIMIT:16,RANDOM_BASE:36,RANDOM_ID_LENGTH:9,MIN_PANEL_WIDTH:200,MIN_PANEL_HEIGHT:150,DEFAULT_HIDE_DELAY:5e3,MAX_FEEDBACK_ITEMS:5,ETHICS_GRADES:{EXCELLENT:90,GOOD:80,FAIR:70,NEEDS_IMPROVEMENT:60},CLEANUP_DELAY:300},_={light:{primary:"#1a73e8",secondary:"#34a853",surface:"#ffffff",background:"#f8f9fa",text:"#202124",border:"#dadce0"},dark:{primary:"#4285f4",secondary:"#34a853",surface:"#2d2d30",background:"#1e1e1e",text:"#e8eaed",border:"#5f6368"},highContrast:{primary:"#000000",secondary:"#000000",surface:"#ffffff",background:"#ffffff",text:"#000000",border:"#000000"}};class M{static getCurrentTheme(){const e=window.matchMedia?.("(prefers-contrast: high)").matches,t=window.matchMedia?.("(prefers-reduced-motion: reduce)").matches;return{name:e?"highContrast":"light",highContrast:e,reducedMotion:t,colors:_[e?"highContrast":"light"]}}static applyThemeToElement(e,t=this.getCurrentTheme()){e.style.setProperty("--theme-primary",t.colors.primary),e.style.setProperty("--theme-secondary",t.colors.secondary),e.style.setProperty("--theme-surface",t.colors.surface),e.style.setProperty("--theme-background",t.colors.background),e.style.setProperty("--theme-text",t.colors.text),e.style.setProperty("--theme-border",t.colors.border)}}class I{static startMeasurement(e){this.measurements.set(e,performance.now())}static endMeasurement(e){const t=this.measurements.get(e);if(t){const s=performance.now()-t;return this.measurements.delete(e),s>h.FRAME_TIME_LIMIT&&d.warn(`UI operation '${e}' took ${s.toFixed(2)}ms`),s}return 0}}k(I,"measurements",new Map);class L{constructor(e={}){I.startMeasurement(`ui-component-init-${this.constructor.name}`),this.id=e.id||`ui-${Date.now()}-${Math.random().toString(h.RANDOM_BASE).substr(2,h.RANDOM_ID_LENGTH)}`,this.position=e.position||{x:0,y:0},this.size=e.size||{width:100,height:100},this.visible=e.visible!==!1,this.active=e.active!==!1,this.zIndex=e.zIndex||0,this.engine=null,this.element=null,this.styles=e.styles||{},this.theme=M.getCurrentTheme(),this.accessible=e.accessible!==!1,this.responsive=e.responsive!==!1,this.animated=e.animated!==!1&&!this.theme.reducedMotion,this.events=new Map,this.listeners=new Map,this.ariaLabel=e.ariaLabel||"",this.ariaRole=e.ariaRole||"button",this.focusable=e.focusable!==!1,this.tabIndex=e.tabIndex||(this.focusable?0:-1),this.performanceOptions={useGPU:e.useGPU!==!1,enableVirtualization:e.enableVirtualization===!0,debounceEvents:e.debounceEvents!==!1},this.errorHandler=e.errorHandler||this.defaultErrorHandler.bind(this),this.createElement(),this.applyStyles(),this.setupAccessibility(),this.setupEventListeners(),this.setupThemeMonitoring(),I.endMeasurement(`ui-component-init-${this.constructor.name}`)}createElement(){try{this.element=document.createElement(this.getElementTag()),this.element.className=this.getElementClasses(),this.element.id=this.id,M.applyThemeToElement(this.element,this.theme),this.updateElementPosition()}catch(e){this.errorHandler(e,"createElement")}}getElementTag(){return"div"}getElementClasses(){const e=["ui-component",`ui-${this.constructor.name.toLowerCase()}`,"theme-aware"];return this.responsive&&e.push("responsive"),this.animated&&e.push("animated"),this.theme.highContrast&&e.push("high-contrast"),e.join(" ")}applyStyles(){try{const e={position:"absolute",boxSizing:"border-box",userSelect:"none",outline:"none",transition:this.animated?"all 0.3s ease":"none",backgroundColor:"var(--theme-surface)",color:"var(--theme-text)",borderColor:"var(--theme-border)",minWidth:this.focusable?`${h.TOUCH_TARGET_SIZE}px`:"auto",minHeight:this.focusable?`${h.TOUCH_TARGET_SIZE}px`:"auto",willChange:this.animated?"transform, opacity":"auto",backfaceVisibility:"hidden",transform:"translateZ(0)",...this.styles};Object.assign(this.element.style,e),this.addFocusStyles()}catch(e){this.errorHandler(e,"applyStyles")}}addFocusStyles(){if(!this.focusable)return;const e=document.createElement("style");e.textContent=`
            #${this.id}:focus {
                outline: ${h.FOCUS_RING_WIDTH}px solid var(--theme-primary);
                outline-offset: 2px;
                box-shadow: 0 0 0 4px var(--theme-primary)20;
            }
            
            #${this.id}:focus:not(:focus-visible) {
                outline: none;
                box-shadow: none;
            }
        `,document.head.appendChild(e)}setupAccessibility(){if(!(!this.accessible||!this.element))try{this.ariaLabel&&this.element.setAttribute("aria-label",this.ariaLabel),this.ariaRole&&this.element.setAttribute("role",this.ariaRole),this.element.setAttribute("tabindex",this.tabIndex),this.element.setAttribute("aria-hidden",this.visible?"false":"true"),"ontouchstart"in window&&(this.element.style.touchAction="manipulation")}catch(e){this.errorHandler(e,"setupAccessibility")}}setupEventListeners(){if(this.element)try{this.focusable&&(this.addEventListener("keydown",this.handleKeyDown.bind(this)),this.addEventListener("keyup",this.handleKeyUp.bind(this))),this.addEventListener("mouseenter",this.handleMouseEnter.bind(this)),this.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),"ontouchstart"in window&&(this.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!0}),this.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!0})),this.addEventListener("focus",this.handleFocus.bind(this)),this.addEventListener("blur",this.handleBlur.bind(this))}catch(e){this.errorHandler(e,"setupEventListeners")}}setupThemeMonitoring(){const e=window.matchMedia?.("(prefers-contrast: high)"),t=window.matchMedia?.("(prefers-reduced-motion: reduce)"),s=()=>{this.theme=M.getCurrentTheme(),this.updateTheme()};e?.addEventListener?.("change",s),t?.addEventListener?.("change",s),this.themeQueries={contrastQuery:e,motionQuery:t},this.themeChangeHandler=s}updateTheme(){try{this.animated=!this.theme.reducedMotion,this.element.className=this.getElementClasses(),M.applyThemeToElement(this.element,this.theme),this.applyStyles(),this.emit("themeChanged",this.theme)}catch(e){this.errorHandler(e,"updateTheme")}}handleKeyDown(e){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),this.emit("activate",{event:e,source:"keyboard"})),this.emit("keyDown",{event:e,key:e.key})}handleKeyUp(e){this.emit("keyUp",{event:e,key:e.key})}handleMouseEnter(e){this.element.classList.add("hover"),this.emit("mouseEnter",{event:e})}handleMouseLeave(e){this.element.classList.remove("hover"),this.emit("mouseLeave",{event:e})}handleTouchStart(e){this.element.classList.add("active"),this.emit("touchStart",{event:e})}handleTouchEnd(e){this.element.classList.remove("active"),this.emit("touchEnd",{event:e})}handleFocus(e){this.element.classList.add("focused"),this.emit("focus",{event:e})}handleBlur(e){this.element.classList.remove("focused"),this.emit("blur",{event:e})}updateElementPosition(){this.element&&(this.element.style.left=`${this.position.x}px`,this.element.style.top=`${this.position.y}px`,this.element.style.width=`${this.size.width}px`,this.element.style.height=`${this.size.height}px`,this.element.style.zIndex=this.zIndex,this.responsive&&this.updateResponsiveStyles())}updateResponsiveStyles(){const e=window.innerWidth,t=e<h.BREAKPOINTS.mobile,s=e<h.BREAKPOINTS.tablet;this.element.classList.toggle("mobile",t),this.element.classList.toggle("tablet",s&&!t),this.element.classList.toggle("desktop",!s),t&&this.focusable&&(this.element.style.minWidth=`${h.TOUCH_TARGET_SIZE}px`,this.element.style.minHeight=`${h.TOUCH_TARGET_SIZE}px`)}setEngine(e){this.engine=e,e&&e.container&&e.container.appendChild(this.element)}setPosition(e,t){this.position.x=e,this.position.y=t,this.updateElementPosition()}setSize(e,t){this.size.width=e,this.size.height=t,this.updateElementPosition()}show(){this.visible=!0,this.element&&(this.element.style.display="block",this.element.setAttribute("aria-hidden","false"),this.animated&&(this.element.style.opacity="0",this.element.style.transform="scale(0.95)",requestAnimationFrame(()=>{this.element.style.transition="opacity 0.3s ease, transform 0.3s ease",this.element.style.opacity="1",this.element.style.transform="scale(1)"}))),this.emit("show")}hide(){this.visible=!1,this.element&&(this.animated?(this.element.style.transition="opacity 0.3s ease, transform 0.3s ease",this.element.style.opacity="0",this.element.style.transform="scale(0.95)",setTimeout(()=>{this.element.style.display="none",this.element.setAttribute("aria-hidden","true")},N.FAST)):(this.element.style.display="none",this.element.setAttribute("aria-hidden","true"))),this.emit("hide")}addEventListener(e,t,s={}){this.performanceOptions.debounceEvents&&["resize","scroll","mousemove"].includes(e)&&(t=this.debounce(t,h.DEBOUNCE_DELAY)),this.element?.addEventListener(e,t,s),this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:t,options:s})}removeEventListener(e,t){this.element?.removeEventListener(e,t);const s=this.listeners.get(e);if(s){const i=s.findIndex(n=>n.callback===t);i>-1&&s.splice(i,1)}}debounce(e,t){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>e.apply(this,i),t)}}on(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}emit(e,t={}){this.events.has(e)&&this.events.get(e).forEach(s=>{try{s(t)}catch(i){this.errorHandler(i,`emit-${e}`)}})}defaultErrorHandler(e,t){d.error(`UI Component Error (${t}):`,e),this.emit("error",{error:e,context:t})}announce(e,t="polite"){const s=document.createElement("div");s.setAttribute("aria-live",t),s.setAttribute("aria-atomic","true"),s.style.position="absolute",s.style.left="-10000px",s.style.width="1px",s.style.height="1px",s.style.overflow="hidden",document.body.appendChild(s),setTimeout(()=>{s.textContent=e,setTimeout(()=>{document.body.removeChild(s)},1e3)},100)}update(e){this.emit("update",{deltaTime:e})}render(e){}destroy(){try{if(this.listeners.forEach((e,t)=>{e.forEach(({callback:s})=>{this.element?.removeEventListener(t,s)})}),this.listeners.clear(),this.themeQueries){const{contrastQuery:e,motionQuery:t}=this.themeQueries;e?.removeEventListener?.("change",this.themeChangeHandler),t?.removeEventListener?.("change",this.themeChangeHandler)}this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.engine=null,this.events.clear(),this.emit("destroyed")}catch(e){this.errorHandler(e,"destroy")}}}class B extends L{constructor(e={}){super({...e,ariaRole:"dialog",ariaLabel:e.title||"Panel",styles:{backgroundColor:"var(--theme-surface)",border:"1px solid var(--theme-border)",borderRadius:"12px",padding:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif",backdropFilter:"blur(10px)",...e.styles}}),this.title=e.title||"",this.content=e.content||"",this.components=[],this.resizable=e.resizable===!0,this.closable=e.closable!==!1,this.modal=e.modal===!0,this.createContent(),this.setupPanelBehavior()}getElementTag(){return"section"}getElementClasses(){const e=super.getElementClasses(),t=["ui-panel"];return this.modal&&t.push("modal-dialog"),this.resizable&&t.push("resizable"),this.closable&&t.push("closable"),`${e} ${t.join(" ")}`}createContent(){try{this.element.innerHTML=`
                ${this.closable?`
                    <button class="panel-close" aria-label="Close panel" tabindex="0">
                        <span aria-hidden="true">&times;</span>
                    </button>
                `:""}
                ${this.title?`
                    <header class="panel-header">
                        <h2 class="panel-title">${this.title}</h2>
                    </header>
                `:""}
                <main class="panel-content" role="main">${this.content}</main>
                <footer class="panel-controls" role="toolbar"></footer>
            `,this.styleContent()}catch(e){this.errorHandler(e,"createContent")}}styleContent(){const e=this.element.querySelector(".panel-close");e&&(Object.assign(e.style,{position:"absolute",top:"10px",right:"10px",background:"none",border:"none",fontSize:"24px",color:"var(--theme-text)",cursor:"pointer",width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s ease"}),e.addEventListener("click",()=>this.close()),e.addEventListener("mouseenter",()=>{e.style.backgroundColor="var(--theme-border)"}),e.addEventListener("mouseleave",()=>{e.style.backgroundColor="transparent"}));const t=this.element.querySelector(".panel-header");t&&Object.assign(t.style,{fontWeight:"600",marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid var(--theme-border)",color:"var(--theme-text)"});const s=this.element.querySelector(".panel-title");s&&Object.assign(s.style,{margin:"0",fontSize:"18px",fontWeight:"600",color:"var(--theme-text)"});const i=this.element.querySelector(".panel-content");i&&Object.assign(i.style,{marginBottom:"16px",lineHeight:"1.5",color:"var(--theme-text)",maxHeight:this.modal?"60vh":"none",overflowY:this.modal?"auto":"visible"});const n=this.element.querySelector(".panel-controls");n&&Object.assign(n.style,{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end",paddingTop:"12px",borderTop:"1px solid var(--theme-border)"})}setupPanelBehavior(){this.modal&&this.setupModalBehavior(),this.resizable&&this.setupResizableBehavior(),this.addEventListener("keydown",e=>{e.key==="Escape"&&this.closable&&this.close()})}setupModalBehavior(){this.backdrop=document.createElement("div"),this.backdrop.className="modal-backdrop",Object.assign(this.backdrop.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",zIndex:this.zIndex-1,display:"none"}),this.backdrop.addEventListener("click",e=>{e.target===this.backdrop&&this.close()}),document.body.appendChild(this.backdrop)}setupResizableBehavior(){["n","e","s","w","ne","se","sw","nw"].forEach(t=>{const s=document.createElement("div");switch(s.className=`resize-handle resize-${t}`,s.style.cssText=`
                position: absolute;
                background: transparent;
                cursor: ${t}-resize;
            `,t){case"n":case"s":s.style.cssText+="left: 0; right: 0; height: 4px;",s.style[t==="n"?"top":"bottom"]="-2px";break;case"e":case"w":s.style.cssText+="top: 0; bottom: 0; width: 4px;",s.style[t==="e"?"right":"left"]="-2px";break;default:s.style.cssText+="width: 8px; height: 8px;",t.includes("n")&&(s.style.top="-4px"),t.includes("s")&&(s.style.bottom="-4px"),t.includes("e")&&(s.style.right="-4px"),t.includes("w")&&(s.style.left="-4px")}this.setupResizeHandle(s,t),this.element.appendChild(s)})}setupResizeHandle(e,t){let s=!1,i,n,o,r,c,a;e.addEventListener("mousedown",f=>{s=!0,i=f.clientX,n=f.clientY;const p=this.element.getBoundingClientRect();o=p.width,r=p.height,c=p.left,a=p.top,document.addEventListener("mousemove",b),document.addEventListener("mouseup",A),f.preventDefault()});const b=f=>{if(!s)return;const p=f.clientX-i,C=f.clientY-n;let E=o,x=r,S=c,m=a;t.includes("e")&&(E+=p),t.includes("w")&&(E-=p,S+=p),t.includes("s")&&(x+=C),t.includes("n")&&(x-=C,m+=C),E=Math.max(h.MIN_PANEL_WIDTH,E),x=Math.max(h.MIN_PANEL_HEIGHT,x),this.setSize(E,x),this.setPosition(S,m)},A=()=>{s=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",A)}}setContent(e){const t=this.element.querySelector(".panel-content");t&&(t.innerHTML=e)}close(){this.emit("beforeClose"),this.animated?(this.element.style.transition="opacity 0.3s ease, transform 0.3s ease",this.element.style.opacity="0",this.element.style.transform="scale(0.95)",this.backdrop&&(this.backdrop.style.transition="opacity 0.3s ease",this.backdrop.style.opacity="0"),setTimeout(()=>{this.hide(),this.emit("closed")},N.FAST)):(this.hide(),this.emit("closed"))}show(){this.modal&&this.backdrop&&(this.backdrop.style.display="block",this.animated&&(this.backdrop.style.opacity="0",requestAnimationFrame(()=>{this.backdrop.style.transition="opacity 0.3s ease",this.backdrop.style.opacity="1"}))),super.show();const e=this.element.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');e&&setTimeout(()=>e.focus(),h.FOCUS_TRANSITION_DELAY)}hide(){this.backdrop&&(this.backdrop.style.display="none"),super.hide()}addButton(e,t,s={}){const i=document.createElement("button");i.textContent=e,i.className="panel-button ui-button",i.type="button",s.ariaLabel&&i.setAttribute("aria-label",s.ariaLabel),s.disabled&&(i.disabled=!0,i.setAttribute("aria-disabled","true")),Object.assign(i.style,{padding:"8px 16px",margin:"4px",border:"none",backgroundColor:"var(--theme-primary)",color:"white",borderRadius:"6px",cursor:s.disabled?"not-allowed":"pointer",fontSize:"14px",fontWeight:"500",fontFamily:"inherit",minHeight:`${h.TOUCH_TARGET_SIZE}px`,transition:"all 0.2s ease",outline:"none",opacity:s.disabled?"0.6":"1",...s.styles}),s.disabled||(i.addEventListener("click",o=>{try{t(o)}catch(r){this.errorHandler(r,"button-click")}}),i.addEventListener("mouseenter",()=>{i.disabled||(i.style.transform="translateY(-1px)",i.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)")}),i.addEventListener("mouseleave",()=>{i.style.transform="translateY(0)",i.style.boxShadow="none"}),i.addEventListener("mousedown",()=>{i.style.transform="translateY(0) scale(0.98)"}),i.addEventListener("mouseup",()=>{i.style.transform="translateY(-1px) scale(1)"}),i.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),i.click())})),i.addEventListener("focus",()=>{i.style.outline="2px solid var(--theme-primary)",i.style.outlineOffset="2px"}),i.addEventListener("blur",()=>{i.style.outline="none"});const n=this.element.querySelector(".panel-controls");return n&&n.appendChild(i),i}addSlider(e,t,s,i,n,o={}){const r=document.createElement("div");r.className="slider-container",r.style.marginBottom="16px";const c=document.createElement("label");c.textContent=e,c.style.cssText=`
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--theme-text);
        `;const a=document.createElement("input");a.type="range",a.min=t,a.max=s,a.value=i,a.step=o.step||1,a.className="panel-slider";const b=`slider-${this.id}-${Date.now()}`;a.id=b,c.setAttribute("for",b),a.setAttribute("role","slider"),a.setAttribute("aria-valuemin",t),a.setAttribute("aria-valuemax",s),a.setAttribute("aria-valuenow",i),a.setAttribute("aria-label",e),Object.assign(a.style,{width:"100%",height:"6px",borderRadius:"3px",background:"var(--theme-border)",outline:"none",appearance:"none",marginBottom:"8px",cursor:"pointer",...o.styles});const A=document.createElement("style");A.textContent=`
            #${b}::-webkit-slider-thumb {
                appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--theme-primary);
                cursor: pointer;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                transition: transform 0.2s ease;
            }
            
            #${b}::-webkit-slider-thumb:hover {
                transform: scale(1.1);
            }
            
            #${b}::-moz-range-thumb {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--theme-primary);
                cursor: pointer;
                border: none;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            
            #${b}:focus::-webkit-slider-thumb {
                outline: 2px solid var(--theme-primary);
                outline-offset: 2px;
            }
        `,document.head.appendChild(A);const f=document.createElement("div");f.className="slider-value-display",f.style.cssText=`
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--theme-text);
            opacity: 0.8;
        `;const p=document.createElement("span");p.textContent=i,p.style.fontWeight="600";const C=document.createElement("span");C.textContent=`${t} - ${s}`,f.appendChild(p),f.appendChild(C);const E=m=>{const y=parseFloat(m.target.value);p.textContent=y,a.setAttribute("aria-valuenow",y);try{n(y,m)}catch(g){this.errorHandler(g,"slider-change")}},x=this.debounce(E,h.FOCUS_DELAY);a.addEventListener("input",x),a.addEventListener("input",m=>{const y=parseFloat(m.target.value);p.textContent=y,a.setAttribute("aria-valuenow",y)}),a.addEventListener("keydown",m=>{const y=parseFloat(a.step);let g=parseFloat(a.value);switch(m.key){case"ArrowUp":case"ArrowRight":m.preventDefault(),g=Math.min(s,g+y);break;case"ArrowDown":case"ArrowLeft":m.preventDefault(),g=Math.max(t,g-y);break;case"Home":m.preventDefault(),g=t;break;case"End":m.preventDefault(),g=s;break;case"PageUp":m.preventDefault(),g=Math.min(s,g+y*10);break;case"PageDown":m.preventDefault(),g=Math.max(t,g-y*10);break;default:return}a.value=g,E({target:a})}),r.appendChild(c),r.appendChild(a),r.appendChild(f);const S=this.element.querySelector(".panel-controls");return S&&S.appendChild(r),{container:r,slider:a,valueDisplay:f,setValue:m=>{a.value=m,p.textContent=m,a.setAttribute("aria-valuenow",m)}}}destroy(){this.backdrop&&this.backdrop.parentNode&&this.backdrop.parentNode.removeChild(this.backdrop),super.destroy()}}class P extends L{constructor(e={}){super({...e,ariaRole:"status",ariaLabel:"Ethics metrics display",accessible:!0,animated:e.animated!==!1,styles:{backgroundColor:"var(--theme-surface)",color:"var(--theme-text)",border:"1px solid var(--theme-border)",borderRadius:"12px",padding:"20px",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif",backdropFilter:"blur(10px)",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",...e.styles}}),this.metrics=e.metrics||new Map,this.showLabels=e.showLabels!==!1,this.showValues=e.showValues!==!1,this.format=e.format||"percentage",this.colorMode=e.colorMode||"gradient",this.animated=e.animated!==!1&&!this.theme.reducedMotion,this.colorSchemes={gradient:{low:"#ef4444",medium:"#f59e0b",high:"#22c55e"},threshold:{poor:"#ef4444",fair:"#f59e0b",good:"#22c55e",excellent:"#06b6d4"}},this.createMetersDisplay(),this.setupLiveRegion()}getElementTag(){return"section"}getElementClasses(){const e=super.getElementClasses(),t=["ethics-display"];return this.animated&&t.push("animated"),this.colorMode&&t.push(`color-${this.colorMode}`),`${e} ${t.join(" ")}`}createMetersDisplay(){try{this.element.innerHTML=`
                <header class="ethics-header">
                    <h3 class="ethics-title">Ethics Metrics</h3>
                    <div class="ethics-summary" aria-live="polite"></div>
                </header>
                <main class="ethics-meters" role="main"></main>
            `,this.styleHeader(),this.renderMeters()}catch(e){this.errorHandler(e,"createMetersDisplay")}}styleHeader(){const e=this.element.querySelector(".ethics-header");e&&Object.assign(e.style,{marginBottom:"16px",borderBottom:"1px solid var(--theme-border)",paddingBottom:"12px"});const t=this.element.querySelector(".ethics-title");t&&Object.assign(t.style,{margin:"0 0 8px 0",fontSize:"18px",fontWeight:"600",color:"var(--theme-text)"});const s=this.element.querySelector(".ethics-summary");s&&Object.assign(s.style,{fontSize:"12px",color:"var(--theme-text)",opacity:"0.8"})}setupLiveRegion(){this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","false"),this.liveRegion.style.cssText=`
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        `,this.element.appendChild(this.liveRegion)}renderMeters(){const e=this.element.querySelector(".ethics-meters");e&&(e.innerHTML="",this.metrics.forEach((t,s)=>{const i=this.createMeter(t,s);e.appendChild(i)}),this.updateSummary())}createMeter(e,t){const s=document.createElement("div");s.className="ethics-meter",s.setAttribute("data-metric",t);const i=`label-${this.id}-${t}`,n=`value-${this.id}-${t}`,o=Math.round(e.value||0),r=this.formatValue(e.value||0),c=this.getColorForValue(e.value||0),a=e.description||`${e.label} level`;return s.innerHTML=`
            ${this.showLabels?`
                <div class="meter-label" id="${i}">
                    ${e.label}
                    ${e.description?`<span class="meter-description">${e.description}</span>`:""}
                </div>
            `:""}
            
            <div class="meter-container" role="progressbar" 
                 aria-labelledby="${i}" 
                 aria-describedby="${n}"
                 aria-valuemin="0" 
                 aria-valuemax="100" 
                 aria-valuenow="${o}"
                 aria-valuetext="${r} ${a}">
                 
                <div class="meter-track"></div>
                <div class="meter-fill" style="width: 0%; background-color: ${c};"></div>
                
                ${this.showValues?`
                    <div class="meter-value" id="${n}" aria-hidden="true">
                        ${r}
                    </div>
                `:""}
            </div>
        `,this.styleMeter(s,e),s}styleMeter(e,t){Object.assign(e.style,{marginBottom:"16px",position:"relative"});const s=e.querySelector(".meter-label");s&&Object.assign(s.style,{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"var(--theme-text)"});const i=e.querySelector(".meter-description");i&&Object.assign(i.style,{fontSize:"12px",fontWeight:"400",opacity:"0.7",fontStyle:"italic"});const n=e.querySelector(".meter-container");n&&Object.assign(n.style,{position:"relative",height:"12px",borderRadius:"6px",overflow:"hidden",backgroundColor:"var(--theme-border)",border:"1px solid var(--theme-border)"});const o=e.querySelector(".meter-track");o&&Object.assign(o.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.1)",borderRadius:"6px"});const r=e.querySelector(".meter-fill");r&&Object.assign(r.style,{position:"absolute",top:"0",left:"0",height:"100%",borderRadius:"6px",transition:this.animated?"width 0.8s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s ease":"none",backgroundImage:this.colorMode==="gradient"?"linear-gradient(90deg, var(--meter-color) 0%, var(--meter-color) 100%)":"none"});const c=e.querySelector(".meter-value");c&&Object.assign(c.style,{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",fontSize:"11px",fontWeight:"600",color:"var(--theme-text)",textShadow:"0 1px 2px rgba(0,0,0,0.3)",pointerEvents:"none"})}getColorForValue(e){if(this.colorMode==="single")return this.colorSchemes.gradient.high;const t=Math.max(0,Math.min(100,e))/100;return this.colorMode==="threshold"?t<T.OPACITY_30?this.colorSchemes.threshold.poor:t<T.HALF?this.colorSchemes.threshold.fair:t<T.OPACITY_80?this.colorSchemes.threshold.good:this.colorSchemes.threshold.excellent:t<T.HALF?this.interpolateColor(this.colorSchemes.gradient.low,this.colorSchemes.gradient.medium,t*2):this.interpolateColor(this.colorSchemes.gradient.medium,this.colorSchemes.gradient.high,(t-T.HALF)*T.TWO)}interpolateColor(e,t,s){const i=this.hexToRgb(e),n=this.hexToRgb(t),o=Math.round(i.r+(n.r-i.r)*s),r=Math.round(i.g+(n.g-i.g)*s),c=Math.round(i.b+(n.b-i.b)*s);return`rgb(${o}, ${r}, ${c})`}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}}formatValue(e){switch(this.format){case"decimal":return(e/100).toFixed(2);case"score":return`${Math.round(e)}/100`;case"percentage":default:return`${Math.round(e)}%`}}updateSummary(){const e=this.element.querySelector(".ethics-summary");if(!e||this.metrics.size===0)return;const t=Array.from(this.metrics.values()).map(o=>o.value||0),s=t.reduce((o,r)=>o+r,0)/t.length,i=this.metrics.size,n=this.getEthicsGrade(s);e.textContent=`Overall: ${this.formatValue(s)} (${n}) • ${i} metrics`}getEthicsGrade(e){return e>=h.ETHICS_GRADES.EXCELLENT?"Excellent":e>=h.ETHICS_GRADES.GOOD?"Good":e>=h.ETHICS_GRADES.FAIR?"Fair":e>=h.ETHICS_GRADES.NEEDS_IMPROVEMENT?"Needs Improvement":"Critical Issues"}updateMetric(e,t,s={}){const i=this.metrics.get(e);if(!i)return;const n=i.value||0;i.value=Math.max(0,Math.min(100,t));const o=this.element.querySelector(`[data-metric="${e}"]`);if(!o)return;const r=o.querySelector(".meter-fill"),c=o.querySelector(".meter-value"),a=o.querySelector(".meter-container");if(r){const b=this.getColorForValue(i.value);r.style.backgroundColor=b,this.animated&&!this.theme.reducedMotion?r.style.width=`${i.value}%`:r.style.width=`${i.value}%`}if(c&&(c.textContent=this.formatValue(i.value)),a&&(a.setAttribute("aria-valuenow",Math.round(i.value)),a.setAttribute("aria-valuetext",`${this.formatValue(i.value)} ${i.description||i.label}`)),Math.abs(t-n)>=10){const b=`${i.label} changed to ${this.formatValue(i.value)}`;this.announce(b)}this.updateSummary(),this.emit("metricUpdated",{metricName:e,oldValue:n,newValue:i.value})}addMetric(e,t){this.metrics.set(e,{label:t.label||e,value:t.value||0,description:t.description||"",color:t.color||null}),this.renderMeters(),this.emit("metricAdded",{name:e,config:t})}removeMetric(e){this.metrics.delete(e)&&(this.renderMeters(),this.emit("metricRemoved",{name:e}))}getMetrics(){const e={};return this.metrics.forEach((t,s)=>{e[s]=t.value}),e}setMetrics(e){Object.entries(e).forEach(([t,s])=>{this.metrics.has(t)&&this.updateMetric(t,s)})}resetMetrics(){this.metrics.forEach((e,t)=>{this.updateMetric(t,0)}),this.emit("metricsReset")}}class z extends L{constructor(e={}){super({...e,ariaRole:"alert",ariaLabel:"Feedback system",accessible:!0,animated:e.animated!==!1,styles:{backgroundColor:"var(--theme-surface)",color:"var(--theme-text)",border:"1px solid var(--theme-border)",borderRadius:"12px",padding:"16px",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif",maxWidth:"400px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",...e.styles}}),this.feedbackQueue=[],this.currentFeedback=null,this.autoHide=e.autoHide!==!1,this.hideDelay=e.hideDelay||h.DEFAULT_HIDE_DELAY,this.maxItems=e.maxItems||h.MAX_FEEDBACK_ITEMS,this.position=e.position||"top-right",this.createFeedbackContainer(),this.setupPositioning()}getElementTag(){return"aside"}getElementClasses(){const e=super.getElementClasses(),t=["feedback-system",`position-${this.position}`];return this.animated&&t.push("animated"),`${e} ${t.join(" ")}`}createFeedbackContainer(){try{this.element.innerHTML=`
                <div class="feedback-header" style="display: none;">
                    <h3 class="feedback-title">Notifications</h3>
                    <button class="feedback-clear" aria-label="Clear all notifications">Clear All</button>
                </div>
                <div class="feedback-list" role="log" aria-live="polite" aria-atomic="false"></div>
            `,this.setupFeedbackBehavior()}catch(e){this.errorHandler(e,"createFeedbackContainer")}}setupPositioning(){const e={"top-right":{top:"20px",right:"20px"},"top-left":{top:"20px",left:"20px"},"bottom-right":{bottom:"20px",right:"20px"},"bottom-left":{bottom:"20px",left:"20px"}},t=e[this.position]||e["top-right"];Object.assign(this.element.style,{position:"fixed",...t,zIndex:"9999",pointerEvents:"auto"})}setupFeedbackBehavior(){const e=this.element.querySelector(".feedback-clear");e&&(e.addEventListener("click",()=>this.clearAll()),Object.assign(e.style,{background:"none",border:"none",color:"var(--theme-primary)",cursor:"pointer",fontSize:"12px",textDecoration:"underline"}))}showFeedback(e,t="info",s={}){try{const i={id:`feedback-${Date.now()}-${Math.random().toString(h.RANDOM_BASE).substr(2,h.RANDOM_ID_LENGTH)}`,message:e,type:t,timestamp:new Date,duration:s.duration||this.hideDelay,persistent:s.persistent===!0,actions:s.actions||[]};return this.feedbackQueue.push(i),this.feedbackQueue.length>this.maxItems&&this.feedbackQueue.shift(),this.renderFeedback(i),this.autoHide&&!i.persistent&&setTimeout(()=>{this.hideFeedback(i.id)},i.duration),this.emit("feedbackShown",i),i.id}catch(i){return this.errorHandler(i,"showFeedback"),null}}renderFeedback(e){const t=this.element.querySelector(".feedback-list");if(!t)return;const s=document.createElement("div");s.className=`feedback-item feedback-${e.type}`,s.setAttribute("data-feedback-id",e.id),s.setAttribute("role","alert"),s.setAttribute("aria-live","assertive");const i={success:"✓",error:"✕",warning:"⚠",info:"ℹ"},n={success:"#22c55e",error:"#ef4444",warning:"#f59e0b",info:"#3b82f6"};s.innerHTML=`
            <div class="feedback-icon" aria-hidden="true">${i[e.type]||i.info}</div>
            <div class="feedback-content">
                <div class="feedback-message">${e.message}</div>
                ${e.actions.length>0?`
                    <div class="feedback-actions">
                        ${e.actions.map(o=>`
                            <button class="feedback-action" data-action="${o.id}">
                                ${o.label}
                            </button>
                        `).join("")}
                    </div>
                `:""}
            </div>
            ${e.persistent?"":`
                <button class="feedback-close" aria-label="Close notification" data-close="${e.id}">
                    <span aria-hidden="true">&times;</span>
                </button>
            `}
        `,Object.assign(s.style,{display:"flex",alignItems:"flex-start",gap:"12px",padding:"16px",marginBottom:"12px",backgroundColor:"var(--theme-surface)",border:`1px solid ${n[e.type]}`,borderLeft:`4px solid ${n[e.type]}`,borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",position:"relative",opacity:"0",transform:this.position.includes("top")?"translateY(-20px)":"translateY(20px)",transition:this.animated?"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)":"none"}),this.styleFeedbackComponents(s,e,n[e.type]),this.setupFeedbackEventHandlers(s,e),t.appendChild(s),this.animated?requestAnimationFrame(()=>{s.style.opacity="1",s.style.transform="translateY(0)"}):(s.style.opacity="1",s.style.transform="translateY(0)"),this.updateHeader()}styleFeedbackComponents(e,t,s){const i=e.querySelector(".feedback-icon");i&&Object.assign(i.style,{color:s,fontSize:"18px",fontWeight:"bold",minWidth:"20px",textAlign:"center"});const n=e.querySelector(".feedback-content");n&&Object.assign(n.style,{flex:"1",lineHeight:"1.4"});const o=e.querySelector(".feedback-message");o&&Object.assign(o.style,{color:"var(--theme-text)",marginBottom:t.actions.length>0?"8px":"0"});const r=e.querySelector(".feedback-actions");r&&Object.assign(r.style,{display:"flex",gap:"8px",flexWrap:"wrap"}),e.querySelectorAll(".feedback-action").forEach(a=>{Object.assign(a.style,{padding:"4px 12px",border:`1px solid ${s}`,backgroundColor:"transparent",color:s,borderRadius:"4px",fontSize:"12px",cursor:"pointer",transition:"all 0.2s ease"}),a.addEventListener("mouseenter",()=>{a.style.backgroundColor=s,a.style.color="white"}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor="transparent",a.style.color=s})});const c=e.querySelector(".feedback-close");c&&(Object.assign(c.style,{position:"absolute",top:"8px",right:"8px",background:"none",border:"none",fontSize:"18px",color:"var(--theme-text)",cursor:"pointer",width:"24px",height:"24px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",opacity:"0.7",transition:"all 0.2s ease"}),c.addEventListener("mouseenter",()=>{c.style.opacity="1",c.style.backgroundColor="var(--theme-border)"}),c.addEventListener("mouseleave",()=>{c.style.opacity="0.7",c.style.backgroundColor="transparent"}))}setupFeedbackEventHandlers(e,t){const s=e.querySelector(".feedback-close");s&&s.addEventListener("click",()=>{this.hideFeedback(t.id)}),e.querySelectorAll(".feedback-action").forEach(i=>{i.addEventListener("click",n=>{const o=i.getAttribute("data-action"),r=t.actions.find(c=>c.id===o);if(r&&r.handler)try{r.handler(t,n)}catch(c){this.errorHandler(c,"feedback-action")}t.persistent||this.hideFeedback(t.id)})}),e.addEventListener("keydown",i=>{this.disabled||i.key==="Escape"&&this.hideFeedback(t.id)})}hideFeedback(e){const t=this.element.querySelector(`[data-feedback-id="${e}"]`);t&&(this.animated?(t.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",t.style.opacity="0",t.style.transform=this.position.includes("top")?"translateY(-20px)":"translateY(20px)",t.style.maxHeight="0",t.style.marginBottom="0",t.style.padding="0 16px",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),this.updateHeader()},h.CLEANUP_DELAY)):(t.parentNode?.removeChild(t),this.updateHeader()),this.feedbackQueue=this.feedbackQueue.filter(s=>s.id!==e),this.emit("feedbackHidden",{feedbackId:e}))}updateHeader(){const e=this.element.querySelector(".feedback-header"),t=this.element.querySelectorAll(".feedback-item");e&&(e.style.display=t.length>1?"flex":"none",t.length>1&&Object.assign(e.style,{justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid var(--theme-border)",marginBottom:"12px"}))}showSuccess(e,t={}){return this.showFeedback(e,"success",t)}showError(e,t={}){return this.showFeedback(e,"error",{...t,persistent:!0})}showWarning(e,t={}){return this.showFeedback(e,"warning",t)}showInfo(e,t={}){return this.showFeedback(e,"info",t)}clearAll(){this.element.querySelectorAll(".feedback-item").forEach(t=>{const s=t.getAttribute("data-feedback-id");this.hideFeedback(s)}),this.emit("allFeedbackCleared")}getCount(){return this.feedbackQueue.length}hasItems(){return this.feedbackQueue.length>0}}const l={ANNOUNCEMENT_DELAY:100,FOCUS_DELAY:16,KEYBOARD_REPEAT_DELAY:200,ANIMATION_DURATION:250,HIGH_CONTRAST_THRESHOLD:4.5,TOUCH_TARGET_MIN_SIZE:44,SCREEN_READER_DELAY_MULTIPLIER:1.5,FEATURE_DISABLE_TIMEOUT:3e4,FOCUS_HISTORY_LIMIT:50,ANNOUNCEMENT_TIMEOUT:2e3,ANNOUNCEMENT_CLEAR_DELAY:1500,ANNOUNCEMENT_MIN_DURATION:1e3,ANNOUNCEMENT_CHAR_MULTIPLIER:50,GESTURE_TIMEOUT:5e3,FOCUS_BORDER_OFFSET:3,FOCUS_BORDER_PADDING:6,ETHICS_SIGNIFICANT_CHANGE:20,ETHICS_HIGH_PRIORITY:15,PERFORMANCE_EXCELLENT:90,PERFORMANCE_GOOD:75,PERFORMANCE_SATISFACTORY:60},O={NVDA:/nvda/i,JAWS:/jaws/i,VOICEOVER:/voiceover/i,NARRATOR:/narrator/i,DRAGON:/dragon/i};class R{static getCurrentTheme(){const e=window.matchMedia?.("(prefers-contrast: high)").matches,t=window.matchMedia?.("(prefers-reduced-motion: reduce)").matches;return{highContrast:e,reducedMotion:t,theme:e?"highContrast":"light"}}static getFocusStyle(e=null){return(e||this.getCurrentTheme()).highContrast?{outline:"3px solid #ffff00",outlineOffset:"2px",backgroundColor:"transparent"}:{outline:"2px solid #007bff",outlineOffset:"2px",backgroundColor:"rgba(0, 123, 255, 0.1)"}}}class F{static startOperation(e){const t=performance.now();return this.metrics.set(e,{startTime:t,operations:0}),t}static endOperation(e,t=null){const s=performance.now(),i=this.metrics.get(e);if(i){const n=s-(t||i.startTime);i.operations+=1,i.lastDuration=n,i.averageDuration=((i.averageDuration||0)*(i.operations-1)+n)/i.operations,n>l.FOCUS_DELAY*2&&d.warn(`Slow accessibility operation: ${e} took ${n.toFixed(2)}ms`)}}static getMetrics(){return Object.fromEntries(this.metrics)}}k(F,"metrics",new Map);class v extends Error{constructor(e,t={},s=null){super(e),this.name="AccessibilityError",this.context=t,this.originalError=s,this.timestamp=new Date().toISOString(),this.userAgent=navigator.userAgent,this.screenReader=w.detectScreenReaderType()}}class w{constructor(e,t){this.container=e,this.engine=t,this.components=new Map,this.focusableElements=[],this.currentFocusIndex=-1,this.keyboardNavigationEnabled=!0,this.screenReaderEnabled=this.detectScreenReader(),this.announcements=[],this.announcementDelay=l.ANNOUNCEMENT_DELAY,this.theme=R.getCurrentTheme(),this.isHighContrastMode=this.theme.highContrast,this.isReducedMotionMode=this.theme.reducedMotion,this.performanceMonitor=F,this.renderCache=new Map,this.gestureHandler=null,this.voiceCommands=new Map,this.keyboardShortcuts=new Map,this.focusHistory=[],this.regionManager=new Map,this.errorCount=0,this.lastError=null,this.init()}init(){const e=this.performanceMonitor.startOperation("accessibility-init");try{this.setupContainer(),this.setupKeyboardNavigation(),this.setupScreenReaderSupport(),this.setupFocusManagement(),this.setupThemeIntegration(),this.setupGestureSupport(),this.createAccessibilityOverlay(),this.setupPerformanceMonitoring(),this.setupThemeChangeListeners(),this.setupVoiceCommands(),d.info("Accessibility","Enhanced AccessibilityManager initialized with advanced features")}catch(t){this.handleError(new v("Failed to initialize AccessibilityManager",{container:this.container.id},t))}finally{this.performanceMonitor.endOperation("accessibility-init",e)}}setupContainer(){this.container.hasAttribute("tabindex")||this.container.setAttribute("tabindex","0"),this.container.hasAttribute("role")||this.container.setAttribute("role","application"),this.container.hasAttribute("aria-label")||this.container.setAttribute("aria-label","AI Ethics Simulation Environment"),this.container.setAttribute("aria-describedby","accessibility-description"),this.container.setAttribute("aria-live","polite"),this.container.setAttribute("aria-atomic","false"),this.container.classList.add("accessibility-enabled"),this.updateContainerTheme(),this.createAccessibilityDescription()}createAccessibilityDescription(){if(document.getElementById("accessibility-description"))return;const e=document.createElement("div");e.id="accessibility-description",e.className="sr-only",e.textContent="Interactive AI ethics simulation with keyboard navigation, screen reader support, and voice commands. Press ? for help.",document.body.appendChild(e)}updateContainerTheme(){this.container.classList.toggle("high-contrast",this.theme.highContrast),this.container.classList.toggle("reduced-motion",this.theme.reducedMotion),this.container.style.setProperty("--accessibility-focus-color",this.theme.highContrast?"#ffff00":"#007bff"),this.container.style.setProperty("--accessibility-bg-color",this.theme.highContrast?"#000000":"#ffffff")}setupThemeIntegration(){this.applyThemeSpecificStyles(),this.observeThemeChanges()}applyThemeSpecificStyles(){const e=R.getFocusStyle(this.theme);let t=document.getElementById("accessibility-focus-styles");t||(t=document.createElement("style"),t.id="accessibility-focus-styles",document.head.appendChild(t)),t.textContent=`
            .accessibility-enabled *:focus {
                outline: ${e.outline} !important;
                outline-offset: ${e.outlineOffset} !important;
                background-color: ${e.backgroundColor} !important;
            }
            
            .accessibility-enabled .focus-indicator {
                border: 3px solid ${this.theme.highContrast?"#ffff00":"#007bff"};
                box-shadow: ${this.theme.highContrast?"none":"0 0 0 1px white"};
            }
            
            .accessibility-enabled .high-contrast {
                filter: ${this.theme.highContrast?"contrast(200%) brightness(150%)":"none"};
            }
        `}observeThemeChanges(){const e=window.matchMedia("(prefers-contrast: high)"),t=window.matchMedia("(prefers-reduced-motion: reduce)"),s=()=>{this.theme=R.getCurrentTheme(),this.updateContainerTheme(),this.applyThemeSpecificStyles(),this.updateFocusIndicatorTheme(),this.announce(`Theme updated: ${this.theme.theme} mode`)};e.addEventListener?(e.addEventListener("change",s),t.addEventListener("change",s)):(e.addListener(s),t.addListener(s))}setupThemeChangeListeners(){document.addEventListener("themechange",e=>{this.theme=R.getCurrentTheme(),this.updateContainerTheme(),this.applyThemeSpecificStyles(),this.announce(`Application theme changed to ${e.detail.theme}`)})}setupGestureSupport(){"ontouchstart"in window&&(this.gestureHandler={startX:0,startY:0,threshold:50,restraint:100,allowedTime:300,startTime:0},this.container.addEventListener("touchstart",e=>this.handleTouchStart(e),{passive:!0}),this.container.addEventListener("touchend",e=>this.handleTouchEnd(e),{passive:!0}))}handleTouchStart(e){const t=e.changedTouches[0];this.gestureHandler.startX=t.pageX,this.gestureHandler.startY=t.pageY,this.gestureHandler.startTime=new Date().getTime()}handleTouchEnd(e){const t=e.changedTouches[0],s=t.pageX-this.gestureHandler.startX,i=t.pageY-this.gestureHandler.startY;if(new Date().getTime()-this.gestureHandler.startTime<=this.gestureHandler.allowedTime){if(Math.abs(s)>=this.gestureHandler.threshold&&Math.abs(i)<=this.gestureHandler.restraint){const o=s<0?"left":"right";this.handleSwipeGesture(o)}else if(Math.abs(i)>=this.gestureHandler.threshold&&Math.abs(s)<=this.gestureHandler.restraint){const o=i<0?"up":"down";this.handleSwipeGesture(o)}}}handleSwipeGesture(e){switch(e){case"right":this.handleTabNavigation(!1),this.announce("Swiped to next element");break;case"left":this.handleTabNavigation(!0),this.announce("Swiped to previous element");break;case"up":this.cycleFocusRegions(-1);break;case"down":this.cycleFocusRegions(1);break}}setupVoiceCommands(){if(!(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)))try{const e=window.SpeechRecognition||window.webkitSpeechRecognition;this.speechRecognition=new e,this.speechRecognition.continuous=!1,this.speechRecognition.interimResults=!1,this.speechRecognition.lang=navigator.language||"en-US",this.setupVoiceCommandMap(),this.speechRecognition.onresult=t=>{const s=t.results[0][0].transcript.toLowerCase().trim();this.processVoiceCommand(s)},this.speechRecognition.onerror=t=>{d.warn("Speech recognition error:",t.error)}}catch(e){d.warn("Voice commands setup failed:",e)}}setupVoiceCommandMap(){this.voiceCommands.set("next",()=>this.handleTabNavigation(!1)),this.voiceCommands.set("previous",()=>this.handleTabNavigation(!0)),this.voiceCommands.set("activate",()=>this.activateCurrentElement()),this.voiceCommands.set("help",()=>this.showKeyboardShortcuts()),this.voiceCommands.set("escape",()=>this.handleEscape()),this.voiceCommands.set("high contrast",()=>this.toggleHighContrastMode()),this.voiceCommands.set("large text",()=>this.toggleLargeTextMode())}processVoiceCommand(e){for(const[t,s]of this.voiceCommands)if(e.includes(t)){s(),this.announce(`Voice command executed: ${t}`);return}this.announce('Voice command not recognized. Say "help" for available commands.')}setupPerformanceMonitoring(){let e=0;const t=this.focusComponent;this.focusComponent=(...s)=>{const i=this.performanceMonitor.startOperation("focus-component"),n=t.apply(this,s);return this.performanceMonitor.endOperation("focus-component",i),e++,e%100===0&&d.info("Accessibility Performance:",this.performanceMonitor.getMetrics()),n}}setupKeyboardNavigation(){const e=this.throttle(t=>this.handleKeyDown(t),l.KEYBOARD_REPEAT_DELAY);this.container.addEventListener("keydown",e),this.container.addEventListener("keyup",t=>this.handleKeyUp(t)),this.container.addEventListener("focus",()=>this.onContainerFocus()),this.container.addEventListener("blur",()=>this.onContainerBlur()),this.setupKeyboardShortcuts()}setupKeyboardShortcuts(){this.keyboardShortcuts.set("ctrl+shift+?",()=>this.showKeyboardShortcuts()),this.keyboardShortcuts.set("ctrl+shift+h",()=>this.toggleHighContrastMode()),this.keyboardShortcuts.set("ctrl+shift+l",()=>this.toggleLargeTextMode()),this.keyboardShortcuts.set("ctrl+shift+v",()=>this.toggleVoiceCommands()),this.keyboardShortcuts.set("ctrl+shift+r",()=>this.resetAccessibilitySettings()),this.keyboardShortcuts.set("ctrl+shift+f",()=>this.showAccessibilityReport())}toggleVoiceCommands(){this.speechRecognition?this.voiceCommandsEnabled?(this.speechRecognition.stop(),this.voiceCommandsEnabled=!1,this.announce("Voice commands disabled")):(this.speechRecognition.start(),this.voiceCommandsEnabled=!0,this.announce('Voice commands enabled. Say "help" for available commands.')):this.announce("Voice commands not supported in this browser")}showAccessibilityReport(){const e=this.performanceMonitor.getMetrics(),t=this.components.size,s=this.focusableElements.length,i=`
            Accessibility Report:
            - ${t} registered components
            - ${s} focusable elements
            - Theme: ${this.theme.theme}
            - High contrast: ${this.theme.highContrast?"enabled":"disabled"}
            - Reduced motion: ${this.theme.reducedMotion?"enabled":"disabled"}
            - Screen reader: ${this.screenReaderEnabled?"detected":"not detected"}
            - Voice commands: ${this.voiceCommandsEnabled?"available":"not available"}
            - Performance: ${Object.keys(e).length} tracked operations
        `;this.announce(i,!0),d.info("Accessibility Report:",{metrics:e,theme:this.theme,components:t})}resetAccessibilitySettings(){this.setHighContrastMode(!1),this.setLargeTextMode(!1),this.setKeyboardNavigationEnabled(!0),this.speechRecognition&&this.voiceCommandsEnabled&&(this.speechRecognition.stop(),this.voiceCommandsEnabled=!1),this.announce("Accessibility settings reset to defaults")}setupScreenReaderSupport(){this.createAnnouncementRegions(),this.setupScreenReaderDetection()}createAnnouncementRegions(){this.liveRegion=this.createAnnouncementRegion("polite","accessibility-announcements"),this.urgentRegion=this.createAnnouncementRegion("assertive","accessibility-urgent"),this.statusRegion=this.createAnnouncementRegion("polite","accessibility-status"),this.statusRegion.setAttribute("aria-atomic","false"),this.logRegion=this.createAnnouncementRegion("polite","accessibility-log"),this.logRegion.setAttribute("role","log")}createAnnouncementRegion(e,t){if(document.getElementById(t))return document.getElementById(t);const s=document.createElement("div");return s.id=t,s.setAttribute("aria-live",e),s.setAttribute("aria-atomic","true"),s.className="sr-only",s.style.cssText=`
            position: absolute !important;
            left: -10000px !important;
            width: 1px !important;
            height: 1px !important;
            overflow: hidden !important;
            clip: rect(1px, 1px, 1px, 1px) !important;
            white-space: nowrap !important;
        `,document.body.appendChild(s),s}setupScreenReaderDetection(){this.screenReaderType=this.detectScreenReaderType(),this.screenReaderEnabled=this.screenReaderType!==null,this.screenReaderType&&this.adaptToScreenReader(this.screenReaderType)}detectScreenReaderType(){const{userAgent:e}=navigator;for(const[t,s]of Object.entries(O))if(s.test(e))return t.toLowerCase();return window.speechSynthesis&&window.speechSynthesis.getVoices().length>0?"speech-synthesis":window.matchMedia&&window.matchMedia("(prefers-contrast: high)").matches?"high-contrast-user":null}adaptToScreenReader(e){switch(e){case"nvda":case"jaws":this.announcementDelay=l.ANNOUNCEMENT_DELAY*l.SCREEN_READER_DELAY_MULTIPLIER,this.verboseMode=!0;break;case"voiceover":this.announcementDelay=l.ANNOUNCEMENT_DELAY,this.verboseMode=!1;break;case"narrator":this.announcementDelay=l.ANNOUNCEMENT_DELAY*2,this.verboseMode=!0;break;default:this.verboseMode=!1}d.info(`Accessibility optimized for ${e} screen reader`)}setupFocusManagement(){document.addEventListener("focusin",e=>this.onFocusChange(e)),document.addEventListener("focusout",e=>this.onFocusChange(e))}createAccessibilityOverlay(){this.overlay=document.createElement("div"),this.overlay.className="accessibility-overlay",this.overlay.setAttribute("aria-hidden","true"),this.overlay.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10000;
            contain: layout style;
        `,this.container.appendChild(this.overlay),this.createFocusIndicator(),this.createAccessibilityToolbar()}createFocusIndicator(){this.focusIndicator=document.createElement("div"),this.focusIndicator.className="focus-indicator",this.focusIndicator.setAttribute("aria-hidden","true"),this.updateFocusIndicatorTheme(),this.overlay.appendChild(this.focusIndicator)}updateFocusIndicatorTheme(){this.focusIndicator&&(this.focusIndicator.style.cssText=`
            position: absolute;
            border: 3px solid ${this.theme.highContrast?"#ffff00":"#007bff"};
            border-radius: 4px;
            box-shadow: ${this.theme.highContrast?"none":"0 0 0 1px white, 0 0 8px rgba(0, 123, 255, 0.3)"};
            pointer-events: none;
            transition: ${this.theme.reducedMotion?"none":"all 0.2s ease"};
            display: none;
            z-index: 10001;
        `)}createAccessibilityToolbar(){if(!this.theme.highContrast&&!this.isAccessibilityToolbarRequested)return;this.accessibilityToolbar=document.createElement("div"),this.accessibilityToolbar.className="accessibility-toolbar",this.accessibilityToolbar.setAttribute("role","toolbar"),this.accessibilityToolbar.setAttribute("aria-label","Accessibility Tools"),[{id:"high-contrast",label:"Toggle High Contrast",action:()=>this.toggleHighContrastMode()},{id:"large-text",label:"Toggle Large Text",action:()=>this.toggleLargeTextMode()},{id:"keyboard-help",label:"Show Keyboard Help",action:()=>this.showKeyboardShortcuts()},{id:"voice-commands",label:"Toggle Voice Commands",action:()=>this.toggleVoiceCommands()}].forEach(t=>{const s=document.createElement("button");s.id=t.id,s.textContent=t.label,s.setAttribute("aria-label",t.label),s.addEventListener("click",t.action),this.accessibilityToolbar.appendChild(s)}),this.accessibilityToolbar.style.cssText=`
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            background: #ffffff;
            border: 2px solid ${this.theme.highContrast?"#ffff00":"#007bff"};
            border-radius: 4px;
            padding: 5px;
            z-index: 10002;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        `,document.body.appendChild(this.accessibilityToolbar)}registerComponent(e){const t=this.performanceMonitor.startOperation("register-component");try{if(!e||!e.id)throw new v("Invalid component for accessibility registration",{component:e});const s=e.accessibilityConfig||this.getDefaultAccessibilityConfig(e),i={component:e,config:s,focusable:s.focusable!==!1,description:s.description||this.generateComponentDescription(e),role:s.role||"button",keyboardActions:s.keyboardActions||{},registrationTime:Date.now(),focusCount:0,lastFocused:null};this.components.set(e.id,i),this.updateFocusableElements(),this.applyAccessibilityAttributes(e,s),this.registerComponentInRegion(e,s),this.verboseMode&&this.announce(`Component registered: ${i.description}`)}catch(s){this.handleError(new v("Failed to register component",{componentId:e?.id},s))}finally{this.performanceMonitor.endOperation("register-component",t)}}generateComponentDescription(e){const t=e.constructor.name.toLowerCase(),s=e.text||e.label||e.title||"",i=e.value!==void 0?` with value ${e.value}`:"";return`${t}${s?`: ${s}`:""}${i}`}registerComponentInRegion(e,t){const s=t.region||"main";this.regionManager.has(s)||this.regionManager.set(s,{components:new Set,focusIndex:-1,description:t.regionDescription||`${s} region`}),this.regionManager.get(s).components.add(e.id)}unregisterComponent(e){if(e&&e.id){const t=this.components.get(e.id);t&&this.verboseMode&&this.announce(`Component unregistered: ${t.description}`),this.components.delete(e.id),this.updateFocusableElements();for(const s of this.regionManager.values())s.components.delete(e.id)}}getDefaultAccessibilityConfig(e){const t=e.constructor.name.toLowerCase();return{button:{role:"button",focusable:!0,keyboardActions:{Enter:"click",Space:"click"},description:"Button"},slider:{role:"slider",focusable:!0,keyboardActions:{ArrowLeft:"decrease",ArrowRight:"increase",ArrowDown:"decrease",ArrowUp:"increase",Home:"minimum",End:"maximum"},description:"Slider"},panel:{role:"region",focusable:!0,keyboardActions:{},description:"Panel"},tabcontainer:{role:"tablist",focusable:!0,keyboardActions:{ArrowLeft:"previousTab",ArrowRight:"nextTab",Home:"firstTab",End:"lastTab"},description:"Tab container"},treeview:{role:"tree",focusable:!0,keyboardActions:{ArrowUp:"previousNode",ArrowDown:"nextNode",ArrowLeft:"collapseNode",ArrowRight:"expandNode",Enter:"activateNode",Space:"toggleNode"},description:"Tree view"},fileupload:{role:"button",focusable:!0,keyboardActions:{Enter:"openFileDialog",Space:"openFileDialog"},description:"File upload"}}[t]||{role:"generic",focusable:!0,keyboardActions:{},description:"Interactive element"}}applyAccessibilityAttributes(e,t){if(!e.element)return;const{element:s}=e;try{this.setAriaAttribute(s,"role",t.role),t.focusable&&s.setAttribute("tabindex",s.hasAttribute("tabindex")?s.getAttribute("tabindex"):"0"),t.description&&this.setAriaAttribute(s,"aria-label",t.description),t.required&&this.setAriaAttribute(s,"aria-required","true"),t.expanded!==void 0&&this.setAriaAttribute(s,"aria-expanded",t.expanded.toString()),t.selected!==void 0&&this.setAriaAttribute(s,"aria-selected",t.selected.toString()),t.pressed!==void 0&&this.setAriaAttribute(s,"aria-pressed",t.pressed.toString()),this.addKeyboardListeners(s,e,t.keyboardActions)}catch(i){this.handleError(new v("Failed to apply accessibility attributes",{componentId:e.id,config:t},i))}}setAriaAttribute(e,t,s){s!=null&&e.setAttribute(t,s)}addKeyboardListeners(e,t,s){Object.entries(s).forEach(([i,n])=>{const o=r=>{(r.key===i||r.code===i)&&(r.preventDefault(),r.stopPropagation(),this.handleComponentKeyboardAction(t,n,r))};e.addEventListener("keydown",o),t._accessibilityListeners||(t._accessibilityListeners=[]),t._accessibilityListeners.push({element:e,event:"keydown",listener:o})})}updateFocusableElements(){const e=this.performanceMonitor.startOperation("update-focusable");try{this.focusableElements=Array.from(this.components.values()).filter(t=>t.focusable&&t.component.visible!==!1&&!t.component.disabled).map(t=>t.component).sort((t,s)=>{const i=parseInt(t.element?.getAttribute("tabindex")||"0"),n=parseInt(s.element?.getAttribute("tabindex")||"0");return i!==n?i-n:t.element&&s.element&&t.element.compareDocumentPosition?t.element.compareDocumentPosition(s.element)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1:0}),this.currentFocusIndex>=this.focusableElements.length&&(this.currentFocusIndex=this.focusableElements.length-1)}catch(t){this.handleError(new v("Failed to update focusable elements",{},t))}finally{this.performanceMonitor.endOperation("update-focusable",e)}}handleError(e){this.errorCount++,this.lastError=e,d.error("Accessibility Error:",e),this.engine&&this.engine.emit&&this.engine.emit("accessibility:error",e),this.attemptErrorRecovery(e),this.errorCount>10&&(d.warn("High error rate detected, temporarily reducing accessibility features"),this.reduceFeatures())}attemptErrorRecovery(e){switch(e.context?.operation){case"focus":this.currentFocusIndex=-1;break;case"register-component":e.context?.componentId&&setTimeout(()=>{const t=this.findComponentById(e.context.componentId);t&&this.registerComponent(t)},1e3);break;case"keyboard":this.keyboardNavigationEnabled=!0;break}}reduceFeatures(){this.verboseMode=!1,this.announcementDelay*=2,setTimeout(()=>{this.errorCount=0,this.verboseMode=this.screenReaderType!==null,this.announcementDelay=l.ANNOUNCEMENT_DELAY},l.FEATURE_DISABLE_TIMEOUT)}findComponentById(e){const t=this.components.get(e);return t?t.component:null}handleKeyDown(e){if(!this.keyboardNavigationEnabled)return;const t=this.performanceMonitor.startOperation("keyboard-navigation");try{const s=this.getShortcutKey(e);if(this.keyboardShortcuts.has(s)){e.preventDefault(),e.stopPropagation(),this.keyboardShortcuts.get(s)();return}switch(e.key){case"Tab":e.preventDefault(),this.handleTabNavigation(e.shiftKey);break;case"Escape":this.handleEscape();break;case"F6":e.preventDefault(),this.cycleFocusRegions(e.shiftKey?-1:1);break;case"?":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.showKeyboardShortcuts());break;case"F1":e.preventDefault(),this.showAccessibilityHelp();break}}catch(s){this.handleError(new v("Keyboard navigation error",{key:e.key,operation:"keyboard"},s))}finally{this.performanceMonitor.endOperation("keyboard-navigation",t)}}getShortcutKey(e){const t=[];return e.ctrlKey&&t.push("ctrl"),e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.metaKey&&t.push("meta"),t.push(e.key.toLowerCase()),t.join("+")}showAccessibilityHelp(){const e=`
            Accessibility Help:
            
            Navigation:
            - Tab/Shift+Tab: Move between elements
            - Arrow keys: Navigate within components
            - Enter/Space: Activate elements
            - Escape: Cancel or close
            - F6/Shift+F6: Cycle between regions
            - F1: Show this help
            
            Shortcuts:
            - Ctrl+Shift+?: Show keyboard shortcuts
            - Ctrl+Shift+H: Toggle high contrast
            - Ctrl+Shift+L: Toggle large text
            - Ctrl+Shift+V: Toggle voice commands
            - Ctrl+Shift+R: Reset accessibility settings
            - Ctrl+Shift+F: Show accessibility report
            
            Voice Commands (if available):
            - "Next" or "Previous": Navigate elements
            - "Activate": Activate current element
            - "Help": Show available commands
            - "High contrast": Toggle high contrast mode
            - "Large text": Toggle large text mode
            
            Current Settings:
            - Theme: ${this.theme.theme}
            - High contrast: ${this.theme.highContrast?"on":"off"}
            - Reduced motion: ${this.theme.reducedMotion?"on":"off"}
            - Screen reader: ${this.screenReaderEnabled?"detected":"not detected"}
            - Voice commands: ${this.voiceCommandsEnabled?"enabled":"disabled"}
        `;this.announce(e,!0)}handleTabNavigation(e=!1){if(this.focusableElements.length===0)return;const t=e?-1:1;let s=this.currentFocusIndex+t;s>=this.focusableElements.length?s=0:s<0&&(s=this.focusableElements.length-1),this.currentFocusIndex=s,this.focusComponent(this.focusableElements[this.currentFocusIndex])}handleComponentKeyboardAction(e,t,s){const i=this.components.get(e.id);if(!i)return;const n=this.performanceMonitor.startOperation("component-action");try{switch(i.lastFocused=Date.now(),i.focusCount++,t){case"click":case"activate":this.activateComponent(e,i);break;case"increase":case"decrease":this.adjustComponentValue(e,t,i);break;case"minimum":case"maximum":this.setComponentExtreme(e,t,i);break;case"previousTab":case"nextTab":case"firstTab":case"lastTab":this.handleTabAction(e,t,i);break;case"previousNode":case"nextNode":case"expandNode":case"collapseNode":case"activateNode":case"toggleNode":this.handleTreeAction(e,t,i);break;case"openFileDialog":this.handleFileAction(e,t,i);break;default:e[t]&&typeof e[t]=="function"&&(e[t](s),this.announce(`${t} performed on ${i.description}`))}}catch(o){this.handleError(new v("Component action failed",{componentId:e.id,action:t,operation:"component-action"},o))}finally{this.performanceMonitor.endOperation("component-action",n)}}activateComponent(e,t){e.element&&e.element.click?e.element.click():e.onClick?e.onClick():e.activate&&e.activate(),this.announce(`${t.description} activated`)}adjustComponentValue(e,t,s){if(e.setValue&&e.value!==void 0){const i=t==="increase"?1:-1,n=e.step||1,o=Math.max(e.min||0,Math.min(e.max||100,e.value+i*n));e.setValue(o),this.announce(`${s.description} ${t}d to ${o}`)}}setComponentExtreme(e,t,s){if(e.setValue){const i=t==="minimum"?e.min||0:e.max||100;e.setValue(i),this.announce(`${s.description} set to ${t} value: ${i}`)}}handleTabAction(e,t,s){e.handleTabNavigation&&(e.handleTabNavigation(t),this.announce(`Tab navigation: ${t} on ${s.description}`))}handleTreeAction(e,t,s){e[t]&&(e[t](),this.announce(`Tree action: ${t} on ${s.description}`))}handleFileAction(e,t,s){e.openFileDialog&&(e.openFileDialog(),this.announce(`File dialog opened for ${s.description}`))}focusComponent(e){if(!e||!e.element)return;const t=this.performanceMonitor.startOperation("focus-component");try{this.focusHistory.push({component:e.id,timestamp:Date.now()}),this.focusHistory.length>l.FOCUS_HISTORY_LIMIT&&this.focusHistory.shift(),e.element.focus(),this.updateFocusIndicator(e);const s=this.components.get(e.id);s&&(s.lastFocused=Date.now(),s.focusCount++,s.description&&this.announce(s.description))}catch(s){this.handleError(new v("Focus operation failed",{componentId:e.id,operation:"focus"},s))}finally{this.performanceMonitor.endOperation("focus-component",t)}}updateFocusIndicator(e){if(!(!e.element||!this.focusIndicator))try{const t=e.element.getBoundingClientRect(),s=this.container.getBoundingClientRect(),i=t.left-s.left-l.FOCUS_BORDER_OFFSET,n=t.top-s.top-l.FOCUS_BORDER_OFFSET,o=t.width+l.FOCUS_BORDER_PADDING,r=t.height+l.FOCUS_BORDER_PADDING;this.focusIndicator.style.cssText+=`
                display: block;
                left: ${i}px;
                top: ${n}px;
                width: ${o}px;
                height: ${r}px;
            `,this.theme.reducedMotion?this.focusIndicator.scrollIntoView({block:"nearest"}):this.focusIndicator.scrollIntoView({block:"nearest",behavior:"smooth"})}catch(t){this.handleError(new v("Focus indicator update failed",{componentId:e.id},t))}}announce(e,t=!1,s={}){if(!e)return;const i={message:String(e).trim(),urgent:t,timestamp:Date.now(),category:s.category||"general",priority:t?"high":s.priority||"normal",delay:s.delay||this.announcementDelay,repeat:s.repeat||!1};!s.allowDuplicates&&this.isDuplicateAnnouncement(i)||(this.announcements.push(i),t?this.processUrgentAnnouncement(i):setTimeout(()=>this.processAnnouncements(),i.delay))}isDuplicateAnnouncement(e){return this.announcements.filter(s=>Date.now()-s.timestamp<l.ANNOUNCEMENT_TIMEOUT).some(s=>s.message===e.message&&s.category===e.category)}processUrgentAnnouncement(e){this.urgentRegion&&(this.urgentRegion.textContent=e.message,setTimeout(()=>{this.urgentRegion&&(this.urgentRegion.textContent="")},l.ANNOUNCEMENT_CLEAR_DELAY))}processAnnouncements(){if(this.announcements.length===0)return;this.announcements.sort((s,i)=>{const n={high:3,normal:2,low:1};return n[i.priority]-n[s.priority]});const e=this.announcements.shift();let t=this.liveRegion;if(e.urgent?t=this.urgentRegion:e.category==="status"?t=this.statusRegion:e.category==="log"&&(t=this.logRegion),t){t.textContent=e.message;const s=Math.min(l.GESTURE_TIMEOUT,Math.max(l.ANNOUNCEMENT_MIN_DURATION,e.message.length*l.ANNOUNCEMENT_CHAR_MULTIPLIER));setTimeout(()=>{t&&t.textContent===e.message&&(t.textContent="")},s)}this.verboseMode&&d.info("Accessibility Announcement:",e)}cycleFocusRegions(e=1){const t=Array.from(this.regionManager.keys());if(t.length<=1)return;const s=this.getCurrentRegion();let i=t.indexOf(s);i===-1&&(i=0),i=(i+e+t.length)%t.length;const n=t[i];this.focusOnRegion(n);const o=this.regionManager.get(n);this.announce(`Moved to ${o.description}`,!1,{category:"navigation"})}getCurrentRegion(){if(this.currentFocusIndex>=0&&this.focusableElements[this.currentFocusIndex]){const e=this.focusableElements[this.currentFocusIndex];for(const[t,s]of this.regionManager)if(s.components.has(e.id))return t}return"main"}focusOnRegion(e){const t=this.regionManager.get(e);if(!t||t.components.size===0)return;const s=Array.from(t.components)[0],i=this.components.get(s);if(i){const n=this.focusableElements.indexOf(i.component);n>=0&&(this.currentFocusIndex=n,this.focusComponent(i.component))}}setKeyboardNavigationEnabled(e){this.keyboardNavigationEnabled=e,this.announce(`Keyboard navigation ${e?"enabled":"disabled"}`,!1,{category:"settings"}),this.saveSetting("keyboardNavigation",e)}setHighContrastMode(e){this.isHighContrastMode=e,e?(this.container.classList.add("high-contrast"),document.body.classList.add("high-contrast"),this.theme.highContrast=!0):(this.container.classList.remove("high-contrast"),document.body.classList.remove("high-contrast"),this.theme.highContrast=!1),this.updateContainerTheme(),this.applyThemeSpecificStyles(),this.updateFocusIndicatorTheme(),this.announce(`High contrast mode ${e?"enabled":"disabled"}`,!1,{category:"settings"}),this.saveSetting("highContrast",e)}toggleHighContrastMode(){this.setHighContrastMode(!this.isHighContrastMode)}setLargeTextMode(e){e?(this.container.classList.add("large-text"),document.body.classList.add("large-text")):(this.container.classList.remove("large-text"),document.body.classList.remove("large-text")),this.announce(`Large text mode ${e?"enabled":"disabled"}`,!1,{category:"settings"}),this.saveSetting("largeText",e)}toggleLargeTextMode(){const e=this.container.classList.contains("large-text");this.setLargeTextMode(!e)}saveSetting(e,t){try{if(localStorage){const s=JSON.parse(localStorage.getItem("accessibilitySettings")||"{}");s[e]=t,localStorage.setItem("accessibilitySettings",JSON.stringify(s))}}catch(s){d.warn("Failed to save accessibility setting:",s)}}loadSettings(){try{if(localStorage){const e=JSON.parse(localStorage.getItem("accessibilitySettings")||"{}");e.keyboardNavigation!==void 0&&(this.keyboardNavigationEnabled=e.keyboardNavigation),e.highContrast&&this.setHighContrastMode(!0),e.largeText&&this.setLargeTextMode(!0)}}catch(e){d.warn("Failed to load accessibility settings:",e)}}throttle(e,t){let s,i=0;return function(...o){const r=Date.now();r-i>=t?(e.apply(this,o),i=r):(clearTimeout(s),s=setTimeout(()=>{e.apply(this,o),i=Date.now()},t-(r-i)))}}activateCurrentElement(){if(this.currentFocusIndex>=0&&this.focusableElements[this.currentFocusIndex]){const e=this.focusableElements[this.currentFocusIndex];this.handleComponentKeyboardAction(e,"activate",{})}}announceEthicsChange(e,t,s,i){const n=s-t,o=n>0?"increased":"decreased",r=Math.abs(n);let c="slightly";r>l.ETHICS_SIGNIFICANT_CHANGE?c="significantly":r>10&&(c="moderately");const a=`${e} ${c} ${o} from ${t} to ${s}. ${i}`;this.announce(a,!1,{category:"ethics",priority:r>l.ETHICS_HIGH_PRIORITY?"high":"normal"})}announceScenarioChange(e,t,s){const i=`Starting scenario ${t} of ${s}: ${e}`;this.announce(i,!0,{category:"scenario"})}announceSimulationComplete(e,t){const s=Math.round(e/t*100);let i="needs improvement";s>=l.PERFORMANCE_EXCELLENT?i="excellent":s>=l.PERFORMANCE_GOOD?i="good":s>=l.PERFORMANCE_SATISFACTORY&&(i="satisfactory");const n=`Simulation complete. Final score: ${e} out of ${t} (${s}%). Performance: ${i}.`;this.announce(n,!0,{category:"completion"})}onContainerFocus(){this.focusableElements.length>0&&this.currentFocusIndex===-1&&(this.currentFocusIndex=0,this.focusComponent(this.focusableElements[0])),this.verboseMode&&this.announce("Entered simulation environment",!1,{category:"navigation"})}onContainerBlur(){this.focusIndicator&&(this.focusIndicator.style.display="none")}onFocusChange(e){if(e.type==="focusin"){const t=this.findComponentByElement(e.target);if(t){this.currentFocusIndex=this.focusableElements.indexOf(t),this.updateFocusIndicator(t);const s=this.components.get(t.id);s&&(s.lastFocused=Date.now(),s.focusCount++)}}}findComponentByElement(e){for(const[,t]of this.components)if(t.component.element===e||t.component.element?.contains(e))return t.component;return null}detectScreenReader(){try{return this.detectScreenReaderType()!==null}catch(e){return d.warn("Screen reader detection failed:",e),!1}}handleEscape(){if(this.announce("Escape pressed",!1,{category:"interaction"}),this.accessibilityToolbar&&this.accessibilityToolbar.style.display!=="none"){this.accessibilityToolbar.style.display="none",this.announce("Accessibility toolbar closed");return}if(this.currentFocusIndex===-1&&this.focusableElements.length>0){this.currentFocusIndex=0,this.focusComponent(this.focusableElements[0]);return}this.engine&&this.engine.emit&&this.engine.emit("accessibility:escape")}showKeyboardShortcuts(){this.announce(`
            Keyboard Shortcuts:
            
            Basic Navigation:
            • Tab/Shift+Tab: Navigate between elements
            • Arrow keys: Navigate within components
            • Enter/Space: Activate buttons and controls
            • Escape: Cancel, close, or reset focus
            • F6/Shift+F6: Cycle between regions
            • F1: Show accessibility help
            
            Advanced Shortcuts:
            • Ctrl+Shift+?: Show this shortcuts list
            • Ctrl+Shift+H: Toggle high contrast mode
            • Ctrl+Shift+L: Toggle large text mode
            • Ctrl+Shift+V: Toggle voice commands
            • Ctrl+Shift+R: Reset accessibility settings
            • Ctrl+Shift+F: Show accessibility report
            
            Component-Specific:
            • Home/End: First/last item in lists
            • Arrow keys: Navigate trees and tabs
            • Space: Toggle checkboxes and expand/collapse
            • Enter: Activate primary actions
            
            Voice Commands (if supported):
            • "Next" / "Previous": Navigate elements
            • "Activate": Activate current element
            • "High contrast": Toggle high contrast
            • "Large text": Toggle large text
            • "Help": Show voice command help
        `,!0,{category:"help"})}handleKeyUp(e){e.key==="Alt"&&this.altKeyPressed&&(this.altKeyPressed=!1)}destroy(){const e=this.performanceMonitor.startOperation("cleanup");try{if(this.removeEventListeners(),this.speechRecognition)try{this.speechRecognition.stop(),this.speechRecognition=null}catch(t){d.warn("Speech recognition cleanup failed:",t)}this.removeDOMElements(),this.cleanupComponentListeners(),this.clearDataStructures(),this.saveFinalSettings(),d.info("AccessibilityManager destroyed successfully")}catch(t){d.error("Error during AccessibilityManager cleanup:",t)}finally{this.performanceMonitor.endOperation("cleanup",e),this.verboseMode&&d.info("Final Accessibility Performance Report:",this.performanceMonitor.getMetrics())}}removeEventListeners(){try{this.container.removeEventListener("keydown",this.handleKeyDown),this.container.removeEventListener("keyup",this.handleKeyUp),this.container.removeEventListener("focus",this.onContainerFocus),this.container.removeEventListener("blur",this.onContainerBlur),document.removeEventListener("focusin",this.onFocusChange),document.removeEventListener("focusout",this.onFocusChange);const e=window.matchMedia("(prefers-contrast: high)"),t=window.matchMedia("(prefers-reduced-motion: reduce)");e.removeEventListener&&(e.removeEventListener("change",this.updateTheme),t.removeEventListener("change",this.updateTheme))}catch(e){d.warn("Event listener cleanup failed:",e)}}removeDOMElements(){[this.liveRegion,this.urgentRegion,this.statusRegion,this.logRegion,this.overlay,this.accessibilityToolbar,document.getElementById("accessibility-description"),document.getElementById("accessibility-focus-styles")].forEach(t=>{try{t&&t.parentNode&&t.parentNode.removeChild(t)}catch(s){d.warn("Failed to remove DOM element:",s)}})}cleanupComponentListeners(){for(const[e,t]of this.components){const{component:s}=t;s._accessibilityListeners&&(s._accessibilityListeners.forEach(({element:i,event:n,listener:o})=>{try{i.removeEventListener(n,o)}catch(r){d.warn(`Failed to remove listener for component ${e}:`,r)}}),delete s._accessibilityListeners)}}clearDataStructures(){this.components.clear(),this.focusableElements=[],this.announcements=[],this.focusHistory=[],this.regionManager.clear(),this.voiceCommands.clear(),this.keyboardShortcuts.clear(),this.renderCache.clear()}saveFinalSettings(){try{if(localStorage){const e={sessionDuration:Date.now()-(this.initTime||Date.now()),totalComponents:this.components.size,totalAnnouncements:this.announcements.length,errorCount:this.errorCount,performanceMetrics:this.performanceMonitor.getMetrics(),lastSession:Date.now()};localStorage.setItem("accessibilitySessionReport",JSON.stringify(e))}}catch(e){d.warn("Failed to save session report:",e)}}getAccessibilityReport(){return{isEnabled:!0,componentsRegistered:this.components.size,focusableElements:this.focusableElements.length,theme:this.theme,screenReader:{enabled:this.screenReaderEnabled,type:this.screenReaderType},features:{keyboardNavigation:this.keyboardNavigationEnabled,voiceCommands:this.voiceCommandsEnabled,highContrast:this.isHighContrastMode,largeText:this.container.classList.contains("large-text")},performance:this.performanceMonitor.getMetrics(),errors:this.errorCount,lastError:this.lastError}}updateAccessibilityConfig(e){e.theme&&(this.theme={...this.theme,...e.theme},this.updateContainerTheme()),e.announcements&&(this.announcementDelay=e.announcements.delay||this.announcementDelay,this.verboseMode=e.announcements.verbose!==void 0?e.announcements.verbose:this.verboseMode),e.performance&&Object.assign(l,e.performance),this.announce("Accessibility configuration updated",!1,{category:"settings"})}}w.detectScreenReaderType=function(){const{userAgent:u}=navigator;for(const[e,t]of Object.entries(O))if(t.test(u))return e.toLowerCase();return null};w.createGlobalAccessibilityStyles=function(){if(document.getElementById("global-accessibility-styles"))return;const u=document.createElement("style");u.id="global-accessibility-styles",u.textContent=`
        /* Global accessibility styles */
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }
        
        .accessibility-enabled *:focus {
            outline: 2px solid #007bff !important;
            outline-offset: 2px !important;
        }
        
        .high-contrast *:focus {
            outline: 3px solid #ffff00 !important;
            outline-offset: 2px !important;
        }
        
        .large-text {
            font-size: 120% !important;
            line-height: 1.5 !important;
        }
        
        .reduced-motion * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        
        @media (prefers-reduced-motion: reduce) {
            .accessibility-enabled * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    `,document.head.appendChild(u)};typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w.createGlobalAccessibilityStyles):w.createGlobalAccessibilityStyles());export{w as A,P as E,z as F,B as U};
//# sourceMappingURL=ui-D3JF1NtD.js.map
