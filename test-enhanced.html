<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Objects Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Enhanced Objects Integration Test</h1>
    
    <div class="test-section">
        <h2>Visual Engine Test</h2>
        <div id="visual-engine-test">Testing...</div>
        <canvas id="test-canvas" width="400" height="200" style="border: 1px solid #ccc;"></canvas>
    </div>
    
    <div class="test-section">
        <h2>Enhanced Objects Test</h2>
        <div id="enhanced-objects-test">Testing...</div>
        <canvas id="objects-canvas" width="600" height="300" style="border: 1px solid #ccc;"></canvas>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console-output"></div>
    </div>

    <script type="module">
        // Capture console output
        const consoleOutput = document.getElementById('console-output');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        function logToPage(message, type = 'log') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${type.toUpperCase()}] ${message}`;
            consoleOutput.appendChild(div);
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            logToPage(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            logToPage(args.join(' '), 'error');
        };

        async function testVisualEngine() {
            try {
                const { VisualEngine } = await import('./src/js/core/visual-engine.js');
                const canvas = document.getElementById('test-canvas');
                
                const engine = new VisualEngine({
                    preferredRenderer: 'canvas',
                    enableAccessibility: true,
                    enableAnimations: true,
                    debug: true
                });
                
                engine.init(canvas);
                console.log('Visual Engine initialized successfully');
                document.getElementById('visual-engine-test').innerHTML = '<span class="success">✓ Visual Engine working</span>';
                
                return engine;
            } catch (error) {
                console.error('Visual Engine failed:', error);
                document.getElementById('visual-engine-test').innerHTML = '<span class="error">✗ Visual Engine failed: ' + error.message + '</span>';
                return null;
            }
        }

        async function testEnhancedObjects(engine) {
            try {
                const { EthicsMeter, InteractiveButton, InteractiveSlider } = await import('./src/js/objects/enhanced-objects.js');
                const canvas = document.getElementById('objects-canvas');
                
                if (!engine) {
                    engine = new (await import('./src/js/core/visual-engine.js')).VisualEngine({
                        preferredRenderer: 'canvas',
                        enableAccessibility: true,
                        enableAnimations: true,
                        debug: true
                    });
                    engine.init(canvas);
                }
                
                // Test EthicsMeter
                const meter = new EthicsMeter({
                    id: 'test-meter',
                    x: 100,
                    y: 50,
                    width: 150,
                    height: 60,
                    label: 'Test Meter',
                    value: 0.7,
                    color: '#28a745'
                });
                
                // Test InteractiveButton
                const button = new InteractiveButton({
                    id: 'test-button',
                    x: 300,
                    y: 50,
                    width: 120,
                    height: 40,
                    text: 'Test Button',
                    variant: 'primary'
                });
                
                // Test InteractiveSlider
                const slider = new InteractiveSlider({
                    id: 'test-slider',
                    x: 100,
                    y: 150,
                    width: 300,
                    height: 40,
                    min: 0,
                    max: 100,
                    value: 50,
                    label: 'Test Slider'
                });
                
                engine.scene.addObject(meter);
                engine.scene.addObject(button);
                engine.scene.addObject(slider);
                
                console.log('Enhanced Objects created successfully');
                document.getElementById('enhanced-objects-test').innerHTML = '<span class="success">✓ Enhanced Objects working</span>';
                
            } catch (error) {
                console.error('Enhanced Objects failed:', error);
                document.getElementById('enhanced-objects-test').innerHTML = '<span class="error">✗ Enhanced Objects failed: ' + error.message + '</span>';
            }
        }

        // Run tests
        console.log('Starting Enhanced Objects Integration Test...');
        
        const engine = await testVisualEngine();
        await testEnhancedObjects(engine);
        
        console.log('Test completed');
    </script>
</body>
</html>
