<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GDPR Cookie Notice Style Test</title>

    <!-- Load fallback styles -->
    <link
      rel="stylesheet"
      href="src/styles/components/gdpr-cookie-notice-fallback.css"
    />

    <style>
      body {
        margin: 0;
        padding: 2rem;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        line-height: 1.6;
        background: #f8f9fa;
      }

      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .test-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 2rem;
      }

      .test-btn {
        padding: 0.75rem 1.5rem;
        background: #1a73e8;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.2s;
      }

      .test-btn:hover {
        background: #1565c0;
      }

      .test-btn.secondary {
        background: #6c757d;
      }

      .test-btn.secondary:hover {
        background: #545b62;
      }

      .test-btn.danger {
        background: #dc3545;
      }

      .test-btn.danger:hover {
        background: #c82333;
      }

      .status {
        margin-top: 1rem;
        padding: 1rem;
        background: #e7f3ff;
        border-radius: 6px;
        border-left: 4px solid #1a73e8;
      }

      pre {
        background: #f1f3f4;
        padding: 1rem;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 0.85rem;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üç™ GDPR Cookie Notice Style Test</h1>

      <p>
        This page tests the GDPR cookie notice with fallback CSS styles that
        don't depend on CSS layers.
      </p>

      <div class="test-buttons">
        <button class="test-btn" onclick="showCookieNotice()">
          Show Cookie Notice
        </button>
        <button class="test-btn secondary" onclick="resetAndShow()">
          Reset & Show Notice
        </button>
        <button class="test-btn secondary" onclick="toggleDarkMode()">
          Toggle Dark Mode
        </button>
        <button class="test-btn danger" onclick="clearAllData()">
          Clear All Data
        </button>
      </div>

      <div class="status" id="status">
        Ready to test. Click "Show Cookie Notice" to see the styled notice.
      </div>

      <h3>Expected Features:</h3>
      <ul>
        <li>‚úÖ Cookie notice slides up from bottom</li>
        <li>
          ‚úÖ Three cookie type checkboxes (Essential, Analytics, Research)
        </li>
        <li>
          ‚úÖ Three action buttons (Essential Only, Accept Selected, Accept All)
        </li>
        <li>‚úÖ Privacy Notice link opens in new tab</li>
        <li>‚úÖ Close button (only works after consent given)</li>
        <li>‚úÖ Dark mode support</li>
        <li>‚úÖ Mobile responsive design</li>
        <li>‚úÖ Confirmation toast after saving preferences</li>
      </ul>

      <h3>Debug Info:</h3>
      <pre id="debug-info">No debug info yet...</pre>
    </div>

    <!-- Mock DataHandler for testing -->
    <script>
      // Improved mock DataHandler for testing
      class MockDataHandler {
        constructor() {
          this.storage = new Map();
          console.log("MockDataHandler initialized");
        }

        async getData(key) {
          try {
            const stored = localStorage.getItem(`test_${key}`);
            const result = stored ? JSON.parse(stored) : null;
            console.log(`MockDataHandler.getData(${key}):`, result);
            return result;
          } catch (error) {
            console.error(`MockDataHandler.getData(${key}) error:`, error);
            return null;
          }
        }

        async saveData(key, data) {
          try {
            const serialized = JSON.stringify(data);
            localStorage.setItem(`test_${key}`, serialized);
            console.log(`MockDataHandler.saveData(${key}):`, data);
            return data;
          } catch (error) {
            console.error(`MockDataHandler.saveData(${key}) error:`, error);
            throw error;
          }
        }

        async saveConsentData(data) {
          try {
            console.log("MockDataHandler.saveConsentData called with:", data);
            const result = await this.saveData("consent_data", data);
            console.log(
              "MockDataHandler.saveConsentData completed successfully",
            );
            return result;
          } catch (error) {
            console.error("MockDataHandler.saveConsentData error:", error);
            throw new Error(`Failed to save consent data: ${error.message}`);
          }
        }

        async getConsentData() {
          try {
            return await this.getData("consent_data");
          } catch (error) {
            console.error("MockDataHandler.getConsentData error:", error);
            return null;
          }
        }

        async removeData(key) {
          try {
            localStorage.removeItem(`test_${key}`);
            console.log(`MockDataHandler.removeData(${key}): removed`);
          } catch (error) {
            console.error(`MockDataHandler.removeData(${key}) error:`, error);
            throw error;
          }
        }
      }

      // Initialize mock DataHandler
      window.dataHandler = new MockDataHandler();
      console.log("Window dataHandler set:", window.dataHandler);
    </script>

    <!-- Load GDPR Component -->
    <script src="src/js/components/gdpr-cookie-notice.js"></script>

    <script>
      let cookieNotice = null;

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        updateStatus("Page loaded. DataHandler initialized.");
        updateDebugInfo();
      });

      function showCookieNotice() {
        if (!cookieNotice) {
          cookieNotice = new GDPRCookieNotice(window.dataHandler, {
            position: "bottom",
            theme: "auto",
            autoHide: false,
            showDetails: true,
          });
        }

        // Force show
        cookieNotice.show();
        updateStatus("Cookie notice shown");
      }

      function resetAndShow() {
        // Clear existing consent
        localStorage.removeItem("test_gdpr_cookie_consent");
        localStorage.removeItem("test_consent_data");

        // Create fresh instance
        cookieNotice = new GDPRCookieNotice(window.dataHandler, {
          position: "bottom",
          theme: "auto",
          autoHide: false,
          showDetails: true,
        });

        updateStatus("Consent data cleared and notice shown");
        updateDebugInfo();
      }

      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        const isDark = document.body.classList.contains("dark-mode");
        updateStatus(`Dark mode ${isDark ? "enabled" : "disabled"}`);
      }

      function clearAllData() {
        localStorage.clear();
        updateStatus("All localStorage data cleared");
        updateDebugInfo();
      }

      function updateStatus(message) {
        const status = document.getElementById("status");
        const timestamp = new Date().toLocaleTimeString();
        status.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
      }

      function updateDebugInfo() {
        const debug = document.getElementById("debug-info");
        const consentData = localStorage.getItem("test_gdpr_cookie_consent");
        const legacyConsent = localStorage.getItem("test_consent_data");

        // Get DataHandler method information
        const dataHandlerMethods = window.dataHandler
          ? Object.getOwnPropertyNames(
              Object.getPrototypeOf(window.dataHandler),
            )
              .filter((name) => name !== "constructor")
              .join(", ")
          : "No DataHandler";

        debug.textContent = `
Consent Data: ${consentData || "None"}
Legacy Consent: ${legacyConsent || "None"}
Dark Mode: ${document.body.classList.contains("dark-mode")}
DataHandler Methods: ${dataHandlerMethods}
DataHandler Available: ${!!window.dataHandler}
            `.trim();
      }

      // Listen for consent events
      window.addEventListener("gdprConsentChanged", function (event) {
        updateStatus("Consent changed: " + JSON.stringify(event.detail));
        updateDebugInfo();
      });
    </script>
  </body>
</html>
