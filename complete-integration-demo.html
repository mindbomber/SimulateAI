<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Complete Integration Demo - SimulateAI</title>

    <!-- Google reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js"></script>

    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        min-height: 100vh;
      }

      .container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      h1 {
        text-align: center;
        color: #4a90e2;
        margin-bottom: 30px;
      }

      .integration-flow {
        background: #e8f5e8;
        border: 2px solid #28a745;
        border-radius: 12px;
        padding: 25px;
        margin: 20px 0;
      }

      .flow-step {
        background: white;
        border-left: 4px solid #3498db;
        padding: 20px;
        margin: 15px 0;
        border-radius: 0 8px 8px 0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .flow-step h3 {
        color: #2c3e50;
        margin-top: 0;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .demo-card {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        transition: all 0.3s ease;
      }

      .demo-card:hover {
        border-color: #3498db;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .demo-card.user {
        border-left: 4px solid #e74c3c;
      }

      .demo-card.blog {
        border-left: 4px solid #f39c12;
      }

      .demo-card.forum {
        border-left: 4px solid #9b59b6;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        margin: 10px 5px;
        width: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn.user {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      }

      .btn.blog {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
      }

      .btn.forum {
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
      }

      .file-input {
        width: 100%;
        padding: 10px;
        border: 2px dashed #ddd;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        margin: 15px 0;
        font-size: 14px;
      }

      .form-group {
        margin: 15px 0;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }

      .form-group textarea {
        height: 100px;
        resize: vertical;
      }

      .status {
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        font-weight: 600;
      }

      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .results-container {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
        max-height: 400px;
        overflow-y: auto;
      }

      .architecture-diagram {
        background: #fff3cd;
        border: 2px solid #ffc107;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
        text-align: center;
      }

      .service-flow {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        margin: 20px 0;
      }

      .service-box {
        background: white;
        border: 2px solid #3498db;
        border-radius: 8px;
        padding: 15px;
        margin: 10px;
        text-align: center;
        flex: 1;
        min-width: 150px;
      }

      .arrow {
        font-size: 24px;
        color: #3498db;
        margin: 0 10px;
      }

      @media (max-width: 768px) {
        .demo-grid {
          grid-template-columns: 1fr;
        }

        .service-flow {
          flex-direction: column;
        }

        .arrow {
          transform: rotate(90deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üöÄ Complete Firebase Integration</h1>
      <p style="text-align: center; font-size: 18px; color: #7f8c8d">
        User Profiles + Blog Posts + Comments with File Storage Integration
      </p>

      <!-- Architecture Overview -->
      <div class="architecture-diagram">
        <h2>üèóÔ∏è System Architecture</h2>
        <div class="service-flow">
          <div class="service-box">
            <strong>üîê reCAPTCHA v3</strong><br />
            <small>Security validation</small>
          </div>
          <div class="arrow">‚Üí</div>
          <div class="service-box">
            <strong>üõ°Ô∏è App Check</strong><br />
            <small>App verification</small>
          </div>
          <div class="arrow">‚Üí</div>
          <div class="service-box">
            <strong>üîó Hybrid Data</strong><br />
            <small>Firestore + Data Connect</small>
          </div>
          <div class="arrow">‚Üí</div>
          <div class="service-box">
            <strong>üìÅ Firebase Storage</strong><br />
            <small>File management</small>
          </div>
        </div>
      </div>

      <!-- Integration Flow -->
      <div class="integration-flow">
        <h2>üîÑ Integration Flow</h2>

        <div class="flow-step">
          <h3>1. üë§ User Registration with Profile</h3>
          <p>
            <strong>Process:</strong> User data ‚Üí Hybrid Data Service ‚Üí Profile
            image ‚Üí Firebase Storage ‚Üí Metadata linking
          </p>
          <p>
            <strong>Result:</strong> User stored in both Firestore (flexible)
            and Data Connect (structured) with profile image URL
          </p>
        </div>

        <div class="flow-step">
          <h3>2. üìù Blog Post Creation with Images</h3>
          <p>
            <strong>Process:</strong> Blog content ‚Üí Image uploads ‚Üí Storage
            URLs ‚Üí Hybrid storage with image references
          </p>
          <p>
            <strong>Result:</strong> Blog post with embedded images, metadata,
            and analytics ready
          </p>
        </div>

        <div class="flow-step">
          <h3>3. üí¨ Blog Comments with Attachments</h3>
          <p>
            <strong>Process:</strong> Comment content ‚Üí File attachments ‚Üí
            Storage ‚Üí Real-time comment features
          </p>
          <p>
            <strong>Result:</strong> Blog comments with file attachments,
            real-time updates, and structured relationships
          </p>
        </div>
      </div>

      <!-- Demo Operations -->
      <div class="demo-grid">
        <!-- User Creation Demo -->
        <div class="demo-card user">
          <h3>üë§ Create User with Profile</h3>

          <div class="form-group">
            <label>Display Name:</label>
            <input
              type="text"
              id="userName"
              placeholder="Dr. AI Ethics Researcher"
              value="Dr. Alex Chen"
            />
          </div>

          <div class="form-group">
            <label>Email:</label>
            <input
              type="email"
              id="userEmail"
              placeholder="researcher@university.edu"
              value="alex.chen@stanford.edu"
            />
          </div>

          <div class="form-group">
            <label>Research Participant:</label>
            <select id="researchParticipant">
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>

          <div class="form-group">
            <label>Profile Image:</label>
            <input
              type="file"
              id="userProfileImage"
              accept="image/*"
              class="file-input"
            />
          </div>

          <button class="btn user" onclick="createUserWithProfile()">
            Create User with Profile
          </button>
        </div>

        <!-- Blog Creation Demo -->
        <div class="demo-card blog">
          <h3>üìù Create Blog Post with Images</h3>

          <div class="form-group">
            <label>Blog Title:</label>
            <input
              type="text"
              id="blogTitle"
              placeholder="AI Ethics in Healthcare"
              value="The Future of AI Ethics in Medical Diagnosis"
            />
          </div>

          <div class="form-group">
            <label>Content:</label>
            <textarea
              id="blogContent"
              placeholder="Write your blog content here..."
            >
As artificial intelligence becomes increasingly prevalent in medical diagnosis, we must carefully consider the ethical implications. This comprehensive analysis explores the balance between technological advancement and patient privacy, examining real-world case studies and proposing frameworks for ethical AI implementation in healthcare settings.</textarea
            >
          </div>

          <div class="form-group">
            <label>Category:</label>
            <select id="blogCategory">
              <option value="healthcare_ethics">Healthcare Ethics</option>
              <option value="ai_research">AI Research</option>
              <option value="case_studies">Case Studies</option>
            </select>
          </div>

          <div class="form-group">
            <label>Blog Images:</label>
            <input
              type="file"
              id="blogImages"
              accept="image/*"
              multiple
              class="file-input"
            />
          </div>

          <button class="btn blog" onclick="createBlogWithImages()">
            Create Blog Post with Images
          </button>
        </div>

        <!-- Comment Creation Demo -->
        <div class="demo-card forum">
          <h3>üí¨ Add Comment with Attachments</h3>

          <div class="form-group">
            <label>Blog Post ID:</label>
            <input
              type="text"
              id="forumTitle"
              placeholder="Post ID..."
              value="ai-ethics-best-practices-2025"
            />
          </div>

          <div class="form-group">
            <label>Comment:</label>
            <textarea id="forumContent" placeholder="Share your thoughts...">
Great article! I've been working on similar research and have found that incorporating diverse stakeholder perspectives early in the design process leads to more robust ethical frameworks. I've attached a case study that demonstrates this approach in practice.</textarea
            >
          </div>

          <div class="form-group">
            <label>Comment Type:</label>
            <select id="forumCategory">
              <option value="general_comment">General Comment</option>
              <option value="question">Question</option>
              <option value="additional_resource">Additional Resource</option>
            </select>
          </div>

          <div class="form-group">
            <label>Attachments:</label>
            <input
              type="file"
              id="forumAttachments"
              accept="image/*,.pdf,.doc,.docx,.txt"
              multiple
              class="file-input"
            />
          </div>

          <button class="btn forum" onclick="createCommentWithAttachments()">
            Add Comment with Attachments
          </button>
        </div>
      </div>

      <!-- Status and Results -->
      <div id="statusContainer">
        <div class="status info">
          <strong>‚ÑπÔ∏è Ready:</strong> All services initialized and ready for
          testing. Fill out the forms above and click the buttons to test the
          complete integration.
        </div>
      </div>

      <!-- Results Container -->
      <div
        id="resultsContainer"
        class="results-container"
        style="display: none"
      >
        <h3>üìä Integration Results</h3>
        <div id="resultsContent"></div>
      </div>
    </div>

    <!-- JavaScript -->
    <script type="module">
      // Import all services
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
      import HybridDataService from './src/js/services/hybrid-data-service.js';
      import FirebaseStorageService from './src/js/services/firebase-storage-service.js';

      // Firebase config
      const firebaseConfig = {
        apiKey: 'AIzaSyAwoc3L-43aXyNjNB9ncGbFm7eE-yn5bFA',
        authDomain: 'simulateai-research.firebaseapp.com',
        projectId: 'simulateai-research',
        storageBucket: 'simulateai-research.firebasestorage.app',
        messagingSenderId: '52924445915',
        appId: '1:52924445915:web:dadca1a93bc382403a08fe',
        measurementId: 'G-XW8H062BMV',
      };

      // Initialize Firebase and all services
      const app = initializeApp(firebaseConfig);
      const hybridData = new HybridDataService(app);
      const storageService = new FirebaseStorageService(app, hybridData);

      // Connect services
      hybridData.setStorageService(storageService);
      await hybridData.initializeDataConnect();

      // Make functions globally available
      window.createUserWithProfile = createUserWithProfile;
      window.createBlogWithImages = createBlogWithImages;
      window.createCommentWithAttachments = createCommentWithAttachments;

      // Demo Functions
      async function createUserWithProfile() {
        const name = document.getElementById('userName').value;
        const email = document.getElementById('userEmail').value;
        const researchParticipant =
          document.getElementById('researchParticipant').value === 'true';
        const profileImageFile =
          document.getElementById('userProfileImage').files[0];

        if (!name || !email) {
          showStatus('Please fill in name and email', 'error');
          return;
        }

        try {
          showStatus('Creating user with profile...', 'info');

          const userData = {
            uid: `user_${Date.now()}`,
            displayName: name,
            email: email,
            researchParticipant: researchParticipant,
            flair: { badge: 'üéì', color: '#4a90e2' },
            tier: 1,
            createdAt: new Date(),
          };

          const result = await hybridData.createUserWithProfile(
            userData,
            profileImageFile
          );

          if (result.success) {
            showStatus('‚úÖ User created successfully with profile!', 'success');
            showResults('User Creation', {
              userData,
              firestoreCreated: result.firestore,
              dataConnectCreated: result.dataConnect,
              profileImageUploaded: !!result.profileImage,
              profileImageURL: result.profileImage?.downloadURL,
            });
          } else {
            showStatus(`‚ùå User creation failed: ${result.error}`, 'error');
          }
        } catch (error) {
          showStatus(`‚ùå Error: ${error.message}`, 'error');
        }
      }

      async function createBlogWithImages() {
        const title = document.getElementById('blogTitle').value;
        const content = document.getElementById('blogContent').value;
        const category = document.getElementById('blogCategory').value;
        const imageFiles = Array.from(
          document.getElementById('blogImages').files
        );

        if (!title || !content) {
          showStatus('Please fill in title and content', 'error');
          return;
        }

        try {
          showStatus('Creating blog post with images...', 'info');

          const blogData = {
            id: `blog_${Date.now()}`,
            title: title,
            content: content,
            authorId: `user_${Math.floor(Date.now() / 1000)}`,
            categoryId: category,
            tags: ['AI', 'Ethics', 'Healthcare', 'Research'],
            createdAt: new Date(),
          };

          const result = await hybridData.createBlogPostWithImages(
            blogData,
            imageFiles
          );

          if (result.success) {
            showStatus(
              `‚úÖ Blog post created with ${result.uploadedImages.length} images!`,
              'success'
            );
            showResults('Blog Creation', {
              blogData,
              firestoreCreated: result.firestore,
              dataConnectCreated: result.dataConnect,
              imagesUploaded: result.uploadedImages.length,
              imageDetails: result.uploadedImages,
            });
          } else {
            showStatus(`‚ùå Blog creation failed: ${result.error}`, 'error');
          }
        } catch (error) {
          showStatus(`‚ùå Error: ${error.message}`, 'error');
        }
      }

      async function createCommentWithAttachments() {
        const postId = document.getElementById('forumTitle').value;
        const content = document.getElementById('forumContent').value;
        const commentType = document.getElementById('forumCategory').value;
        const attachmentFiles = Array.from(
          document.getElementById('forumAttachments').files
        );

        if (!postId || !content) {
          showStatus('Please fill in post ID and comment content', 'error');
          return;
        }

        try {
          showStatus('Adding comment with attachments...', 'info');

          const commentData = {
            id: `comment_${Date.now()}`,
            postId: postId,
            content: content,
            authorId: `user_${Math.floor(Date.now() / 1000)}`,
            commentType: commentType,
            parentCommentId: null, // Top-level comment
            createdAt: new Date(),
          };

          const result = await hybridData.createBlogCommentWithAttachments(
            commentData,
            attachmentFiles
          );

          if (result.success) {
            showStatus(
              `‚úÖ Comment added with ${result.uploadedAttachments.length} attachments!`,
              'success'
            );
            showResults('Comment Creation', {
              commentData,
              firestoreCreated: result.firestore,
              dataConnectCreated: result.dataConnect,
              attachmentsUploaded: result.uploadedAttachments.length,
              attachmentDetails: result.uploadedAttachments,
            });
          } else {
            showStatus(`‚ùå Comment creation failed: ${result.error}`, 'error');
          }
        } catch (error) {
          showStatus(`‚ùå Error: ${error.message}`, 'error');
        }
      }

      // UI Helper Functions
      function showStatus(message, type = 'info') {
        const statusContainer = document.getElementById('statusContainer');
        statusContainer.innerHTML = `<div class="status ${type}">${message}</div>`;
      }

      function showResults(operation, data) {
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsContent = document.getElementById('resultsContent');

        resultsContent.innerHTML = `
                <h4>${operation} Results</h4>
                <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto;">
${JSON.stringify(data, null, 2)}
                </pre>
                <hr>
                ${resultsContent.innerHTML}
            `;

        resultsContainer.style.display = 'block';
      }

      // Initialize
      showStatus(
        'üöÄ Complete Firebase integration loaded and ready!',
        'success'
      );

      // Show architecture benefits
      setTimeout(() => {
        showStatus(
          `
                <strong>‚ú® Integration Benefits:</strong><br>
                ‚Ä¢ <strong>Security:</strong> reCAPTCHA v3 + App Check protection<br>
                ‚Ä¢ <strong>Performance:</strong> Intelligent data routing (Firestore + Data Connect)<br>
                ‚Ä¢ <strong>Scalability:</strong> Firebase Storage for files + metadata linking<br>
                ‚Ä¢ <strong>Real-time:</strong> Live updates for blog comments and user activities<br>
                ‚Ä¢ <strong>Analytics:</strong> Built-in performance metrics and insights
            `,
          'info'
        );
      }, 3000);
    </script>
  </body>
</html>
