<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="theme-color" content="#1a73e8" />
    <meta name="color-scheme" content="light" />
    <title>User Profile - SimulateAI</title>
    <meta
      name="description"
      content="Manage your SimulateAI profile, research participation, and community contributions"
    />

    <!-- Same CSS includes as main app -->
    <link rel="stylesheet" href="src/styles/main.css" />
    <link rel="stylesheet" href="src/styles/accessibility.css" />
    <link rel="stylesheet" href="src/styles/simulations.css" />
    <link rel="stylesheet" href="src/styles/layout-components.css" />
    <link rel="stylesheet" href="src/styles/advanced-ui-components.css" />
    <link rel="stylesheet" href="src/styles/enhanced-objects.css" />
    <link rel="stylesheet" href="src/styles/input-utility-components.css" />
    <link rel="stylesheet" href="src/styles/form-input-components.css" />
    <link rel="stylesheet" href="src/styles/notification-toast.css" />
    <link rel="stylesheet" href="src/styles/onboarding-tour.css" />
    <link rel="stylesheet" href="src/styles/radar-chart.css" />
    <link rel="stylesheet" href="src/styles/scenario-modal.css" />
    <link rel="stylesheet" href="src/styles/card-component.css" />
    <link rel="stylesheet" href="src/styles/loader-spinner.css" />
    <link rel="stylesheet" href="src/styles/hero-demo.css" />
    <link rel="stylesheet" href="src/styles/bias-fairness.css" />
    <link rel="stylesheet" href="src/styles/category-grid.css" />
    <link rel="stylesheet" href="src/styles/ethics-analysis.css" />
    <link rel="stylesheet" href="src/styles/layout-fixes.css" />
    <link rel="stylesheet" href="src/styles/ethics-explorer.css" />
    <link rel="stylesheet" href="src/styles/badge-modal.css" />
    <link rel="stylesheet" href="src/styles/community-features.css" />
    <link
      rel="stylesheet"
      href="src/styles/simulation-modal-consolidated.css"
    />

    <!-- Icons and Favicons -->
    <link rel="icon" type="image/svg+xml" href="src/assets/icons/favicon.svg" />
  </head>
  <body>
    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- ARIA live regions for announcements -->
    <div
      id="aria-live-polite"
      aria-live="polite"
      aria-atomic="true"
      class="sr-only"
    ></div>
    <div
      id="aria-live-assertive"
      aria-live="assertive"
      aria-atomic="true"
      class="sr-only"
    ></div>

    <!-- Header (same as main app) -->
    <header class="header" role="banner">
      <div class="header-container">
        <div class="logo">
          <a href="index.html">
            <img
              src="src/assets/icons/logo.svg"
              alt="SimulateAI Educational Platform"
              class="logo-image"
            />
            <h1 class="site-title">SimulateAI</h1>
          </a>
        </div>

        <!-- Mobile hamburger button -->
        <button
          class="nav-toggle"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="main-navigation"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>

        <nav
          class="main-nav"
          role="navigation"
          aria-label="Main navigation"
          id="main-navigation"
        >
          <ul class="nav-list">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li>
              <a href="index.html#categories" class="nav-link">Categories</a>
            </li>
            <li><a href="blog.html" class="nav-link">Blog</a></li>
            <li><a href="forum.html" class="nav-link">Forum</a></li>
            <li>
              <a href="#profile" class="nav-link active" aria-current="page"
                >Profile</a
              >
            </li>
            <!-- User auth buttons will be added by JavaScript -->
          </ul>
        </nav>
      </div>
      <div class="nav-backdrop" aria-hidden="true"></div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content" role="main">
      <!-- Profile Section -->
      <section class="profile-section">
        <div class="container">
          <!-- Auth Required Content -->
          <div
            id="authenticated-content"
            class="auth-required"
            style="display: none"
          >
            <div class="profile-header">
              <div class="profile-avatar">
                <img
                  id="user-avatar"
                  src="/assets/default-avatar.png"
                  alt="User Avatar"
                />
              </div>
              <div class="profile-info">
                <h1 id="user-display-name" class="profile-name">User</h1>
                <p id="user-tier-info" class="profile-tier">Free Member</p>
                <p id="user-join-date" class="profile-date">Joined: --</p>
              </div>
              <div class="profile-actions">
                <button id="edit-profile-btn" class="btn btn-secondary">
                  Edit Profile
                </button>
                <button id="privacy-settings-btn" class="btn btn-outline">
                  Privacy Settings
                </button>
              </div>
            </div>

            <!-- Profile Stats -->
            <div class="profile-stats">
              <div class="stat-card">
                <h3>Scenarios Completed</h3>
                <span id="scenarios-completed" class="stat-number">0</span>
                <p class="stat-description">Interactive simulations finished</p>
              </div>
              <div class="stat-card">
                <h3>Research Contributions</h3>
                <span id="research-contributions" class="stat-number">0</span>
                <p class="stat-description">Responses shared for research</p>
              </div>
              <div class="stat-card">
                <h3>Community Posts</h3>
                <span id="community-posts" class="stat-number">0</span>
                <p class="stat-description">Blog posts and forum discussions</p>
              </div>
              <div class="stat-card">
                <h3>Total Donated</h3>
                <span id="total-donated" class="stat-number">$0</span>
                <p class="stat-description">Supporting AI ethics education</p>
              </div>
            </div>

            <!-- Research Participation Section -->
            <div class="profile-section-card">
              <h2>üî¨ Research Participation</h2>
              <div id="research-participant-status">
                <!-- Content will be populated by JavaScript -->
              </div>
            </div>

            <!-- Donation & Support Section -->
            <div class="profile-section-card">
              <h2>üíñ Support SimulateAI</h2>
              <div class="support-section">
                <p>
                  Help advance AI ethics education through research and
                  development.
                </p>
                <div class="donation-tiers">
                  <div class="tier-card tier-1">
                    <h3>üî¨ Research Contributor</h3>
                    <p class="tier-price">$5+ monthly</p>
                    <ul>
                      <li>Research participation</li>
                      <li>Contributor badge</li>
                      <li>Research insights access</li>
                      <li>Blog posting privileges</li>
                    </ul>
                    <button class="btn btn-primary donate-btn" data-tier="1">
                      Support Research
                    </button>
                  </div>
                  <div class="tier-card tier-2">
                    <h3>‚≠ê Community Supporter</h3>
                    <p class="tier-price">$25+ monthly</p>
                    <ul>
                      <li>All Research Contributor benefits</li>
                      <li>Gold supporter badge</li>
                      <li>Early access to new features</li>
                      <li>Direct feedback channel</li>
                    </ul>
                    <button class="btn btn-primary donate-btn" data-tier="2">
                      Become Supporter
                    </button>
                  </div>
                  <div class="tier-card tier-3">
                    <h3>üëë Education Patron</h3>
                    <p class="tier-price">$100+ monthly</p>
                    <ul>
                      <li>All Supporter benefits</li>
                      <li>Patron crown badge</li>
                      <li>Co-author credit opportunity</li>
                      <li>Advisory board participation</li>
                    </ul>
                    <button class="btn btn-primary donate-btn" data-tier="3">
                      Become Patron
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Account Management -->
            <div class="profile-section-card">
              <h2>‚öôÔ∏è Account Management</h2>
              <div class="account-actions">
                <button id="export-data-btn" class="btn btn-outline">
                  üì• Export My Data
                </button>
                <button id="delete-data-btn" class="btn btn-outline">
                  üóëÔ∏è Delete Research Data
                </button>
                <button id="sign-out-btn" class="btn btn-secondary">
                  üö™ Sign Out
                </button>
              </div>
            </div>
          </div>

          <!-- Login Required Content -->
          <div id="login-required-content" class="login-required">
            <div class="login-prompt-card">
              <div class="login-prompt-content">
                <h1>üë§ User Profile</h1>
                <p>
                  Sign in to access your profile, research participation, and
                  community features.
                </p>

                <div class="login-benefits">
                  <div class="benefit-item">
                    <span class="benefit-icon">üî¨</span>
                    <div>
                      <h3>Join Research Study</h3>
                      <p>
                        Contribute to AI ethics research and get exclusive
                        insights
                      </p>
                    </div>
                  </div>
                  <div class="benefit-item">
                    <span class="benefit-icon">üìù</span>
                    <div>
                      <h3>Write Blog Posts</h3>
                      <p>
                        Share your thoughts and experiences with the community
                      </p>
                    </div>
                  </div>
                  <div class="benefit-item">
                    <span class="benefit-icon">üí¨</span>
                    <div>
                      <h3>Join Discussions</h3>
                      <p>Participate in forum discussions about AI ethics</p>
                    </div>
                  </div>
                </div>

                <button id="login-btn" class="btn btn-primary">
                  üîê Sign In with Google
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer (same as main app) -->
    <footer class="footer" role="contentinfo">
      <div class="footer-content">
        <div class="footer-sections">
          <div class="footer-section">
            <h3>Privacy & Research</h3>
            <p>
              Your privacy is important. All research data is anonymized and
              used solely for educational advancement.
            </p>
          </div>
          <div class="footer-section">
            <h3>Contact</h3>
            <p>
              Questions about your profile or research participation?
              <a href="mailto:support@simulateai.org">Contact us</a>
            </p>
          </div>
        </div>
        <div class="footer-bottom">
          <p>
            &copy; 2025 SimulateAI Educational Platform. Open source AI ethics
            education.
          </p>
        </div>
      </div>
    </footer>

    <!-- Loading indicator -->
    <div id="loading" class="loading" aria-hidden="true" role="status">
      <div class="loading-spinner" aria-hidden="true"></div>
      <p class="loading-text">Loading profile...</p>
    </div>

    <!-- Scripts -->
    <script type="module" src="src/js/services/firebase-service.js"></script>
    <script type="module" src="src/js/services/auth-service.js"></script>
    <script
      type="module"
      src="src/js/components/notification-toast.js"
    ></script>
    <script type="module" src="src/js/components/modal-utility.js"></script>

    <!-- Profile Page Script -->
    <script type="module">
      import AuthService from './src/js/services/auth-service.js';

      class ProfilePage {
        constructor() {
          this.authService = new AuthService();
          this.currentUser = null;
          this.userProfile = null;
        }

        async init() {
          await this.authService.initialize();

          // Set up auth state listener
          this.authService.firebaseService.addAuthStateListener(user => {
            this.handleAuthStateChange(user);
          });

          this.setupEventHandlers();
        }

        async handleAuthStateChange(user) {
          this.currentUser = user;

          if (user) {
            this.userProfile =
              await this.authService.firebaseService.getUserProfile(user.uid);
            this.showAuthenticatedContent();
            this.populateProfileData();
          } else {
            this.showLoginContent();
          }
        }

        showAuthenticatedContent() {
          document.getElementById('authenticated-content').style.display =
            'block';
          document.getElementById('login-required-content').style.display =
            'none';
        }

        showLoginContent() {
          document.getElementById('authenticated-content').style.display =
            'none';
          document.getElementById('login-required-content').style.display =
            'block';
        }

        populateProfileData() {
          if (!this.currentUser || !this.userProfile) return;

          // Basic profile info
          document.getElementById('user-avatar').src =
            this.currentUser.photoURL || '/assets/default-avatar.png';
          document.getElementById('user-display-name').textContent =
            this.userProfile.displayName || 'User';
          document.getElementById('user-tier-info').textContent =
            this.getTierDisplayName();
          document.getElementById('user-join-date').textContent =
            `Joined: ${this.formatDate(this.userProfile.createdAt)}`;

          // Stats
          document.getElementById('scenarios-completed').textContent =
            this.userProfile.scenariosCompleted || 0;
          document.getElementById('research-contributions').textContent =
            this.userProfile.researchResponsesSubmitted || 0;
          document.getElementById('community-posts').textContent = '0'; // TODO: implement
          document.getElementById('total-donated').textContent =
            `$${this.userProfile.totalDonated || 0}`;

          // Research status
          this.updateResearchStatus();
        }

        updateResearchStatus() {
          const statusContainer = document.getElementById(
            'research-participant-status'
          );

          if (this.userProfile.researchParticipant) {
            statusContainer.innerHTML = `
                        <div class="research-status active">
                            <h3>‚úÖ Active Research Participant</h3>
                            <p>Thank you for contributing to AI ethics research! Your responses help advance education.</p>
                            <div class="research-actions">
                                <button id="view-research-data" class="btn btn-secondary">View My Data</button>
                                <button id="export-research-data" class="btn btn-outline">Export Data</button>
                                <button id="opt-out-research" class="btn btn-outline">Opt Out</button>
                            </div>
                        </div>
                    `;
          } else {
            statusContainer.innerHTML = `
                        <div class="research-invitation">
                            <h3>üî¨ Join Our Research Study</h3>
                            <p>Help advance AI ethics education by contributing your simulation responses to our research.</p>
                            <ul>
                                <li>Contribute to academic publications</li>
                                <li>Support evidence-based education</li>
                                <li>Get research contributor badge</li>
                                <li>Access to research insights</li>
                            </ul>
                            <button id="join-research-study" class="btn btn-primary">Join Study ($5+ donation)</button>
                        </div>
                    `;
          }
        }

        getTierDisplayName() {
          const tier = this.userProfile?.tier || 0;
          const flair = this.userProfile?.flair?.badge || '';

          const tierNames = {
            0: 'Free Member',
            1: 'üî¨ Research Contributor',
            2: '‚≠ê Community Supporter',
            3: 'üëë Education Patron',
          };

          return tierNames[tier] || 'Free Member';
        }

        formatDate(timestamp) {
          if (!timestamp) return '--';
          const date = timestamp.toDate
            ? timestamp.toDate()
            : new Date(timestamp);
          return date.toLocaleDateString();
        }

        setupEventHandlers() {
          // Login button
          document
            .getElementById('login-btn')
            ?.addEventListener('click', () => {
              this.authService.showLoginModal();
            });

          // Sign out button
          document
            .getElementById('sign-out-btn')
            ?.addEventListener('click', () => {
              this.authService.signOut();
            });

          // Donation buttons
          document.querySelectorAll('.donate-btn').forEach(btn => {
            btn.addEventListener('click', e => {
              const tier = e.target.dataset.tier;
              this.initiateDonation(tier);
            });
          });
        }

        async initiateDonation(tier) {
          // TODO: Implement Stripe integration
          alert(`Donation for tier ${tier} - Integration coming soon!`);
        }
      }

      // Initialize profile page
      const profilePage = new ProfilePage();
      profilePage.init();
    </script>
  </body>
</html>
