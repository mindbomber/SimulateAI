<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SimulateAI Emulator Connection Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .status-indicator {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
      }
      .connected {
        background: #d4edda;
        color: #155724;
      }
      .disconnected {
        background: #f8d7da;
        color: #721c24;
      }
      .testing {
        background: #fff3cd;
        color: #856404;
      }
      .test-button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        margin: 10px 5px;
      }
      .test-button:hover {
        background: #5a6fd8;
      }
      .log-area {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        font-family: monospace;
        font-size: 14px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
      }
      h1 {
        color: #333;
        text-align: center;
      }
      h2 {
        color: #667eea;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ”¥ SimulateAI Emulator Connection Test</h1>

    <div class="test-card">
      <h2>Emulator Status Check</h2>
      <div id="emulator-status">
        <p>
          ğŸ” Authentication Emulator:
          <span id="auth-status" class="status-indicator testing"
            >Testing...</span
          >
        </p>
        <p>
          ğŸ“Š Firestore Emulator:
          <span id="firestore-status" class="status-indicator testing"
            >Testing...</span
          >
        </p>
        <p>
          ğŸ“ Storage Emulator:
          <span id="storage-status" class="status-indicator testing"
            >Testing...</span
          >
        </p>
        <p>
          âš¡ Functions Emulator:
          <span id="functions-status" class="status-indicator testing"
            >Testing...</span
          >
        </p>
      </div>
    </div>

    <div class="test-card">
      <h2>SimulateAI Feature Tests</h2>
      <button class="test-button" onclick="testAuthentication()">
        ğŸ” Test Authentication
      </button>
      <button class="test-button" onclick="testDataHandler()">
        ğŸ“Š Test Data Handler
      </button>
      <button class="test-button" onclick="testScenarioProgress()">
        ğŸ¯ Test Scenario Progress
      </button>
      <button class="test-button" onclick="testBadgeSystem()">
        ğŸ† Test Badge System
      </button>
      <button class="test-button" onclick="clearTestData()">
        ğŸ§¹ Clear Test Data
      </button>
    </div>

    <div class="test-card">
      <h2>Test Results</h2>
      <div id="test-log" class="log-area">
        Starting emulator connection tests...\n
      </div>
    </div>

    <script type="module">
      let testLog = document.getElementById("test-log");

      function log(message) {
        testLog.textContent += `${new Date().toLocaleTimeString()}: ${message}\n`;
        testLog.scrollTop = testLog.scrollHeight;
      }

      function setStatus(elementId, status, message) {
        const element = document.getElementById(elementId);
        element.className = `status-indicator ${status}`;
        element.textContent = message;
      }

      // Test emulator connections
      async function testEmulatorConnections() {
        log("ğŸ”§ Testing emulator connections...");

        // Test Auth Emulator
        try {
          const authResponse = await fetch(
            "http://127.0.0.1:9099/emulator/v1/projects/simulateai-research",
          );
          if (authResponse.ok) {
            setStatus("auth-status", "connected", "âœ… Connected");
            log("âœ… Auth Emulator: Connected");
          } else {
            throw new Error("Auth emulator not responding");
          }
        } catch (error) {
          setStatus("auth-status", "disconnected", "âŒ Disconnected");
          log("âŒ Auth Emulator: " + error.message);
        }

        // Test Firestore Emulator
        try {
          const firestoreResponse = await fetch("http://127.0.0.1:8080/");
          if (firestoreResponse.ok) {
            setStatus("firestore-status", "connected", "âœ… Connected");
            log("âœ… Firestore Emulator: Connected");
          } else {
            throw new Error("Firestore emulator not responding");
          }
        } catch (error) {
          setStatus("firestore-status", "disconnected", "âŒ Disconnected");
          log("âŒ Firestore Emulator: " + error.message);
        }

        // Test Storage Emulator
        try {
          const storageResponse = await fetch(
            "http://127.0.0.1:9199/storage/v1/b",
          );
          if (storageResponse.ok || storageResponse.status === 404) {
            // 404 is expected for empty bucket
            setStatus("storage-status", "connected", "âœ… Connected");
            log("âœ… Storage Emulator: Connected");
          } else {
            throw new Error("Storage emulator not responding");
          }
        } catch (error) {
          setStatus("storage-status", "disconnected", "âŒ Disconnected");
          log("âŒ Storage Emulator: " + error.message);
        }

        // Test Functions Emulator
        try {
          const functionsResponse = await fetch("http://127.0.0.1:5001/");
          if (functionsResponse.ok || functionsResponse.status === 404) {
            setStatus("functions-status", "connected", "âœ… Connected");
            log("âœ… Functions Emulator: Connected");
          } else {
            throw new Error("Functions emulator not responding");
          }
        } catch (error) {
          setStatus("functions-status", "disconnected", "âŒ Disconnected");
          log("âŒ Functions Emulator: " + error.message);
        }

        log("ğŸ‰ Emulator connection test completed!");
      }

      // Make test functions global
      window.testAuthentication = function () {
        log("ğŸ” Testing authentication flow...");
        log("ğŸ“ Open your SimulateAI app and try signing in");
        log("ğŸ‘€ Check the Auth emulator at http://127.0.0.1:4001/auth");
      };

      window.testDataHandler = function () {
        log("ğŸ“Š Testing DataHandler functionality...");
        log("ğŸ’¾ Testing localStorage and Firebase sync...");

        // Test localStorage
        const testData = { test: true, timestamp: Date.now() };
        localStorage.setItem("simulateai-test", JSON.stringify(testData));
        const retrieved = JSON.parse(localStorage.getItem("simulateai-test"));

        if (retrieved.test) {
          log("âœ… localStorage: Working correctly");
        } else {
          log("âŒ localStorage: Failed test");
        }
      };

      window.testScenarioProgress = function () {
        log("ğŸ¯ Testing scenario progress tracking...");
        log("ğŸ“ Complete a scenario in your app and check Firestore emulator");
        log("ğŸ‘€ Monitor at http://127.0.0.1:4001/firestore");
      };

      window.testBadgeSystem = function () {
        log("ğŸ† Testing badge system...");
        log("ğŸ“ Complete scenarios to earn badges");
        log("ğŸ‘€ Check badge data in Firestore emulator");
      };

      window.clearTestData = function () {
        log("ğŸ§¹ Clearing test data...");
        localStorage.removeItem("simulateai-test");
        log("âœ… Test data cleared");
      };

      // Start tests on page load
      testEmulatorConnections();
    </script>
  </body>
</html>
