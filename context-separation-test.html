<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Radar Chart Context Separation Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="src/css/main.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        max-width: 1400px;
        margin: 0 auto;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .chart-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 30px;
        margin-top: 20px;
      }
      .chart-container {
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        height: 500px;
      }
      .hero-demo-chart {
        border-color: #3b82f6;
        background: linear-gradient(135deg, #f0f9ff, #dbeafe);
      }
      .scenario-chart {
        border-color: #10b981;
        background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      }
      .test-chart {
        border-color: #f59e0b;
        background: linear-gradient(135deg, #fefbf3, #fef3c7);
      }
      .context-info {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 10px;
        font-family: monospace;
        font-size: 12px;
      }
      .demo-controls {
        margin: 10px 0;
      }
      .demo-button {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        margin: 2px;
        font-size: 12px;
      }
      .demo-button:hover {
        background: #2563eb;
      }
      h1 {
        color: #1f2937;
        text-align: center;
      }
      h2 {
        color: #374151;
        margin-bottom: 10px;
      }
      h3 {
        margin-bottom: 10px;
        font-size: 14px;
      }
      .status {
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 4px;
        margin-top: 10px;
        font-size: 12px;
      }
      .status.pass {
        background-color: #d1fae5;
        color: #065f46;
      }
      .status.fail {
        background-color: #fee2e2;
        color: #991b1b;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üéØ Radar Chart Context Separation Test</h1>
      <p>
        <strong>Testing:</strong> Enhanced separation between Hero Demo,
        Scenario Modal, and Test contexts with JSON SSOT integration.
      </p>

      <div class="test-section">
        <h2>Context Separation Test Results</h2>
        <div class="chart-grid">
          <div class="chart-container hero-demo-chart">
            <h3>üèÜ Hero Demo Context</h3>
            <div class="context-info" id="hero-context-info">
              Context: Loading...
            </div>
            <div class="demo-controls">
              <button
                class="demo-button"
                onclick="testHeroDemoPattern('utilitarian')"
              >
                Utilitarian
              </button>
              <button
                class="demo-button"
                onclick="testHeroDemoPattern('deontological')"
              >
                Rights-Based
              </button>
              <button
                class="demo-button"
                onclick="testHeroDemoPattern('virtue')"
              >
                Virtue Ethics
              </button>
              <button
                class="demo-button"
                onclick="testHeroDemoPattern('balanced')"
              >
                Balanced
              </button>
              <button class="demo-button" onclick="resetHeroDemo()">
                Reset
              </button>
            </div>
            <div id="hero-demo-chart" style="height: 350px"></div>
            <div id="hero-status" class="status">Testing...</div>
          </div>

          <div class="chart-container scenario-chart">
            <h3>üìä Scenario Modal Context</h3>
            <div class="context-info" id="scenario-context-info">
              Context: Loading...
            </div>
            <div class="demo-controls">
              <button
                class="demo-button"
                onclick="testScenarioUpdate('random')"
              >
                Random Update
              </button>
              <button
                class="demo-button"
                onclick="testScenarioUpdate('positive')"
              >
                Positive Impact
              </button>
              <button
                class="demo-button"
                onclick="testScenarioUpdate('negative')"
              >
                Negative Impact
              </button>
              <button class="demo-button" onclick="resetScenarioChart()">
                Reset
              </button>
            </div>
            <div id="scenario-chart" style="height: 350px"></div>
            <div id="scenario-status" class="status">Testing...</div>
          </div>

          <div class="chart-container test-chart">
            <h3>üß™ Test/Debug Context</h3>
            <div class="context-info" id="test-context-info">
              Context: Loading...
            </div>
            <div class="demo-controls">
              <button class="demo-button" onclick="testValidation('equal')">
                Equal Values
              </button>
              <button class="demo-button" onclick="testValidation('mixed')">
                Mixed Values
              </button>
              <button class="demo-button" onclick="testValidation('extreme')">
                Extreme Values
              </button>
              <button class="demo-button" onclick="resetTestChart()">
                Reset
              </button>
            </div>
            <div id="test-chart" style="height: 350px"></div>
            <div id="test-status" class="status">Testing...</div>
          </div>
        </div>
      </div>

      <div class="test-section">
        <h2>üéØ Expected Context Behaviors</h2>
        <div
          style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px"
        >
          <div>
            <h3>üèÜ Hero Demo</h3>
            <ul style="font-size: 12px">
              <li>‚úÖ Context: 'hero-demo'</li>
              <li>‚úÖ Classes: radar-demo-container, hero-radar-chart</li>
              <li>‚úÖ JSON SSOT demo patterns integration</li>
              <li>‚úÖ Interactive ethics pattern simulation</li>
              <li>‚úÖ Pure default values (all 3s) for visibility</li>
              <li>‚úÖ Optimized for homepage demonstrations</li>
            </ul>
          </div>
          <div>
            <h3>üìä Scenario Modal</h3>
            <ul style="font-size: 12px">
              <li>‚úÖ Context: 'scenario'</li>
              <li>‚úÖ Classes: radar-chart-container, scenario-radar-chart</li>
              <li>‚úÖ Real-time ethical decision tracking</li>
              <li>‚úÖ Minimal variation (3,3,3,3,3,3,3,4) for visibility</li>
              <li>‚úÖ Consistent default initialization</li>
              <li>‚úÖ Enterprise telemetry with context</li>
            </ul>
          </div>
          <div>
            <h3>üß™ Test/Debug</h3>
            <ul style="font-size: 12px">
              <li>‚úÖ Context: 'test'</li>
              <li>‚úÖ Classes: radar-chart-container, test-radar-chart</li>
              <li>‚úÖ Predictable behavior for validation</li>
              <li>‚úÖ Pure default values for consistent testing</li>
              <li>‚úÖ Debug-optimized configuration</li>
              <li>‚úÖ Context-aware error handling</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { RadarChart } from "./src/js/components/radar-chart.js";

      // Global chart instances for testing
      window.heroChart = null;
      window.scenarioChart = null;
      window.testChart = null;

      // Test functions for hero demo patterns
      window.testHeroDemoPattern = function (pattern) {
        if (window.heroChart) {
          const success = window.heroChart.applyDemoPattern(pattern);
          updateContextInfo(
            "hero",
            `Applied pattern: ${pattern} (${success ? "success" : "failed"})`,
          );
        }
      };

      window.resetHeroDemo = function () {
        if (window.heroChart) {
          window.heroChart.resetScores();
          updateContextInfo("hero", "Reset to default scores");
        }
      };

      // Test functions for scenario chart
      window.testScenarioUpdate = function (type) {
        if (!window.scenarioChart) return;

        let updates = {};
        const axes = [
          "fairness",
          "sustainability",
          "autonomy",
          "beneficence",
          "transparency",
          "accountability",
          "privacy",
          "proportionality",
        ];

        switch (type) {
          case "random":
            axes.forEach((axis) => {
              updates[axis] = Math.floor(Math.random() * 5) + 1;
            });
            break;
          case "positive":
            axes.forEach((axis) => {
              updates[axis] = 4 + Math.random(); // 4-5 range
            });
            break;
          case "negative":
            axes.forEach((axis) => {
              updates[axis] = 1 + Math.random(); // 1-2 range
            });
            break;
        }

        window.scenarioChart.updateScores(updates);
        updateContextInfo("scenario", `Applied ${type} updates`);
      };

      window.resetScenarioChart = function () {
        if (window.scenarioChart) {
          window.scenarioChart.resetScores();
          updateContextInfo("scenario", "Reset to default scores");
        }
      };

      // Test functions for test chart
      window.testValidation = function (type) {
        if (!window.testChart) return;

        let updates = {};
        const axes = [
          "fairness",
          "sustainability",
          "autonomy",
          "beneficence",
          "transparency",
          "accountability",
          "privacy",
          "proportionality",
        ];

        switch (type) {
          case "equal":
            axes.forEach((axis) => {
              updates[axis] = 3; // All equal for visibility testing
            });
            break;
          case "mixed":
            updates = {
              fairness: 2,
              sustainability: 4,
              autonomy: 1,
              beneficence: 5,
              transparency: 3,
              accountability: 3,
              privacy: 2,
              proportionality: 4,
            };
            break;
          case "extreme":
            updates = {
              fairness: 1,
              sustainability: 5,
              autonomy: 1,
              beneficence: 5,
              transparency: 1,
              accountability: 5,
              privacy: 1,
              proportionality: 5,
            };
            break;
        }

        window.testChart.updateScores(updates);
        updateContextInfo("test", `Applied ${type} test pattern`);
      };

      window.resetTestChart = function () {
        if (window.testChart) {
          window.testChart.resetScores();
          updateContextInfo("test", "Reset to default scores");
        }
      };

      // Helper function to update context info
      function updateContextInfo(chartType, action) {
        const chart = window[chartType + "Chart"];
        if (!chart) return;

        const info = document.getElementById(chartType + "-context-info");
        if (info) {
          info.textContent = `Context: ${chart.options.context} | ${action} | Instance: ${chart.instanceId}`;
        }
      }

      async function createContextSeparationTests() {
        console.log("Creating context separation test charts...");

        try {
          // Create Hero Demo Chart
          console.log("Creating hero demo chart...");
          window.heroChart = new RadarChart("hero-demo-chart", {
            width: 350,
            height: 350,
            title: "Hero Demo Chart",
            isDemo: true,
            context: "hero-demo", // Explicit context
          });

          await window.heroChart.initializeChart();
          updateContextInfo("hero", "Initialized");

          // Create Scenario Chart
          console.log("Creating scenario chart...");
          window.scenarioChart = new RadarChart("scenario-chart", {
            width: 350,
            height: 350,
            title: "Scenario Modal Chart",
            isDemo: false,
            realTime: true,
            context: "scenario", // Explicit context
          });

          await window.scenarioChart.initializeChart();
          updateContextInfo("scenario", "Initialized");

          // Create Test Chart
          console.log("Creating test chart...");
          window.testChart = new RadarChart("test-chart", {
            width: 350,
            height: 350,
            title: "Test Chart",
            isDemo: false,
            realTime: false,
            context: "test", // Explicit context
          });

          await window.testChart.initializeChart();
          updateContextInfo("test", "Initialized");

          // Validate context separation
          validateContextSeparation();

          console.log(
            "All context separation test charts created successfully",
          );
        } catch (error) {
          console.error(
            "Failed to create context separation test charts:",
            error,
          );
          ["hero", "scenario", "test"].forEach((type) => {
            const statusElement = document.getElementById(type + "-status");
            if (statusElement) {
              statusElement.textContent = "ERROR: " + error.message;
              statusElement.className = "status fail";
            }
          });
        }
      }

      function validateContextSeparation() {
        const charts = [
          {
            chart: window.heroChart,
            type: "hero",
            expectedContext: "hero-demo",
          },
          {
            chart: window.scenarioChart,
            type: "scenario",
            expectedContext: "scenario",
          },
          { chart: window.testChart, type: "test", expectedContext: "test" },
        ];

        charts.forEach(({ chart, type, expectedContext }) => {
          const statusElement = document.getElementById(type + "-status");
          if (!statusElement) return;

          if (!chart) {
            statusElement.textContent = "FAIL: Chart not created";
            statusElement.className = "status fail";
            return;
          }

          const contextMatch = chart.options.context === expectedContext;
          const hasCorrectClasses = chart.container.classList.contains(
            `${type === "hero" ? "hero" : type === "test" ? "test" : "scenario"}-radar-chart`,
          );
          const hasInstanceId = !!chart.instanceId;
          const isInitialized = chart.isInitialized;

          if (
            contextMatch &&
            hasCorrectClasses &&
            hasInstanceId &&
            isInitialized
          ) {
            statusElement.textContent = `PASS: Context '${chart.options.context}' correctly configured`;
            statusElement.className = "status pass";
          } else {
            statusElement.textContent = `FAIL: Context issues - ${chart.options.context}`;
            statusElement.className = "status fail";
          }
        });
      }

      // Create charts when page loads
      document.addEventListener(
        "DOMContentLoaded",
        createContextSeparationTests,
      );
    </script>
  </body>
</html>
