<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Classroom Creation Test</title>
    <link rel="stylesheet" href="./src/styles/main.css" />
    <style>
      .test-container {
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        font-weight: bold;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .test-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        font-size: 16px;
      }
      .test-button:hover {
        background: #0056b3;
      }
      .test-button:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üè´ Classroom Creation Test</h1>
      <p>
        This page tests the complete classroom creation flow with the new
        fallback system.
      </p>

      <div id="status-display"></div>

      <div class="controls">
        <button
          class="test-button"
          onclick="testClassroomCreation()"
          id="test-btn"
        >
          üß™ Test Classroom Creation
        </button>
        <button
          class="test-button"
          onclick="openCreateClassroomModal()"
          id="modal-btn"
        >
          üè´ Open Classroom Modal
        </button>
      </div>

      <h2>Test Results:</h2>
      <div id="test-results"></div>
    </div>

    <script type="module">
      import DataHandler from "./src/js/core/data-handler.js";
      import FirebaseService from "./src/js/services/firebase-service.js";
      import ClassroomIntegrationManager from "./src/js/services/classroom-integration-manager.js";

      let dataHandler, firebaseService, classroomManager;

      window.showStatus = function (message, type = "info") {
        const statusDiv = document.getElementById("status-display");
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
      };

      window.addResult = function (message, type = "info") {
        const resultsDiv = document.getElementById("test-results");
        resultsDiv.innerHTML += `<div class="status ${type}">${message}</div>`;
      };

      // Initialize services
      async function initializeServices() {
        try {
          showStatus("Initializing services...", "info");

          // Initialize DataHandler
          dataHandler = new DataHandler();
          await dataHandler.initialize();
          addResult("‚úÖ DataHandler initialized", "success");

          // Initialize FirebaseService
          firebaseService = new FirebaseService();
          await firebaseService.initialize();
          addResult("‚úÖ FirebaseService initialized", "success");

          // Initialize ClassroomIntegrationManager
          classroomManager = new ClassroomIntegrationManager(
            dataHandler,
            firebaseService,
          );
          await classroomManager.initialize();
          addResult("‚úÖ ClassroomIntegrationManager initialized", "success");

          showStatus("All services initialized successfully!", "success");

          // Enable buttons
          document.getElementById("test-btn").disabled = false;
          document.getElementById("modal-btn").disabled = false;
        } catch (error) {
          showStatus(`Initialization failed: ${error.message}`, "error");
          addResult(`‚ùå Initialization error: ${error.message}`, "error");
          console.error("Initialization error:", error);
        }
      }

      window.testClassroomCreation = async function () {
        try {
          showStatus("Testing classroom creation...", "info");

          // Test the teacher modals directly
          const teacherModals = classroomManager.teacherModals;

          // Test initialization
          await teacherModals.initialize(true); // Guest mode
          addResult("‚úÖ Teacher modals initialized in guest mode", "success");

          // Test classroom service creation
          const testClassroomData = {
            classroomName: "Test Classroom " + Date.now(),
            instructorId: "test_instructor_123",
            instructorName: "Test Instructor",
            selectedScenarios: [
              {
                scenarioId: "test_scenario_1",
                title: "Test Scenario",
                category: "Ethics",
                order: 0,
              },
            ],
          };

          showStatus("Creating test classroom...", "info");
          const result =
            await teacherModals.classroomService.createClassroom(
              testClassroomData,
            );

          addResult(`‚úÖ Classroom created successfully!`, "success");
          addResult(`üìã Classroom Code: ${result.classroomCode}`, "info");
          addResult(`üè´ Classroom Name: ${result.classroomName}`, "info");
          addResult(`üë®‚Äçüè´ Instructor: ${result.instructorName}`, "info");
          addResult(`üìö Scenarios: ${result.selectedScenarios.length}`, "info");

          showStatus(
            `Classroom created! Code: ${result.classroomCode}`,
            "success",
          );
        } catch (error) {
          showStatus(`Test failed: ${error.message}`, "error");
          addResult(`‚ùå Test failed: ${error.message}`, "error");
          console.error("Test error:", error);
        }
      };

      window.openCreateClassroomModal = async function () {
        try {
          showStatus("Opening classroom creation modal...", "info");

          if (!classroomManager) {
            throw new Error("Services not initialized");
          }

          // Show the create classroom modal
          await classroomManager.teacherModals.showCreateClassroomModal(true);
          addResult("‚úÖ Classroom modal opened", "success");
          showStatus(
            "Classroom modal opened - you can now test the form!",
            "success",
          );
        } catch (error) {
          showStatus(`Failed to open modal: ${error.message}`, "error");
          addResult(`‚ùå Modal error: ${error.message}`, "error");
          console.error("Modal error:", error);
        }
      };

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", () => {
        // Disable buttons initially
        document.getElementById("test-btn").disabled = true;
        document.getElementById("modal-btn").disabled = true;

        // Initialize services
        initializeServices();
      });
    </script>
  </body>
</html>
